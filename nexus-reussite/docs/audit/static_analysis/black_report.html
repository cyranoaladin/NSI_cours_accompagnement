
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Static Analysis Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; margin: -30px -30px 30px -30px; border-radius: 8px 8px 0 0; }
        .success { color: #27ae60; font-weight: bold; }
        .error { color: #e74c3c; font-weight: bold; }
        .warning { color: #f39c12; font-weight: bold; }
        .info { color: #3498db; font-weight: bold; }
        .code-block { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 10px 0; font-family: 'Courier New', monospace; }
        .section { margin: 20px 0; padding: 15px; border-left: 4px solid #3498db; background: #f8f9fa; }
        .metric { display: inline-block; margin: 10px; padding: 10px 15px; background: #ecf0f1; border-radius: 5px; }
        .status-success { background: #d5f4e6; border-left-color: #27ae60; }
        .status-error { background: #fdf2f2; border-left-color: #e74c3c; }
        .status-warning { background: #fef9e7; border-left-color: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Black Analysis Report</h1>
            <p>Generated on 2025-07-24 21:54:23</p>
        </div>
        
        <div class="section status-error">
            <h2>üìã Execution Summary</h2>
            <div class="metric">
                <strong>Status:</strong> 
                <span class="error">
                    ‚ùå Failed
                </span>
            </div>
            <div class="metric"><strong>Return Code:</strong> 1</div>
            <div class="metric"><strong>Command:</strong> <code>black --check --diff backend/src</code></div>
        </div>
        
        <div class="section">
            <h2>üì§ Standard Output</h2>
            <div class="code-block">
                <pre>--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database.py	2025-07-24 07:24:17.020976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database.py	2025-07-24 20:54:01.918789+00:00
@@ -5,10 +5,11 @@
 
 from flask_sqlalchemy import SQLAlchemy
 
 # Instance SQLAlchemy centralis√©e
 db = SQLAlchemy()
+
 
 def init_database(app):
     &quot;&quot;&quot;
     Initialise la base de donn√©es avec l&#x27;application Flask
 
@@ -22,6 +23,7 @@
 
     with app.app_context():
         db.create_all()
         print(&quot;‚úÖ Tables de base de donn√©es cr√©√©es avec succ√®s&quot;)
 
+
 __all__ = [&quot;db&quot;, &quot;init_database&quot;]
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/__init__.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/__init__.py	2025-07-24 20:54:01.919103+00:00
@@ -13,21 +13,15 @@
 # from .openai_routes import openai_bp
 # from .video_conference_routes import video_bp
 # from .websocket_routes import websocket_bp
 
 # Liste des blueprints √† enregistrer
-BLUEPRINTS = [
-    user_bp,
-    students_bp,
-    formulas_bp,
-    aria_bp,
-    documents_bp
-]
+BLUEPRINTS = [user_bp, students_bp, formulas_bp, aria_bp, documents_bp]
 
 __all__ = [
     &quot;BLUEPRINTS&quot;,
     &quot;user_bp&quot;,
     &quot;students_bp&quot;,
     &quot;formulas_bp&quot;,
     &quot;aria_bp&quot;,
-    &quot;documents_bp&quot;
+    &quot;documents_bp&quot;,
 ]
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/__init__.py	2025-07-24 07:24:17.020976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/__init__.py	2025-07-24 20:54:01.918292+00:00
@@ -7,17 +7,20 @@
 __author__ = &quot;Nexus R√©ussite Team&quot;
 
 # Imports principaux pour faciliter l&#x27;utilisation - imports retard√©s pour √©viter les probl√®mes circulaires
 from .config import Config, DevelopmentConfig, TestingConfig, ProductionConfig
 
+
 def get_app():
     &quot;&quot;&quot;Factory function pour cr√©er l&#x27;application&quot;&quot;&quot;
     from .main_production import create_app
+
     return create_app()
+
 
 __all__ = [
     &quot;Config&quot;,
     &quot;DevelopmentConfig&quot;,
     &quot;TestingConfig&quot;,
     &quot;ProductionConfig&quot;,
-    &quot;get_app&quot;
-]
\ No newline at end of file
+    &quot;get_app&quot;,
+]
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/__init__.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/__init__.py	2025-07-24 20:54:01.920957+00:00
@@ -4,11 +4,17 @@
 &quot;&quot;&quot;
 
 from .user import User, UserRole
 from .student import Student, LearningSession, Assessment, ARIAInteraction
 from .formulas import Formula, Enrollment, Teacher, Group, Booking
-from .content_system import ContentBrick, DocumentRequest, GeneratedDocument, BrickType, Subject
+from .content_system import (
+    ContentBrick,
+    DocumentRequest,
+    GeneratedDocument,
+    BrickType,
+    Subject,
+)
 
 # Exports principaux
 __all__ = [
     &quot;User&quot;,
     &quot;UserRole&quot;,
@@ -23,7 +29,7 @@
     &quot;Booking&quot;,
     &quot;ContentBrick&quot;,
     &quot;DocumentRequest&quot;,
     &quot;GeneratedDocument&quot;,
     &quot;BrickType&quot;,
-    &quot;Subject&quot;
+    &quot;Subject&quot;,
 ]
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/config.py	2025-07-24 08:52:43.275310+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/config.py	2025-07-24 20:54:01.954557+00:00
@@ -1,63 +1,71 @@
 &quot;&quot;&quot;
 Configuration centralis√©e pour Nexus R√©ussite Backend
 Version am√©lior√©e et production-ready
 &quot;&quot;&quot;
+
 import os
 from typing import Dict, List, Any
 
 try:
     from dotenv import load_dotenv
+
     load_dotenv()
 except ImportError:
     pass
 
 
 class Config:
     &quot;&quot;&quot;Configuration de base&quot;&quot;&quot;
-    SECRET_KEY = os.environ.get(&#x27;SECRET_KEY&#x27;) or &#x27;nexus-reussite-secret-key-2024&#x27;
-    SQLALCHEMY_DATABASE_URI = os.environ.get(&#x27;DATABASE_URL&#x27;) or &#x27;sqlite:///nexus_reussite.db&#x27;
+
+    SECRET_KEY = os.environ.get(&quot;SECRET_KEY&quot;) or &quot;nexus-reussite-secret-key-2024&quot;
+    SQLALCHEMY_DATABASE_URI = (
+        os.environ.get(&quot;DATABASE_URL&quot;) or &quot;sqlite:///nexus_reussite.db&quot;
+    )
     SQLALCHEMY_TRACK_MODIFICATIONS = False
 
 
 class DevelopmentConfig(Config):
     &quot;&quot;&quot;Configuration pour le d√©veloppement&quot;&quot;&quot;
+
     DEBUG = True
 
 
 class TestingConfig(Config):
     &quot;&quot;&quot;Configuration pour les tests&quot;&quot;&quot;
+
     TESTING = True
-    SQLALCHEMY_DATABASE_URI = &#x27;sqlite:///:memory:&#x27;
+    SQLALCHEMY_DATABASE_URI = &quot;sqlite:///:memory:&quot;
 
 
 class ProductionConfig(Config):
     &quot;&quot;&quot;Configuration pour la production&quot;&quot;&quot;
+
     DEBUG = False
 
 
 # Configuration mapping
 config = {
-    &#x27;development&#x27;: DevelopmentConfig,
-    &#x27;testing&#x27;: TestingConfig,
-    &#x27;production&#x27;: ProductionConfig,
-    &#x27;default&#x27;: DevelopmentConfig
+    &quot;development&quot;: DevelopmentConfig,
+    &quot;testing&quot;: TestingConfig,
+    &quot;production&quot;: ProductionConfig,
+    &quot;default&quot;: DevelopmentConfig,
 }
 
 
 def get_config(config_name=None):
     &quot;&quot;&quot;R√©cup√®re la configuration selon l&#x27;environnement&quot;&quot;&quot;
     if config_name is None:
-        config_name = os.environ.get(&#x27;FLASK_ENV&#x27;, &#x27;default&#x27;)
+        config_name = os.environ.get(&quot;FLASK_ENV&quot;, &quot;default&quot;)
 
-    return config.get(config_name, config[&#x27;default&#x27;])
+    return config.get(config_name, config[&quot;default&quot;])
 
 
 def validate_config(config_obj) -&gt; Dict[str, Any]:
     &quot;&quot;&quot;Valide la configuration et retourne un rapport d√©taill√©&quot;&quot;&quot;
-    required_vars = [&#x27;SECRET_KEY&#x27;, &#x27;SQLALCHEMY_DATABASE_URI&#x27;]
-    optional_vars = [&#x27;OPENAI_API_KEY&#x27;, &#x27;MAIL_USERNAME&#x27;, &#x27;MAIL_PASSWORD&#x27;]
+    required_vars = [&quot;SECRET_KEY&quot;, &quot;SQLALCHEMY_DATABASE_URI&quot;]
+    optional_vars = [&quot;OPENAI_API_KEY&quot;, &quot;MAIL_USERNAME&quot;, &quot;MAIL_PASSWORD&quot;]
 
     issues: List[str] = []
     warnings: List[str] = []
 
     # V√©rification des variables requises
@@ -70,16 +78,12 @@
         if not hasattr(config_obj, var) or not getattr(config_obj, var):
             warnings.append(f&quot;Variable optionnelle manquante: {var}&quot;)
 
     # D√©termination du statut
     if issues:
-        status = &#x27;critical&#x27;
+        status = &quot;critical&quot;
     elif warnings:
-        status = &#x27;warning&#x27;
+        status = &quot;warning&quot;
     else:
-        status = &#x27;ok&#x27;
+        status = &quot;ok&quot;
 
-    return {
-        &#x27;status&#x27;: status,
-        &#x27;issues&#x27;: issues,
-        &#x27;warnings&#x27;: warnings
-    }
+    return {&quot;status&quot;: status, &quot;issues&quot;: issues, &quot;warnings&quot;: warnings}
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/user.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/user.py	2025-07-24 20:54:01.963931+00:00
@@ -1,40 +1,45 @@
 from flask import Blueprint, jsonify, request
 from ..models.user import User
 from ..database import db
 
-user_bp = Blueprint(&#x27;user&#x27;, __name__)
+user_bp = Blueprint(&quot;user&quot;, __name__)
 
-@user_bp.route(&#x27;/users&#x27;, methods=[&#x27;GET&#x27;])
+
+@user_bp.route(&quot;/users&quot;, methods=[&quot;GET&quot;])
 def get_users():
     users = User.query.all()
     return jsonify([user.to_dict() for user in users])
 
-@user_bp.route(&#x27;/users&#x27;, methods=[&#x27;POST&#x27;])
+
+@user_bp.route(&quot;/users&quot;, methods=[&quot;POST&quot;])
 def create_user():
 
     data = request.json
-    user = User(username=data[&#x27;username&#x27;], email=data[&#x27;email&#x27;])
+    user = User(username=data[&quot;username&quot;], email=data[&quot;email&quot;])
     db.session.add(user)
     db.session.commit()
     return jsonify(user.to_dict()), 201
 
-@user_bp.route(&#x27;/users/&lt;int:user_id&gt;&#x27;, methods=[&#x27;GET&#x27;])
+
+@user_bp.route(&quot;/users/&lt;int:user_id&gt;&quot;, methods=[&quot;GET&quot;])
 def get_user(user_id):
     user = User.query.get_or_404(user_id)
     return jsonify(user.to_dict())
 
-@user_bp.route(&#x27;/users/&lt;int:user_id&gt;&#x27;, methods=[&#x27;PUT&#x27;])
+
+@user_bp.route(&quot;/users/&lt;int:user_id&gt;&quot;, methods=[&quot;PUT&quot;])
 def update_user(user_id):
     user = User.query.get_or_404(user_id)
     data = request.json
-    user.username = data.get(&#x27;username&#x27;, user.username)
-    user.email = data.get(&#x27;email&#x27;, user.email)
+    user.username = data.get(&quot;username&quot;, user.username)
+    user.email = data.get(&quot;email&quot;, user.email)
     db.session.commit()
     return jsonify(user.to_dict())
 
-@user_bp.route(&#x27;/users/&lt;int:user_id&gt;&#x27;, methods=[&#x27;DELETE&#x27;])
+
+@user_bp.route(&quot;/users/&lt;int:user_id&gt;&quot;, methods=[&quot;DELETE&quot;])
 def delete_user(user_id):
     user = User.query.get_or_404(user_id)
     db.session.delete(user)
     db.session.commit()
-    return &#x27;&#x27;, 204
+    return &quot;&quot;, 204
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/__init__.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/__init__.py	2025-07-24 20:54:01.979098+00:00
@@ -14,7 +14,7 @@
     &quot;ARIAService&quot;,
     &quot;ContentAssemblyEngine&quot;,
     &quot;NexusPDFGenerator&quot;,
     &quot;DocumentDatabase&quot;,
     &quot;ParentDashboardService&quot;,
-    &quot;ContentBankService&quot;
+    &quot;ContentBankService&quot;,
 ]
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/content_system.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/content_system.py	2025-07-24 20:54:02.056072+00:00
@@ -7,12 +7,14 @@
 from datetime import datetime
 from typing import List, Optional, Dict, Any
 from dataclasses import dataclass
 import json
 
+
 class BrickType(Enum):
     &quot;&quot;&quot;Types de briques de contenu disponibles&quot;&quot;&quot;
+
     DEFINITION = &quot;definition&quot;
     THEOREME = &quot;theoreme&quot;
     PROPRIETE = &quot;propriete&quot;
     EXEMPLE = &quot;exemple&quot;
     EXERCICE = &quot;exercice&quot;
@@ -20,55 +22,63 @@
     CONSEIL_METHODE = &quot;conseil_methode&quot;
     HISTOIRE_SCIENCES = &quot;histoire_sciences&quot;
     SCHEMA = &quot;schema&quot;
     FORMULE = &quot;formule&quot;
 
+
 class Subject(Enum):
     &quot;&quot;&quot;Mati√®res disponibles&quot;&quot;&quot;
+
     MATHEMATIQUES = &quot;mathematiques&quot;
     NSI = &quot;nsi&quot;
     PHYSIQUE = &quot;physique&quot;
     CHIMIE = &quot;chimie&quot;
     FRANCAIS = &quot;francais&quot;
     PHILOSOPHIE = &quot;philosophie&quot;
     HISTOIRE_GEO = &quot;histoire_geo&quot;
     SES = &quot;ses&quot;
 
+
 class TargetProfile(Enum):
     &quot;&quot;&quot;Profils d&#x27;√©l√®ves cibl√©s&quot;&quot;&quot;
-    STRUGGLING = &quot;struggling&quot;      # En difficult√©
-    AVERAGE = &quot;average&quot;           # Niveau moyen
-    EXCELLENCE = &quot;excellence&quot;     # Visant l&#x27;excellence
-    REMEDIATION = &quot;remediation&quot;   # Rem√©diation sp√©cifique
+
+    STRUGGLING = &quot;struggling&quot;  # En difficult√©
+    AVERAGE = &quot;average&quot;  # Niveau moyen
+    EXCELLENCE = &quot;excellence&quot;  # Visant l&#x27;excellence
+    REMEDIATION = &quot;remediation&quot;  # Rem√©diation sp√©cifique
+
 
 class LearningStep(Enum):
     &quot;&quot;&quot;√âtapes d&#x27;apprentissage&quot;&quot;&quot;
-    DISCOVERY = &quot;discovery&quot;       # D√©couverte du concept
-    TRAINING = &quot;training&quot;         # Entra√Ænement
-    DEEPENING = &quot;deepening&quot;       # Approfondissement
-    REVISION = &quot;revision&quot;         # R√©vision
-    EVALUATION = &quot;evaluation&quot;     # √âvaluation
+
+    DISCOVERY = &quot;discovery&quot;  # D√©couverte du concept
+    TRAINING = &quot;training&quot;  # Entra√Ænement
+    DEEPENING = &quot;deepening&quot;  # Approfondissement
+    REVISION = &quot;revision&quot;  # R√©vision
+    EVALUATION = &quot;evaluation&quot;  # √âvaluation
+
 
 @dataclass
 class ContentBrick:
     &quot;&quot;&quot;Mod√®le d&#x27;une brique de contenu&quot;&quot;&quot;
+
     id: str
-    content: str                  # Contenu en Markdown/HTML
+    content: str  # Contenu en Markdown/HTML
     type: BrickType
     title: str
 
     # M√©tadonn√©es pour la personnalisation
     subject: Subject
-    chapter: str                  # Ex: &quot;Suites num√©riques&quot;, &quot;Graphes&quot;
-    difficulty: int               # De 1 (tr√®s facile) √† 5 (expert)
+    chapter: str  # Ex: &quot;Suites num√©riques&quot;, &quot;Graphes&quot;
+    difficulty: int  # De 1 (tr√®s facile) √† 5 (expert)
     target_profiles: List[TargetProfile]
     learning_steps: List[LearningStep]
 
     # M√©tadonn√©es additionnelles
-    tags: List[str]              # Tags libres pour recherche
-    prerequisites: List[str]      # IDs des briques pr√©requises
-    duration_minutes: int         # Temps estim√© de travail
+    tags: List[str]  # Tags libres pour recherche
+    prerequisites: List[str]  # IDs des briques pr√©requises
+    duration_minutes: int  # Temps estim√© de travail
 
     # Informations de cr√©ation
     created_at: datetime
     updated_at: datetime
     author_id: str
@@ -79,135 +89,138 @@
     average_rating: float = 0.0
 
     def to_dict(self) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Conversion en dictionnaire pour stockage JSON&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;content&#x27;: self.content,
-            &#x27;type&#x27;: self.type.value,
-            &#x27;title&#x27;: self.title,
-            &#x27;subject&#x27;: self.subject.value,
-            &#x27;chapter&#x27;: self.chapter,
-            &#x27;difficulty&#x27;: self.difficulty,
-            &#x27;target_profiles&#x27;: [p.value for p in self.target_profiles],
-            &#x27;learning_steps&#x27;: [s.value for s in self.learning_steps],
-            &#x27;tags&#x27;: self.tags,
-            &#x27;prerequisites&#x27;: self.prerequisites,
-            &#x27;duration_minutes&#x27;: self.duration_minutes,
-            &#x27;created_at&#x27;: self.created_at.isoformat(),
-            &#x27;updated_at&#x27;: self.updated_at.isoformat(),
-            &#x27;author_id&#x27;: self.author_id,
-            &#x27;author_name&#x27;: self.author_name,
-            &#x27;usage_count&#x27;: self.usage_count,
-            &#x27;average_rating&#x27;: self.average_rating
+            &quot;id&quot;: self.id,
+            &quot;content&quot;: self.content,
+            &quot;type&quot;: self.type.value,
+            &quot;title&quot;: self.title,
+            &quot;subject&quot;: self.subject.value,
+            &quot;chapter&quot;: self.chapter,
+            &quot;difficulty&quot;: self.difficulty,
+            &quot;target_profiles&quot;: [p.value for p in self.target_profiles],
+            &quot;learning_steps&quot;: [s.value for s in self.learning_steps],
+            &quot;tags&quot;: self.tags,
+            &quot;prerequisites&quot;: self.prerequisites,
+            &quot;duration_minutes&quot;: self.duration_minutes,
+            &quot;created_at&quot;: self.created_at.isoformat(),
+            &quot;updated_at&quot;: self.updated_at.isoformat(),
+            &quot;author_id&quot;: self.author_id,
+            &quot;author_name&quot;: self.author_name,
+            &quot;usage_count&quot;: self.usage_count,
+            &quot;average_rating&quot;: self.average_rating,
         }
 
     @classmethod
-    def from_dict(cls, data: Dict[str, Any]) -&gt; &#x27;ContentBrick&#x27;:
+    def from_dict(cls, data: Dict[str, Any]) -&gt; &quot;ContentBrick&quot;:
         &quot;&quot;&quot;Cr√©ation depuis un dictionnaire&quot;&quot;&quot;
         return cls(
-            id=data[&#x27;id&#x27;],
-            content=data[&#x27;content&#x27;],
-            type=BrickType(data[&#x27;type&#x27;]),
-            title=data[&#x27;title&#x27;],
-            subject=Subject(data[&#x27;subject&#x27;]),
-            chapter=data[&#x27;chapter&#x27;],
-            difficulty=data[&#x27;difficulty&#x27;],
-            target_profiles=[TargetProfile(p) for p in data[&#x27;target_profiles&#x27;]],
-            learning_steps=[LearningStep(s) for s in data[&#x27;learning_steps&#x27;]],
-            tags=data[&#x27;tags&#x27;],
-            prerequisites=data[&#x27;prerequisites&#x27;],
-            duration_minutes=data[&#x27;duration_minutes&#x27;],
-            created_at=datetime.fromisoformat(data[&#x27;created_at&#x27;]),
-            updated_at=datetime.fromisoformat(data[&#x27;updated_at&#x27;]),
-            author_id=data[&#x27;author_id&#x27;],
-            author_name=data[&#x27;author_name&#x27;],
-            usage_count=data.get(&#x27;usage_count&#x27;, 0),
-            average_rating=data.get(&#x27;average_rating&#x27;, 0.0)
+            id=data[&quot;id&quot;],
+            content=data[&quot;content&quot;],
+            type=BrickType(data[&quot;type&quot;]),
+            title=data[&quot;title&quot;],
+            subject=Subject(data[&quot;subject&quot;]),
+            chapter=data[&quot;chapter&quot;],
+            difficulty=data[&quot;difficulty&quot;],
+            target_profiles=[TargetProfile(p) for p in data[&quot;target_profiles&quot;]],
+            learning_steps=[LearningStep(s) for s in data[&quot;learning_steps&quot;]],
+            tags=data[&quot;tags&quot;],
+            prerequisites=data[&quot;prerequisites&quot;],
+            duration_minutes=data[&quot;duration_minutes&quot;],
+            created_at=datetime.fromisoformat(data[&quot;created_at&quot;]),
+            updated_at=datetime.fromisoformat(data[&quot;updated_at&quot;]),
+            author_id=data[&quot;author_id&quot;],
+            author_name=data[&quot;author_name&quot;],
+            usage_count=data.get(&quot;usage_count&quot;, 0),
+            average_rating=data.get(&quot;average_rating&quot;, 0.0),
         )
+
 
 @dataclass
 class DocumentRequest:
     &quot;&quot;&quot;Requ√™te de g√©n√©ration de document personnalis√©&quot;&quot;&quot;
+
     student_id: str
     student_profile: TargetProfile
     subject: Subject
     chapter: str
-    document_type: str           # &quot;fiche_revision&quot;, &quot;exercices&quot;, &quot;cours_complet&quot;
-    difficulty_range: tuple      # (min, max) ex: (3, 5)
+    document_type: str  # &quot;fiche_revision&quot;, &quot;exercices&quot;, &quot;cours_complet&quot;
+    difficulty_range: tuple  # (min, max) ex: (3, 5)
     learning_step: LearningStep
-    duration_target: int         # Dur√©e cible en minutes
-    specific_topics: List[str]   # Sujets sp√©cifiques √† couvrir
-    exclude_topics: List[str]    # Sujets √† √©viter
-    requested_by: str           # ID du demandeur (coach, syst√®me, √©l√®ve)
+    duration_target: int  # Dur√©e cible en minutes
+    specific_topics: List[str]  # Sujets sp√©cifiques √† couvrir
+    exclude_topics: List[str]  # Sujets √† √©viter
+    requested_by: str  # ID du demandeur (coach, syst√®me, √©l√®ve)
     request_time: datetime
 
     # Pr√©f√©rences de format (avec valeurs par d√©faut)
     include_examples: bool = True
     include_exercises: bool = True
     include_corrections: bool = True
     include_methods: bool = True
-    priority: int = 1           # 1=normal, 2=urgent, 3=critique
+    priority: int = 1  # 1=normal, 2=urgent, 3=critique
+
 
 @dataclass
 class GeneratedDocument:
     &quot;&quot;&quot;Document g√©n√©r√© par le syst√®me&quot;&quot;&quot;
+
     id: str
     request: DocumentRequest
-    bricks_used: List[str]      # IDs des briques utilis√©es
-    content_html: str           # Contenu final en HTML
-    content_markdown: str       # Contenu final en Markdown
+    bricks_used: List[str]  # IDs des briques utilis√©es
+    content_html: str  # Contenu final en HTML
+    content_markdown: str  # Contenu final en Markdown
 
     # M√©tadonn√©es du document
     title: str
-    estimated_duration: int     # Dur√©e estim√©e en minutes
-    difficulty_level: float     # Niveau de difficult√© moyen
+    estimated_duration: int  # Dur√©e estim√©e en minutes
+    difficulty_level: float  # Niveau de difficult√© moyen
 
     # Informations de g√©n√©ration
     generated_at: datetime
-    generation_time_ms: int     # Temps de g√©n√©ration en millisecondes
-    template_used: str          # Template utilis√© pour la g√©n√©ration
+    generation_time_ms: int  # Temps de g√©n√©ration en millisecondes
+    template_used: str  # Template utilis√© pour la g√©n√©ration
 
     # Statistiques et feedback
     views_count: int = 0
     completion_rate: float = 0.0
     student_rating: Optional[int] = None
     teacher_rating: Optional[int] = None
 
     def to_dict(self) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Conversion en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;request&#x27;: {
-                &#x27;student_id&#x27;: self.request.student_id,
-                &#x27;student_profile&#x27;: self.request.student_profile.value,
-                &#x27;subject&#x27;: self.request.subject.value,
-                &#x27;chapter&#x27;: self.request.chapter,
-                &#x27;document_type&#x27;: self.request.document_type,
-                &#x27;difficulty_range&#x27;: self.request.difficulty_range,
-                &#x27;learning_step&#x27;: self.request.learning_step.value,
-                &#x27;duration_target&#x27;: self.request.duration_target,
-                &#x27;specific_topics&#x27;: self.request.specific_topics,
-                &#x27;exclude_topics&#x27;: self.request.exclude_topics,
-                &#x27;include_examples&#x27;: self.request.include_examples,
-                &#x27;include_exercises&#x27;: self.request.include_exercises,
-                &#x27;include_corrections&#x27;: self.request.include_corrections,
-                &#x27;include_methods&#x27;: self.request.include_methods,
-                &#x27;requested_by&#x27;: self.request.requested_by,
-                &#x27;request_time&#x27;: self.request.request_time.isoformat(),
-                &#x27;priority&#x27;: self.request.priority
+            &quot;id&quot;: self.id,
+            &quot;request&quot;: {
+                &quot;student_id&quot;: self.request.student_id,
+                &quot;student_profile&quot;: self.request.student_profile.value,
+                &quot;subject&quot;: self.request.subject.value,
+                &quot;chapter&quot;: self.request.chapter,
+                &quot;document_type&quot;: self.request.document_type,
+                &quot;difficulty_range&quot;: self.request.difficulty_range,
+                &quot;learning_step&quot;: self.request.learning_step.value,
+                &quot;duration_target&quot;: self.request.duration_target,
+                &quot;specific_topics&quot;: self.request.specific_topics,
+                &quot;exclude_topics&quot;: self.request.exclude_topics,
+                &quot;include_examples&quot;: self.request.include_examples,
+                &quot;include_exercises&quot;: self.request.include_exercises,
+                &quot;include_corrections&quot;: self.request.include_corrections,
+                &quot;include_methods&quot;: self.request.include_methods,
+                &quot;requested_by&quot;: self.request.requested_by,
+                &quot;request_time&quot;: self.request.request_time.isoformat(),
+                &quot;priority&quot;: self.request.priority,
             },
-            &#x27;bricks_used&#x27;: self.bricks_used,
-            &#x27;content_html&#x27;: self.content_html,
-            &#x27;content_markdown&#x27;: self.content_markdown,
-            &#x27;title&#x27;: self.title,
-            &#x27;estimated_duration&#x27;: self.estimated_duration,
-            &#x27;difficulty_level&#x27;: self.difficulty_level,
-            &#x27;generated_at&#x27;: self.generated_at.isoformat(),
-            &#x27;generation_time_ms&#x27;: self.generation_time_ms,
-            &#x27;template_used&#x27;: self.template_used,
-            &#x27;views_count&#x27;: self.views_count,
-            &#x27;completion_rate&#x27;: self.completion_rate,
-            &#x27;student_rating&#x27;: self.student_rating,
-            &#x27;teacher_rating&#x27;: self.teacher_rating
+            &quot;bricks_used&quot;: self.bricks_used,
+            &quot;content_html&quot;: self.content_html,
+            &quot;content_markdown&quot;: self.content_markdown,
+            &quot;title&quot;: self.title,
+            &quot;estimated_duration&quot;: self.estimated_duration,
+            &quot;difficulty_level&quot;: self.difficulty_level,
+            &quot;generated_at&quot;: self.generated_at.isoformat(),
+            &quot;generation_time_ms&quot;: self.generation_time_ms,
+            &quot;template_used&quot;: self.template_used,
+            &quot;views_count&quot;: self.views_count,
+            &quot;completion_rate&quot;: self.completion_rate,
+            &quot;student_rating&quot;: self.student_rating,
+            &quot;teacher_rating&quot;: self.teacher_rating,
         }
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/aria.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/aria.py	2025-07-24 20:54:02.129002+00:00
@@ -11,289 +11,285 @@
 from ..services.document_database import DocumentDatabase
 
 # Configuration du logging
 logger = logging.getLogger(__name__)
 
-aria_bp = Blueprint(&#x27;aria&#x27;, __name__)
+aria_bp = Blueprint(&quot;aria&quot;, __name__)
 aria_service = ARIAService()
 doc_db = DocumentDatabase()
 
 
-@aria_bp.route(&#x27;/chat&#x27;, methods=[&#x27;POST&#x27;])
+@aria_bp.route(&quot;/chat&quot;, methods=[&quot;POST&quot;])
 def chat_with_aria():
     &quot;&quot;&quot;Endpoint pour discuter avec ARIA&quot;&quot;&quot;
     try:
         data = request.get_json()
-        message = data.get(&#x27;message&#x27;, &#x27;&#x27;)
-        student_id = data.get(&#x27;student_id&#x27;)  # Used for personalized profile retrieval
-        context = data.get(&#x27;context&#x27;, &#x27;&#x27;)
+        message = data.get(&quot;message&quot;, &quot;&quot;)
+        student_id = data.get(&quot;student_id&quot;)  # Used for personalized profile retrieval
+        context = data.get(&quot;context&quot;, &quot;&quot;)
 
         if not message:
-            return jsonify({&#x27;error&#x27;: &#x27;Message requis&#x27;}), 400
+            return jsonify({&quot;error&quot;: &quot;Message requis&quot;}), 400
 
         # Profil √©tudiant par d√©faut ou r√©cup√©r√© de la base
         # NOTE: Replace with actual student profile retrieval using student_id
         student_profile = {
-            &#x27;student_id&#x27;: student_id,  # Include in profile for future use
-            &#x27;grade_level&#x27;: &#x27;terminale&#x27;,
-            &#x27;current_subject&#x27;: &#x27;mathematiques&#x27;,
-            &#x27;learning_style&#x27;: &#x27;visual&#x27;,
-            &#x27;difficulty_preference&#x27;: 3
+            &quot;student_id&quot;: student_id,  # Include in profile for future use
+            &quot;grade_level&quot;: &quot;terminale&quot;,
+            &quot;current_subject&quot;: &quot;mathematiques&quot;,
+            &quot;learning_style&quot;: &quot;visual&quot;,
+            &quot;difficulty_preference&quot;: 3,
         }
 
         # Rechercher des documents pertinents
         relevant_docs = doc_db.search_documents(
             query=message,
-            subject=student_profile.get(&#x27;current_subject&#x27;),
-            grade_level=student_profile.get(&#x27;grade_level&#x27;),
-            max_results=3
+            subject=student_profile.get(&quot;current_subject&quot;),
+            grade_level=student_profile.get(&quot;grade_level&quot;),
+            max_results=3,
         )
 
         # Obtenir des suggestions contextuelles
         contextual_suggestions = doc_db.get_contextual_suggestions(
-            context=message + &#x27; &#x27; + context,
-            student_profile=student_profile
+            context=message + &quot; &quot; + context, student_profile=student_profile
         )
 
         # G√©n√©rer la r√©ponse ARIA
         response = aria_service.generate_response(
             message=message,
             student_profile=student_profile,
             context=context,
-            relevant_documents=relevant_docs
-        )
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;response&#x27;: response,
-            &#x27;relevant_documents&#x27;: relevant_docs,
-            &#x27;suggestions&#x27;: contextual_suggestions,
-            &#x27;student_profile&#x27;: student_profile
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+            relevant_documents=relevant_docs,
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;response&quot;: response,
+                &quot;relevant_documents&quot;: relevant_docs,
+                &quot;suggestions&quot;: contextual_suggestions,
+                &quot;student_profile&quot;: student_profile,
+            }
+        )
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in chat_with_aria: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/recommendations&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/recommendations&quot;, methods=[&quot;POST&quot;])
 def get_recommendations():
     &quot;&quot;&quot;Obtenir des recommandations personnalis√©es&quot;&quot;&quot;
     try:
         data = request.get_json()
-        student_profile = data.get(&#x27;student_profile&#x27;, {})
+        student_profile = data.get(&quot;student_profile&quot;, {})
 
         # Profil par d√©faut si non fourni
         if not student_profile:
             student_profile = {
-                &#x27;grade_level&#x27;: &#x27;terminale&#x27;,
-                &#x27;current_subject&#x27;: &#x27;mathematiques&#x27;,
-                &#x27;learning_style&#x27;: &#x27;visual&#x27;,
-                &#x27;difficulty_preference&#x27;: 3
+                &quot;grade_level&quot;: &quot;terminale&quot;,
+                &quot;current_subject&quot;: &quot;mathematiques&quot;,
+                &quot;learning_style&quot;: &quot;visual&quot;,
+                &quot;difficulty_preference&quot;: 3,
             }
 
         recommendations = doc_db.get_recommendations_for_profile(student_profile)
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;recommendations&#x27;: recommendations
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+        return jsonify({&quot;success&quot;: True, &quot;recommendations&quot;: recommendations})
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in get_recommendations: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/documents/search&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/documents/search&quot;, methods=[&quot;POST&quot;])
 def search_documents():
     &quot;&quot;&quot;Rechercher des documents dans la base&quot;&quot;&quot;
     try:
         data = request.get_json()
-        query = data.get(&#x27;query&#x27;, &#x27;&#x27;)
-        subject = data.get(&#x27;subject&#x27;)
-        grade_level = data.get(&#x27;grade_level&#x27;)
-        document_type = data.get(&#x27;document_type&#x27;)
-        max_results = data.get(&#x27;max_results&#x27;, 10)
+        query = data.get(&quot;query&quot;, &quot;&quot;)
+        subject = data.get(&quot;subject&quot;)
+        grade_level = data.get(&quot;grade_level&quot;)
+        document_type = data.get(&quot;document_type&quot;)
+        max_results = data.get(&quot;max_results&quot;, 10)
 
         documents = doc_db.search_documents(
             query=query,
             subject=subject,
             grade_level=grade_level,
             document_type=document_type,
-            max_results=max_results
-        )
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;documents&#x27;: documents,
-            &#x27;count&#x27;: len(documents)
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+            max_results=max_results,
+        )
+
+        return jsonify(
+            {&quot;success&quot;: True, &quot;documents&quot;: documents, &quot;count&quot;: len(documents)}
+        )
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in search_documents: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/documents/add&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/documents/add&quot;, methods=[&quot;POST&quot;])
 def add_document():
     &quot;&quot;&quot;Ajouter un nouveau document √† la base&quot;&quot;&quot;
     try:
         data = request.get_json()
 
-        required_fields = [&#x27;title&#x27;, &#x27;content&#x27;, &#x27;subject&#x27;, &#x27;grade_level&#x27;, &#x27;document_type&#x27;]
+        required_fields = [
+            &quot;title&quot;,
+            &quot;content&quot;,
+            &quot;subject&quot;,
+            &quot;grade_level&quot;,
+            &quot;document_type&quot;,
+        ]
         for field in required_fields:
             if not data.get(field):
-                return jsonify({&#x27;error&#x27;: f&#x27;Champ requis: {field}&#x27;}), 400
+                return jsonify({&quot;error&quot;: f&quot;Champ requis: {field}&quot;}), 400
 
         doc_id = doc_db.add_document(
-            title=data[&#x27;title&#x27;],
-            content=data[&#x27;content&#x27;],
-            subject=data[&#x27;subject&#x27;],
-            grade_level=data[&#x27;grade_level&#x27;],
-            document_type=data[&#x27;document_type&#x27;],
-            tags=data.get(&#x27;tags&#x27;, &#x27;&#x27;),
-            difficulty_level=data.get(&#x27;difficulty_level&#x27;, 3),
-            url=data.get(&#x27;url&#x27;, &#x27;&#x27;)
-        )
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;document_id&#x27;: doc_id,
-            &#x27;message&#x27;: &#x27;Document ajout√© avec succ√®s&#x27;
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+            title=data[&quot;title&quot;],
+            content=data[&quot;content&quot;],
+            subject=data[&quot;subject&quot;],
+            grade_level=data[&quot;grade_level&quot;],
+            document_type=data[&quot;document_type&quot;],
+            tags=data.get(&quot;tags&quot;, &quot;&quot;),
+            difficulty_level=data.get(&quot;difficulty_level&quot;, 3),
+            url=data.get(&quot;url&quot;, &quot;&quot;),
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;document_id&quot;: doc_id,
+                &quot;message&quot;: &quot;Document ajout√© avec succ√®s&quot;,
+            }
+        )
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in add_document: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/analyze_learning_style&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/analyze_learning_style&quot;, methods=[&quot;POST&quot;])
 def analyze_learning_style():
     &quot;&quot;&quot;Analyser le style d&#x27;apprentissage d&#x27;un √©l√®ve&quot;&quot;&quot;
     try:
         data = request.get_json()
-        responses = data.get(&#x27;responses&#x27;, {})
+        responses = data.get(&quot;responses&quot;, {})
 
         # Simulation d&#x27;analyse du style d&#x27;apprentissage
         learning_analysis = aria_service.analyze_learning_style(responses)
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;analysis&#x27;: learning_analysis
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+        return jsonify({&quot;success&quot;: True, &quot;analysis&quot;: learning_analysis})
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in analyze_learning_style: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/generate_study_plan&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/generate_study_plan&quot;, methods=[&quot;POST&quot;])
 def generate_study_plan():
     &quot;&quot;&quot;G√©n√©rer un plan d&#x27;√©tude personnalis√©&quot;&quot;&quot;
     try:
         data = request.get_json()
-        student_profile = data.get(&#x27;student_profile&#x27;, {})
-        goals = data.get(&#x27;goals&#x27;, [])
-        timeframe = data.get(&#x27;timeframe&#x27;, &#x27;monthly&#x27;)
+        student_profile = data.get(&quot;student_profile&quot;, {})
+        goals = data.get(&quot;goals&quot;, [])
+        timeframe = data.get(&quot;timeframe&quot;, &quot;monthly&quot;)
 
         # Create study plan structure
         study_plan = {
             &quot;title&quot;: f&quot;{timeframe.capitalize()} Study Plan&quot;,
             &quot;student&quot;: student_profile,
             &quot;goals&quot;: goals,
-            &quot;schedule&quot;: []
+            &quot;schedule&quot;: [],
         }
 
         # Generate a basic schedule based on goals and timeframe
         if goals and isinstance(goals, list):
             for i, goal in enumerate(goals):
                 # Get relevant resources for this goal
                 try:
                     resources = doc_db.search_documents(
                         query=goal,
-                        subject=student_profile.get(&#x27;current_subject&#x27;, &#x27;&#x27;),
-                        grade_level=student_profile.get(&#x27;grade_level&#x27;, &#x27;&#x27;),
-                        max_results=2
+                        subject=student_profile.get(&quot;current_subject&quot;, &quot;&quot;),
+                        grade_level=student_profile.get(&quot;grade_level&quot;, &quot;&quot;),
+                        max_results=2,
                     )
                 except (ValueError, KeyError) as e:
-                    logger.warning(&quot;Error searching documents for goal &#x27;%s&#x27;: %s&quot;, goal, str(e))
+                    logger.warning(
+                        &quot;Error searching documents for goal &#x27;%s&#x27;: %s&quot;, goal, str(e)
+                    )
                     resources = []
 
-                study_plan[&quot;schedule&quot;].append({
-                    &quot;week&quot;: i + 1,
-                    &quot;focus&quot;: goal,
-                    &quot;activities&quot;: [
-                        &quot;Review core concepts&quot;,
-                        &quot;Practice exercises&quot;,
-                        &quot;Self-assessment&quot;
-                    ],
-                    &quot;resources&quot;: resources
-                })
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;study_plan&#x27;: study_plan
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+                study_plan[&quot;schedule&quot;].append(
+                    {
+                        &quot;week&quot;: i + 1,
+                        &quot;focus&quot;: goal,
+                        &quot;activities&quot;: [
+                            &quot;Review core concepts&quot;,
+                            &quot;Practice exercises&quot;,
+                            &quot;Self-assessment&quot;,
+                        ],
+                        &quot;resources&quot;: resources,
+                    }
+                )
+
+        return jsonify({&quot;success&quot;: True, &quot;study_plan&quot;: study_plan})
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in generate_study_plan: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/evaluate_progress&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/evaluate_progress&quot;, methods=[&quot;POST&quot;])
 def evaluate_progress():
     &quot;&quot;&quot;√âvaluer les progr√®s d&#x27;un √©l√®ve&quot;&quot;&quot;
     try:
         data = request.get_json()
-        student_id = data.get(&#x27;student_id&#x27;)
-        subject = data.get(&#x27;subject&#x27;)
-        recent_scores = data.get(&#x27;recent_scores&#x27;, [])
+        student_id = data.get(&quot;student_id&quot;)
+        subject = data.get(&quot;subject&quot;)
+        recent_scores = data.get(&quot;recent_scores&quot;, [])
 
         # pylint: disable=no-member
         progress_evaluation = aria_service.evaluate_progress(
-            student_id=student_id,
-            subject=subject,
-            recent_scores=recent_scores
-        )
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;evaluation&#x27;: progress_evaluation
-        })
-
-    except (ValueError, KeyError) as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Invalid request data: {str(e)}&#x27;}), 400
+            student_id=student_id, subject=subject, recent_scores=recent_scores
+        )
+
+        return jsonify({&quot;success&quot;: True, &quot;evaluation&quot;: progress_evaluation})
+
+    except (ValueError, KeyError) as e:
+        return jsonify({&quot;error&quot;: f&quot;Invalid request data: {str(e)}&quot;}), 400
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in evaluate_progress: %s&quot;, str(e))
-        return jsonify({&#x27;error&#x27;: &#x27;Internal server error&#x27;}), 500
-
-
-@aria_bp.route(&#x27;/health&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;}), 500
+
+
+@aria_bp.route(&quot;/health&quot;, methods=[&quot;GET&quot;])
 def health_check():
     &quot;&quot;&quot;V√©rification de l&#x27;√©tat du service ARIA&quot;&quot;&quot;
     try:
         # Test simple sans d√©pendance externe pour √©viter les erreurs
-        return jsonify({
-            &#x27;status&#x27;: &#x27;healthy&#x27;,
-            &#x27;aria_service&#x27;: &#x27;operational&#x27;,
-            &#x27;document_database&#x27;: &#x27;operational&#x27;,
-            &#x27;timestamp&#x27;: str(datetime.now())
-        })
+        return jsonify(
+            {
+                &quot;status&quot;: &quot;healthy&quot;,
+                &quot;aria_service&quot;: &quot;operational&quot;,
+                &quot;document_database&quot;: &quot;operational&quot;,
+                &quot;timestamp&quot;: str(datetime.now()),
+            }
+        )
 
     except Exception as e:  # pylint: disable=broad-exception-caught
         logger.error(&quot;Error in health_check: %s&quot;, str(e))
-        return jsonify({
-            &#x27;status&#x27;: &#x27;error&#x27;,
-            &#x27;error&#x27;: &#x27;Internal server error&#x27;
-        }), 500
+        return jsonify({&quot;status&quot;: &quot;error&quot;, &quot;error&quot;: &quot;Internal server error&quot;}), 500
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/main_production.py	2025-07-24 08:52:43.279310+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/main_production.py	2025-07-24 20:54:02.134475+00:00
@@ -1,9 +1,10 @@
 &quot;&quot;&quot;
 Point d&#x27;entr√©e principal de Nexus R√©ussite Backend
 Version production-ready avec architecture modulaire
 &quot;&quot;&quot;
+
 import os
 import logging
 from typing import Dict, Any
 from datetime import datetime
 from flask import Flask, jsonify, send_from_directory, request
@@ -24,11 +25,11 @@
 # Initialisation des extensions Flask (sans SQLAlchemy car il est import√©)
 jwt = JWTManager()
 limiter = Limiter(
     app=None,
     key_func=get_remote_address,
-    default_limits=[&quot;100 per hour&quot;, &quot;20 per minute&quot;]
+    default_limits=[&quot;100 per hour&quot;, &quot;20 per minute&quot;],
 )
 
 
 def create_app(config_name=None):  # pylint: disable=unused-argument
     &quot;&quot;&quot;Factory pour cr√©er l&#x27;application Flask&quot;&quot;&quot;
@@ -36,19 +37,19 @@
     # R√©cup√©ration de la configuration
     config_obj = get_config(config_name)
 
     # Validation de la configuration
     config_report: Dict[str, Any] = validate_config(config_obj)
-    if config_report[&#x27;status&#x27;] == &#x27;critical&#x27;:
+    if config_report[&quot;status&quot;] == &quot;critical&quot;:
         logger.error(&quot;Configuration critique manquante:&quot;)
-        for issue in config_report[&#x27;issues&#x27;]:
+        for issue in config_report[&quot;issues&quot;]:
             logger.error(&quot;  - %s&quot;, issue)
         raise RuntimeError(&quot;Configuration critique manquante&quot;)
 
-    if config_report[&#x27;warnings&#x27;]:
+    if config_report[&quot;warnings&quot;]:
         logger.warning(&quot;Avertissements de configuration:&quot;)
-        for warning in config_report[&#x27;warnings&#x27;]:
+        for warning in config_report[&quot;warnings&quot;]:
             logger.warning(&quot;  - %s&quot;, warning)
 
     # Cr√©ation de l&#x27;application Flask
     flask_app = Flask(__name__)
 
@@ -60,22 +61,25 @@
     db.init_app(flask_app)
     jwt.init_app(flask_app)
     limiter.init_app(flask_app)
 
     # Initialisation de la base de donn√©es (v√©rification si d√©j√† initialis√©e)
-    if not hasattr(flask_app, &#x27;extensions&#x27;) or &#x27;sqlalchemy&#x27; not in flask_app.extensions:
+    if not hasattr(flask_app, &quot;extensions&quot;) or &quot;sqlalchemy&quot; not in flask_app.extensions:
         db.init_app(flask_app)
 
     # Configuration CORS
-    CORS(flask_app, resources={
-        r&quot;/api/*&quot;: {
-            &quot;origins&quot;: flask_app.config[&#x27;CORS_ORIGINS&#x27;],
-            &quot;methods&quot;: [&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;],
-            &quot;allow_headers&quot;: [&quot;Content-Type&quot;, &quot;Authorization&quot;],
-            &quot;supports_credentials&quot;: True
-        }
-    })
+    CORS(
+        flask_app,
+        resources={
+            r&quot;/api/*&quot;: {
+                &quot;origins&quot;: flask_app.config[&quot;CORS_ORIGINS&quot;],
+                &quot;methods&quot;: [&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;],
+                &quot;allow_headers&quot;: [&quot;Content-Type&quot;, &quot;Authorization&quot;],
+                &quot;supports_credentials&quot;: True,
+            }
+        },
+    )
 
     # Middleware de gestion des erreurs
     register_error_handlers(flask_app)
 
     # Import et enregistrement des blueprints
@@ -94,58 +98,64 @@
 def register_error_handlers(flask_app):
     &quot;&quot;&quot;Enregistre les gestionnaires d&#x27;erreurs globaux&quot;&quot;&quot;
 
     @flask_app.errorhandler(400)
     def bad_request(error):  # pylint: disable=unused-argument
-        return jsonify({
-            &#x27;error&#x27;: &#x27;Bad Request&#x27;,
-            &#x27;message&#x27;: &#x27;Requ√™te malform√©e&#x27;
-        }), 400
+        return jsonify({&quot;error&quot;: &quot;Bad Request&quot;, &quot;message&quot;: &quot;Requ√™te malform√©e&quot;}), 400
 
     @flask_app.errorhandler(401)
     def unauthorized(error):  # pylint: disable=unused-argument
-        return jsonify({
-            &#x27;error&#x27;: &#x27;Unauthorized&#x27;,
-            &#x27;message&#x27;: &#x27;Authentification requise&#x27;
-        }), 401
+        return (
+            jsonify({&quot;error&quot;: &quot;Unauthorized&quot;, &quot;message&quot;: &quot;Authentification requise&quot;}),
+            401,
+        )
 
     @flask_app.errorhandler(403)
     def forbidden(error):  # pylint: disable=unused-argument
-        return jsonify({
-            &#x27;error&#x27;: &#x27;Forbidden&#x27;,
-            &#x27;message&#x27;: &#x27;Acc√®s interdit&#x27;
-        }), 403
+        return jsonify({&quot;error&quot;: &quot;Forbidden&quot;, &quot;message&quot;: &quot;Acc√®s interdit&quot;}), 403
 
     @flask_app.errorhandler(404)
     def not_found(error):  # pylint: disable=unused-argument
-        return jsonify({
-            &#x27;error&#x27;: &#x27;Not Found&#x27;,
-            &#x27;message&#x27;: &#x27;Ressource non trouv√©e&#x27;
-        }), 404
+        return jsonify({&quot;error&quot;: &quot;Not Found&quot;, &quot;message&quot;: &quot;Ressource non trouv√©e&quot;}), 404
 
     @flask_app.errorhandler(413)
     @flask_app.errorhandler(RequestEntityTooLarge)
     def too_large(error):  # pylint: disable=unused-argument
-        return jsonify({
-            &#x27;error&#x27;: &#x27;File Too Large&#x27;,
-            &#x27;message&#x27;: &#x27;Fichier trop volumineux (16MB max)&#x27;
-        }), 413
+        return (
+            jsonify(
+                {
+                    &quot;error&quot;: &quot;File Too Large&quot;,
+                    &quot;message&quot;: &quot;Fichier trop volumineux (16MB max)&quot;,
+                }
+            ),
+            413,
+        )
 
     @flask_app.errorhandler(429)
     def ratelimit_handler(e):  # pylint: disable=unused-argument
-        return jsonify({
-            &#x27;error&#x27;: &#x27;Rate Limit Exceeded&#x27;,
-            &#x27;message&#x27;: &#x27;Trop de requ√™tes, veuillez patienter&#x27;
-        }), 429
+        return (
+            jsonify(
+                {
+                    &quot;error&quot;: &quot;Rate Limit Exceeded&quot;,
+                    &quot;message&quot;: &quot;Trop de requ√™tes, veuillez patienter&quot;,
+                }
+            ),
+            429,
+        )
 
     @flask_app.errorhandler(500)
     def internal_error(error):
         logger.error(&quot;Erreur interne: %s&quot;, error)
-        return jsonify({
-            &#x27;error&#x27;: &#x27;Internal Server Error&#x27;,
-            &#x27;message&#x27;: &#x27;Erreur interne du serveur&#x27;
-        }), 500
+        return (
+            jsonify(
+                {
+                    &quot;error&quot;: &quot;Internal Server Error&quot;,
+                    &quot;message&quot;: &quot;Erreur interne du serveur&quot;,
+                }
+            ),
+            500,
+        )
 
 
 def register_blueprints(flask_app):
     &quot;&quot;&quot;Enregistre tous les blueprints de l&#x27;application&quot;&quot;&quot;
 
@@ -153,138 +163,171 @@
     # pylint: disable=import-outside-toplevel
     from .routes import BLUEPRINTS
 
     # Enregistrement des blueprints avec pr√©fixe API
     for blueprint in BLUEPRINTS:
-        flask_app.register_blueprint(blueprint, url_prefix=&#x27;/api&#x27;)
+        flask_app.register_blueprint(blueprint, url_prefix=&quot;/api&quot;)
 
     logger.info(&quot;‚úÖ %d blueprints enregistr√©s avec succ√®s&quot;, len(BLUEPRINTS))
 
 
 def register_main_routes(flask_app):
     &quot;&quot;&quot;Enregistre les routes principales de l&#x27;application&quot;&quot;&quot;
 
-    @flask_app.route(&#x27;/&#x27;)
+    @flask_app.route(&quot;/&quot;)
     def index():
         &quot;&quot;&quot;Page d&#x27;accueil - sert le frontend React&quot;&quot;&quot;
         try:
-            return send_from_directory(&#x27;static&#x27;, &#x27;index.html&#x27;)
+            return send_from_directory(&quot;static&quot;, &quot;index.html&quot;)
         except FileNotFoundError:
             logger.error(&quot;Frontend index.html not found&quot;)
-            return jsonify({
-                &quot;error&quot;: &quot;Page not found&quot;,
-                &quot;message&quot;: &quot;Frontend not built or not found&quot;,
-                &quot;suggestion&quot;: &quot;Run &#x27;npm run build&#x27; in frontend directory&quot;
-            }), 404
+            return (
+                jsonify(
+                    {
+                        &quot;error&quot;: &quot;Page not found&quot;,
+                        &quot;message&quot;: &quot;Frontend not built or not found&quot;,
+                        &quot;suggestion&quot;: &quot;Run &#x27;npm run build&#x27; in frontend directory&quot;,
+                    }
+                ),
+                404,
+            )
         except Exception as exc:  # pylint: disable=broad-exception-caught
             logger.error(&quot;Erreur lors du service de la page d&#x27;accueil: %s&quot;, str(exc))
-            return jsonify({
-                &quot;error&quot;: &quot;Internal server error&quot;,
-                &quot;message&quot;: &quot;Error serving homepage&quot;
-            }), 500
-
-    @flask_app.route(&#x27;/health&#x27;)
-    @flask_app.route(&#x27;/api/health&#x27;)
+            return (
+                jsonify(
+                    {
+                        &quot;error&quot;: &quot;Internal server error&quot;,
+                        &quot;message&quot;: &quot;Error serving homepage&quot;,
+                    }
+                ),
+                500,
+            )
+
+    @flask_app.route(&quot;/health&quot;)
+    @flask_app.route(&quot;/api/health&quot;)
     @limiter.exempt
     def health_check():
         &quot;&quot;&quot;Point de contr√¥le de sant√© pour le monitoring&quot;&quot;&quot;
         try:
             # V√©rification de la base de donn√©es
             # pylint: disable=import-outside-toplevel
             from sqlalchemy import text
-            db.session.execute(text(&#x27;SELECT 1&#x27;))
-            db_status = &#x27;healthy&#x27;
+
+            db.session.execute(text(&quot;SELECT 1&quot;))
+            db_status = &quot;healthy&quot;
         except Exception as exc:  # pylint: disable=broad-exception-caught
             logger.error(&quot;Base de donn√©es non disponible: %s&quot;, exc)
-            db_status = &#x27;unhealthy&#x27;
+            db_status = &quot;unhealthy&quot;
 
         # V√©rification OpenAI
-        openai_status = &#x27;configured&#x27; if flask_app.config.get(&#x27;OPENAI_API_KEY&#x27;) else &#x27;not_configured&#x27;
-
-        status_code = 200 if db_status == &#x27;healthy&#x27; else 503
-
-        return jsonify({
-            &#x27;status&#x27;: &#x27;healthy&#x27; if status_code == 200 else &#x27;unhealthy&#x27;,
-            &#x27;timestamp&#x27;: datetime.utcnow().isoformat(),
-            &#x27;version&#x27;: &#x27;1.0.0&#x27;,
-            &#x27;environment&#x27;: os.environ.get(&#x27;FLASK_ENV&#x27;, &#x27;unknown&#x27;),
-            &#x27;services&#x27;: {
-                &#x27;database&#x27;: db_status,
-                &#x27;openai&#x27;: openai_status
-            }
-        }), status_code
-
-    @flask_app.route(&#x27;/api/config&#x27;)
+        openai_status = (
+            &quot;configured&quot; if flask_app.config.get(&quot;OPENAI_API_KEY&quot;) else &quot;not_configured&quot;
+        )
+
+        status_code = 200 if db_status == &quot;healthy&quot; else 503
+
+        return (
+            jsonify(
+                {
+                    &quot;status&quot;: &quot;healthy&quot; if status_code == 200 else &quot;unhealthy&quot;,
+                    &quot;timestamp&quot;: datetime.utcnow().isoformat(),
+                    &quot;version&quot;: &quot;1.0.0&quot;,
+                    &quot;environment&quot;: os.environ.get(&quot;FLASK_ENV&quot;, &quot;unknown&quot;),
+                    &quot;services&quot;: {&quot;database&quot;: db_status, &quot;openai&quot;: openai_status},
+                }
+            ),
+            status_code,
+        )
+
+    @flask_app.route(&quot;/api/config&quot;)
     @limiter.limit(&quot;10 per minute&quot;)
     def config_info():
         &quot;&quot;&quot;Informations de configuration (publiques uniquement)&quot;&quot;&quot;
         current_config = get_config()
         config_report: Dict[str, Any] = validate_config(current_config)
 
-        return jsonify({
-            &#x27;app_name&#x27;: &#x27;Nexus R√©ussite&#x27;,
-            &#x27;version&#x27;: &#x27;1.0.0&#x27;,
-            &#x27;environment&#x27;: os.environ.get(&#x27;FLASK_ENV&#x27;, &#x27;unknown&#x27;),
-            &#x27;features&#x27;: {
-                &#x27;ai_enabled&#x27;: bool(flask_app.config.get(&#x27;OPENAI_API_KEY&#x27;)),
-                &#x27;email_enabled&#x27;: bool(flask_app.config.get(&#x27;MAIL_USERNAME&#x27;)),
-                &#x27;demo_data&#x27;: flask_app.config.get(&#x27;ENABLE_DEMO_DATA&#x27;, False)
-            },
-            &#x27;config_status&#x27;: config_report[&#x27;status&#x27;]
-        })
+        return jsonify(
+            {
+                &quot;app_name&quot;: &quot;Nexus R√©ussite&quot;,
+                &quot;version&quot;: &quot;1.0.0&quot;,
+                &quot;environment&quot;: os.environ.get(&quot;FLASK_ENV&quot;, &quot;unknown&quot;),
+                &quot;features&quot;: {
+                    &quot;ai_enabled&quot;: bool(flask_app.config.get(&quot;OPENAI_API_KEY&quot;)),
+                    &quot;email_enabled&quot;: bool(flask_app.config.get(&quot;MAIL_USERNAME&quot;)),
+                    &quot;demo_data&quot;: flask_app.config.get(&quot;ENABLE_DEMO_DATA&quot;, False),
+                },
+                &quot;config_status&quot;: config_report[&quot;status&quot;],
+            }
+        )
 
     # Route pour servir les assets statiques
-    @flask_app.route(&#x27;/assets/&lt;path:filename&gt;&#x27;)
+    @flask_app.route(&quot;/assets/&lt;path:filename&gt;&quot;)
     def serve_assets(filename):
         &quot;&quot;&quot;Sert les assets statiques avec cache&quot;&quot;&quot;
         try:
-            response = send_from_directory(&#x27;static/assets&#x27;, filename)
+            response = send_from_directory(&quot;static/assets&quot;, filename)
             # Cache pour 1 heure en d√©veloppement, 1 jour en production
-            cache_timeout = 86400 if flask_app.config.get(&#x27;ENV&#x27;) == &#x27;production&#x27; else 3600
+            cache_timeout = (
+                86400 if flask_app.config.get(&quot;ENV&quot;) == &quot;production&quot; else 3600
+            )
             response.cache_control.max_age = cache_timeout
             return response
         except Exception as exc:  # pylint: disable=broad-exception-caught
             logger.error(&quot;Erreur lors du service de l&#x27;asset %s: %s&quot;, filename, exc)
             return jsonify({&quot;error&quot;: &quot;Asset not found&quot;}), 404
 
     # Route catch-all pour le frontend React (SPA)
-    @flask_app.route(&#x27;/&lt;path:path&gt;&#x27;)
+    @flask_app.route(&quot;/&lt;path:path&gt;&quot;)
     def react_app(path):
         &quot;&quot;&quot;Route catch-all pour servir l&#x27;application React&quot;&quot;&quot;
         # Ne pas intercepter les routes API
-        if path.startswith(&#x27;api/&#x27;):
+        if path.startswith(&quot;api/&quot;):
             return jsonify({&quot;error&quot;: &quot;API endpoint not found&quot;}), 404
 
         try:
             # Essayer de servir le fichier statique
-            return send_from_directory(&#x27;static&#x27;, path)
+            return send_from_directory(&quot;static&quot;, path)
         except FileNotFoundError:
             # Si le fichier n&#x27;existe pas, servir index.html (SPA)
             try:
-                return send_from_directory(&#x27;static&#x27;, &#x27;index.html&#x27;)
+                return send_from_directory(&quot;static&quot;, &quot;index.html&quot;)
             except FileNotFoundError:
-                return jsonify({
-                    &quot;error&quot;: &quot;Frontend not available&quot;,
-                    &quot;message&quot;: &quot;Please build the frontend first&quot;
-                }), 404
+                return (
+                    jsonify(
+                        {
+                            &quot;error&quot;: &quot;Frontend not available&quot;,
+                            &quot;message&quot;: &quot;Please build the frontend first&quot;,
+                        }
+                    ),
+                    404,
+                )
 
 
 def setup_logging_middleware(flask_app):
     &quot;&quot;&quot;Configure le middleware de logging pour les requ√™tes&quot;&quot;&quot;
 
     @flask_app.before_request
     def log_request_info():
         &quot;&quot;&quot;Log des informations de requ√™te&quot;&quot;&quot;
-        if not request.path.startswith(&#x27;/health&#x27;):  # √âviter le spam des health checks
-            logger.info(&quot;Request: %s %s from %s&quot;, request.method, request.path, request.remote_addr)
+        if not request.path.startswith(&quot;/health&quot;):  # √âviter le spam des health checks
+            logger.info(
+                &quot;Request: %s %s from %s&quot;,
+                request.method,
+                request.path,
+                request.remote_addr,
+            )
 
     @flask_app.after_request
     def log_response_info(response):
         &quot;&quot;&quot;Log des informations de r√©ponse&quot;&quot;&quot;
-        if not request.path.startswith(&#x27;/health&#x27;):
-            logger.info(&quot;Response: %s for %s %s&quot;, response.status_code,
-                       request.method, request.path)
+        if not request.path.startswith(&quot;/health&quot;):
+            logger.info(
+                &quot;Response: %s for %s %s&quot;,
+                response.status_code,
+                request.method,
+                request.path,
+            )
         return response
 
 
 # Factory pour cr√©er l&#x27;app avec configuration par d√©faut
 def create_default_app():
@@ -296,13 +339,13 @@
 # app = create_default_app()
 
 # Import des mod√®les pour les migrations - comment√© pour √©viter les imports circulaires
 # from .models import user, student, content_system, formulas
 
-if __name__ == &#x27;__main__&#x27;:
+if __name__ == &quot;__main__&quot;:
     # D√©veloppement uniquement
-    port = int(os.environ.get(&#x27;PORT&#x27;, 5000))
-    debug = os.environ.get(&#x27;FLASK_ENV&#x27;) == &#x27;development&#x27;
+    port = int(os.environ.get(&quot;PORT&quot;, 5000))
+    debug = os.environ.get(&quot;FLASK_ENV&quot;) == &quot;development&quot;
 
     logger.info(&quot;Starting Nexus R√©ussite on port %s&quot;, port)
     application = create_default_app()  # pylint: disable=redefined-outer-name
-    application.run(host=&#x27;0.0.0.0&#x27;, port=port, debug=debug)
+    application.run(host=&quot;0.0.0.0&quot;, port=port, debug=debug)
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/aria_ai_simple.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/aria_ai_simple.py	2025-07-24 20:54:02.166111+00:00
@@ -6,209 +6,248 @@
 import json
 import random
 from datetime import datetime
 from typing import Dict, List, Any
 
+
 class ARIAService:
     def __init__(self):
         self.responses_templates = {
-            &#x27;greeting&#x27;: [
+            &quot;greeting&quot;: [
                 &quot;Bonjour ! Je suis ARIA, votre assistant IA personnel de Nexus R√©ussite. Comment puis-je vous aider aujourd&#x27;hui ?&quot;,
                 &quot;Salut ! Pr√™t(e) √† apprendre ensemble ? Je suis l√† pour vous accompagner dans votre parcours d&#x27;excellence.&quot;,
-                &quot;Bienvenue ! Je suis ARIA, votre coach IA adaptatif. Que souhaitez-vous √©tudier aujourd&#x27;hui ?&quot;
-            ],
-            &#x27;math&#x27;: [
+                &quot;Bienvenue ! Je suis ARIA, votre coach IA adaptatif. Que souhaitez-vous √©tudier aujourd&#x27;hui ?&quot;,
+            ],
+            &quot;math&quot;: [
                 &quot;Les math√©matiques sont passionnantes ! Avec votre style d&#x27;apprentissage, nous allons d√©composer le probl√®me √©tape par √©tape.&quot;,
                 &quot;Excellente question en math√©matiques ! Je vais adapter mon explication √† votre profil d&#x27;apprentissage.&quot;,
-                &quot;Les maths deviennent plus faciles quand on utilise la bonne m√©thode. Laissez-moi vous guider !&quot;
-            ],
-            &#x27;study_tips&#x27;: [
+                &quot;Les maths deviennent plus faciles quand on utilise la bonne m√©thode. Laissez-moi vous guider !&quot;,
+            ],
+            &quot;study_tips&quot;: [
                 &quot;Pour am√©liorer vos notes, je recommande une approche personnalis√©e bas√©e sur votre style d&#x27;apprentissage.&quot;,
                 &quot;Voici mes conseils adapt√©s √† votre profil : planification, r√©visions actives et pratique r√©guli√®re.&quot;,
-                &quot;L&#x27;excellence vient de la r√©gularit√© et de la m√©thode. Cr√©ons ensemble votre plan d&#x27;√©tude personnalis√© !&quot;
-            ],
-            &#x27;bac_prep&#x27;: [
+                &quot;L&#x27;excellence vient de la r√©gularit√© et de la m√©thode. Cr√©ons ensemble votre plan d&#x27;√©tude personnalis√© !&quot;,
+            ],
+            &quot;bac_prep&quot;: [
                 &quot;La pr√©paration au bac n√©cessite une strat√©gie bien d√©finie. Je vais vous aider √† cr√©er un plan d&#x27;√©tude optimal.&quot;,
                 &quot;Pour r√©ussir votre bac, nous allons travailler sur vos points forts et renforcer vos faiblesses.&quot;,
-                &quot;Le bac se pr√©pare m√©thodiquement. Analysons ensemble vos besoins et cr√©ons votre feuille de route !&quot;
-            ],
-            &#x27;subjects&#x27;: [
+                &quot;Le bac se pr√©pare m√©thodiquement. Analysons ensemble vos besoins et cr√©ons votre feuille de route !&quot;,
+            ],
+            &quot;subjects&quot;: [
                 &quot;Analysons vos mati√®res pour identifier celles qui n√©cessitent le plus d&#x27;attention.&quot;,
                 &quot;Chaque mati√®re a ses sp√©cificit√©s. Je vais vous proposer des strat√©gies adapt√©es √† chacune.&quot;,
-                &quot;Vos mati√®res √† renforcer d√©pendent de vos objectifs. Parlons-en pour personnaliser votre parcours !&quot;
-            ],
-            &#x27;default&#x27;: [
+                &quot;Vos mati√®res √† renforcer d√©pendent de vos objectifs. Parlons-en pour personnaliser votre parcours !&quot;,
+            ],
+            &quot;default&quot;: [
                 &quot;C&#x27;est une excellente question ! Adaptons notre approche √† votre style d&#x27;apprentissage.&quot;,
                 &quot;Je vais vous aider avec une m√©thode personnalis√©e selon votre profil cognitif.&quot;,
-                &quot;Int√©ressant ! Laissez-moi vous proposer une approche adapt√©e √† vos besoins sp√©cifiques.&quot;
-            ]
+                &quot;Int√©ressant ! Laissez-moi vous proposer une approche adapt√©e √† vos besoins sp√©cifiques.&quot;,
+            ],
         }
 
     def detect_message_type(self, message: str) -&gt; str:
         &quot;&quot;&quot;D√©tecte le type de message pour choisir la r√©ponse appropri√©e&quot;&quot;&quot;
         message_lower = message.lower()
 
-        if any(word in message_lower for word in [&#x27;bonjour&#x27;, &#x27;salut&#x27;, &#x27;hello&#x27;, &#x27;bonsoir&#x27;]):
-            return &#x27;greeting&#x27;
-        elif any(word in message_lower for word in [&#x27;math√©matiques&#x27;, &#x27;maths&#x27;, &#x27;calcul&#x27;, &#x27;√©quation&#x27;, &#x27;fonction&#x27;]):
-            return &#x27;math&#x27;
-        elif any(word in message_lower for word in [&#x27;am√©liorer&#x27;, &#x27;notes&#x27;, &#x27;r√©sultats&#x27;, &#x27;conseils&#x27;]):
-            return &#x27;study_tips&#x27;
-        elif any(word in message_lower for word in [&#x27;bac&#x27;, &#x27;baccalaur√©at&#x27;, &#x27;examen&#x27;, &#x27;pr√©parer&#x27;]):
-            return &#x27;bac_prep&#x27;
-        elif any(word in message_lower for word in [&#x27;mati√®res&#x27;, &#x27;mati√®re&#x27;, &#x27;renforcer&#x27;, &#x27;faible&#x27;]):
-            return &#x27;subjects&#x27;
+        if any(
+            word in message_lower for word in [&quot;bonjour&quot;, &quot;salut&quot;, &quot;hello&quot;, &quot;bonsoir&quot;]
+        ):
+            return &quot;greeting&quot;
+        elif any(
+            word in message_lower
+            for word in [&quot;math√©matiques&quot;, &quot;maths&quot;, &quot;calcul&quot;, &quot;√©quation&quot;, &quot;fonction&quot;]
+        ):
+            return &quot;math&quot;
+        elif any(
+            word in message_lower
+            for word in [&quot;am√©liorer&quot;, &quot;notes&quot;, &quot;r√©sultats&quot;, &quot;conseils&quot;]
+        ):
+            return &quot;study_tips&quot;
+        elif any(
+            word in message_lower
+            for word in [&quot;bac&quot;, &quot;baccalaur√©at&quot;, &quot;examen&quot;, &quot;pr√©parer&quot;]
+        ):
+            return &quot;bac_prep&quot;
+        elif any(
+            word in message_lower
+            for word in [&quot;mati√®res&quot;, &quot;mati√®re&quot;, &quot;renforcer&quot;, &quot;faible&quot;]
+        ):
+            return &quot;subjects&quot;
         else:
-            return &#x27;default&#x27;
-
-    def generate_chat_response(self, student_profile: Dict, message: str, context: Dict = None) -&gt; Dict[str, Any]:
+            return &quot;default&quot;
+
+    def generate_chat_response(
+        self, student_profile: Dict, message: str, context: Dict = None
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re une r√©ponse de chat personnalis√©e&quot;&quot;&quot;
         try:
             # D√©tection du type de message
             message_type = self.detect_message_type(message)
 
             # S√©lection d&#x27;une r√©ponse appropri√©e
-            responses = self.responses_templates.get(message_type, self.responses_templates[&#x27;default&#x27;])
+            responses = self.responses_templates.get(
+                message_type, self.responses_templates[&quot;default&quot;]
+            )
             response_text = random.choice(responses)
 
             # Personnalisation selon le profil
-            learning_style = student_profile.get(&#x27;learning_style&#x27;, &#x27;adaptatif&#x27;)
-            grade_level = student_profile.get(&#x27;grade_level&#x27;, &#x27;lyc√©e&#x27;)
+            learning_style = student_profile.get(&quot;learning_style&quot;, &quot;adaptatif&quot;)
+            grade_level = student_profile.get(&quot;grade_level&quot;, &quot;lyc√©e&quot;)
 
             # Ajout de badges contextuels
             badges = [
-                {&quot;text&quot;: f&quot;üéØ Style: {learning_style.title()}&quot;, &quot;class&quot;: &quot;bg-blue-100 text-blue-800&quot;},
-                {&quot;text&quot;: f&quot;üìä Confiance: {random.randint(85, 98)}%&quot;, &quot;class&quot;: &quot;bg-green-100 text-green-800&quot;}
+                {
+                    &quot;text&quot;: f&quot;üéØ Style: {learning_style.title()}&quot;,
+                    &quot;class&quot;: &quot;bg-blue-100 text-blue-800&quot;,
+                },
+                {
+                    &quot;text&quot;: f&quot;üìä Confiance: {random.randint(85, 98)}%&quot;,
+                    &quot;class&quot;: &quot;bg-green-100 text-green-800&quot;,
+                },
             ]
 
             # Ajout de badges sp√©cifiques selon le type de message
-            if message_type == &#x27;math&#x27;:
-                badges.append({&quot;text&quot;: &quot;üî¢ Sp√©cialiste Maths&quot;, &quot;class&quot;: &quot;bg-purple-100 text-purple-800&quot;})
-            elif message_type == &#x27;bac_prep&#x27;:
-                badges.append({&quot;text&quot;: &quot;üéì Coach Bac&quot;, &quot;class&quot;: &quot;bg-orange-100 text-orange-800&quot;})
+            if message_type == &quot;math&quot;:
+                badges.append(
+                    {
+                        &quot;text&quot;: &quot;üî¢ Sp√©cialiste Maths&quot;,
+                        &quot;class&quot;: &quot;bg-purple-100 text-purple-800&quot;,
+                    }
+                )
+            elif message_type == &quot;bac_prep&quot;:
+                badges.append(
+                    {&quot;text&quot;: &quot;üéì Coach Bac&quot;, &quot;class&quot;: &quot;bg-orange-100 text-orange-800&quot;}
+                )
 
             return {
                 &quot;response&quot;: response_text,
                 &quot;badges&quot;: badges,
                 &quot;confidence_score&quot;: random.uniform(0.85, 0.98),
                 &quot;processing_time_ms&quot;: random.randint(150, 800),
                 &quot;message_type&quot;: message_type,
-                &quot;personalized&quot;: True
+                &quot;personalized&quot;: True,
             }
 
         except Exception as e:
             # R√©ponse de fallback en cas d&#x27;erreur
             return {
                 &quot;response&quot;: &quot;Je rencontre une petite difficult√© technique. Pouvez-vous reformuler votre question ?&quot;,
-                &quot;badges&quot;: [{&quot;text&quot;: &quot;‚ö†Ô∏è Mode d√©grad√©&quot;, &quot;class&quot;: &quot;bg-orange-100 text-orange-800&quot;}],
+                &quot;badges&quot;: [
+                    {&quot;text&quot;: &quot;‚ö†Ô∏è Mode d√©grad√©&quot;, &quot;class&quot;: &quot;bg-orange-100 text-orange-800&quot;}
+                ],
                 &quot;confidence_score&quot;: 0.7,
                 &quot;processing_time_ms&quot;: 100,
-                &quot;error&quot;: str(e)
+                &quot;error&quot;: str(e),
             }
 
     def analyze_learning_style(self, student_data: Dict) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Analyse le style d&#x27;apprentissage de l&#x27;√©tudiant&quot;&quot;&quot;
         # Simulation d&#x27;analyse bas√©e sur les donn√©es d&#x27;interaction
-        styles = [&#x27;visuel&#x27;, &#x27;auditif&#x27;, &#x27;kinesth√©sique&#x27;, &#x27;lecture/√©criture&#x27;]
+        styles = [&quot;visuel&quot;, &quot;auditif&quot;, &quot;kinesth√©sique&quot;, &quot;lecture/√©criture&quot;]
 
         # Analyse simul√©e
         dominant_style = random.choice(styles)
 
         scores = {
-            &#x27;visuel&#x27;: random.uniform(0.6, 0.9),
-            &#x27;auditif&#x27;: random.uniform(0.5, 0.8),
-            &#x27;kinesth√©sique&#x27;: random.uniform(0.4, 0.7),
-            &#x27;lecture_ecriture&#x27;: random.uniform(0.5, 0.8)
+            &quot;visuel&quot;: random.uniform(0.6, 0.9),
+            &quot;auditif&quot;: random.uniform(0.5, 0.8),
+            &quot;kinesth√©sique&quot;: random.uniform(0.4, 0.7),
+            &quot;lecture_ecriture&quot;: random.uniform(0.5, 0.8),
         }
 
         return {
-            &#x27;dominant_style&#x27;: dominant_style,
-            &#x27;scores&#x27;: scores,
-            &#x27;confidence&#x27;: random.uniform(0.8, 0.95),
-            &#x27;recommendations&#x27;: [
+            &quot;dominant_style&quot;: dominant_style,
+            &quot;scores&quot;: scores,
+            &quot;confidence&quot;: random.uniform(0.8, 0.95),
+            &quot;recommendations&quot;: [
                 f&quot;Privil√©gier les m√©thodes {dominant_style}s&quot;,
                 &quot;Varier les supports d&#x27;apprentissage&quot;,
-                &quot;Adapter le rythme selon les performances&quot;
-            ]
-        }
-
-    def generate_personalized_content(self, student_profile: Dict, subject: str, topic: str) -&gt; Dict[str, Any]:
+                &quot;Adapter le rythme selon les performances&quot;,
+            ],
+        }
+
+    def generate_personalized_content(
+        self, student_profile: Dict, subject: str, topic: str
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re du contenu personnalis√© pour un sujet donn√©&quot;&quot;&quot;
-        learning_style = student_profile.get(&#x27;learning_style&#x27;, &#x27;adaptatif&#x27;)
+        learning_style = student_profile.get(&quot;learning_style&quot;, &quot;adaptatif&quot;)
 
         content = {
             &quot;explanation&quot;: f&quot;Explication adapt√©e au style {learning_style} pour le sujet {topic} en {subject}.&quot;,
             &quot;exercises&quot;: [
                 {
                     &quot;title&quot;: f&quot;Exercice d&#x27;application - {topic}&quot;,
                     &quot;difficulty&quot;: &quot;facile&quot;,
-                    &quot;type&quot;: &quot;application_directe&quot;
+                    &quot;type&quot;: &quot;application_directe&quot;,
                 },
                 {
                     &quot;title&quot;: f&quot;Exercice de synth√®se - {topic}&quot;,
                     &quot;difficulty&quot;: &quot;moyen&quot;,
-                    &quot;type&quot;: &quot;synthese&quot;
+                    &quot;type&quot;: &quot;synthese&quot;,
                 },
                 {
                     &quot;title&quot;: f&quot;Exercice d&#x27;approfondissement - {topic}&quot;,
                     &quot;difficulty&quot;: &quot;difficile&quot;,
-                    &quot;type&quot;: &quot;approfondissement&quot;
-                }
+                    &quot;type&quot;: &quot;approfondissement&quot;,
+                },
             ],
             &quot;methodology_tips&quot;: [
                 f&quot;Adapter la m√©thode au style {learning_style}&quot;,
                 &quot;Pratiquer r√©guli√®rement avec des exercices vari√©s&quot;,
-                &quot;Faire des liens avec les connaissances ant√©rieures&quot;
+                &quot;Faire des liens avec les connaissances ant√©rieures&quot;,
             ],
             &quot;resources&quot;: [
                 f&quot;Ressources {learning_style}s recommand√©es&quot;,
                 &quot;Supports compl√©mentaires adapt√©s&quot;,
-                &quot;Outils d&#x27;auto-√©valuation&quot;
-            ]
+                &quot;Outils d&#x27;auto-√©valuation&quot;,
+            ],
         }
 
         return content
 
-    def assess_student_performance(self, student_id: int, session_data: Dict) -&gt; Dict[str, Any]:
+    def assess_student_performance(
+        self, student_id: int, session_data: Dict
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;√âvalue les performances de l&#x27;√©tudiant&quot;&quot;&quot;
-        answers = session_data.get(&#x27;answers&#x27;, [])
-        questions = session_data.get(&#x27;questions&#x27;, [])
+        answers = session_data.get(&quot;answers&quot;, [])
+        questions = session_data.get(&quot;questions&quot;, [])
 
         if not questions:
             return {&quot;error&quot;: &quot;Aucune question fournie pour l&#x27;√©valuation&quot;}
 
         # Simulation d&#x27;√©valuation
         score = random.uniform(60, 95)
 
         detailed_analysis = []
         for i, question in enumerate(questions):
             is_correct = random.choice([True, False, True])  # Biais vers le succ√®s
-            detailed_analysis.append({
-                &#x27;question_id&#x27;: i + 1,
-                &#x27;is_correct&#x27;: is_correct,
-                &#x27;topic&#x27;: question.get(&#x27;topic&#x27;, &#x27;general&#x27;),
-                &#x27;difficulty&#x27;: question.get(&#x27;difficulty&#x27;, &#x27;medium&#x27;)
-            })
+            detailed_analysis.append(
+                {
+                    &quot;question_id&quot;: i + 1,
+                    &quot;is_correct&quot;: is_correct,
+                    &quot;topic&quot;: question.get(&quot;topic&quot;, &quot;general&quot;),
+                    &quot;difficulty&quot;: question.get(&quot;difficulty&quot;, &quot;medium&quot;),
+                }
+            )
 
         # Analyse des patterns d&#x27;erreur
         error_patterns = {
-            &#x27;calculation_errors&#x27;: random.randint(0, 2),
-            &#x27;methodology_issues&#x27;: random.randint(0, 1),
-            &#x27;comprehension_gaps&#x27;: random.randint(0, 1)
+            &quot;calculation_errors&quot;: random.randint(0, 2),
+            &quot;methodology_issues&quot;: random.randint(0, 1),
+            &quot;comprehension_gaps&quot;: random.randint(0, 1),
         }
 
         # Recommandations
         recommendations = [
             &quot;Continuer sur cette lanc√©e, excellent travail !&quot;,
             &quot;Renforcer la m√©thodologie sur les points identifi√©s&quot;,
-            &quot;Pratiquer davantage les exercices de type similaire&quot;
+            &quot;Pratiquer davantage les exercices de type similaire&quot;,
         ]
 
         return {
-            &#x27;score&#x27;: score,
-            &#x27;detailed_analysis&#x27;: detailed_analysis,
-            &#x27;error_patterns&#x27;: error_patterns,
-            &#x27;recommendations&#x27;: recommendations,
-            &#x27;next_difficulty_level&#x27;: &#x27;intermediate&#x27; if score &gt; 75 else &#x27;basic&#x27;,
-            &#x27;confidence&#x27;: random.uniform(0.8, 0.95)
-        }
-
+            &quot;score&quot;: score,
+            &quot;detailed_analysis&quot;: detailed_analysis,
+            &quot;error_patterns&quot;: error_patterns,
+            &quot;recommendations&quot;: recommendations,
+            &quot;next_difficulty_level&quot;: &quot;intermediate&quot; if score &gt; 75 else &quot;basic&quot;,
+            &quot;confidence&quot;: random.uniform(0.8, 0.95),
+        }
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database/init_db_improved.py	2025-07-24 07:24:17.020976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database/init_db_improved.py	2025-07-24 20:54:02.166140+00:00
@@ -1,9 +1,10 @@
 &quot;&quot;&quot;
 Initialisation de la base de donn√©es Nexus R√©ussite
 Script d&#x27;initialisation avec donn√©es de d√©monstration
 &quot;&quot;&quot;
+
 import os
 import sys
 from datetime import datetime, timedelta
 from werkzeug.security import generate_password_hash
 
@@ -38,207 +39,207 @@
 
     print(&quot;üë• Cr√©ation des utilisateurs de d√©monstration...&quot;)
 
     # === ADMINISTRATEURS ===
     admin = User(
-        email=&#x27;admin@nexus-reussite.com&#x27;,
-        password=&#x27;admin123&#x27;,
-        first_name=&#x27;Admin&#x27;,
-        last_name=&#x27;Nexus&#x27;,
+        email=&quot;admin@nexus-reussite.com&quot;,
+        password=&quot;admin123&quot;,
+        first_name=&quot;Admin&quot;,
+        last_name=&quot;Nexus&quot;,
         role=UserRole.ADMIN,
         status=UserStatus.ACTIVE,
-        email_verified=True
+        email_verified=True,
     )
     db.session.add(admin)
 
     # === ENSEIGNANTS ===
     teachers_data = [
         {
-            &#x27;email&#x27;: &#x27;marc.dubois@nexus-reussite.com&#x27;,
-            &#x27;password&#x27;: &#x27;teacher123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Marc&#x27;,
-            &#x27;last_name&#x27;: &#x27;Dubois&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 123 456&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;Physique&#x27;],
-            &#x27;experience&#x27;: 15,
-            &#x27;qualification&#x27;: &#x27;Agr√©g√© de Math√©matiques&#x27;,
-            &#x27;rating&#x27;: 4.9,
-            &#x27;description&#x27;: &#x27;Professeur agr√©g√© avec 15 ans d\&#x27;exp√©rience dans les √©tablissements AEFE&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;sophie.martin@nexus-reussite.com&#x27;,
-            &#x27;password&#x27;: &#x27;teacher123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Sophie&#x27;,
-            &#x27;last_name&#x27;: &#x27;Martin&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 234 567&#x27;,
-            &#x27;specialties&#x27;: [&#x27;NSI&#x27;, &#x27;Math√©matiques&#x27;],
-            &#x27;experience&#x27;: 8,
-            &#x27;qualification&#x27;: &#x27;Certifi√©e NSI, DIU&#x27;,
-            &#x27;rating&#x27;: 4.8,
-            &#x27;description&#x27;: &#x27;Sp√©cialiste NSI passionn√©e de programmation et d\&#x27;algorithmique&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;david.rousseau@nexus-reussite.com&#x27;,
-            &#x27;password&#x27;: &#x27;teacher123&#x27;,
-            &#x27;first_name&#x27;: &#x27;David&#x27;,
-            &#x27;last_name&#x27;: &#x27;Rousseau&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 345 678&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Physique-Chimie&#x27;],
-            &#x27;experience&#x27;: 12,
-            &#x27;qualification&#x27;: &#x27;Docteur en Physique&#x27;,
-            &#x27;rating&#x27;: 4.9,
-            &#x27;description&#x27;: &#x27;Docteur en Physique avec expertise en sciences exp√©rimentales&#x27;
-        }
+            &quot;email&quot;: &quot;marc.dubois@nexus-reussite.com&quot;,
+            &quot;password&quot;: &quot;teacher123&quot;,
+            &quot;first_name&quot;: &quot;Marc&quot;,
+            &quot;last_name&quot;: &quot;Dubois&quot;,
+            &quot;phone&quot;: &quot;+216 20 123 456&quot;,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;Physique&quot;],
+            &quot;experience&quot;: 15,
+            &quot;qualification&quot;: &quot;Agr√©g√© de Math√©matiques&quot;,
+            &quot;rating&quot;: 4.9,
+            &quot;description&quot;: &quot;Professeur agr√©g√© avec 15 ans d&#x27;exp√©rience dans les √©tablissements AEFE&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;sophie.martin@nexus-reussite.com&quot;,
+            &quot;password&quot;: &quot;teacher123&quot;,
+            &quot;first_name&quot;: &quot;Sophie&quot;,
+            &quot;last_name&quot;: &quot;Martin&quot;,
+            &quot;phone&quot;: &quot;+216 20 234 567&quot;,
+            &quot;specialties&quot;: [&quot;NSI&quot;, &quot;Math√©matiques&quot;],
+            &quot;experience&quot;: 8,
+            &quot;qualification&quot;: &quot;Certifi√©e NSI, DIU&quot;,
+            &quot;rating&quot;: 4.8,
+            &quot;description&quot;: &quot;Sp√©cialiste NSI passionn√©e de programmation et d&#x27;algorithmique&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;david.rousseau@nexus-reussite.com&quot;,
+            &quot;password&quot;: &quot;teacher123&quot;,
+            &quot;first_name&quot;: &quot;David&quot;,
+            &quot;last_name&quot;: &quot;Rousseau&quot;,
+            &quot;phone&quot;: &quot;+216 20 345 678&quot;,
+            &quot;specialties&quot;: [&quot;Physique-Chimie&quot;],
+            &quot;experience&quot;: 12,
+            &quot;qualification&quot;: &quot;Docteur en Physique&quot;,
+            &quot;rating&quot;: 4.9,
+            &quot;description&quot;: &quot;Docteur en Physique avec expertise en sciences exp√©rimentales&quot;,
+        },
     ]
 
     for teacher_data in teachers_data:
         teacher = User(
-            email=teacher_data[&#x27;email&#x27;],
-            password=teacher_data[&#x27;password&#x27;],
-            first_name=teacher_data[&#x27;first_name&#x27;],
-            last_name=teacher_data[&#x27;last_name&#x27;],
-            phone=teacher_data.get(&#x27;phone&#x27;),
+            email=teacher_data[&quot;email&quot;],
+            password=teacher_data[&quot;password&quot;],
+            first_name=teacher_data[&quot;first_name&quot;],
+            last_name=teacher_data[&quot;last_name&quot;],
+            phone=teacher_data.get(&quot;phone&quot;),
             role=UserRole.TEACHER,
             status=UserStatus.ACTIVE,
-            email_verified=True
+            email_verified=True,
         )
         db.session.add(teacher)
 
     # === √âTUDIANTS ===
     students_data = [
         {
-            &#x27;email&#x27;: &#x27;sarah.martin@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Sarah&#x27;,
-            &#x27;last_name&#x27;: &#x27;Martin&#x27;,
-            &#x27;academic_level&#x27;: AcademicLevel.TERMINALE,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;NSI&#x27;, &#x27;Physique-Chimie&#x27;],
-            &#x27;learning_style&#x27;: LearningStyle.VISUAL,
-            &#x27;learning_style_percentage&#x27;: 85,
-            &#x27;current_grade&#x27;: 16.5,
-            &#x27;target_grade&#x27;: 18.0,
-            &#x27;bio&#x27;: &#x27;√âl√®ve s√©rieuse et motiv√©e, vise une √©cole d\&#x27;ing√©nieur&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;ahmed.ben.ali@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Ahmed&#x27;,
-            &#x27;last_name&#x27;: &#x27;Ben Ali&#x27;,
-            &#x27;academic_level&#x27;: AcademicLevel.PREMIERE,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;Physique-Chimie&#x27;],
-            &#x27;learning_style&#x27;: LearningStyle.AUDITORY,
-            &#x27;learning_style_percentage&#x27;: 70,
-            &#x27;current_grade&#x27;: 13.2,
-            &#x27;target_grade&#x27;: 15.0,
-            &#x27;bio&#x27;: &#x27;√âl√®ve appliqu√© qui souhaite progresser en sciences&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;lea.dubois@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;L√©a&#x27;,
-            &#x27;last_name&#x27;: &#x27;Dubois&#x27;,
-            &#x27;academic_level&#x27;: AcademicLevel.TERMINALE,
-            &#x27;specialties&#x27;: [&#x27;Fran√ßais&#x27;, &#x27;Philosophie&#x27;, &#x27;Histoire-G√©ographie&#x27;],
-            &#x27;learning_style&#x27;: LearningStyle.KINESTHETIC,
-            &#x27;learning_style_percentage&#x27;: 80,
-            &#x27;current_grade&#x27;: 15.8,
-            &#x27;target_grade&#x27;: 17.0,
-            &#x27;bio&#x27;: &#x27;Passionn√©e de litt√©rature et de philosophie&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;youssef.trabelsi@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Youssef&#x27;,
-            &#x27;last_name&#x27;: &#x27;Trabelsi&#x27;,
-            &#x27;academic_level&#x27;: AcademicLevel.TERMINALE,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;NSI&#x27;],
-            &#x27;learning_style&#x27;: LearningStyle.LOGICAL,
-            &#x27;learning_style_percentage&#x27;: 90,
-            &#x27;current_grade&#x27;: 17.2,
-            &#x27;target_grade&#x27;: 18.5,
-            &#x27;bio&#x27;: &#x27;Futur ing√©nieur en informatique, passionn√© de programmation&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;nour.ben.salem@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Nour&#x27;,
-            &#x27;last_name&#x27;: &#x27;Ben Salem&#x27;,
-            &#x27;academic_level&#x27;: AcademicLevel.PREMIERE,
-            &#x27;specialties&#x27;: [&#x27;Physique-Chimie&#x27;, &#x27;Math√©matiques&#x27;, &#x27;SVT&#x27;],
-            &#x27;learning_style&#x27;: LearningStyle.VISUAL,
-            &#x27;learning_style_percentage&#x27;: 75,
-            &#x27;current_grade&#x27;: 14.5,
-            &#x27;target_grade&#x27;: 16.0,
-            &#x27;bio&#x27;: &#x27;Int√©ress√©e par la m√©decine et les sciences de la vie&#x27;
-        }
+            &quot;email&quot;: &quot;sarah.martin@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Sarah&quot;,
+            &quot;last_name&quot;: &quot;Martin&quot;,
+            &quot;academic_level&quot;: AcademicLevel.TERMINALE,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;NSI&quot;, &quot;Physique-Chimie&quot;],
+            &quot;learning_style&quot;: LearningStyle.VISUAL,
+            &quot;learning_style_percentage&quot;: 85,
+            &quot;current_grade&quot;: 16.5,
+            &quot;target_grade&quot;: 18.0,
+            &quot;bio&quot;: &quot;√âl√®ve s√©rieuse et motiv√©e, vise une √©cole d&#x27;ing√©nieur&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;ahmed.ben.ali@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Ahmed&quot;,
+            &quot;last_name&quot;: &quot;Ben Ali&quot;,
+            &quot;academic_level&quot;: AcademicLevel.PREMIERE,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;Physique-Chimie&quot;],
+            &quot;learning_style&quot;: LearningStyle.AUDITORY,
+            &quot;learning_style_percentage&quot;: 70,
+            &quot;current_grade&quot;: 13.2,
+            &quot;target_grade&quot;: 15.0,
+            &quot;bio&quot;: &quot;√âl√®ve appliqu√© qui souhaite progresser en sciences&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;lea.dubois@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;L√©a&quot;,
+            &quot;last_name&quot;: &quot;Dubois&quot;,
+            &quot;academic_level&quot;: AcademicLevel.TERMINALE,
+            &quot;specialties&quot;: [&quot;Fran√ßais&quot;, &quot;Philosophie&quot;, &quot;Histoire-G√©ographie&quot;],
+            &quot;learning_style&quot;: LearningStyle.KINESTHETIC,
+            &quot;learning_style_percentage&quot;: 80,
+            &quot;current_grade&quot;: 15.8,
+            &quot;target_grade&quot;: 17.0,
+            &quot;bio&quot;: &quot;Passionn√©e de litt√©rature et de philosophie&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;youssef.trabelsi@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Youssef&quot;,
+            &quot;last_name&quot;: &quot;Trabelsi&quot;,
+            &quot;academic_level&quot;: AcademicLevel.TERMINALE,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;NSI&quot;],
+            &quot;learning_style&quot;: LearningStyle.LOGICAL,
+            &quot;learning_style_percentage&quot;: 90,
+            &quot;current_grade&quot;: 17.2,
+            &quot;target_grade&quot;: 18.5,
+            &quot;bio&quot;: &quot;Futur ing√©nieur en informatique, passionn√© de programmation&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;nour.ben.salem@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Nour&quot;,
+            &quot;last_name&quot;: &quot;Ben Salem&quot;,
+            &quot;academic_level&quot;: AcademicLevel.PREMIERE,
+            &quot;specialties&quot;: [&quot;Physique-Chimie&quot;, &quot;Math√©matiques&quot;, &quot;SVT&quot;],
+            &quot;learning_style&quot;: LearningStyle.VISUAL,
+            &quot;learning_style_percentage&quot;: 75,
+            &quot;current_grade&quot;: 14.5,
+            &quot;target_grade&quot;: 16.0,
+            &quot;bio&quot;: &quot;Int√©ress√©e par la m√©decine et les sciences de la vie&quot;,
+        },
     ]
 
     for student_data in students_data:
         # Cr√©er l&#x27;utilisateur
         student = User(
-            email=student_data[&#x27;email&#x27;],
-            password=student_data[&#x27;password&#x27;],
-            first_name=student_data[&#x27;first_name&#x27;],
-            last_name=student_data[&#x27;last_name&#x27;],
+            email=student_data[&quot;email&quot;],
+            password=student_data[&quot;password&quot;],
+            first_name=student_data[&quot;first_name&quot;],
+            last_name=student_data[&quot;last_name&quot;],
             role=UserRole.STUDENT,
             status=UserStatus.ACTIVE,
-            email_verified=True
+            email_verified=True,
         )
         db.session.add(student)
         db.session.flush()  # Pour obtenir l&#x27;ID
 
         # Cr√©er le profil √©tudiant
         student_profile = StudentProfile(
             user_id=student.id,
-            academic_level=student_data[&#x27;academic_level&#x27;],
-            specialties=student_data[&#x27;specialties&#x27;],
-            learning_style=student_data[&#x27;learning_style&#x27;],
-            learning_style_percentage=student_data[&#x27;learning_style_percentage&#x27;],
-            current_grade=student_data[&#x27;current_grade&#x27;],
-            target_grade=student_data[&#x27;target_grade&#x27;],
-            bio=student_data[&#x27;bio&#x27;]
+            academic_level=student_data[&quot;academic_level&quot;],
+            specialties=student_data[&quot;specialties&quot;],
+            learning_style=student_data[&quot;learning_style&quot;],
+            learning_style_percentage=student_data[&quot;learning_style_percentage&quot;],
+            current_grade=student_data[&quot;current_grade&quot;],
+            target_grade=student_data[&quot;target_grade&quot;],
+            bio=student_data[&quot;bio&quot;],
         )
         db.session.add(student_profile)
 
     # === PARENTS ===
     parents_data = [
         {
-            &#x27;email&#x27;: &#x27;parent.martin@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Pierre&#x27;,
-            &#x27;last_name&#x27;: &#x27;Martin&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 111 222&#x27;,
-            &#x27;children_emails&#x27;: [&#x27;sarah.martin@email.com&#x27;]
-        },
-        {
-            &#x27;email&#x27;: &#x27;parent.benali@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Fatma&#x27;,
-            &#x27;last_name&#x27;: &#x27;Ben Ali&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 333 444&#x27;,
-            &#x27;children_emails&#x27;: [&#x27;ahmed.ben.ali@email.com&#x27;]
-        },
-        {
-            &#x27;email&#x27;: &#x27;parent.dubois@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Marie&#x27;,
-            &#x27;last_name&#x27;: &#x27;Dubois&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 555 666&#x27;,
-            &#x27;children_emails&#x27;: [&#x27;lea.dubois@email.com&#x27;]
-        }
+            &quot;email&quot;: &quot;parent.martin@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Pierre&quot;,
+            &quot;last_name&quot;: &quot;Martin&quot;,
+            &quot;phone&quot;: &quot;+216 20 111 222&quot;,
+            &quot;children_emails&quot;: [&quot;sarah.martin@email.com&quot;],
+        },
+        {
+            &quot;email&quot;: &quot;parent.benali@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Fatma&quot;,
+            &quot;last_name&quot;: &quot;Ben Ali&quot;,
+            &quot;phone&quot;: &quot;+216 20 333 444&quot;,
+            &quot;children_emails&quot;: [&quot;ahmed.ben.ali@email.com&quot;],
+        },
+        {
+            &quot;email&quot;: &quot;parent.dubois@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Marie&quot;,
+            &quot;last_name&quot;: &quot;Dubois&quot;,
+            &quot;phone&quot;: &quot;+216 20 555 666&quot;,
+            &quot;children_emails&quot;: [&quot;lea.dubois@email.com&quot;],
+        },
     ]
 
     for parent_data in parents_data:
         parent = User(
-            email=parent_data[&#x27;email&#x27;],
-            password=parent_data[&#x27;password&#x27;],
-            first_name=parent_data[&#x27;first_name&#x27;],
-            last_name=parent_data[&#x27;last_name&#x27;],
-            phone=parent_data.get(&#x27;phone&#x27;),
+            email=parent_data[&quot;email&quot;],
+            password=parent_data[&quot;password&quot;],
+            first_name=parent_data[&quot;first_name&quot;],
+            last_name=parent_data[&quot;last_name&quot;],
+            phone=parent_data.get(&quot;phone&quot;),
             role=UserRole.PARENT,
             status=UserStatus.ACTIVE,
-            email_verified=True
+            email_verified=True,
         )
         db.session.add(parent)
 
     # Commit des utilisateurs
     print(&quot;üíæ Sauvegarde des utilisateurs...&quot;)
@@ -247,178 +248,178 @@
     # === FORMULES D&#x27;ACCOMPAGNEMENT ===
     print(&quot;üìã Cr√©ation des formules d&#x27;accompagnement...&quot;)
 
     formulas_data = [
         {
-            &#x27;name&#x27;: &#x27;Coaching Premium&#x27;,
-            &#x27;type&#x27;: FormulaType.INDIVIDUAL,
-            &#x27;price&#x27;: 320.0,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_weeks&#x27;: 4,
-            &#x27;hours_per_week&#x27;: 1,
-            &#x27;description&#x27;: &#x27;Accompagnement individuel premium avec suivi personnalis√©&#x27;,
-            &#x27;features&#x27;: [
-                &#x27;4h de cours particuliers par mois&#x27;,
-                &#x27;Acc√®s complet √† la plateforme&#x27;,
-                &#x27;Reporting hebdomadaire d√©taill√©&#x27;,
-                &#x27;Support ARIA 24/7&#x27;,
-                &#x27;Fiches personnalis√©es&#x27;
-            ],
-            &#x27;target_audience&#x27;: &#x27;√âl√®ves souhaitant un accompagnement sur mesure&#x27;
-        },
-        {
-            &#x27;name&#x27;: &#x27;Excellence Bac&#x27;,
-            &#x27;type&#x27;: FormulaType.INDIVIDUAL,
-            &#x27;price&#x27;: 420.0,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_weeks&#x27;: 4,
-            &#x27;hours_per_week&#x27;: 1.5,
-            &#x27;description&#x27;: &#x27;Pr√©paration intensive au Baccalaur√©at fran√ßais&#x27;,
-            &#x27;features&#x27;: [
-                &#x27;6h de cours particuliers par mois&#x27;,
-                &#x27;Simulations de Bac personnalis√©es&#x27;,
-                &#x27;Objectifs cibl√©s par mati√®re&#x27;,
-                &#x27;Grand Oral inclus&#x27;,
-                &#x27;Correction de copies&#x27;
-            ],
-            &#x27;target_audience&#x27;: &#x27;Terminales visant l\&#x27;excellence au Bac&#x27;
-        },
-        {
-            &#x27;name&#x27;: &#x27;Groupe R√©ussite&#x27;,
-            &#x27;type&#x27;: FormulaType.GROUP,
-            &#x27;price&#x27;: 180.0,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_weeks&#x27;: 4,
-            &#x27;hours_per_week&#x27;: 0.5,
-            &#x27;description&#x27;: &#x27;Mini-groupe de 3-5 √©l√®ves de niveau homog√®ne&#x27;,
-            &#x27;features&#x27;: [
-                &#x27;2h de cours en groupe par semaine&#x27;,
-                &#x27;Module en ligne personnalis√©&#x27;,
-                &#x27;√âmulation collective&#x27;,
-                &#x27;Tarif avantageux&#x27;,
-                &#x27;Suivi individuel dans le groupe&#x27;
-            ],
-            &#x27;target_audience&#x27;: &#x27;√âl√®ves appr√©ciant l\&#x27;apprentissage en groupe&#x27;
-        },
-        {
-            &#x27;name&#x27;: &#x27;Combo R√©vision&#x27;,
-            &#x27;type&#x27;: FormulaType.GROUP,
-            &#x27;price&#x27;: 290.0,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_weeks&#x27;: 4,
-            &#x27;hours_per_week&#x27;: 1,
-            &#x27;description&#x27;: &#x27;R√©vision intensive en groupe sur 2 mati√®res&#x27;,
-            &#x27;features&#x27;: [
-                &#x27;2 mati√®res au choix&#x27;,
-                &#x27;4h de cours par semaine&#x27;,
-                &#x27;Groupes de 3-4 √©l√®ves&#x27;,
-                &#x27;M√©thodes collaboratives&#x27;,
-                &#x27;Contr√¥les r√©guliers&#x27;
-            ],
-            &#x27;target_audience&#x27;: &#x27;√âl√®ves souhaitant r√©viser efficacement&#x27;
-        },
-        {
-            &#x27;name&#x27;: &#x27;Duo Sciences&#x27;,
-            &#x27;type&#x27;: FormulaType.SPECIALIZED,
-            &#x27;price&#x27;: 400.0,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_weeks&#x27;: 4,
-            &#x27;hours_per_week&#x27;: 1,
-            &#x27;description&#x27;: &#x27;Maths + NSI en formule hybride optimis√©e&#x27;,
-            &#x27;features&#x27;: [
-                &#x27;Maths et NSI combin√©es&#x27;,
-                &#x27;Approche transversale&#x27;,
-                &#x27;Projets pratiques&#x27;,
-                &#x27;Pr√©paration √©tudes sup√©rieures&#x27;,
-                &#x27;Portfolio de projets&#x27;
-            ],
-            &#x27;target_audience&#x27;: &#x27;Futurs ing√©nieurs et d√©veloppeurs&#x27;
-        },
-        {
-            &#x27;name&#x27;: &#x27;Grand Oral&#x27;,
-            &#x27;type&#x27;: FormulaType.SPECIALIZED,
-            &#x27;price&#x27;: 390.0,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_weeks&#x27;: 8,
-            &#x27;hours_per_week&#x27;: 0.5,
-            &#x27;description&#x27;: &#x27;Pr√©paration compl√®te au Grand Oral du Bac&#x27;,
-            &#x27;features&#x27;: [
-                &#x27;M√©thodologie compl√®te&#x27;,
-                &#x27;Entra√Ænements film√©s&#x27;,
-                &#x27;Feedback d√©taill√©&#x27;,
-                &#x27;Gestion du stress&#x27;,
-                &#x27;Simulations r√©elles&#x27;
-            ],
-            &#x27;target_audience&#x27;: &#x27;Terminales pr√©parant le Grand Oral&#x27;
-        }
+            &quot;name&quot;: &quot;Coaching Premium&quot;,
+            &quot;type&quot;: FormulaType.INDIVIDUAL,
+            &quot;price&quot;: 320.0,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_weeks&quot;: 4,
+            &quot;hours_per_week&quot;: 1,
+            &quot;description&quot;: &quot;Accompagnement individuel premium avec suivi personnalis√©&quot;,
+            &quot;features&quot;: [
+                &quot;4h de cours particuliers par mois&quot;,
+                &quot;Acc√®s complet √† la plateforme&quot;,
+                &quot;Reporting hebdomadaire d√©taill√©&quot;,
+                &quot;Support ARIA 24/7&quot;,
+                &quot;Fiches personnalis√©es&quot;,
+            ],
+            &quot;target_audience&quot;: &quot;√âl√®ves souhaitant un accompagnement sur mesure&quot;,
+        },
+        {
+            &quot;name&quot;: &quot;Excellence Bac&quot;,
+            &quot;type&quot;: FormulaType.INDIVIDUAL,
+            &quot;price&quot;: 420.0,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_weeks&quot;: 4,
+            &quot;hours_per_week&quot;: 1.5,
+            &quot;description&quot;: &quot;Pr√©paration intensive au Baccalaur√©at fran√ßais&quot;,
+            &quot;features&quot;: [
+                &quot;6h de cours particuliers par mois&quot;,
+                &quot;Simulations de Bac personnalis√©es&quot;,
+                &quot;Objectifs cibl√©s par mati√®re&quot;,
+                &quot;Grand Oral inclus&quot;,
+                &quot;Correction de copies&quot;,
+            ],
+            &quot;target_audience&quot;: &quot;Terminales visant l&#x27;excellence au Bac&quot;,
+        },
+        {
+            &quot;name&quot;: &quot;Groupe R√©ussite&quot;,
+            &quot;type&quot;: FormulaType.GROUP,
+            &quot;price&quot;: 180.0,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_weeks&quot;: 4,
+            &quot;hours_per_week&quot;: 0.5,
+            &quot;description&quot;: &quot;Mini-groupe de 3-5 √©l√®ves de niveau homog√®ne&quot;,
+            &quot;features&quot;: [
+                &quot;2h de cours en groupe par semaine&quot;,
+                &quot;Module en ligne personnalis√©&quot;,
+                &quot;√âmulation collective&quot;,
+                &quot;Tarif avantageux&quot;,
+                &quot;Suivi individuel dans le groupe&quot;,
+            ],
+            &quot;target_audience&quot;: &quot;√âl√®ves appr√©ciant l&#x27;apprentissage en groupe&quot;,
+        },
+        {
+            &quot;name&quot;: &quot;Combo R√©vision&quot;,
+            &quot;type&quot;: FormulaType.GROUP,
+            &quot;price&quot;: 290.0,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_weeks&quot;: 4,
+            &quot;hours_per_week&quot;: 1,
+            &quot;description&quot;: &quot;R√©vision intensive en groupe sur 2 mati√®res&quot;,
+            &quot;features&quot;: [
+                &quot;2 mati√®res au choix&quot;,
+                &quot;4h de cours par semaine&quot;,
+                &quot;Groupes de 3-4 √©l√®ves&quot;,
+                &quot;M√©thodes collaboratives&quot;,
+                &quot;Contr√¥les r√©guliers&quot;,
+            ],
+            &quot;target_audience&quot;: &quot;√âl√®ves souhaitant r√©viser efficacement&quot;,
+        },
+        {
+            &quot;name&quot;: &quot;Duo Sciences&quot;,
+            &quot;type&quot;: FormulaType.SPECIALIZED,
+            &quot;price&quot;: 400.0,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_weeks&quot;: 4,
+            &quot;hours_per_week&quot;: 1,
+            &quot;description&quot;: &quot;Maths + NSI en formule hybride optimis√©e&quot;,
+            &quot;features&quot;: [
+                &quot;Maths et NSI combin√©es&quot;,
+                &quot;Approche transversale&quot;,
+                &quot;Projets pratiques&quot;,
+                &quot;Pr√©paration √©tudes sup√©rieures&quot;,
+                &quot;Portfolio de projets&quot;,
+            ],
+            &quot;target_audience&quot;: &quot;Futurs ing√©nieurs et d√©veloppeurs&quot;,
+        },
+        {
+            &quot;name&quot;: &quot;Grand Oral&quot;,
+            &quot;type&quot;: FormulaType.SPECIALIZED,
+            &quot;price&quot;: 390.0,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_weeks&quot;: 8,
+            &quot;hours_per_week&quot;: 0.5,
+            &quot;description&quot;: &quot;Pr√©paration compl√®te au Grand Oral du Bac&quot;,
+            &quot;features&quot;: [
+                &quot;M√©thodologie compl√®te&quot;,
+                &quot;Entra√Ænements film√©s&quot;,
+                &quot;Feedback d√©taill√©&quot;,
+                &quot;Gestion du stress&quot;,
+                &quot;Simulations r√©elles&quot;,
+            ],
+            &quot;target_audience&quot;: &quot;Terminales pr√©parant le Grand Oral&quot;,
+        },
     ]
 
     for formula_data in formulas_data:
         formula = Formula(
-            name=formula_data[&#x27;name&#x27;],
-            type=formula_data[&#x27;type&#x27;],
-            price=formula_data[&#x27;price&#x27;],
-            currency=formula_data[&#x27;currency&#x27;],
-            duration_weeks=formula_data[&#x27;duration_weeks&#x27;],
-            hours_per_week=formula_data[&#x27;hours_per_week&#x27;],
-            description=formula_data[&#x27;description&#x27;],
-            features=formula_data[&#x27;features&#x27;],
-            target_audience=formula_data[&#x27;target_audience&#x27;],
-            is_active=True
+            name=formula_data[&quot;name&quot;],
+            type=formula_data[&quot;type&quot;],
+            price=formula_data[&quot;price&quot;],
+            currency=formula_data[&quot;currency&quot;],
+            duration_weeks=formula_data[&quot;duration_weeks&quot;],
+            hours_per_week=formula_data[&quot;hours_per_week&quot;],
+            description=formula_data[&quot;description&quot;],
+            features=formula_data[&quot;features&quot;],
+            target_audience=formula_data[&quot;target_audience&quot;],
+            is_active=True,
         )
         db.session.add(formula)
 
     # === CONTENU P√âDAGOGIQUE ===
     print(&quot;üìö Cr√©ation du contenu p√©dagogique...&quot;)
 
     # Cours de Math√©matiques Terminale
     math_course = Course(
-        title=&#x27;Math√©matiques Terminale&#x27;,
-        description=&#x27;Cours complet de math√©matiques pour la classe de Terminale&#x27;,
-        subject=&#x27;Math√©matiques&#x27;,
-        level=&#x27;Terminale&#x27;,
+        title=&quot;Math√©matiques Terminale&quot;,
+        description=&quot;Cours complet de math√©matiques pour la classe de Terminale&quot;,
+        subject=&quot;Math√©matiques&quot;,
+        level=&quot;Terminale&quot;,
         duration_hours=120,
         difficulty_level=8,
-        is_published=True
+        is_published=True,
     )
     db.session.add(math_course)
     db.session.flush()
 
     # Modules du cours de maths
     math_modules = [
         {
-            &#x27;title&#x27;: &#x27;Fonctions et D√©rivation&#x27;,
-            &#x27;description&#x27;: &#x27;√âtude compl√®te des fonctions et de la d√©rivation&#x27;,
-            &#x27;content&#x27;: &#x27;Module couvrant les fonctions, limites, d√©riv√©es et applications&#x27;,
-            &#x27;order_index&#x27;: 1,
-            &#x27;estimated_duration&#x27;: 20
-        },
-        {
-            &#x27;title&#x27;: &#x27;Int√©gration&#x27;,
-            &#x27;description&#x27;: &#x27;Calcul int√©gral et applications&#x27;,
-            &#x27;content&#x27;: &#x27;Primitives, int√©grales d√©finies et applications g√©om√©triques&#x27;,
-            &#x27;order_index&#x27;: 2,
-            &#x27;estimated_duration&#x27;: 15
-        },
-        {
-            &#x27;title&#x27;: &#x27;Probabilit√©s&#x27;,
-            &#x27;description&#x27;: &#x27;Probabilit√©s et statistiques&#x27;,
-            &#x27;content&#x27;: &#x27;Variables al√©atoires, lois de probabilit√©, statistiques&#x27;,
-            &#x27;order_index&#x27;: 3,
-            &#x27;estimated_duration&#x27;: 18
-        }
+            &quot;title&quot;: &quot;Fonctions et D√©rivation&quot;,
+            &quot;description&quot;: &quot;√âtude compl√®te des fonctions et de la d√©rivation&quot;,
+            &quot;content&quot;: &quot;Module couvrant les fonctions, limites, d√©riv√©es et applications&quot;,
+            &quot;order_index&quot;: 1,
+            &quot;estimated_duration&quot;: 20,
+        },
+        {
+            &quot;title&quot;: &quot;Int√©gration&quot;,
+            &quot;description&quot;: &quot;Calcul int√©gral et applications&quot;,
+            &quot;content&quot;: &quot;Primitives, int√©grales d√©finies et applications g√©om√©triques&quot;,
+            &quot;order_index&quot;: 2,
+            &quot;estimated_duration&quot;: 15,
+        },
+        {
+            &quot;title&quot;: &quot;Probabilit√©s&quot;,
+            &quot;description&quot;: &quot;Probabilit√©s et statistiques&quot;,
+            &quot;content&quot;: &quot;Variables al√©atoires, lois de probabilit√©, statistiques&quot;,
+            &quot;order_index&quot;: 3,
+            &quot;estimated_duration&quot;: 18,
+        },
     ]
 
     for module_data in math_modules:
         module = Module(
             course_id=math_course.id,
-            title=module_data[&#x27;title&#x27;],
-            description=module_data[&#x27;description&#x27;],
-            content=module_data[&#x27;content&#x27;],
-            order_index=module_data[&#x27;order_index&#x27;],
-            estimated_duration=module_data[&#x27;estimated_duration&#x27;],
-            is_published=True
+            title=module_data[&quot;title&quot;],
+            description=module_data[&quot;description&quot;],
+            content=module_data[&quot;content&quot;],
+            order_index=module_data[&quot;order_index&quot;],
+            estimated_duration=module_data[&quot;estimated_duration&quot;],
+            is_published=True,
         )
         db.session.add(module)
 
     # Commit final
     print(&quot;üíæ Sauvegarde finale...&quot;)
@@ -430,10 +431,10 @@
     print(&quot;üë®‚Äçüè´ Enseignants: marc.dubois@nexus-reussite.com / teacher123&quot;)
     print(&quot;üë®‚Äçüéì √âtudiants: sarah.martin@email.com / demo123&quot;)
     print(&quot;üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parents: parent.martin@email.com / demo123&quot;)
 
 
-if __name__ == &#x27;__main__&#x27;:
+if __name__ == &quot;__main__&quot;:
     app = create_app()
 
     with app.app_context():
         init_database()
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/student.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/student.py	2025-07-24 20:54:02.192300+00:00
@@ -1,142 +1,200 @@
 from ..database import db
 from datetime import datetime
 import json
 
+
 class Student(db.Model):
     &quot;&quot;&quot;Mod√®le pour les √©tudiants de Nexus R√©ussite&quot;&quot;&quot;
-    __tablename__ = &#x27;students&#x27;
+
+    __tablename__ = &quot;students&quot;
 
     id = db.Column(db.Integer, primary_key=True)
     full_name = db.Column(db.String(100), nullable=False)
     email = db.Column(db.String(120), unique=True, nullable=False)
     phone = db.Column(db.String(20), nullable=True)
-    grade_level = db.Column(db.String(20), nullable=False)  # seconde, premiere, terminale
+    grade_level = db.Column(
+        db.String(20), nullable=False
+    )  # seconde, premiere, terminale
     school = db.Column(db.String(100), nullable=True)
     preferred_subjects = db.Column(db.Text, nullable=True)  # JSON string
 
     # Profil d&#x27;apprentissage ARIA
-    learning_style = db.Column(db.String(50), nullable=True)  # visual, auditory, kinesthetic, mixed
-    cognitive_profile = db.Column(db.Text, nullable=True)  # JSON string avec les pr√©f√©rences
-    performance_data = db.Column(db.Text, nullable=True)  # JSON string avec les performances
-
-    # M√©tadonn√©es
-    created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
+    learning_style = db.Column(
+        db.String(50), nullable=True
+    )  # visual, auditory, kinesthetic, mixed
+    cognitive_profile = db.Column(
+        db.Text, nullable=True
+    )  # JSON string avec les pr√©f√©rences
+    performance_data = db.Column(
+        db.Text, nullable=True
+    )  # JSON string avec les performances
+
+    # M√©tadonn√©es
+    created_at = db.Column(db.DateTime, default=datetime.utcnow)
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
     is_active = db.Column(db.Boolean, default=True)
 
     # Relations
-    sessions = db.relationship(&#x27;LearningSession&#x27;, backref=&#x27;student&#x27;, lazy=True, cascade=&#x27;all, delete-orphan&#x27;)
-    assessments = db.relationship(&#x27;Assessment&#x27;, backref=&#x27;student&#x27;, lazy=True, cascade=&#x27;all, delete-orphan&#x27;)
-
-    def __init__(self, full_name, email, grade_level, phone=None, school=None, preferred_subjects=None):
+    sessions = db.relationship(
+        &quot;LearningSession&quot;, backref=&quot;student&quot;, lazy=True, cascade=&quot;all, delete-orphan&quot;
+    )
+    assessments = db.relationship(
+        &quot;Assessment&quot;, backref=&quot;student&quot;, lazy=True, cascade=&quot;all, delete-orphan&quot;
+    )
+
+    def __init__(
+        self,
+        full_name,
+        email,
+        grade_level,
+        phone=None,
+        school=None,
+        preferred_subjects=None,
+    ):
         self.full_name = full_name
         self.email = email
         self.phone = phone
         self.grade_level = grade_level
         self.school = school
-        self.preferred_subjects = json.dumps(preferred_subjects) if preferred_subjects else None
+        self.preferred_subjects = (
+            json.dumps(preferred_subjects) if preferred_subjects else None
+        )
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit l&#x27;objet Student en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;full_name&#x27;: self.full_name,
-            &#x27;email&#x27;: self.email,
-            &#x27;phone&#x27;: self.phone,
-            &#x27;grade_level&#x27;: self.grade_level,
-            &#x27;school&#x27;: self.school,
-            &#x27;preferred_subjects&#x27;: json.loads(self.preferred_subjects) if self.preferred_subjects else [],
-            &#x27;learning_style&#x27;: self.learning_style,
-            &#x27;cognitive_profile&#x27;: json.loads(self.cognitive_profile) if self.cognitive_profile else {},
-            &#x27;performance_data&#x27;: json.loads(self.performance_data) if self.performance_data else {},
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None,
-            &#x27;is_active&#x27;: self.is_active
+            &quot;id&quot;: self.id,
+            &quot;full_name&quot;: self.full_name,
+            &quot;email&quot;: self.email,
+            &quot;phone&quot;: self.phone,
+            &quot;grade_level&quot;: self.grade_level,
+            &quot;school&quot;: self.school,
+            &quot;preferred_subjects&quot;: (
+                json.loads(self.preferred_subjects) if self.preferred_subjects else []
+            ),
+            &quot;learning_style&quot;: self.learning_style,
+            &quot;cognitive_profile&quot;: (
+                json.loads(self.cognitive_profile) if self.cognitive_profile else {}
+            ),
+            &quot;performance_data&quot;: (
+                json.loads(self.performance_data) if self.performance_data else {}
+            ),
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+            &quot;is_active&quot;: self.is_active,
         }
 
     def update_cognitive_profile(self, profile_data):
         &quot;&quot;&quot;Met √† jour le profil cognitif de l&#x27;√©tudiant&quot;&quot;&quot;
-        current_profile = json.loads(self.cognitive_profile) if self.cognitive_profile else {}
+        current_profile = (
+            json.loads(self.cognitive_profile) if self.cognitive_profile else {}
+        )
         current_profile.update(profile_data)
         self.cognitive_profile = json.dumps(current_profile)
         self.updated_at = datetime.utcnow()
 
     def update_performance_data(self, performance_data):
         &quot;&quot;&quot;Met √† jour les donn√©es de performance de l&#x27;√©tudiant&quot;&quot;&quot;
-        current_data = json.loads(self.performance_data) if self.performance_data else {}
+        current_data = (
+            json.loads(self.performance_data) if self.performance_data else {}
+        )
         current_data.update(performance_data)
         self.performance_data = json.dumps(current_data)
         self.updated_at = datetime.utcnow()
 
 
 class LearningSession(db.Model):
     &quot;&quot;&quot;Mod√®le pour les sessions d&#x27;apprentissage avec ARIA&quot;&quot;&quot;
-    __tablename__ = &#x27;learning_sessions&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;learning_sessions&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
 
     # Informations de session
     subject = db.Column(db.String(50), nullable=False)
     topic = db.Column(db.String(100), nullable=False)
-    session_type = db.Column(db.String(30), nullable=False)  # practice, assessment, review, tutoring
+    session_type = db.Column(
+        db.String(30), nullable=False
+    )  # practice, assessment, review, tutoring
     duration_minutes = db.Column(db.Integer, nullable=True)
 
     # Donn√©es ARIA
     aria_recommendations = db.Column(db.Text, nullable=True)  # JSON string
     interaction_data = db.Column(db.Text, nullable=True)  # JSON string
     performance_metrics = db.Column(db.Text, nullable=True)  # JSON string
 
     # R√©sultats
     completion_rate = db.Column(db.Float, nullable=True)  # 0.0 √† 1.0
     accuracy_rate = db.Column(db.Float, nullable=True)  # 0.0 √† 1.0
-    difficulty_level = db.Column(db.String(20), nullable=True)  # easy, medium, hard, expert
+    difficulty_level = db.Column(
+        db.String(20), nullable=True
+    )  # easy, medium, hard, expert
 
     # M√©tadonn√©es
     started_at = db.Column(db.DateTime, default=datetime.utcnow)
     completed_at = db.Column(db.DateTime, nullable=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit l&#x27;objet LearningSession en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;student_id&#x27;: self.student_id,
-            &#x27;subject&#x27;: self.subject,
-            &#x27;topic&#x27;: self.topic,
-            &#x27;session_type&#x27;: self.session_type,
-            &#x27;duration_minutes&#x27;: self.duration_minutes,
-            &#x27;aria_recommendations&#x27;: json.loads(self.aria_recommendations) if self.aria_recommendations else {},
-            &#x27;interaction_data&#x27;: json.loads(self.interaction_data) if self.interaction_data else {},
-            &#x27;performance_metrics&#x27;: json.loads(self.performance_metrics) if self.performance_metrics else {},
-            &#x27;completion_rate&#x27;: self.completion_rate,
-            &#x27;accuracy_rate&#x27;: self.accuracy_rate,
-            &#x27;difficulty_level&#x27;: self.difficulty_level,
-            &#x27;started_at&#x27;: self.started_at.isoformat() if self.started_at else None,
-            &#x27;completed_at&#x27;: self.completed_at.isoformat() if self.completed_at else None,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None
+            &quot;id&quot;: self.id,
+            &quot;student_id&quot;: self.student_id,
+            &quot;subject&quot;: self.subject,
+            &quot;topic&quot;: self.topic,
+            &quot;session_type&quot;: self.session_type,
+            &quot;duration_minutes&quot;: self.duration_minutes,
+            &quot;aria_recommendations&quot;: (
+                json.loads(self.aria_recommendations)
+                if self.aria_recommendations
+                else {}
+            ),
+            &quot;interaction_data&quot;: (
+                json.loads(self.interaction_data) if self.interaction_data else {}
+            ),
+            &quot;performance_metrics&quot;: (
+                json.loads(self.performance_metrics) if self.performance_metrics else {}
+            ),
+            &quot;completion_rate&quot;: self.completion_rate,
+            &quot;accuracy_rate&quot;: self.accuracy_rate,
+            &quot;difficulty_level&quot;: self.difficulty_level,
+            &quot;started_at&quot;: self.started_at.isoformat() if self.started_at else None,
+            &quot;completed_at&quot;: (
+                self.completed_at.isoformat() if self.completed_at else None
+            ),
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
         }
 
 
 class Assessment(db.Model):
     &quot;&quot;&quot;Mod√®le pour les √©valuations g√©n√©r√©es par ARIA&quot;&quot;&quot;
-    __tablename__ = &#x27;assessments&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;assessments&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
 
     # Informations d&#x27;√©valuation
     title = db.Column(db.String(100), nullable=False)
     subject = db.Column(db.String(50), nullable=False)
-    assessment_type = db.Column(db.String(30), nullable=False)  # diagnostic, formative, summative
-    questions_data = db.Column(db.Text, nullable=False)  # JSON string avec les questions
+    assessment_type = db.Column(
+        db.String(30), nullable=False
+    )  # diagnostic, formative, summative
+    questions_data = db.Column(
+        db.Text, nullable=False
+    )  # JSON string avec les questions
 
     # R√©sultats
     answers_data = db.Column(db.Text, nullable=True)  # JSON string avec les r√©ponses
     score = db.Column(db.Float, nullable=True)  # Score sur 100
-    detailed_results = db.Column(db.Text, nullable=True)  # JSON string avec analyse d√©taill√©e
+    detailed_results = db.Column(
+        db.Text, nullable=True
+    )  # JSON string avec analyse d√©taill√©e
 
     # Recommandations ARIA
     aria_feedback = db.Column(db.Text, nullable=True)  # JSON string
     next_steps = db.Column(db.Text, nullable=True)  # JSON string
 
@@ -146,36 +204,47 @@
     is_completed = db.Column(db.Boolean, default=False)
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit l&#x27;objet Assessment en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;student_id&#x27;: self.student_id,
-            &#x27;title&#x27;: self.title,
-            &#x27;subject&#x27;: self.subject,
-            &#x27;assessment_type&#x27;: self.assessment_type,
-            &#x27;questions_data&#x27;: json.loads(self.questions_data) if self.questions_data else {},
-            &#x27;answers_data&#x27;: json.loads(self.answers_data) if self.answers_data else {},
-            &#x27;score&#x27;: self.score,
-            &#x27;detailed_results&#x27;: json.loads(self.detailed_results) if self.detailed_results else {},
-            &#x27;aria_feedback&#x27;: json.loads(self.aria_feedback) if self.aria_feedback else {},
-            &#x27;next_steps&#x27;: json.loads(self.next_steps) if self.next_steps else {},
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;completed_at&#x27;: self.completed_at.isoformat() if self.completed_at else None,
-            &#x27;is_completed&#x27;: self.is_completed
+            &quot;id&quot;: self.id,
+            &quot;student_id&quot;: self.student_id,
+            &quot;title&quot;: self.title,
+            &quot;subject&quot;: self.subject,
+            &quot;assessment_type&quot;: self.assessment_type,
+            &quot;questions_data&quot;: (
+                json.loads(self.questions_data) if self.questions_data else {}
+            ),
+            &quot;answers_data&quot;: json.loads(self.answers_data) if self.answers_data else {},
+            &quot;score&quot;: self.score,
+            &quot;detailed_results&quot;: (
+                json.loads(self.detailed_results) if self.detailed_results else {}
+            ),
+            &quot;aria_feedback&quot;: (
+                json.loads(self.aria_feedback) if self.aria_feedback else {}
+            ),
+            &quot;next_steps&quot;: json.loads(self.next_steps) if self.next_steps else {},
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;completed_at&quot;: (
+                self.completed_at.isoformat() if self.completed_at else None
+            ),
+            &quot;is_completed&quot;: self.is_completed,
         }
 
 
 class ARIAInteraction(db.Model):
     &quot;&quot;&quot;Mod√®le pour les interactions avec l&#x27;IA ARIA&quot;&quot;&quot;
-    __tablename__ = &#x27;aria_interactions&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;aria_interactions&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
 
     # Donn√©es d&#x27;interaction
-    interaction_type = db.Column(db.String(30), nullable=False)  # chat, recommendation, assessment, feedback
+    interaction_type = db.Column(
+        db.String(30), nullable=False
+    )  # chat, recommendation, assessment, feedback
     user_input = db.Column(db.Text, nullable=True)
     aria_response = db.Column(db.Text, nullable=False)
     context_data = db.Column(db.Text, nullable=True)  # JSON string avec le contexte
 
     # M√©tadonn√©es d&#x27;analyse
@@ -187,17 +256,16 @@
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit l&#x27;objet ARIAInteraction en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;student_id&#x27;: self.student_id,
-            &#x27;interaction_type&#x27;: self.interaction_type,
-            &#x27;user_input&#x27;: self.user_input,
-            &#x27;aria_response&#x27;: self.aria_response,
-            &#x27;context_data&#x27;: json.loads(self.context_data) if self.context_data else {},
-            &#x27;confidence_score&#x27;: self.confidence_score,
-            &#x27;processing_time_ms&#x27;: self.processing_time_ms,
-            &#x27;feedback_rating&#x27;: self.feedback_rating,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None
-        }
-
+            &quot;id&quot;: self.id,
+            &quot;student_id&quot;: self.student_id,
+            &quot;interaction_type&quot;: self.interaction_type,
+            &quot;user_input&quot;: self.user_input,
+            &quot;aria_response&quot;: self.aria_response,
+            &quot;context_data&quot;: json.loads(self.context_data) if self.context_data else {},
+            &quot;confidence_score&quot;: self.confidence_score,
+            &quot;processing_time_ms&quot;: self.processing_time_ms,
+            &quot;feedback_rating&quot;: self.feedback_rating,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+        }
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database/init_db.py	2025-07-24 07:24:17.020976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database/init_db.py	2025-07-24 20:54:02.271706+00:00
@@ -12,198 +12,205 @@
 # Ajouter le r√©pertoire parent au path pour les imports
 sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
 
 from main import app, db
 from models.student import Student, Parent, Teacher, Admin, User
-from models.content_system import ContentModule, LearningPath, Quiz, QuizQuestion, StudentProgress
+from models.content_system import (
+    ContentModule,
+    LearningPath,
+    Quiz,
+    QuizQuestion,
+    StudentProgress,
+)
 from models.formulas import Formula, Enrollment
+
 
 def create_demo_users():
     &quot;&quot;&quot;Cr√©er les utilisateurs de d√©monstration&quot;&quot;&quot;
     print(&quot;Cr√©ation des utilisateurs de d√©monstration...&quot;)
 
     # √âtudiants
     students_data = [
         {
-            &#x27;email&#x27;: &#x27;sarah.martin@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Sarah&#x27;,
-            &#x27;last_name&#x27;: &#x27;Martin&#x27;,
-            &#x27;grade&#x27;: &#x27;Terminale&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;NSI&#x27;, &#x27;Physique&#x27;],
-            &#x27;learning_style&#x27;: &#x27;Visuel&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 123 456&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;ahmed.ben.ali@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Ahmed&#x27;,
-            &#x27;last_name&#x27;: &#x27;Ben Ali&#x27;,
-            &#x27;grade&#x27;: &#x27;Premi√®re&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;Physique&#x27;],
-            &#x27;learning_style&#x27;: &#x27;Auditif&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 234 567&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;lea.dubois@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;L√©a&#x27;,
-            &#x27;last_name&#x27;: &#x27;Dubois&#x27;,
-            &#x27;grade&#x27;: &#x27;Terminale&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Fran√ßais&#x27;, &#x27;Philosophie&#x27;],
-            &#x27;learning_style&#x27;: &#x27;Kinesth√©sique&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 345 678&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;youssef.trabelsi@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Youssef&#x27;,
-            &#x27;last_name&#x27;: &#x27;Trabelsi&#x27;,
-            &#x27;grade&#x27;: &#x27;Terminale&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Math√©matiques&#x27;, &#x27;NSI&#x27;],
-            &#x27;learning_style&#x27;: &#x27;Logique&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 456 789&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;nour.ben.salem@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Nour&#x27;,
-            &#x27;last_name&#x27;: &#x27;Ben Salem&#x27;,
-            &#x27;grade&#x27;: &#x27;Premi√®re&#x27;,
-            &#x27;specialties&#x27;: [&#x27;Physique&#x27;, &#x27;Math√©matiques&#x27;],
-            &#x27;learning_style&#x27;: &#x27;Visuel&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 20 567 890&#x27;
-        }
+            &quot;email&quot;: &quot;sarah.martin@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Sarah&quot;,
+            &quot;last_name&quot;: &quot;Martin&quot;,
+            &quot;grade&quot;: &quot;Terminale&quot;,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;NSI&quot;, &quot;Physique&quot;],
+            &quot;learning_style&quot;: &quot;Visuel&quot;,
+            &quot;phone&quot;: &quot;+216 20 123 456&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;ahmed.ben.ali@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Ahmed&quot;,
+            &quot;last_name&quot;: &quot;Ben Ali&quot;,
+            &quot;grade&quot;: &quot;Premi√®re&quot;,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;Physique&quot;],
+            &quot;learning_style&quot;: &quot;Auditif&quot;,
+            &quot;phone&quot;: &quot;+216 20 234 567&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;lea.dubois@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;L√©a&quot;,
+            &quot;last_name&quot;: &quot;Dubois&quot;,
+            &quot;grade&quot;: &quot;Terminale&quot;,
+            &quot;specialties&quot;: [&quot;Fran√ßais&quot;, &quot;Philosophie&quot;],
+            &quot;learning_style&quot;: &quot;Kinesth√©sique&quot;,
+            &quot;phone&quot;: &quot;+216 20 345 678&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;youssef.trabelsi@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Youssef&quot;,
+            &quot;last_name&quot;: &quot;Trabelsi&quot;,
+            &quot;grade&quot;: &quot;Terminale&quot;,
+            &quot;specialties&quot;: [&quot;Math√©matiques&quot;, &quot;NSI&quot;],
+            &quot;learning_style&quot;: &quot;Logique&quot;,
+            &quot;phone&quot;: &quot;+216 20 456 789&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;nour.ben.salem@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Nour&quot;,
+            &quot;last_name&quot;: &quot;Ben Salem&quot;,
+            &quot;grade&quot;: &quot;Premi√®re&quot;,
+            &quot;specialties&quot;: [&quot;Physique&quot;, &quot;Math√©matiques&quot;],
+            &quot;learning_style&quot;: &quot;Visuel&quot;,
+            &quot;phone&quot;: &quot;+216 20 567 890&quot;,
+        },
     ]
 
     students = []
     for student_data in students_data:
         student = Student(
-            email=student_data[&#x27;email&#x27;],
-            password_hash=generate_password_hash(student_data[&#x27;password&#x27;]),
-            first_name=student_data[&#x27;first_name&#x27;],
-            last_name=student_data[&#x27;last_name&#x27;],
-            role=&#x27;student&#x27;,
-            grade=student_data[&#x27;grade&#x27;],
-            specialties=student_data[&#x27;specialties&#x27;],
-            learning_style=student_data[&#x27;learning_style&#x27;],
-            phone=student_data[&#x27;phone&#x27;],
+            email=student_data[&quot;email&quot;],
+            password_hash=generate_password_hash(student_data[&quot;password&quot;]),
+            first_name=student_data[&quot;first_name&quot;],
+            last_name=student_data[&quot;last_name&quot;],
+            role=&quot;student&quot;,
+            grade=student_data[&quot;grade&quot;],
+            specialties=student_data[&quot;specialties&quot;],
+            learning_style=student_data[&quot;learning_style&quot;],
+            phone=student_data[&quot;phone&quot;],
             is_active=True,
-            created_at=datetime.utcnow()
+            created_at=datetime.utcnow(),
         )
         students.append(student)
         db.session.add(student)
 
     # Parents
     parents_data = [
         {
-            &#x27;email&#x27;: &#x27;parent.martin@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Pierre&#x27;,
-            &#x27;last_name&#x27;: &#x27;Martin&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 70 123 456&#x27;,
-            &#x27;children_emails&#x27;: [&#x27;sarah.martin@email.com&#x27;]
-        },
-        {
-            &#x27;email&#x27;: &#x27;parent.benali@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Fatma&#x27;,
-            &#x27;last_name&#x27;: &#x27;Ben Ali&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 70 234 567&#x27;,
-            &#x27;children_emails&#x27;: [&#x27;ahmed.ben.ali@email.com&#x27;]
-        },
-        {
-            &#x27;email&#x27;: &#x27;parent.dubois@email.com&#x27;,
-            &#x27;password&#x27;: &#x27;demo123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Marie&#x27;,
-            &#x27;last_name&#x27;: &#x27;Dubois&#x27;,
-            &#x27;phone&#x27;: &#x27;+216 70 345 678&#x27;,
-            &#x27;children_emails&#x27;: [&#x27;lea.dubois@email.com&#x27;]
-        }
+            &quot;email&quot;: &quot;parent.martin@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Pierre&quot;,
+            &quot;last_name&quot;: &quot;Martin&quot;,
+            &quot;phone&quot;: &quot;+216 70 123 456&quot;,
+            &quot;children_emails&quot;: [&quot;sarah.martin@email.com&quot;],
+        },
+        {
+            &quot;email&quot;: &quot;parent.benali@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Fatma&quot;,
+            &quot;last_name&quot;: &quot;Ben Ali&quot;,
+            &quot;phone&quot;: &quot;+216 70 234 567&quot;,
+            &quot;children_emails&quot;: [&quot;ahmed.ben.ali@email.com&quot;],
+        },
+        {
+            &quot;email&quot;: &quot;parent.dubois@email.com&quot;,
+            &quot;password&quot;: &quot;demo123&quot;,
+            &quot;first_name&quot;: &quot;Marie&quot;,
+            &quot;last_name&quot;: &quot;Dubois&quot;,
+            &quot;phone&quot;: &quot;+216 70 345 678&quot;,
+            &quot;children_emails&quot;: [&quot;lea.dubois@email.com&quot;],
+        },
     ]
 
     parents = []
     for parent_data in parents_data:
         parent = Parent(
-            email=parent_data[&#x27;email&#x27;],
-            password_hash=generate_password_hash(parent_data[&#x27;password&#x27;]),
-            first_name=parent_data[&#x27;first_name&#x27;],
-            last_name=parent_data[&#x27;last_name&#x27;],
-            role=&#x27;parent&#x27;,
-            phone=parent_data[&#x27;phone&#x27;],
+            email=parent_data[&quot;email&quot;],
+            password_hash=generate_password_hash(parent_data[&quot;password&quot;]),
+            first_name=parent_data[&quot;first_name&quot;],
+            last_name=parent_data[&quot;last_name&quot;],
+            role=&quot;parent&quot;,
+            phone=parent_data[&quot;phone&quot;],
             is_active=True,
-            created_at=datetime.utcnow()
+            created_at=datetime.utcnow(),
         )
         parents.append(parent)
         db.session.add(parent)
 
     # Enseignants
     teachers_data = [
         {
-            &#x27;email&#x27;: &#x27;marc.dubois@nexus-reussite.com&#x27;,
-            &#x27;password&#x27;: &#x27;teacher123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Marc&#x27;,
-            &#x27;last_name&#x27;: &#x27;Dubois&#x27;,
-            &#x27;subjects&#x27;: [&#x27;Math√©matiques&#x27;],
-            &#x27;qualifications&#x27;: [&#x27;Agr√©g√© de Math√©matiques&#x27;, &#x27;AEFE&#x27;],
-            &#x27;experience_years&#x27;: 15,
-            &#x27;phone&#x27;: &#x27;+216 70 111 222&#x27;,
-            &#x27;bio&#x27;: &#x27;Professeur agr√©g√© de math√©matiques avec 15 ans d\&#x27;exp√©rience dans les √©tablissements AEFE.&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;sophie.martin@nexus-reussite.com&#x27;,
-            &#x27;password&#x27;: &#x27;teacher123&#x27;,
-            &#x27;first_name&#x27;: &#x27;Sophie&#x27;,
-            &#x27;last_name&#x27;: &#x27;Martin&#x27;,
-            &#x27;subjects&#x27;: [&#x27;NSI&#x27;, &#x27;Math√©matiques&#x27;],
-            &#x27;qualifications&#x27;: [&#x27;Certifi√©e NSI&#x27;, &#x27;DIU NSI&#x27;, &#x27;AEFE&#x27;],
-            &#x27;experience_years&#x27;: 8,
-            &#x27;phone&#x27;: &#x27;+216 70 222 333&#x27;,
-            &#x27;bio&#x27;: &#x27;Sp√©cialiste NSI dipl√¥m√©e DIU avec une longue exp√©rience en programmation Python.&#x27;
-        },
-        {
-            &#x27;email&#x27;: &#x27;david.rousseau@nexus-reussite.com&#x27;,
-            &#x27;password&#x27;: &#x27;teacher123&#x27;,
-            &#x27;first_name&#x27;: &#x27;David&#x27;,
-            &#x27;last_name&#x27;: &#x27;Rousseau&#x27;,
-            &#x27;subjects&#x27;: [&#x27;Physique-Chimie&#x27;],
-            &#x27;qualifications&#x27;: [&#x27;Docteur en Physique&#x27;, &#x27;AEFE&#x27;],
-            &#x27;experience_years&#x27;: 12,
-            &#x27;phone&#x27;: &#x27;+216 70 333 444&#x27;,
-            &#x27;bio&#x27;: &#x27;Docteur en physique, expert en pr√©paration au Grand Oral et aux concours.&#x27;
-        }
+            &quot;email&quot;: &quot;marc.dubois@nexus-reussite.com&quot;,
+            &quot;password&quot;: &quot;teacher123&quot;,
+            &quot;first_name&quot;: &quot;Marc&quot;,
+            &quot;last_name&quot;: &quot;Dubois&quot;,
+            &quot;subjects&quot;: [&quot;Math√©matiques&quot;],
+            &quot;qualifications&quot;: [&quot;Agr√©g√© de Math√©matiques&quot;, &quot;AEFE&quot;],
+            &quot;experience_years&quot;: 15,
+            &quot;phone&quot;: &quot;+216 70 111 222&quot;,
+            &quot;bio&quot;: &quot;Professeur agr√©g√© de math√©matiques avec 15 ans d&#x27;exp√©rience dans les √©tablissements AEFE.&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;sophie.martin@nexus-reussite.com&quot;,
+            &quot;password&quot;: &quot;teacher123&quot;,
+            &quot;first_name&quot;: &quot;Sophie&quot;,
+            &quot;last_name&quot;: &quot;Martin&quot;,
+            &quot;subjects&quot;: [&quot;NSI&quot;, &quot;Math√©matiques&quot;],
+            &quot;qualifications&quot;: [&quot;Certifi√©e NSI&quot;, &quot;DIU NSI&quot;, &quot;AEFE&quot;],
+            &quot;experience_years&quot;: 8,
+            &quot;phone&quot;: &quot;+216 70 222 333&quot;,
+            &quot;bio&quot;: &quot;Sp√©cialiste NSI dipl√¥m√©e DIU avec une longue exp√©rience en programmation Python.&quot;,
+        },
+        {
+            &quot;email&quot;: &quot;david.rousseau@nexus-reussite.com&quot;,
+            &quot;password&quot;: &quot;teacher123&quot;,
+            &quot;first_name&quot;: &quot;David&quot;,
+            &quot;last_name&quot;: &quot;Rousseau&quot;,
+            &quot;subjects&quot;: [&quot;Physique-Chimie&quot;],
+            &quot;qualifications&quot;: [&quot;Docteur en Physique&quot;, &quot;AEFE&quot;],
+            &quot;experience_years&quot;: 12,
+            &quot;phone&quot;: &quot;+216 70 333 444&quot;,
+            &quot;bio&quot;: &quot;Docteur en physique, expert en pr√©paration au Grand Oral et aux concours.&quot;,
+        },
     ]
 
     teachers = []
     for teacher_data in teachers_data:
         teacher = Teacher(
-            email=teacher_data[&#x27;email&#x27;],
-            password_hash=generate_password_hash(teacher_data[&#x27;password&#x27;]),
-            first_name=teacher_data[&#x27;first_name&#x27;],
-            last_name=teacher_data[&#x27;last_name&#x27;],
-            role=&#x27;teacher&#x27;,
-            subjects=teacher_data[&#x27;subjects&#x27;],
-            qualifications=teacher_data[&#x27;qualifications&#x27;],
-            experience_years=teacher_data[&#x27;experience_years&#x27;],
-            phone=teacher_data[&#x27;phone&#x27;],
-            bio=teacher_data[&#x27;bio&#x27;],
+            email=teacher_data[&quot;email&quot;],
+            password_hash=generate_password_hash(teacher_data[&quot;password&quot;]),
+            first_name=teacher_data[&quot;first_name&quot;],
+            last_name=teacher_data[&quot;last_name&quot;],
+            role=&quot;teacher&quot;,
+            subjects=teacher_data[&quot;subjects&quot;],
+            qualifications=teacher_data[&quot;qualifications&quot;],
+            experience_years=teacher_data[&quot;experience_years&quot;],
+            phone=teacher_data[&quot;phone&quot;],
+            bio=teacher_data[&quot;bio&quot;],
             is_active=True,
-            created_at=datetime.utcnow()
+            created_at=datetime.utcnow(),
         )
         teachers.append(teacher)
         db.session.add(teacher)
 
     # Administrateur
     admin = Admin(
-        email=&#x27;admin@nexus-reussite.com&#x27;,
-        password_hash=generate_password_hash(&#x27;admin123&#x27;),
-        first_name=&#x27;Admin&#x27;,
-        last_name=&#x27;Nexus&#x27;,
-        role=&#x27;admin&#x27;,
-        phone=&#x27;+216 70 000 000&#x27;,
+        email=&quot;admin@nexus-reussite.com&quot;,
+        password_hash=generate_password_hash(&quot;admin123&quot;),
+        first_name=&quot;Admin&quot;,
+        last_name=&quot;Nexus&quot;,
+        role=&quot;admin&quot;,
+        phone=&quot;+216 70 000 000&quot;,
         is_active=True,
-        created_at=datetime.utcnow()
+        created_at=datetime.utcnow(),
     )
     db.session.add(admin)
 
     db.session.commit()
     print(f&quot;‚úÖ {len(students)} √©tudiants cr√©√©s&quot;)
@@ -211,191 +218,202 @@
     print(f&quot;‚úÖ {len(teachers)} enseignants cr√©√©s&quot;)
     print(f&quot;‚úÖ 1 administrateur cr√©√©&quot;)
 
     return students, parents, teachers, admin
 
+
 def create_demo_content():
     &quot;&quot;&quot;Cr√©er le contenu p√©dagogique de d√©monstration&quot;&quot;&quot;
     print(&quot;Cr√©ation du contenu p√©dagogique...&quot;)
 
     # Parcours de math√©matiques
     math_path = LearningPath(
-        title=&#x27;Math√©matiques Terminale&#x27;,
-        subject=&#x27;Math√©matiques&#x27;,
-        grade=&#x27;Terminale&#x27;,
-        description=&#x27;Parcours complet pour ma√Ætriser le programme de Terminale&#x27;,
+        title=&quot;Math√©matiques Terminale&quot;,
+        subject=&quot;Math√©matiques&quot;,
+        grade=&quot;Terminale&quot;,
+        description=&quot;Parcours complet pour ma√Ætriser le programme de Terminale&quot;,
         estimated_hours=120,
-        difficulty=&#x27;Avanc√©&#x27;,
-        created_at=datetime.utcnow()
+        difficulty=&quot;Avanc√©&quot;,
+        created_at=datetime.utcnow(),
     )
     db.session.add(math_path)
     db.session.commit()
 
     # Modules de math√©matiques
     math_modules = [
         {
-            &#x27;title&#x27;: &#x27;Limites et continuit√©&#x27;,
-            &#x27;description&#x27;: &#x27;Comprendre les limites de fonctions et la continuit√©&#x27;,
-            &#x27;content_type&#x27;: &#x27;lesson&#x27;,
-            &#x27;estimated_time&#x27;: 15,
-            &#x27;order_index&#x27;: 1,
-            &#x27;skills&#x27;: [&#x27;Calcul de limites&#x27;, &#x27;Th√©or√®mes de continuit√©&#x27;, &#x27;Asymptotes&#x27;]
-        },
-        {
-            &#x27;title&#x27;: &#x27;D√©rivation&#x27;,
-            &#x27;description&#x27;: &#x27;Ma√Ætriser les techniques de d√©rivation et leurs applications&#x27;,
-            &#x27;content_type&#x27;: &#x27;lesson&#x27;,
-            &#x27;estimated_time&#x27;: 18,
-            &#x27;order_index&#x27;: 2,
-            &#x27;skills&#x27;: [&#x27;Calcul de d√©riv√©es&#x27;, &#x27;√âquations de tangentes&#x27;, &#x27;Variations de fonctions&#x27;]
-        },
-        {
-            &#x27;title&#x27;: &#x27;Int√©gration&#x27;,
-            &#x27;description&#x27;: &#x27;Techniques d\&#x27;int√©gration et calcul d\&#x27;aires&#x27;,
-            &#x27;content_type&#x27;: &#x27;lesson&#x27;,
-            &#x27;estimated_time&#x27;: 20,
-            &#x27;order_index&#x27;: 3,
-            &#x27;skills&#x27;: [&#x27;Calcul de primitives&#x27;, &#x27;Int√©gration par parties&#x27;, &#x27;Calcul d\&#x27;aires&#x27;]
-        }
+            &quot;title&quot;: &quot;Limites et continuit√©&quot;,
+            &quot;description&quot;: &quot;Comprendre les limites de fonctions et la continuit√©&quot;,
+            &quot;content_type&quot;: &quot;lesson&quot;,
+            &quot;estimated_time&quot;: 15,
+            &quot;order_index&quot;: 1,
+            &quot;skills&quot;: [&quot;Calcul de limites&quot;, &quot;Th√©or√®mes de continuit√©&quot;, &quot;Asymptotes&quot;],
+        },
+        {
+            &quot;title&quot;: &quot;D√©rivation&quot;,
+            &quot;description&quot;: &quot;Ma√Ætriser les techniques de d√©rivation et leurs applications&quot;,
+            &quot;content_type&quot;: &quot;lesson&quot;,
+            &quot;estimated_time&quot;: 18,
+            &quot;order_index&quot;: 2,
+            &quot;skills&quot;: [
+                &quot;Calcul de d√©riv√©es&quot;,
+                &quot;√âquations de tangentes&quot;,
+                &quot;Variations de fonctions&quot;,
+            ],
+        },
+        {
+            &quot;title&quot;: &quot;Int√©gration&quot;,
+            &quot;description&quot;: &quot;Techniques d&#x27;int√©gration et calcul d&#x27;aires&quot;,
+            &quot;content_type&quot;: &quot;lesson&quot;,
+            &quot;estimated_time&quot;: 20,
+            &quot;order_index&quot;: 3,
+            &quot;skills&quot;: [
+                &quot;Calcul de primitives&quot;,
+                &quot;Int√©gration par parties&quot;,
+                &quot;Calcul d&#x27;aires&quot;,
+            ],
+        },
     ]
 
     modules = []
     for module_data in math_modules:
         module = ContentModule(
-            title=module_data[&#x27;title&#x27;],
-            description=module_data[&#x27;description&#x27;],
-            content_type=module_data[&#x27;content_type&#x27;],
-            subject=&#x27;Math√©matiques&#x27;,
-            grade=&#x27;Terminale&#x27;,
-            estimated_time=module_data[&#x27;estimated_time&#x27;],
-            order_index=module_data[&#x27;order_index&#x27;],
-            skills=module_data[&#x27;skills&#x27;],
+            title=module_data[&quot;title&quot;],
+            description=module_data[&quot;description&quot;],
+            content_type=module_data[&quot;content_type&quot;],
+            subject=&quot;Math√©matiques&quot;,
+            grade=&quot;Terminale&quot;,
+            estimated_time=module_data[&quot;estimated_time&quot;],
+            order_index=module_data[&quot;order_index&quot;],
+            skills=module_data[&quot;skills&quot;],
             learning_path_id=math_path.id,
-            created_at=datetime.utcnow()
+            created_at=datetime.utcnow(),
         )
         modules.append(module)
         db.session.add(module)
 
     db.session.commit()
 
     # Quiz de d√©monstration
     quiz = Quiz(
-        title=&#x27;Quiz Limites et Continuit√©&#x27;,
-        subject=&#x27;Math√©matiques&#x27;,
-        grade=&#x27;Terminale&#x27;,
-        description=&#x27;√âvaluation des connaissances sur les limites&#x27;,
+        title=&quot;Quiz Limites et Continuit√©&quot;,
+        subject=&quot;Math√©matiques&quot;,
+        grade=&quot;Terminale&quot;,
+        description=&quot;√âvaluation des connaissances sur les limites&quot;,
         time_limit=30,
         total_points=20,
         module_id=modules[0].id,
-        created_at=datetime.utcnow()
+        created_at=datetime.utcnow(),
     )
     db.session.add(quiz)
     db.session.commit()
 
     # Questions du quiz
     questions = [
         {
-            &#x27;question&#x27;: &#x27;Quelle est la limite de (x¬≤-1)/(x-1) quand x tend vers 1 ?&#x27;,
-            &#x27;options&#x27;: [&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;La limite n\&#x27;existe pas&#x27;],
-            &#x27;correct_answer&#x27;: 2,
-            &#x27;explanation&#x27;: &#x27;En factorisant le num√©rateur : (x¬≤-1)/(x-1) = (x+1)(x-1)/(x-1) = x+1. Donc lim(x‚Üí1) = 1+1 = 2&#x27;
-        },
-        {
-            &#x27;question&#x27;: &#x27;Une fonction continue sur [a,b] est n√©cessairement :&#x27;,
-            &#x27;options&#x27;: [&#x27;D√©rivable&#x27;, &#x27;Born√©e&#x27;, &#x27;Croissante&#x27;, &#x27;Constante&#x27;],
-            &#x27;correct_answer&#x27;: 1,
-            &#x27;explanation&#x27;: &#x27;D\&#x27;apr√®s le th√©or√®me des valeurs interm√©diaires, une fonction continue sur un segment est born√©e.&#x27;
-        }
+            &quot;question&quot;: &quot;Quelle est la limite de (x¬≤-1)/(x-1) quand x tend vers 1 ?&quot;,
+            &quot;options&quot;: [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;La limite n&#x27;existe pas&quot;],
+            &quot;correct_answer&quot;: 2,
+            &quot;explanation&quot;: &quot;En factorisant le num√©rateur : (x¬≤-1)/(x-1) = (x+1)(x-1)/(x-1) = x+1. Donc lim(x‚Üí1) = 1+1 = 2&quot;,
+        },
+        {
+            &quot;question&quot;: &quot;Une fonction continue sur [a,b] est n√©cessairement :&quot;,
+            &quot;options&quot;: [&quot;D√©rivable&quot;, &quot;Born√©e&quot;, &quot;Croissante&quot;, &quot;Constante&quot;],
+            &quot;correct_answer&quot;: 1,
+            &quot;explanation&quot;: &quot;D&#x27;apr√®s le th√©or√®me des valeurs interm√©diaires, une fonction continue sur un segment est born√©e.&quot;,
+        },
     ]
 
     for i, q_data in enumerate(questions):
         question = QuizQuestion(
             quiz_id=quiz.id,
-            question=q_data[&#x27;question&#x27;],
-            options=q_data[&#x27;options&#x27;],
-            correct_answer=q_data[&#x27;correct_answer&#x27;],
-            explanation=q_data[&#x27;explanation&#x27;],
+            question=q_data[&quot;question&quot;],
+            options=q_data[&quot;options&quot;],
+            correct_answer=q_data[&quot;correct_answer&quot;],
+            explanation=q_data[&quot;explanation&quot;],
             points=10,
-            order_index=i+1
+            order_index=i + 1,
         )
         db.session.add(question)
 
     db.session.commit()
     print(f&quot;‚úÖ 1 parcours d&#x27;apprentissage cr√©√©&quot;)
     print(f&quot;‚úÖ {len(modules)} modules cr√©√©s&quot;)
     print(f&quot;‚úÖ 1 quiz avec {len(questions)} questions cr√©√©&quot;)
 
+
 def create_demo_formulas():
     &quot;&quot;&quot;Cr√©er les formules de d√©monstration&quot;&quot;&quot;
     print(&quot;Cr√©ation des formules...&quot;)
 
     formulas_data = [
         {
-            &#x27;name&#x27;: &#x27;Coaching Premium&#x27;,
-            &#x27;type&#x27;: &#x27;individual&#x27;,
-            &#x27;description&#x27;: &#x27;Suivi individualis√© toutes mati√®res avec coach d√©di√©&#x27;,
-            &#x27;price&#x27;: 320,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_months&#x27;: 1,
-            &#x27;features&#x27;: [
-                &#x27;4h de cours par mois&#x27;,
-                &#x27;Acc√®s plateforme 24/7&#x27;,
-                &#x27;Reporting hebdomadaire&#x27;,
-                &#x27;Coach d√©di√©&#x27;,
-                &#x27;Suivi personnalis√©&#x27;
-            ]
-        },
-        {
-            &#x27;name&#x27;: &#x27;Excellence Bac&#x27;,
-            &#x27;type&#x27;: &#x27;individual&#x27;,
-            &#x27;description&#x27;: &#x27;Pr√©paration Bac intensifi√©e avec objectifs cibl√©s&#x27;,
-            &#x27;price&#x27;: 420,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_months&#x27;: 1,
-            &#x27;features&#x27;: [
-                &#x27;6h de cours par mois&#x27;,
-                &#x27;Fiche objectifs personnalis√©e&#x27;,
-                &#x27;Simulations d\&#x27;examen&#x27;,
-                &#x27;Correction d√©taill√©e&#x27;,
-                &#x27;Suivi progression&#x27;
-            ]
-        },
-        {
-            &#x27;name&#x27;: &#x27;Groupe R√©ussite&#x27;,
-            &#x27;type&#x27;: &#x27;group&#x27;,
-            &#x27;description&#x27;: &#x27;S√©ances hebdomadaires en pr√©sentiel sur une mati√®re&#x27;,
-            &#x27;price&#x27;: 180,
-            &#x27;currency&#x27;: &#x27;TND&#x27;,
-            &#x27;duration_months&#x27;: 1,
-            &#x27;features&#x27;: [
-                &#x27;2h par semaine&#x27;,
-                &#x27;Groupes de 3-5 √©l√®ves&#x27;,
-                &#x27;Module en ligne inclus&#x27;,
-                &#x27;Exercices corrig√©s&#x27;,
-                &#x27;√âmulation de groupe&#x27;
-            ]
-        }
+            &quot;name&quot;: &quot;Coaching Premium&quot;,
+            &quot;type&quot;: &quot;individual&quot;,
+            &quot;description&quot;: &quot;Suivi individualis√© toutes mati√®res avec coach d√©di√©&quot;,
+            &quot;price&quot;: 320,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_months&quot;: 1,
+            &quot;features&quot;: [
+                &quot;4h de cours par mois&quot;,
+                &quot;Acc√®s plateforme 24/7&quot;,
+                &quot;Reporting hebdomadaire&quot;,
+                &quot;Coach d√©di√©&quot;,
+                &quot;Suivi personnalis√©&quot;,
+            ],
+        },
+        {
+            &quot;name&quot;: &quot;Excellence Bac&quot;,
+            &quot;type&quot;: &quot;individual&quot;,
+            &quot;description&quot;: &quot;Pr√©paration Bac intensifi√©e avec objectifs cibl√©s&quot;,
+            &quot;price&quot;: 420,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_months&quot;: 1,
+            &quot;features&quot;: [
+                &quot;6h de cours par mois&quot;,
+                &quot;Fiche objectifs personnalis√©e&quot;,
+                &quot;Simulations d&#x27;examen&quot;,
+                &quot;Correction d√©taill√©e&quot;,
+                &quot;Suivi progression&quot;,
+            ],
+        },
+        {
+            &quot;name&quot;: &quot;Groupe R√©ussite&quot;,
+            &quot;type&quot;: &quot;group&quot;,
+            &quot;description&quot;: &quot;S√©ances hebdomadaires en pr√©sentiel sur une mati√®re&quot;,
+            &quot;price&quot;: 180,
+            &quot;currency&quot;: &quot;TND&quot;,
+            &quot;duration_months&quot;: 1,
+            &quot;features&quot;: [
+                &quot;2h par semaine&quot;,
+                &quot;Groupes de 3-5 √©l√®ves&quot;,
+                &quot;Module en ligne inclus&quot;,
+                &quot;Exercices corrig√©s&quot;,
+                &quot;√âmulation de groupe&quot;,
+            ],
+        },
     ]
 
     formulas = []
     for formula_data in formulas_data:
         formula = Formula(
-            name=formula_data[&#x27;name&#x27;],
-            type=formula_data[&#x27;type&#x27;],
-            description=formula_data[&#x27;description&#x27;],
-            price=formula_data[&#x27;price&#x27;],
-            currency=formula_data[&#x27;currency&#x27;],
-            duration_months=formula_data[&#x27;duration_months&#x27;],
-            features=formula_data[&#x27;features&#x27;],
+            name=formula_data[&quot;name&quot;],
+            type=formula_data[&quot;type&quot;],
+            description=formula_data[&quot;description&quot;],
+            price=formula_data[&quot;price&quot;],
+            currency=formula_data[&quot;currency&quot;],
+            duration_months=formula_data[&quot;duration_months&quot;],
+            features=formula_data[&quot;features&quot;],
             is_active=True,
-            created_at=datetime.utcnow()
+            created_at=datetime.utcnow(),
         )
         formulas.append(formula)
         db.session.add(formula)
 
     db.session.commit()
     print(f&quot;‚úÖ {len(formulas)} formules cr√©√©es&quot;)
+
 
 def create_demo_progress():
     &quot;&quot;&quot;Cr√©er les donn√©es de progression de d√©monstration&quot;&quot;&quot;
     print(&quot;Cr√©ation des donn√©es de progression...&quot;)
 
@@ -406,51 +424,52 @@
     if not students or not modules:
         print(&quot;‚ö†Ô∏è Aucun √©tudiant ou module trouv√© pour cr√©er la progression&quot;)
         return
 
     # Cr√©er des progressions pour Sarah (√©tudiant avanc√©)
-    sarah = next((s for s in students if s.first_name == &#x27;Sarah&#x27;), None)
+    sarah = next((s for s in students if s.first_name == &quot;Sarah&quot;), None)
     if sarah and modules:
         for i, module in enumerate(modules[:2]):  # 2 premiers modules termin√©s
             progress = StudentProgress(
                 student_id=sarah.id,
                 module_id=module.id,
-                status=&#x27;completed&#x27;,
+                status=&quot;completed&quot;,
                 progress_percentage=100,
                 time_spent=module.estimated_time * 60,  # en minutes
-                last_accessed=datetime.utcnow() - timedelta(days=i+1),
-                completed_at=datetime.utcnow() - timedelta(days=i)
+                last_accessed=datetime.utcnow() - timedelta(days=i + 1),
+                completed_at=datetime.utcnow() - timedelta(days=i),
             )
             db.session.add(progress)
 
         # Module en cours
         if len(modules) &gt; 2:
             progress = StudentProgress(
                 student_id=sarah.id,
                 module_id=modules[2].id,
-                status=&#x27;in_progress&#x27;,
+                status=&quot;in_progress&quot;,
                 progress_percentage=65,
                 time_spent=modules[2].estimated_time * 60 * 0.65,
-                last_accessed=datetime.utcnow()
+                last_accessed=datetime.utcnow(),
             )
             db.session.add(progress)
 
     # Cr√©er des progressions pour Ahmed (√©tudiant d√©butant)
-    ahmed = next((s for s in students if s.first_name == &#x27;Ahmed&#x27;), None)
+    ahmed = next((s for s in students if s.first_name == &quot;Ahmed&quot;), None)
     if ahmed and modules:
         progress = StudentProgress(
             student_id=ahmed.id,
             module_id=modules[0].id,
-            status=&#x27;in_progress&#x27;,
+            status=&quot;in_progress&quot;,
             progress_percentage=30,
             time_spent=modules[0].estimated_time * 60 * 0.3,
-            last_accessed=datetime.utcnow()
+            last_accessed=datetime.utcnow(),
         )
         db.session.add(progress)
 
     db.session.commit()
     print(&quot;‚úÖ Donn√©es de progression cr√©√©es&quot;)
+
 
 def init_database():
     &quot;&quot;&quot;Initialiser compl√®tement la base de donn√©es&quot;&quot;&quot;
     print(&quot;üöÄ Initialisation de la base de donn√©es Nexus R√©ussite...&quot;)
 
@@ -486,8 +505,8 @@
         print(&quot;  - sophie.martin@nexus-reussite.com / teacher123&quot;)
         print(&quot;  - david.rousseau@nexus-reussite.com / teacher123&quot;)
         print(&quot;\nüë®‚Äçüíº Administrateur :&quot;)
         print(&quot;  - admin@nexus-reussite.com / admin123&quot;)
 
-if __name__ == &#x27;__main__&#x27;:
+
+if __name__ == &quot;__main__&quot;:
     init_database()
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/content_bank.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/content_bank.py	2025-07-24 20:54:02.353676+00:00
@@ -7,13 +7,18 @@
 import os
 from typing import List, Optional, Dict, Any
 from datetime import datetime
 import uuid
 from ..models.content_system import (
-    ContentBrick, BrickType, Subject, TargetProfile,
-    LearningStep, DocumentRequest
+    ContentBrick,
+    BrickType,
+    Subject,
+    TargetProfile,
+    LearningStep,
+    DocumentRequest,
 )
+
 
 class ContentBankService:
     &quot;&quot;&quot;Service de gestion de la banque de contenu&quot;&quot;&quot;
 
     def __init__(self, data_file: str = &quot;content_bank.json&quot;):
@@ -23,13 +28,13 @@
 
     def load_data(self):
         &quot;&quot;&quot;Charge les donn√©es depuis le fichier JSON&quot;&quot;&quot;
         if os.path.exists(self.data_file):
             try:
-                with open(self.data_file, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:
+                with open(self.data_file, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
                     data = json.load(f)
-                    for brick_data in data.get(&#x27;bricks&#x27;, []):
+                    for brick_data in data.get(&quot;bricks&quot;, []):
                         brick = ContentBrick.from_dict(brick_data)
                         self.bricks[brick.id] = brick
             except Exception as e:
                 print(f&quot;Erreur lors du chargement des donn√©es: {e}&quot;)
                 self._initialize_sample_data()
@@ -38,14 +43,14 @@
 
     def save_data(self):
         &quot;&quot;&quot;Sauvegarde les donn√©es dans le fichier JSON&quot;&quot;&quot;
         try:
             data = {
-                &#x27;bricks&#x27;: [brick.to_dict() for brick in self.bricks.values()],
-                &#x27;last_updated&#x27;: datetime.now().isoformat()
+                &quot;bricks&quot;: [brick.to_dict() for brick in self.bricks.values()],
+                &quot;last_updated&quot;: datetime.now().isoformat(),
             }
-            with open(self.data_file, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:
+            with open(self.data_file, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
                 json.dump(data, f, ensure_ascii=False, indent=2)
         except Exception as e:
             print(f&quot;Erreur lors de la sauvegarde: {e}&quot;)
 
     def _initialize_sample_data(self):
@@ -76,13 +81,12 @@
                 prerequisites=[],
                 duration_minutes=10,
                 created_at=datetime.now(),
                 updated_at=datetime.now(),
                 author_id=&quot;coach_dubois&quot;,
-                author_name=&quot;M. Dubois&quot;
+                author_name=&quot;M. Dubois&quot;,
             ),
-
             ContentBrick(
                 id=str(uuid.uuid4()),
                 content=&quot;&quot;&quot;# Propri√©t√© fondamentale de l&#x27;exponentielle
 
 Pour tous r√©els a et b :
@@ -105,13 +109,12 @@
                 prerequisites=[],
                 duration_minutes=15,
                 created_at=datetime.now(),
                 updated_at=datetime.now(),
                 author_id=&quot;coach_dubois&quot;,
-                author_name=&quot;M. Dubois&quot;
+                author_name=&quot;M. Dubois&quot;,
             ),
-
             # NSI - Graphes
             ContentBrick(
                 id=str(uuid.uuid4()),
                 content=&quot;&quot;&quot;# D√©finition d&#x27;un graphe en informatique
 
@@ -139,13 +142,12 @@
                 prerequisites=[],
                 duration_minutes=12,
                 created_at=datetime.now(),
                 updated_at=datetime.now(),
                 author_id=&quot;coach_martin&quot;,
-                author_name=&quot;Mme Martin&quot;
+                author_name=&quot;Mme Martin&quot;,
             ),
-
             ContentBrick(
                 id=str(uuid.uuid4()),
                 content=&quot;&quot;&quot;# Exercice : Parcours en largeur (BFS)
 
 Soit le graphe suivant repr√©sent√© par sa liste d&#x27;adjacence :
@@ -176,12 +178,12 @@
                 prerequisites=[&quot;definition_graphe&quot;],
                 duration_minutes=25,
                 created_at=datetime.now(),
                 updated_at=datetime.now(),
                 author_id=&quot;coach_martin&quot;,
-                author_name=&quot;Mme Martin&quot;
-            )
+                author_name=&quot;Mme Martin&quot;,
+            ),
         ]
 
         for brick in sample_bricks:
             self.bricks[brick.id] = brick
 
@@ -223,20 +225,22 @@
             del self.bricks[brick_id]
             self.save_data()
             return True
         return False
 
-    def search_bricks(self,
-                     subject: Optional[Subject] = None,
-                     chapter: Optional[str] = None,
-                     brick_type: Optional[BrickType] = None,
-                     difficulty_min: Optional[int] = None,
-                     difficulty_max: Optional[int] = None,
-                     target_profile: Optional[TargetProfile] = None,
-                     learning_step: Optional[LearningStep] = None,
-                     tags: Optional[List[str]] = None,
-                     limit: Optional[int] = None) -&gt; List[ContentBrick]:
+    def search_bricks(
+        self,
+        subject: Optional[Subject] = None,
+        chapter: Optional[str] = None,
+        brick_type: Optional[BrickType] = None,
+        difficulty_min: Optional[int] = None,
+        difficulty_max: Optional[int] = None,
+        target_profile: Optional[TargetProfile] = None,
+        learning_step: Optional[LearningStep] = None,
+        tags: Optional[List[str]] = None,
+        limit: Optional[int] = None,
+    ) -&gt; List[ContentBrick]:
         &quot;&quot;&quot;Recherche des briques selon des crit√®res&quot;&quot;&quot;
 
         results = []
 
         for brick in self.bricks.values():
@@ -266,11 +270,13 @@
             if learning_step and learning_step not in brick.learning_steps:
                 continue
 
             # Filtrage par tags
             if tags:
-                if not any(tag.lower() in [t.lower() for t in brick.tags] for tag in tags):
+                if not any(
+                    tag.lower() in [t.lower() for t in brick.tags] for tag in tags
+                ):
                     continue
 
             results.append(brick)
 
         # Tri par pertinence (usage_count et rating)
@@ -301,15 +307,15 @@
             # Par difficult√©
             diff_key = f&quot;niveau_{brick.difficulty}&quot;
             by_difficulty[diff_key] = by_difficulty.get(diff_key, 0) + 1
 
         return {
-            &#x27;total_bricks&#x27;: total_bricks,
-            &#x27;by_subject&#x27;: by_subject,
-            &#x27;by_type&#x27;: by_type,
-            &#x27;by_difficulty&#x27;: by_difficulty,
-            &#x27;last_updated&#x27;: datetime.now().isoformat()
+            &quot;total_bricks&quot;: total_bricks,
+            &quot;by_subject&quot;: by_subject,
+            &quot;by_type&quot;: by_type,
+            &quot;by_difficulty&quot;: by_difficulty,
+            &quot;last_updated&quot;: datetime.now().isoformat(),
         }
 
     def increment_usage(self, brick_id: str):
         &quot;&quot;&quot;Incr√©mente le compteur d&#x27;utilisation d&#x27;une brique&quot;&quot;&quot;
         if brick_id in self.bricks:
@@ -321,6 +327,5 @@
         if brick_id in self.bricks:
             brick = self.bricks[brick_id]
             # Calcul simple de moyenne pond√©r√©e (√† am√©liorer avec un vrai syst√®me de votes)
             brick.average_rating = (brick.average_rating + rating) / 2
             self.save_data()
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/websocket_routes.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/websocket_routes.py	2025-07-24 20:54:02.361711+00:00
@@ -15,536 +15,577 @@
     Notification,
     create_student_progress_notification,
     create_teacher_message_notification,
     create_achievement_notification,
     create_parent_notification,
-    create_system_alert
+    create_system_alert,
 )
 
-websocket_bp = Blueprint(&#x27;websocket&#x27;, __name__, url_prefix=&#x27;/api/websocket&#x27;)
-
-@websocket_bp.route(&#x27;/notifications&#x27;, methods=[&#x27;GET&#x27;])
+websocket_bp = Blueprint(&quot;websocket&quot;, __name__, url_prefix=&quot;/api/websocket&quot;)
+
+
+@websocket_bp.route(&quot;/notifications&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_notifications():
     &quot;&quot;&quot;R√©cup√®re les notifications d&#x27;un utilisateur&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
-
-        limit = request.args.get(&#x27;limit&#x27;, 50, type=int)
-        unread_only = request.args.get(&#x27;unread_only&#x27;, False, type=bool)
+        user_id = current_user.get(&quot;user_id&quot;)
+
+        limit = request.args.get(&quot;limit&quot;, 50, type=int)
+        unread_only = request.args.get(&quot;unread_only&quot;, False, type=bool)
 
         notifications = websocket_service.get_user_notifications(user_id, limit)
 
         if unread_only:
-            notifications = [n for n in notifications if not n[&#x27;read&#x27;]]
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;notifications&#x27;: notifications,
-            &#x27;total&#x27;: len(notifications)
-        })
-
-    except Exception as e:
-        current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des notifications: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration des notifications&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/notifications/&lt;notification_id&gt;/read&#x27;, methods=[&#x27;POST&#x27;])
+            notifications = [n for n in notifications if not n[&quot;read&quot;]]
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;notifications&quot;: notifications,
+                &quot;total&quot;: len(notifications),
+            }
+        )
+
+    except Exception as e:
+        current_app.logger.error(
+            f&quot;Erreur lors de la r√©cup√©ration des notifications: {e}&quot;
+        )
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration des notifications&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/notifications/&lt;notification_id&gt;/read&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def mark_notification_read(notification_id):
     &quot;&quot;&quot;Marque une notification comme lue&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
+        user_id = current_user.get(&quot;user_id&quot;)
 
         success = websocket_service.mark_notification_as_read(notification_id, user_id)
 
         if success:
-            return jsonify({
-                &#x27;success&#x27;: True,
-                &#x27;message&#x27;: &#x27;Notification marqu√©e comme lue&#x27;
-            })
+            return jsonify(
+                {&quot;success&quot;: True, &quot;message&quot;: &quot;Notification marqu√©e comme lue&quot;}
+            )
         else:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Notification non trouv√©e&#x27;
-            }), 404
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Notification non trouv√©e&quot;}), 404
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors du marquage de la notification: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors du marquage de la notification&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/notifications/mark-all-read&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors du marquage de la notification&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/notifications/mark-all-read&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def mark_all_notifications_read():
     &quot;&quot;&quot;Marque toutes les notifications d&#x27;un utilisateur comme lues&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
+        user_id = current_user.get(&quot;user_id&quot;)
 
         # Marquer toutes les notifications non lues comme lues
         marked_count = 0
         for notification in websocket_service.notification_history:
             if notification.recipient_id == user_id and not notification.read:
                 notification.read = True
                 marked_count += 1
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: f&#x27;{marked_count} notifications marqu√©es comme lues&#x27;
-        })
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;message&quot;: f&quot;{marked_count} notifications marqu√©es comme lues&quot;,
+            }
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors du marquage des notifications: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors du marquage des notifications&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/send-notification&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify(
+                {&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors du marquage des notifications&quot;}
+            ),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/send-notification&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def send_notification():
     &quot;&quot;&quot;Envoie une notification (pour les enseignants et admins)&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         data = request.get_json()
 
         # Validation des donn√©es
-        required_fields = [&#x27;recipient_id&#x27;, &#x27;title&#x27;, &#x27;message&#x27;, &#x27;type&#x27;]
+        required_fields = [&quot;recipient_id&quot;, &quot;title&quot;, &quot;message&quot;, &quot;type&quot;]
         for field in required_fields:
             if field not in data:
-                return jsonify({
-                    &#x27;success&#x27;: False,
-                    &#x27;error&#x27;: f&#x27;Champ requis manquant: {field}&#x27;
-                }), 400
+                return (
+                    jsonify(
+                        {&quot;success&quot;: False, &quot;error&quot;: f&quot;Champ requis manquant: {field}&quot;}
+                    ),
+                    400,
+                )
 
         # Cr√©er la notification
         notification = Notification(
             id=f&quot;manual_{datetime.utcnow().timestamp()}&quot;,
-            type=NotificationType(data[&#x27;type&#x27;]),
-            title=data[&#x27;title&#x27;],
-            message=data[&#x27;message&#x27;],
-            recipient_id=data[&#x27;recipient_id&#x27;],
-            recipient_role=UserRole(data.get(&#x27;recipient_role&#x27;, &#x27;student&#x27;)),
-            data=data.get(&#x27;data&#x27;, {}),
-            priority=data.get(&#x27;priority&#x27;, &#x27;normal&#x27;)
+            type=NotificationType(data[&quot;type&quot;]),
+            title=data[&quot;title&quot;],
+            message=data[&quot;message&quot;],
+            recipient_id=data[&quot;recipient_id&quot;],
+            recipient_role=UserRole(data.get(&quot;recipient_role&quot;, &quot;student&quot;)),
+            data=data.get(&quot;data&quot;, {}),
+            priority=data.get(&quot;priority&quot;, &quot;normal&quot;),
         )
 
         # Envoyer la notification
         success = await websocket_service.send_notification(notification)
 
         if success:
-            return jsonify({
-                &#x27;success&#x27;: True,
-                &#x27;message&#x27;: &#x27;Notification envoy√©e avec succ√®s&#x27;,
-                &#x27;notification_id&#x27;: notification.id
-            })
+            return jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;message&quot;: &quot;Notification envoy√©e avec succ√®s&quot;,
+                    &quot;notification_id&quot;: notification.id,
+                }
+            )
         else:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;√âchec de l\&#x27;envoi de la notification&#x27;
-            }), 500
+            return (
+                jsonify(
+                    {&quot;success&quot;: False, &quot;error&quot;: &quot;√âchec de l&#x27;envoi de la notification&quot;}
+                ),
+                500,
+            )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de l&#x27;envoi de la notification: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de l\&#x27;envoi de la notification&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/broadcast&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify(
+                {&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de l&#x27;envoi de la notification&quot;}
+            ),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/broadcast&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def broadcast_notification():
     &quot;&quot;&quot;Diffuse une notification √† tous les utilisateurs d&#x27;un r√¥le (admin seulement)&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions admin
-        if user_role != &#x27;admin&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission administrateur requise&#x27;
-            }), 403
+        if user_role != &quot;admin&quot;:
+            return (
+                jsonify(
+                    {&quot;success&quot;: False, &quot;error&quot;: &quot;Permission administrateur requise&quot;}
+                ),
+                403,
+            )
 
         data = request.get_json()
 
         # Validation des donn√©es
-        required_fields = [&#x27;target_role&#x27;, &#x27;title&#x27;, &#x27;message&#x27;]
+        required_fields = [&quot;target_role&quot;, &quot;title&quot;, &quot;message&quot;]
         for field in required_fields:
             if field not in data:
-                return jsonify({
-                    &#x27;success&#x27;: False,
-                    &#x27;error&#x27;: f&#x27;Champ requis manquant: {field}&#x27;
-                }), 400
-
-        target_role = UserRole(data[&#x27;target_role&#x27;])
+                return (
+                    jsonify(
+                        {&quot;success&quot;: False, &quot;error&quot;: f&quot;Champ requis manquant: {field}&quot;}
+                    ),
+                    400,
+                )
+
+        target_role = UserRole(data[&quot;target_role&quot;])
 
         # Cr√©er le message de diffusion
         broadcast_message = {
-            &#x27;type&#x27;: &#x27;broadcast_notification&#x27;,
-            &#x27;data&#x27;: {
-                &#x27;id&#x27;: f&quot;broadcast_{datetime.utcnow().timestamp()}&quot;,
-                &#x27;type&#x27;: data.get(&#x27;type&#x27;, &#x27;system_alert&#x27;),
-                &#x27;title&#x27;: data[&#x27;title&#x27;],
-                &#x27;message&#x27;: data[&#x27;message&#x27;],
-                &#x27;priority&#x27;: data.get(&#x27;priority&#x27;, &#x27;normal&#x27;),
-                &#x27;timestamp&#x27;: datetime.utcnow().isoformat(),
-                &#x27;data&#x27;: data.get(&#x27;data&#x27;, {})
+            &quot;type&quot;: &quot;broadcast_notification&quot;,
+            &quot;data&quot;: {
+                &quot;id&quot;: f&quot;broadcast_{datetime.utcnow().timestamp()}&quot;,
+                &quot;type&quot;: data.get(&quot;type&quot;, &quot;system_alert&quot;),
+                &quot;title&quot;: data[&quot;title&quot;],
+                &quot;message&quot;: data[&quot;message&quot;],
+                &quot;priority&quot;: data.get(&quot;priority&quot;, &quot;normal&quot;),
+                &quot;timestamp&quot;: datetime.utcnow().isoformat(),
+                &quot;data&quot;: data.get(&quot;data&quot;, {}),
+            },
+        }
+
+        # Diffuser le message
+        sent_count = await websocket_service.broadcast_to_role(
+            target_role, broadcast_message
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;message&quot;: f&quot;Notification diffus√©e √† {sent_count} utilisateurs&quot;,
+                &quot;sent_count&quot;: sent_count,
             }
-        }
-
-        # Diffuser le message
-        sent_count = await websocket_service.broadcast_to_role(target_role, broadcast_message)
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: f&#x27;Notification diffus√©e √† {sent_count} utilisateurs&#x27;,
-            &#x27;sent_count&#x27;: sent_count
-        })
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la diffusion: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la diffusion&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/connections&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la diffusion&quot;}), 500
+
+
+@websocket_bp.route(&quot;/connections&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_active_connections():
     &quot;&quot;&quot;R√©cup√®re les connexions actives (admin seulement)&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions admin
-        if user_role != &#x27;admin&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission administrateur requise&#x27;
-            }), 403
+        if user_role != &quot;admin&quot;:
+            return (
+                jsonify(
+                    {&quot;success&quot;: False, &quot;error&quot;: &quot;Permission administrateur requise&quot;}
+                ),
+                403,
+            )
 
         # Statistiques des connexions
         connections_stats = {
-            &#x27;total_connections&#x27;: len(websocket_service.connections),
-            &#x27;unique_users&#x27;: len(websocket_service.user_connections),
-            &#x27;connections_by_role&#x27;: {},
-            &#x27;recent_connections&#x27;: []
+            &quot;total_connections&quot;: len(websocket_service.connections),
+            &quot;unique_users&quot;: len(websocket_service.user_connections),
+            &quot;connections_by_role&quot;: {},
+            &quot;recent_connections&quot;: [],
         }
 
         # Compter par r√¥le
         for connection in websocket_service.connections.values():
             role = connection.user_role.value
-            if role not in connections_stats[&#x27;connections_by_role&#x27;]:
-                connections_stats[&#x27;connections_by_role&#x27;][role] = 0
-            connections_stats[&#x27;connections_by_role&#x27;][role] += 1
+            if role not in connections_stats[&quot;connections_by_role&quot;]:
+                connections_stats[&quot;connections_by_role&quot;][role] = 0
+            connections_stats[&quot;connections_by_role&quot;][role] += 1
 
         # Connexions r√©centes (derni√®res 10)
         recent_connections = sorted(
             websocket_service.connections.values(),
             key=lambda x: x.connected_at,
-            reverse=True
+            reverse=True,
         )[:10]
 
         for connection in recent_connections:
-            connections_stats[&#x27;recent_connections&#x27;].append({
-                &#x27;user_id&#x27;: connection.user_id,
-                &#x27;role&#x27;: connection.user_role.value,
-                &#x27;connected_at&#x27;: connection.connected_at.isoformat(),
-                &#x27;last_ping&#x27;: connection.last_ping.isoformat()
-            })
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;data&#x27;: connections_stats
-        })
+            connections_stats[&quot;recent_connections&quot;].append(
+                {
+                    &quot;user_id&quot;: connection.user_id,
+                    &quot;role&quot;: connection.user_role.value,
+                    &quot;connected_at&quot;: connection.connected_at.isoformat(),
+                    &quot;last_ping&quot;: connection.last_ping.isoformat(),
+                }
+            )
+
+        return jsonify({&quot;success&quot;: True, &quot;data&quot;: connections_stats})
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des connexions: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration des connexions&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/test-notification&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration des connexions&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/test-notification&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def test_notification():
     &quot;&quot;&quot;Envoie une notification de test (d√©veloppement seulement)&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
+        user_id = current_user.get(&quot;user_id&quot;)
 
         # Cr√©er une notification de test
         test_notification = Notification(
             id=f&quot;test_{datetime.utcnow().timestamp()}&quot;,
             type=NotificationType.SYSTEM_ALERT,
             title=&quot;Notification de test&quot;,
             message=&quot;Ceci est une notification de test pour v√©rifier le syst√®me WebSocket&quot;,
             recipient_id=user_id,
-            recipient_role=UserRole(current_user.get(&#x27;role&#x27;, &#x27;student&#x27;)),
-            data={&#x27;test&#x27;: True},
-            priority=&#x27;normal&#x27;
+            recipient_role=UserRole(current_user.get(&quot;role&quot;, &quot;student&quot;)),
+            data={&quot;test&quot;: True},
+            priority=&quot;normal&quot;,
         )
 
         # Envoyer la notification
         success = await websocket_service.send_notification(test_notification)
 
-        return jsonify({
-            &#x27;success&#x27;: success,
-            &#x27;message&#x27;: &#x27;Notification de test envoy√©e&#x27; if success else &#x27;√âchec de l\&#x27;envoi&#x27;,
-            &#x27;notification_id&#x27;: test_notification.id
-        })
+        return jsonify(
+            {
+                &quot;success&quot;: success,
+                &quot;message&quot;: (
+                    &quot;Notification de test envoy√©e&quot; if success else &quot;√âchec de l&#x27;envoi&quot;
+                ),
+                &quot;notification_id&quot;: test_notification.id,
+            }
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors du test de notification: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors du test de notification&#x27;
-        }), 500
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors du test de notification&quot;}),
+            500,
+        )
+
 
 # Routes pour les notifications sp√©cialis√©es
 
-@websocket_bp.route(&#x27;/student-progress&#x27;, methods=[&#x27;POST&#x27;])
+
+@websocket_bp.route(&quot;/student-progress&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def notify_student_progress():
     &quot;&quot;&quot;Notifie la progression d&#x27;un √©l√®ve&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         data = request.get_json()
-        student_id = data.get(&#x27;student_id&#x27;)
-        subject = data.get(&#x27;subject&#x27;)
-        progress = data.get(&#x27;progress&#x27;)
+        student_id = data.get(&quot;student_id&quot;)
+        subject = data.get(&quot;subject&quot;)
+        progress = data.get(&quot;progress&quot;)
 
         if not all([student_id, subject, progress is not None]):
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Donn√©es manquantes&#x27;
-            }), 400
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Donn√©es manquantes&quot;}), 400
 
         # Cr√©er et envoyer la notification
-        notification = create_student_progress_notification(student_id, subject, progress)
+        notification = create_student_progress_notification(
+            student_id, subject, progress
+        )
         success = await websocket_service.send_notification(notification)
 
         # Notifier aussi les parents si applicable
         # TODO: R√©cup√©rer l&#x27;ID du parent depuis la base de donn√©es
         parent_id = f&quot;parent_{student_id}&quot;  # Exemple
         parent_notification = create_parent_notification(
             parent_id,
             &quot;Votre enfant&quot;,  # TODO: R√©cup√©rer le vrai nom
             f&quot;Progression mise √† jour en {subject}: {progress}%&quot;,
-            {&#x27;subject&#x27;: subject, &#x27;progress&#x27;: progress}
+            {&quot;subject&quot;: subject, &quot;progress&quot;: progress},
         )
         await websocket_service.send_notification(parent_notification)
 
-        return jsonify({
-            &#x27;success&#x27;: success,
-            &#x27;message&#x27;: &#x27;Notification de progression envoy√©e&#x27;
-        })
+        return jsonify(
+            {&quot;success&quot;: success, &quot;message&quot;: &quot;Notification de progression envoy√©e&quot;}
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la notification de progression: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la notification&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/achievement&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la notification&quot;}),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/achievement&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def notify_achievement():
     &quot;&quot;&quot;Notifie qu&#x27;un √©l√®ve a d√©bloqu√© une r√©ussite&quot;&quot;&quot;
     try:
         data = request.get_json()
-        student_id = data.get(&#x27;student_id&#x27;)
-        achievement_name = data.get(&#x27;achievement_name&#x27;)
-        description = data.get(&#x27;description&#x27;, &#x27;&#x27;)
+        student_id = data.get(&quot;student_id&quot;)
+        achievement_name = data.get(&quot;achievement_name&quot;)
+        description = data.get(&quot;description&quot;, &quot;&quot;)
 
         if not all([student_id, achievement_name]):
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Donn√©es manquantes&#x27;
-            }), 400
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Donn√©es manquantes&quot;}), 400
 
         # Cr√©er et envoyer la notification
-        notification = create_achievement_notification(student_id, achievement_name, description)
+        notification = create_achievement_notification(
+            student_id, achievement_name, description
+        )
         success = await websocket_service.send_notification(notification)
 
-        return jsonify({
-            &#x27;success&#x27;: success,
-            &#x27;message&#x27;: &#x27;Notification de r√©ussite envoy√©e&#x27;
-        })
+        return jsonify(
+            {&quot;success&quot;: success, &quot;message&quot;: &quot;Notification de r√©ussite envoy√©e&quot;}
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la notification de r√©ussite: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la notification&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/teacher-message&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la notification&quot;}),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/teacher-message&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def send_teacher_message():
     &quot;&quot;&quot;Envoie un message d&#x27;enseignant √† un √©l√®ve&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role != &#x27;teacher&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission enseignant requise&#x27;
-            }), 403
+        if user_role != &quot;teacher&quot;:
+            return (
+                jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission enseignant requise&quot;}),
+                403,
+            )
 
         data = request.get_json()
-        student_id = data.get(&#x27;student_id&#x27;)
-        message = data.get(&#x27;message&#x27;)
-        teacher_name = current_user.get(&#x27;name&#x27;, &#x27;Votre enseignant&#x27;)
+        student_id = data.get(&quot;student_id&quot;)
+        message = data.get(&quot;message&quot;)
+        teacher_name = current_user.get(&quot;name&quot;, &quot;Votre enseignant&quot;)
 
         if not all([student_id, message]):
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Donn√©es manquantes&#x27;
-            }), 400
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Donn√©es manquantes&quot;}), 400
 
         # Cr√©er et envoyer la notification
-        notification = create_teacher_message_notification(student_id, teacher_name, message)
+        notification = create_teacher_message_notification(
+            student_id, teacher_name, message
+        )
         success = await websocket_service.send_notification(notification)
 
-        return jsonify({
-            &#x27;success&#x27;: success,
-            &#x27;message&#x27;: &#x27;Message envoy√© √† l\&#x27;√©l√®ve&#x27;
-        })
+        return jsonify({&quot;success&quot;: success, &quot;message&quot;: &quot;Message envoy√© √† l&#x27;√©l√®ve&quot;})
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de l&#x27;envoi du message: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de l\&#x27;envoi du message&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/system-alert&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de l&#x27;envoi du message&quot;}),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/system-alert&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def send_system_alert():
     &quot;&quot;&quot;Envoie une alerte syst√®me (admin seulement)&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions admin
-        if user_role != &#x27;admin&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission administrateur requise&#x27;
-            }), 403
+        if user_role != &quot;admin&quot;:
+            return (
+                jsonify(
+                    {&quot;success&quot;: False, &quot;error&quot;: &quot;Permission administrateur requise&quot;}
+                ),
+                403,
+            )
 
         data = request.get_json()
-        title = data.get(&#x27;title&#x27;)
-        message = data.get(&#x27;message&#x27;)
-        priority = data.get(&#x27;priority&#x27;, &#x27;normal&#x27;)
-        target_admins = data.get(&#x27;target_admins&#x27;, [&#x27;admin&#x27;])  # Liste des IDs admin
+        title = data.get(&quot;title&quot;)
+        message = data.get(&quot;message&quot;)
+        priority = data.get(&quot;priority&quot;, &quot;normal&quot;)
+        target_admins = data.get(&quot;target_admins&quot;, [&quot;admin&quot;])  # Liste des IDs admin
 
         if not all([title, message]):
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Titre et message requis&#x27;
-            }), 400
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Titre et message requis&quot;}), 400
 
         # Envoyer l&#x27;alerte √† tous les admins cibl√©s
         sent_count = 0
         for admin_id in target_admins:
             alert = create_system_alert(admin_id, title, message, priority)
             if await websocket_service.send_notification(alert):
                 sent_count += 1
 
-        return jsonify({
-            &#x27;success&#x27;: sent_count &gt; 0,
-            &#x27;message&#x27;: f&#x27;Alerte envoy√©e √† {sent_count} administrateurs&#x27;
-        })
+        return jsonify(
+            {
+                &quot;success&quot;: sent_count &gt; 0,
+                &quot;message&quot;: f&quot;Alerte envoy√©e √† {sent_count} administrateurs&quot;,
+            }
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de l&#x27;envoi de l&#x27;alerte: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de l\&#x27;envoi de l\&#x27;alerte&#x27;
-        }), 500
-
-@websocket_bp.route(&#x27;/stats&#x27;, methods=[&#x27;GET&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de l&#x27;envoi de l&#x27;alerte&quot;}),
+            500,
+        )
+
+
+@websocket_bp.route(&quot;/stats&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_notification_stats():
     &quot;&quot;&quot;R√©cup√®re les statistiques des notifications&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # Statistiques de base pour tous les utilisateurs
-        user_id = current_user.get(&#x27;user_id&#x27;)
+        user_id = current_user.get(&quot;user_id&quot;)
         user_notifications = [
-            n for n in websocket_service.notification_history
+            n
+            for n in websocket_service.notification_history
             if n.recipient_id == user_id
         ]
 
         stats = {
-            &#x27;total_notifications&#x27;: len(user_notifications),
-            &#x27;unread_notifications&#x27;: len([n for n in user_notifications if not n.read]),
-            &#x27;notifications_by_type&#x27;: {},
-            &#x27;notifications_by_priority&#x27;: {}
+            &quot;total_notifications&quot;: len(user_notifications),
+            &quot;unread_notifications&quot;: len([n for n in user_notifications if not n.read]),
+            &quot;notifications_by_type&quot;: {},
+            &quot;notifications_by_priority&quot;: {},
         }
 
         # Compter par type et priorit√©
         for notification in user_notifications:
             # Par type
             notif_type = notification.type.value
-            if notif_type not in stats[&#x27;notifications_by_type&#x27;]:
-                stats[&#x27;notifications_by_type&#x27;][notif_type] = 0
-            stats[&#x27;notifications_by_type&#x27;][notif_type] += 1
+            if notif_type not in stats[&quot;notifications_by_type&quot;]:
+                stats[&quot;notifications_by_type&quot;][notif_type] = 0
+            stats[&quot;notifications_by_type&quot;][notif_type] += 1
 
             # Par priorit√©
             priority = notification.priority
-            if priority not in stats[&#x27;notifications_by_priority&#x27;]:
-                stats[&#x27;notifications_by_priority&#x27;][priority] = 0
-            stats[&#x27;notifications_by_priority&#x27;][priority] += 1
+            if priority not in stats[&quot;notifications_by_priority&quot;]:
+                stats[&quot;notifications_by_priority&quot;][priority] = 0
+            stats[&quot;notifications_by_priority&quot;][priority] += 1
 
         # Statistiques globales pour les admins
-        if user_role == &#x27;admin&#x27;:
-            stats[&#x27;global&#x27;] = {
-                &#x27;total_notifications&#x27;: len(websocket_service.notification_history),
-                &#x27;active_connections&#x27;: len(websocket_service.connections),
-                &#x27;unique_users&#x27;: len(websocket_service.user_connections)
+        if user_role == &quot;admin&quot;:
+            stats[&quot;global&quot;] = {
+                &quot;total_notifications&quot;: len(websocket_service.notification_history),
+                &quot;active_connections&quot;: len(websocket_service.connections),
+                &quot;unique_users&quot;: len(websocket_service.user_connections),
             }
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;stats&#x27;: stats
-        })
-
-    except Exception as e:
-        current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des statistiques: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration des statistiques&#x27;
-        }), 500
-
+        return jsonify({&quot;success&quot;: True, &quot;stats&quot;: stats})
+
+    except Exception as e:
+        current_app.logger.error(
+            f&quot;Erreur lors de la r√©cup√©ration des statistiques: {e}&quot;
+        )
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration des statistiques&quot;,
+                }
+            ),
+            500,
+        )
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/video_conference_routes.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/video_conference_routes.py	2025-07-24 20:54:02.366428+00:00
@@ -10,517 +10,533 @@
 from ..services.video_conference import (
     video_conference_service,
     ConferenceStatus,
     ParticipantRole,
     create_instant_meeting,
-    get_meeting_link
+    get_meeting_link,
 )
 
-video_conference_bp = Blueprint(&#x27;video_conference&#x27;, __name__, url_prefix=&#x27;/api/video-conference&#x27;)
-
-@video_conference_bp.route(&#x27;/create&#x27;, methods=[&#x27;POST&#x27;])
+video_conference_bp = Blueprint(
+    &quot;video_conference&quot;, __name__, url_prefix=&quot;/api/video-conference&quot;
+)
+
+
+@video_conference_bp.route(&quot;/create&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def create_conference():
     &quot;&quot;&quot;Cr√©e une nouvelle conf√©rence&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         data = request.get_json()
 
         # Validation des donn√©es
-        required_fields = [&#x27;subject&#x27;, &#x27;scheduled_start&#x27;]
+        required_fields = [&quot;subject&quot;, &quot;scheduled_start&quot;]
         for field in required_fields:
             if field not in data:
-                return jsonify({
-                    &#x27;success&#x27;: False,
-                    &#x27;error&#x27;: f&#x27;Champ requis manquant: {field}&#x27;
-                }), 400
+                return (
+                    jsonify(
+                        {&quot;success&quot;: False, &quot;error&quot;: f&quot;Champ requis manquant: {field}&quot;}
+                    ),
+                    400,
+                )
 
         # Convertir la date
         try:
-            scheduled_start = datetime.fromisoformat(data[&#x27;scheduled_start&#x27;].replace(&#x27;Z&#x27;, &#x27;+00:00&#x27;))
+            scheduled_start = datetime.fromisoformat(
+                data[&quot;scheduled_start&quot;].replace(&quot;Z&quot;, &quot;+00:00&quot;)
+            )
         except ValueError:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Format de date invalide&#x27;
-            }), 400
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Format de date invalide&quot;}), 400
 
         # Cr√©er la conf√©rence
         room = video_conference_service.create_conference_room(
-            teacher_id=current_user.get(&#x27;user_id&#x27;),
-            teacher_name=current_user.get(&#x27;name&#x27;, &#x27;Enseignant&#x27;),
-            subject=data[&#x27;subject&#x27;],
+            teacher_id=current_user.get(&quot;user_id&quot;),
+            teacher_name=current_user.get(&quot;name&quot;, &quot;Enseignant&quot;),
+            subject=data[&quot;subject&quot;],
             scheduled_start=scheduled_start,
-            duration_minutes=data.get(&#x27;duration_minutes&#x27;, 60),
-            max_participants=data.get(&#x27;max_participants&#x27;, 10),
-            description=data.get(&#x27;description&#x27;)
-        )
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;room_id&#x27;: room.room_id,
-            &#x27;room_info&#x27;: video_conference_service.get_room_info(room.room_id)
-        })
+            duration_minutes=data.get(&quot;duration_minutes&quot;, 60),
+            max_participants=data.get(&quot;max_participants&quot;, 10),
+            description=data.get(&quot;description&quot;),
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;room_id&quot;: room.room_id,
+                &quot;room_info&quot;: video_conference_service.get_room_info(room.room_id),
+            }
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la cr√©ation de la conf√©rence: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la cr√©ation de la conf√©rence&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/instant&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la cr√©ation de la conf√©rence&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/instant&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def create_instant_conference():
     &quot;&quot;&quot;Cr√©e une conf√©rence instantan√©e&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         data = request.get_json()
-        subject = data.get(&#x27;subject&#x27;, &#x27;Cours instantan√©&#x27;)
+        subject = data.get(&quot;subject&quot;, &quot;Cours instantan√©&quot;)
 
         result = create_instant_meeting(
-            teacher_id=current_user.get(&#x27;user_id&#x27;),
-            teacher_name=current_user.get(&#x27;name&#x27;, &#x27;Enseignant&#x27;),
-            subject=subject
+            teacher_id=current_user.get(&quot;user_id&quot;),
+            teacher_name=current_user.get(&quot;name&quot;, &quot;Enseignant&quot;),
+            subject=subject,
         )
 
         return jsonify(result)
 
     except Exception as e:
-        current_app.logger.error(f&quot;Erreur lors de la cr√©ation de la conf√©rence instantan√©e: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la cr√©ation de la conf√©rence&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/join/&lt;room_id&gt;&#x27;, methods=[&#x27;POST&#x27;])
+        current_app.logger.error(
+            f&quot;Erreur lors de la cr√©ation de la conf√©rence instantan√©e: {e}&quot;
+        )
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la cr√©ation de la conf√©rence&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/join/&lt;room_id&gt;&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def join_conference(room_id):
     &quot;&quot;&quot;Rejoint une conf√©rence&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
-        user_name = current_user.get(&#x27;name&#x27;, f&#x27;Utilisateur {user_id}&#x27;)
-        user_email = current_user.get(&#x27;email&#x27;, f&#x27;{user_id}@nexusreussite.tn&#x27;)
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_id = current_user.get(&quot;user_id&quot;)
+        user_name = current_user.get(&quot;name&quot;, f&quot;Utilisateur {user_id}&quot;)
+        user_email = current_user.get(&quot;email&quot;, f&quot;{user_id}@nexusreussite.tn&quot;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # D√©terminer le r√¥le dans la conf√©rence
-        if user_role == &#x27;teacher&#x27;:
+        if user_role == &quot;teacher&quot;:
             participant_role = ParticipantRole.MODERATOR
-        elif user_role == &#x27;admin&#x27;:
+        elif user_role == &quot;admin&quot;:
             participant_role = ParticipantRole.MODERATOR
         else:
             participant_role = ParticipantRole.PARTICIPANT
 
         result = video_conference_service.join_conference(
             room_id=room_id,
             user_id=user_id,
             user_name=user_name,
             user_email=user_email,
-            role=participant_role
+            role=participant_role,
         )
 
         return jsonify(result)
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la connexion √† la conf√©rence: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la connexion √† la conf√©rence&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/leave/&lt;room_id&gt;&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la connexion √† la conf√©rence&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/leave/&lt;room_id&gt;&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def leave_conference(room_id):
     &quot;&quot;&quot;Quitte une conf√©rence&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
+        user_id = current_user.get(&quot;user_id&quot;)
 
         result = video_conference_service.leave_conference(room_id, user_id)
         return jsonify(result)
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la d√©connexion de la conf√©rence: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la d√©connexion&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/end/&lt;room_id&gt;&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la d√©connexion&quot;}),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/end/&lt;room_id&gt;&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def end_conference(room_id):
     &quot;&quot;&quot;Termine une conf√©rence&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
-        teacher_id = current_user.get(&#x27;user_id&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
+        teacher_id = current_user.get(&quot;user_id&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         result = video_conference_service.end_conference(room_id, teacher_id)
         return jsonify(result)
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la fin de la conf√©rence: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la fin de la conf√©rence&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/rooms&#x27;, methods=[&#x27;GET&#x27;])
+        return (
+            jsonify(
+                {&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la fin de la conf√©rence&quot;}
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/rooms&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_user_rooms():
     &quot;&quot;&quot;R√©cup√®re les salles de l&#x27;utilisateur&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
-        user_role = current_user.get(&#x27;role&#x27;)
-
-        include_history = request.args.get(&#x27;include_history&#x27;, False, type=bool)
-
-        if user_role in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
+        user_id = current_user.get(&quot;user_id&quot;)
+        user_role = current_user.get(&quot;role&quot;)
+
+        include_history = request.args.get(&quot;include_history&quot;, False, type=bool)
+
+        if user_role in [&quot;teacher&quot;, &quot;admin&quot;]:
             rooms = video_conference_service.get_teacher_rooms(user_id, include_history)
         else:
             rooms = video_conference_service.get_student_rooms(user_id)
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;rooms&#x27;: rooms
-        })
+        return jsonify({&quot;success&quot;: True, &quot;rooms&quot;: rooms})
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des salles: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration des salles&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/room/&lt;room_id&gt;&#x27;, methods=[&#x27;GET&#x27;])
+        return (
+            jsonify(
+                {&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration des salles&quot;}
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/room/&lt;room_id&gt;&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_room_info(room_id):
     &quot;&quot;&quot;R√©cup√®re les informations d&#x27;une salle&quot;&quot;&quot;
     try:
         room_info = video_conference_service.get_room_info(room_id)
 
         if not room_info:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle non trouv√©e&#x27;
-            }), 404
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;room_info&#x27;: room_info
-        })
-
-    except Exception as e:
-        current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des informations: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration des informations&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/schedule-recurring&#x27;, methods=[&#x27;POST&#x27;])
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Salle non trouv√©e&quot;}), 404
+
+        return jsonify({&quot;success&quot;: True, &quot;room_info&quot;: room_info})
+
+    except Exception as e:
+        current_app.logger.error(
+            f&quot;Erreur lors de la r√©cup√©ration des informations: {e}&quot;
+        )
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration des informations&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/schedule-recurring&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def schedule_recurring_conference():
     &quot;&quot;&quot;Programme des conf√©rences r√©currentes&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         data = request.get_json()
 
         # Validation des donn√©es
-        required_fields = [&#x27;subject&#x27;, &#x27;start_time&#x27;, &#x27;recurrence_days&#x27;, &#x27;end_date&#x27;]
+        required_fields = [&quot;subject&quot;, &quot;start_time&quot;, &quot;recurrence_days&quot;, &quot;end_date&quot;]
         for field in required_fields:
             if field not in data:
-                return jsonify({
-                    &#x27;success&#x27;: False,
-                    &#x27;error&#x27;: f&#x27;Champ requis manquant: {field}&#x27;
-                }), 400
+                return (
+                    jsonify(
+                        {&quot;success&quot;: False, &quot;error&quot;: f&quot;Champ requis manquant: {field}&quot;}
+                    ),
+                    400,
+                )
 
         # Convertir les dates
         try:
-            start_time = datetime.fromisoformat(data[&#x27;start_time&#x27;].replace(&#x27;Z&#x27;, &#x27;+00:00&#x27;))
-            end_date = datetime.fromisoformat(data[&#x27;end_date&#x27;].replace(&#x27;Z&#x27;, &#x27;+00:00&#x27;))
+            start_time = datetime.fromisoformat(
+                data[&quot;start_time&quot;].replace(&quot;Z&quot;, &quot;+00:00&quot;)
+            )
+            end_date = datetime.fromisoformat(data[&quot;end_date&quot;].replace(&quot;Z&quot;, &quot;+00:00&quot;))
         except ValueError:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Format de date invalide&#x27;
-            }), 400
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Format de date invalide&quot;}), 400
 
         # Programmer les conf√©rences
         scheduled_rooms = video_conference_service.schedule_recurring_conference(
-            teacher_id=current_user.get(&#x27;user_id&#x27;),
-            teacher_name=current_user.get(&#x27;name&#x27;, &#x27;Enseignant&#x27;),
-            subject=data[&#x27;subject&#x27;],
+            teacher_id=current_user.get(&quot;user_id&quot;),
+            teacher_name=current_user.get(&quot;name&quot;, &quot;Enseignant&quot;),
+            subject=data[&quot;subject&quot;],
             start_time=start_time,
-            duration_minutes=data.get(&#x27;duration_minutes&#x27;, 60),
-            recurrence_days=data[&#x27;recurrence_days&#x27;],
-            end_date=end_date
-        )
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;scheduled_count&#x27;: len(scheduled_rooms),
-            &#x27;rooms&#x27;: [video_conference_service.get_room_info(room.room_id) for room in scheduled_rooms]
-        })
+            duration_minutes=data.get(&quot;duration_minutes&quot;, 60),
+            recurrence_days=data[&quot;recurrence_days&quot;],
+            end_date=end_date,
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;scheduled_count&quot;: len(scheduled_rooms),
+                &quot;rooms&quot;: [
+                    video_conference_service.get_room_info(room.room_id)
+                    for room in scheduled_rooms
+                ],
+            }
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la programmation r√©currente: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la programmation&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/statistics&#x27;, methods=[&#x27;GET&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la programmation&quot;}),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/statistics&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_conference_statistics():
     &quot;&quot;&quot;R√©cup√®re les statistiques des conf√©rences&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # Les enseignants voient leurs propres stats, les admins voient tout
         teacher_id = None
-        if user_role == &#x27;teacher&#x27;:
-            teacher_id = current_user.get(&#x27;user_id&#x27;)
-        elif user_role != &#x27;admin&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role == &quot;teacher&quot;:
+            teacher_id = current_user.get(&quot;user_id&quot;)
+        elif user_role != &quot;admin&quot;:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         stats = video_conference_service.get_conference_statistics(teacher_id)
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;statistics&#x27;: stats
-        })
-
-    except Exception as e:
-        current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des statistiques: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration des statistiques&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/active&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;success&quot;: True, &quot;statistics&quot;: stats})
+
+    except Exception as e:
+        current_app.logger.error(
+            f&quot;Erreur lors de la r√©cup√©ration des statistiques: {e}&quot;
+        )
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: False,
+                    &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration des statistiques&quot;,
+                }
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/active&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_active_conferences():
     &quot;&quot;&quot;R√©cup√®re les conf√©rences actives&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         active_rooms = []
 
         for room_id, room in video_conference_service.active_rooms.items():
             room_info = video_conference_service.get_room_info(room_id)
 
             # Filtrer selon le r√¥le
-            if user_role == &#x27;teacher&#x27; and room.teacher_id != current_user.get(&#x27;user_id&#x27;):
+            if user_role == &quot;teacher&quot; and room.teacher_id != current_user.get(
+                &quot;user_id&quot;
+            ):
                 continue
-            elif user_role == &#x27;student&#x27;:
+            elif user_role == &quot;student&quot;:
                 # Masquer certaines informations pour les √©l√®ves
-                room_info.pop(&#x27;recording_url&#x27;, None)
-                room_info[&#x27;participants&#x27;] = [
-                    {k: v for k, v in p.items() if k not in [&#x27;user_id&#x27;]}
-                    for p in room_info[&#x27;participants&#x27;]
+                room_info.pop(&quot;recording_url&quot;, None)
+                room_info[&quot;participants&quot;] = [
+                    {k: v for k, v in p.items() if k not in [&quot;user_id&quot;]}
+                    for p in room_info[&quot;participants&quot;]
                 ]
 
             active_rooms.append(room_info)
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;active_conferences&#x27;: active_rooms
-        })
-
-    except Exception as e:
-        current_app.logger.error(f&quot;Erreur lors de la r√©cup√©ration des conf√©rences actives: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la r√©cup√©ration&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/quick-link/&lt;room_id&gt;&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;success&quot;: True, &quot;active_conferences&quot;: active_rooms})
+
+    except Exception as e:
+        current_app.logger.error(
+            f&quot;Erreur lors de la r√©cup√©ration des conf√©rences actives: {e}&quot;
+        )
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la r√©cup√©ration&quot;}),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/quick-link/&lt;room_id&gt;&quot;, methods=[&quot;GET&quot;])
 @jwt_required()
 def get_quick_link(room_id):
     &quot;&quot;&quot;G√©n√®re un lien rapide pour rejoindre une conf√©rence&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_id = current_user.get(&#x27;user_id&#x27;)
-        user_name = current_user.get(&#x27;name&#x27;, f&#x27;Utilisateur {user_id}&#x27;)
-        user_role = current_user.get(&#x27;role&#x27;)
-
-        is_teacher = user_role in [&#x27;teacher&#x27;, &#x27;admin&#x27;]
+        user_id = current_user.get(&quot;user_id&quot;)
+        user_name = current_user.get(&quot;name&quot;, f&quot;Utilisateur {user_id}&quot;)
+        user_role = current_user.get(&quot;role&quot;)
+
+        is_teacher = user_role in [&quot;teacher&quot;, &quot;admin&quot;]
 
         meeting_link = get_meeting_link(room_id, user_id, user_name, is_teacher)
 
         if meeting_link:
-            return jsonify({
-                &#x27;success&#x27;: True,
-                &#x27;meeting_link&#x27;: meeting_link
-            })
+            return jsonify({&quot;success&quot;: True, &quot;meeting_link&quot;: meeting_link})
         else:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Impossible de g√©n√©rer le lien&#x27;
-            }), 400
+            return (
+                jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Impossible de g√©n√©rer le lien&quot;}),
+                400,
+            )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la g√©n√©ration du lien: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la g√©n√©ration du lien&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/update/&lt;room_id&gt;&#x27;, methods=[&#x27;PUT&#x27;])
+        return (
+            jsonify(
+                {&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la g√©n√©ration du lien&quot;}
+            ),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/update/&lt;room_id&gt;&quot;, methods=[&quot;PUT&quot;])
 @jwt_required()
 def update_conference(room_id):
     &quot;&quot;&quot;Met √† jour une conf√©rence&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         if room_id not in video_conference_service.active_rooms:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle non trouv√©e&#x27;
-            }), 404
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Salle non trouv√©e&quot;}), 404
 
         room = video_conference_service.active_rooms[room_id]
 
         # V√©rifier que c&#x27;est l&#x27;enseignant propri√©taire
-        if room.teacher_id != current_user.get(&#x27;user_id&#x27;) and user_role != &#x27;admin&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if room.teacher_id != current_user.get(&quot;user_id&quot;) and user_role != &quot;admin&quot;:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         data = request.get_json()
 
         # Mettre √† jour les champs modifiables
-        if &#x27;description&#x27; in data:
-            room.description = data[&#x27;description&#x27;]
-
-        if &#x27;max_participants&#x27; in data:
-            room.max_participants = data[&#x27;max_participants&#x27;]
-
-        if &#x27;recording_enabled&#x27; in data:
-            room.recording_enabled = data[&#x27;recording_enabled&#x27;]
-
-        if &#x27;scheduled_end&#x27; in data:
+        if &quot;description&quot; in data:
+            room.description = data[&quot;description&quot;]
+
+        if &quot;max_participants&quot; in data:
+            room.max_participants = data[&quot;max_participants&quot;]
+
+        if &quot;recording_enabled&quot; in data:
+            room.recording_enabled = data[&quot;recording_enabled&quot;]
+
+        if &quot;scheduled_end&quot; in data:
             try:
-                room.scheduled_end = datetime.fromisoformat(data[&#x27;scheduled_end&#x27;].replace(&#x27;Z&#x27;, &#x27;+00:00&#x27;))
+                room.scheduled_end = datetime.fromisoformat(
+                    data[&quot;scheduled_end&quot;].replace(&quot;Z&quot;, &quot;+00:00&quot;)
+                )
             except ValueError:
-                return jsonify({
-                    &#x27;success&#x27;: False,
-                    &#x27;error&#x27;: &#x27;Format de date invalide&#x27;
-                }), 400
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;Conf√©rence mise √† jour&#x27;,
-            &#x27;room_info&#x27;: video_conference_service.get_room_info(room_id)
-        })
+                return (
+                    jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Format de date invalide&quot;}),
+                    400,
+                )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;message&quot;: &quot;Conf√©rence mise √† jour&quot;,
+                &quot;room_info&quot;: video_conference_service.get_room_info(room_id),
+            }
+        )
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de la mise √† jour: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de la mise √† jour&#x27;
-        }), 500
-
-@video_conference_bp.route(&#x27;/cancel/&lt;room_id&gt;&#x27;, methods=[&#x27;POST&#x27;])
+        return (
+            jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de la mise √† jour&quot;}),
+            500,
+        )
+
+
+@video_conference_bp.route(&quot;/cancel/&lt;room_id&gt;&quot;, methods=[&quot;POST&quot;])
 @jwt_required()
 def cancel_conference(room_id):
     &quot;&quot;&quot;Annule une conf√©rence programm√©e&quot;&quot;&quot;
     try:
         current_user = get_jwt_identity()
-        user_role = current_user.get(&#x27;role&#x27;)
+        user_role = current_user.get(&quot;role&quot;)
 
         # V√©rifier les permissions
-        if user_role not in [&#x27;teacher&#x27;, &#x27;admin&#x27;]:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if user_role not in [&quot;teacher&quot;, &quot;admin&quot;]:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         if room_id not in video_conference_service.active_rooms:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle non trouv√©e&#x27;
-            }), 404
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Salle non trouv√©e&quot;}), 404
 
         room = video_conference_service.active_rooms[room_id]
 
         # V√©rifier que c&#x27;est l&#x27;enseignant propri√©taire
-        if room.teacher_id != current_user.get(&#x27;user_id&#x27;) and user_role != &#x27;admin&#x27;:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Permission insuffisante&#x27;
-            }), 403
+        if room.teacher_id != current_user.get(&quot;user_id&quot;) and user_role != &quot;admin&quot;:
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Permission insuffisante&quot;}), 403
 
         # V√©rifier que la conf√©rence n&#x27;a pas encore commenc√©
         if room.status != ConferenceStatus.SCHEDULED:
-            return jsonify({
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Impossible d\&#x27;annuler une conf√©rence d√©j√† commenc√©e&#x27;
-            }), 400
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: False,
+                        &quot;error&quot;: &quot;Impossible d&#x27;annuler une conf√©rence d√©j√† commenc√©e&quot;,
+                    }
+                ),
+                400,
+            )
 
         # Annuler la conf√©rence
         room.status = ConferenceStatus.CANCELLED
 
         # D√©placer vers l&#x27;historique
         video_conference_service.room_history.append(room)
         del video_conference_service.active_rooms[room_id]
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;Conf√©rence annul√©e&#x27;
-        })
+        return jsonify({&quot;success&quot;: True, &quot;message&quot;: &quot;Conf√©rence annul√©e&quot;})
 
     except Exception as e:
         current_app.logger.error(f&quot;Erreur lors de l&#x27;annulation: {e}&quot;)
-        return jsonify({
-            &#x27;success&#x27;: False,
-            &#x27;error&#x27;: &#x27;Erreur lors de l\&#x27;annulation&#x27;
-        }), 500
-
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Erreur lors de l&#x27;annulation&quot;}), 500
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/formulas.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/formulas.py	2025-07-24 20:54:02.371546+00:00
@@ -1,184 +1,231 @@
 from flask import Blueprint, request, jsonify
 from flask_cors import cross_origin
 from datetime import datetime, date, timedelta
 from src.models.formulas import (
-    db, Formula, Group, Teacher, Enrollment, IndividualSession,
-    GroupSession, SessionAttendance, WeeklyReport, ParentCommunication,
-    StudentObjective, FormulaType, FormulaLevel
+    db,
+    Formula,
+    Group,
+    Teacher,
+    Enrollment,
+    IndividualSession,
+    GroupSession,
+    SessionAttendance,
+    WeeklyReport,
+    ParentCommunication,
+    StudentObjective,
+    FormulaType,
+    FormulaLevel,
 )
 from src.models.student import Student
 
-formulas_bp = Blueprint(&#x27;formulas&#x27;, __name__)
-
-@formulas_bp.route(&#x27;/api/formulas&#x27;, methods=[&#x27;GET&#x27;])
+formulas_bp = Blueprint(&quot;formulas&quot;, __name__)
+
+
+@formulas_bp.route(&quot;/api/formulas&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_formulas():
     &quot;&quot;&quot;R√©cup√©rer toutes les formules disponibles&quot;&quot;&quot;
     try:
         formulas = Formula.query.all()
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;formulas&#x27;: [{
-                &#x27;id&#x27;: f.id,
-                &#x27;name&#x27;: f.name,
-                &#x27;type&#x27;: f.type.value,
-                &#x27;level&#x27;: f.level.value,
-                &#x27;price_dt&#x27;: f.price_dt,
-                &#x27;hours_per_month&#x27;: f.hours_per_month,
-                &#x27;max_students&#x27;: f.max_students,
-                &#x27;description&#x27;: f.description,
-                &#x27;features&#x27;: f.features
-            } for f in formulas]
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/formulas/individual&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;formulas&quot;: [
+                    {
+                        &quot;id&quot;: f.id,
+                        &quot;name&quot;: f.name,
+                        &quot;type&quot;: f.type.value,
+                        &quot;level&quot;: f.level.value,
+                        &quot;price_dt&quot;: f.price_dt,
+                        &quot;hours_per_month&quot;: f.hours_per_month,
+                        &quot;max_students&quot;: f.max_students,
+                        &quot;description&quot;: f.description,
+                        &quot;features&quot;: f.features,
+                    }
+                    for f in formulas
+                ],
+            }
+        )
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/formulas/individual&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_individual_formulas():
     &quot;&quot;&quot;R√©cup√©rer les formules individuelles&quot;&quot;&quot;
     try:
         formulas = Formula.query.filter_by(type=FormulaType.INDIVIDUAL).all()
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;formulas&#x27;: [{
-                &#x27;id&#x27;: f.id,
-                &#x27;name&#x27;: f.name,
-                &#x27;level&#x27;: f.level.value,
-                &#x27;price_dt&#x27;: f.price_dt,
-                &#x27;hours_per_month&#x27;: f.hours_per_month,
-                &#x27;description&#x27;: f.description,
-                &#x27;features&#x27;: f.features
-            } for f in formulas]
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/formulas/group&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;formulas&quot;: [
+                    {
+                        &quot;id&quot;: f.id,
+                        &quot;name&quot;: f.name,
+                        &quot;level&quot;: f.level.value,
+                        &quot;price_dt&quot;: f.price_dt,
+                        &quot;hours_per_month&quot;: f.hours_per_month,
+                        &quot;description&quot;: f.description,
+                        &quot;features&quot;: f.features,
+                    }
+                    for f in formulas
+                ],
+            }
+        )
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/formulas/group&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_group_formulas():
     &quot;&quot;&quot;R√©cup√©rer les formules de groupe&quot;&quot;&quot;
     try:
         formulas = Formula.query.filter_by(type=FormulaType.GROUP).all()
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;formulas&#x27;: [{
-                &#x27;id&#x27;: f.id,
-                &#x27;name&#x27;: f.name,
-                &#x27;level&#x27;: f.level.value,
-                &#x27;price_dt&#x27;: f.price_dt,
-                &#x27;hours_per_month&#x27;: f.hours_per_month,
-                &#x27;max_students&#x27;: f.max_students,
-                &#x27;description&#x27;: f.description,
-                &#x27;features&#x27;: f.features
-            } for f in formulas]
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/groups&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;formulas&quot;: [
+                    {
+                        &quot;id&quot;: f.id,
+                        &quot;name&quot;: f.name,
+                        &quot;level&quot;: f.level.value,
+                        &quot;price_dt&quot;: f.price_dt,
+                        &quot;hours_per_month&quot;: f.hours_per_month,
+                        &quot;max_students&quot;: f.max_students,
+                        &quot;description&quot;: f.description,
+                        &quot;features&quot;: f.features,
+                    }
+                    for f in formulas
+                ],
+            }
+        )
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/groups&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_groups():
     &quot;&quot;&quot;R√©cup√©rer tous les groupes disponibles&quot;&quot;&quot;
     try:
         groups = Group.query.all()
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;groups&#x27;: [{
-                &#x27;id&#x27;: g.id,
-                &#x27;name&#x27;: g.name,
-                &#x27;subject&#x27;: g.subject,
-                &#x27;level&#x27;: g.level,
-                &#x27;max_students&#x27;: g.max_students,
-                &#x27;current_students&#x27;: g.current_students,
-                &#x27;teacher&#x27;: {
-                    &#x27;id&#x27;: g.teacher.id,
-                    &#x27;name&#x27;: f&quot;{g.teacher.first_name} {g.teacher.last_name}&quot;,
-                    &#x27;subjects&#x27;: g.teacher.subjects
-                } if g.teacher else None,
-                &#x27;schedule&#x27;: g.schedule,
-                &#x27;available_spots&#x27;: g.max_students - g.current_students
-            } for g in groups]
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/groups/&lt;int:group_id&gt;/students&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;groups&quot;: [
+                    {
+                        &quot;id&quot;: g.id,
+                        &quot;name&quot;: g.name,
+                        &quot;subject&quot;: g.subject,
+                        &quot;level&quot;: g.level,
+                        &quot;max_students&quot;: g.max_students,
+                        &quot;current_students&quot;: g.current_students,
+                        &quot;teacher&quot;: (
+                            {
+                                &quot;id&quot;: g.teacher.id,
+                                &quot;name&quot;: f&quot;{g.teacher.first_name} {g.teacher.last_name}&quot;,
+                                &quot;subjects&quot;: g.teacher.subjects,
+                            }
+                            if g.teacher
+                            else None
+                        ),
+                        &quot;schedule&quot;: g.schedule,
+                        &quot;available_spots&quot;: g.max_students - g.current_students,
+                    }
+                    for g in groups
+                ],
+            }
+        )
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/groups/&lt;int:group_id&gt;/students&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_group_students(group_id):
     &quot;&quot;&quot;R√©cup√©rer les √©tudiants d&#x27;un groupe&quot;&quot;&quot;
     try:
-        enrollments = Enrollment.query.filter_by(group_id=group_id, is_active=True).all()
+        enrollments = Enrollment.query.filter_by(
+            group_id=group_id, is_active=True
+        ).all()
         students = []
         for enrollment in enrollments:
             student = Student.query.get(enrollment.student_id)
             if student:
-                students.append({
-                    &#x27;id&#x27;: student.id,
-                    &#x27;name&#x27;: f&quot;{student.first_name} {student.last_name}&quot;,
-                    &#x27;level&#x27;: student.grade_level,
-                    &#x27;enrollment_date&#x27;: enrollment.start_date.isoformat()
-                })
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;students&#x27;: students
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/teachers&#x27;, methods=[&#x27;GET&#x27;])
+                students.append(
+                    {
+                        &quot;id&quot;: student.id,
+                        &quot;name&quot;: f&quot;{student.first_name} {student.last_name}&quot;,
+                        &quot;level&quot;: student.grade_level,
+                        &quot;enrollment_date&quot;: enrollment.start_date.isoformat(),
+                    }
+                )
+
+        return jsonify({&quot;success&quot;: True, &quot;students&quot;: students})
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/teachers&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_teachers():
     &quot;&quot;&quot;R√©cup√©rer tous les enseignants&quot;&quot;&quot;
     try:
         teachers = Teacher.query.all()
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;teachers&#x27;: [{
-                &#x27;id&#x27;: t.id,
-                &#x27;name&#x27;: f&quot;{t.first_name} {t.last_name}&quot;,
-                &#x27;email&#x27;: t.email,
-                &#x27;phone&#x27;: t.phone,
-                &#x27;subjects&#x27;: t.subjects,
-                &#x27;qualifications&#x27;: t.qualifications,
-                &#x27;experience_years&#x27;: t.experience_years,
-                &#x27;is_aefe_certified&#x27;: t.is_aefe_certified,
-                &#x27;is_nsi_diu&#x27;: t.is_nsi_diu
-            } for t in teachers]
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/students/&lt;int:student_id&gt;/enrollment&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;teachers&quot;: [
+                    {
+                        &quot;id&quot;: t.id,
+                        &quot;name&quot;: f&quot;{t.first_name} {t.last_name}&quot;,
+                        &quot;email&quot;: t.email,
+                        &quot;phone&quot;: t.phone,
+                        &quot;subjects&quot;: t.subjects,
+                        &quot;qualifications&quot;: t.qualifications,
+                        &quot;experience_years&quot;: t.experience_years,
+                        &quot;is_aefe_certified&quot;: t.is_aefe_certified,
+                        &quot;is_nsi_diu&quot;: t.is_nsi_diu,
+                    }
+                    for t in teachers
+                ],
+            }
+        )
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/students/&lt;int:student_id&gt;/enrollment&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def enroll_student(student_id):
     &quot;&quot;&quot;Inscrire un √©tudiant √† une formule&quot;&quot;&quot;
     try:
         data = request.get_json()
-        formula_id = data.get(&#x27;formula_id&#x27;)
-        group_id = data.get(&#x27;group_id&#x27;)  # Optionnel pour les formules de groupe
-        teacher_id = data.get(&#x27;teacher_id&#x27;)  # Optionnel pour les formules individuelles
+        formula_id = data.get(&quot;formula_id&quot;)
+        group_id = data.get(&quot;group_id&quot;)  # Optionnel pour les formules de groupe
+        teacher_id = data.get(&quot;teacher_id&quot;)  # Optionnel pour les formules individuelles
 
         # V√©rifier que l&#x27;√©tudiant existe
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         # V√©rifier que la formule existe
         formula = Formula.query.get(formula_id)
         if not formula:
-            return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: &#x27;Formule non trouv√©e&#x27;}), 404
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;Formule non trouv√©e&quot;}), 404
 
         # Cr√©er l&#x27;inscription
         enrollment = Enrollment(
             student_id=student_id,
             formula_id=formula_id,
             group_id=group_id,
             teacher_id=teacher_id,
-            start_date=date.today()
+            start_date=date.today(),
         )
 
         db.session.add(enrollment)
 
         # Mettre √† jour le nombre d&#x27;√©tudiants dans le groupe si applicable
@@ -187,246 +234,299 @@
             if group:
                 group.current_students += 1
 
         db.session.commit()
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;enrollment_id&#x27;: enrollment.id,
-            &#x27;message&#x27;: &#x27;Inscription r√©ussie&#x27;
-        })
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;enrollment_id&quot;: enrollment.id,
+                &quot;message&quot;: &quot;Inscription r√©ussie&quot;,
+            }
+        )
     except Exception as e:
         db.session.rollback()
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/students/&lt;int:student_id&gt;/sessions&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/students/&lt;int:student_id&gt;/sessions&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_sessions(student_id):
     &quot;&quot;&quot;R√©cup√©rer les s√©ances d&#x27;un √©tudiant&quot;&quot;&quot;
     try:
         # S√©ances individuelles
-        individual_sessions = IndividualSession.query.filter_by(student_id=student_id).all()
+        individual_sessions = IndividualSession.query.filter_by(
+            student_id=student_id
+        ).all()
 
         # S√©ances de groupe
-        enrollments = Enrollment.query.filter_by(student_id=student_id, is_active=True).all()
+        enrollments = Enrollment.query.filter_by(
+            student_id=student_id, is_active=True
+        ).all()
         group_sessions = []
         for enrollment in enrollments:
             if enrollment.group_id:
-                sessions = GroupSession.query.filter_by(group_id=enrollment.group_id).all()
+                sessions = GroupSession.query.filter_by(
+                    group_id=enrollment.group_id
+                ).all()
                 group_sessions.extend(sessions)
 
         sessions_data = []
 
         # Ajouter les s√©ances individuelles
         for session in individual_sessions:
             teacher = Teacher.query.get(session.teacher_id)
-            sessions_data.append({
-                &#x27;id&#x27;: session.id,
-                &#x27;type&#x27;: &#x27;individual&#x27;,
-                &#x27;subject&#x27;: session.subject,
-                &#x27;scheduled_at&#x27;: session.scheduled_at.isoformat(),
-                &#x27;duration_minutes&#x27;: session.duration_minutes,
-                &#x27;status&#x27;: session.status,
-                &#x27;teacher&#x27;: {
-                    &#x27;name&#x27;: f&quot;{teacher.first_name} {teacher.last_name}&quot;,
-                    &#x27;email&#x27;: teacher.email
-                } if teacher else None,
-                &#x27;topics_covered&#x27;: session.topics_covered,
-                &#x27;homework_assigned&#x27;: session.homework_assigned,
-                &#x27;teacher_notes&#x27;: session.teacher_notes,
-                &#x27;performance&#x27;: session.student_performance
-            })
+            sessions_data.append(
+                {
+                    &quot;id&quot;: session.id,
+                    &quot;type&quot;: &quot;individual&quot;,
+                    &quot;subject&quot;: session.subject,
+                    &quot;scheduled_at&quot;: session.scheduled_at.isoformat(),
+                    &quot;duration_minutes&quot;: session.duration_minutes,
+                    &quot;status&quot;: session.status,
+                    &quot;teacher&quot;: (
+                        {
+                            &quot;name&quot;: f&quot;{teacher.first_name} {teacher.last_name}&quot;,
+                            &quot;email&quot;: teacher.email,
+                        }
+                        if teacher
+                        else None
+                    ),
+                    &quot;topics_covered&quot;: session.topics_covered,
+                    &quot;homework_assigned&quot;: session.homework_assigned,
+                    &quot;teacher_notes&quot;: session.teacher_notes,
+                    &quot;performance&quot;: session.student_performance,
+                }
+            )
 
         # Ajouter les s√©ances de groupe
         for session in group_sessions:
             group = Group.query.get(session.group_id)
             teacher = Teacher.query.get(group.teacher_id) if group else None
 
             # R√©cup√©rer les informations de pr√©sence
             attendance = SessionAttendance.query.filter_by(
-                session_id=session.id,
-                student_id=student_id
+                session_id=session.id, student_id=student_id
             ).first()
 
-            sessions_data.append({
-                &#x27;id&#x27;: session.id,
-                &#x27;type&#x27;: &#x27;group&#x27;,
-                &#x27;subject&#x27;: session.subject,
-                &#x27;scheduled_at&#x27;: session.scheduled_at.isoformat(),
-                &#x27;duration_minutes&#x27;: session.duration_minutes,
-                &#x27;status&#x27;: session.status,
-                &#x27;group&#x27;: {
-                    &#x27;name&#x27;: group.name,
-                    &#x27;level&#x27;: group.level
-                } if group else None,
-                &#x27;teacher&#x27;: {
-                    &#x27;name&#x27;: f&quot;{teacher.first_name} {teacher.last_name}&quot;,
-                    &#x27;email&#x27;: teacher.email
-                } if teacher else None,
-                &#x27;topics_covered&#x27;: session.topics_covered,
-                &#x27;homework_assigned&#x27;: session.homework_assigned,
-                &#x27;teacher_notes&#x27;: session.teacher_notes,
-                &#x27;attendance&#x27;: {
-                    &#x27;is_present&#x27;: attendance.is_present,
-                    &#x27;participation_score&#x27;: attendance.participation_score,
-                    &#x27;individual_notes&#x27;: attendance.individual_notes
-                } if attendance else None
-            })
+            sessions_data.append(
+                {
+                    &quot;id&quot;: session.id,
+                    &quot;type&quot;: &quot;group&quot;,
+                    &quot;subject&quot;: session.subject,
+                    &quot;scheduled_at&quot;: session.scheduled_at.isoformat(),
+                    &quot;duration_minutes&quot;: session.duration_minutes,
+                    &quot;status&quot;: session.status,
+                    &quot;group&quot;: (
+                        {&quot;name&quot;: group.name, &quot;level&quot;: group.level} if group else None
+                    ),
+                    &quot;teacher&quot;: (
+                        {
+                            &quot;name&quot;: f&quot;{teacher.first_name} {teacher.last_name}&quot;,
+                            &quot;email&quot;: teacher.email,
+                        }
+                        if teacher
+                        else None
+                    ),
+                    &quot;topics_covered&quot;: session.topics_covered,
+                    &quot;homework_assigned&quot;: session.homework_assigned,
+                    &quot;teacher_notes&quot;: session.teacher_notes,
+                    &quot;attendance&quot;: (
+                        {
+                            &quot;is_present&quot;: attendance.is_present,
+                            &quot;participation_score&quot;: attendance.participation_score,
+                            &quot;individual_notes&quot;: attendance.individual_notes,
+                        }
+                        if attendance
+                        else None
+                    ),
+                }
+            )
 
         # Trier par date
-        sessions_data.sort(key=lambda x: x[&#x27;scheduled_at&#x27;], reverse=True)
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;sessions&#x27;: sessions_data
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/students/&lt;int:student_id&gt;/weekly-reports&#x27;, methods=[&#x27;GET&#x27;])
+        sessions_data.sort(key=lambda x: x[&quot;scheduled_at&quot;], reverse=True)
+
+        return jsonify({&quot;success&quot;: True, &quot;sessions&quot;: sessions_data})
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/students/&lt;int:student_id&gt;/weekly-reports&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_weekly_reports(student_id):
     &quot;&quot;&quot;R√©cup√©rer les rapports hebdomadaires d&#x27;un √©tudiant&quot;&quot;&quot;
     try:
-        reports = WeeklyReport.query.filter_by(student_id=student_id).order_by(
-            WeeklyReport.week_start_date.desc()
-        ).all()
+        reports = (
+            WeeklyReport.query.filter_by(student_id=student_id)
+            .order_by(WeeklyReport.week_start_date.desc())
+            .all()
+        )
 
         reports_data = []
         for report in reports:
-            reports_data.append({
-                &#x27;id&#x27;: report.id,
-                &#x27;week_start_date&#x27;: report.week_start_date.isoformat(),
-                &#x27;week_end_date&#x27;: report.week_end_date.isoformat(),
-                &#x27;subjects_progress&#x27;: report.subjects_progress,
-                &#x27;aria_insights&#x27;: report.aria_insights,
-                &#x27;teacher_comments&#x27;: report.teacher_comments,
-                &#x27;next_week_objectives&#x27;: report.next_week_objectives,
-                &#x27;parent_feedback&#x27;: report.parent_feedback,
-                &#x27;is_sent_to_parents&#x27;: report.is_sent_to_parents,
-                &#x27;created_at&#x27;: report.created_at.isoformat()
-            })
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;reports&#x27;: reports_data
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/students/&lt;int:student_id&gt;/communications&#x27;, methods=[&#x27;GET&#x27;])
+            reports_data.append(
+                {
+                    &quot;id&quot;: report.id,
+                    &quot;week_start_date&quot;: report.week_start_date.isoformat(),
+                    &quot;week_end_date&quot;: report.week_end_date.isoformat(),
+                    &quot;subjects_progress&quot;: report.subjects_progress,
+                    &quot;aria_insights&quot;: report.aria_insights,
+                    &quot;teacher_comments&quot;: report.teacher_comments,
+                    &quot;next_week_objectives&quot;: report.next_week_objectives,
+                    &quot;parent_feedback&quot;: report.parent_feedback,
+                    &quot;is_sent_to_parents&quot;: report.is_sent_to_parents,
+                    &quot;created_at&quot;: report.created_at.isoformat(),
+                }
+            )
+
+        return jsonify({&quot;success&quot;: True, &quot;reports&quot;: reports_data})
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/students/&lt;int:student_id&gt;/communications&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_communications(student_id):
     &quot;&quot;&quot;R√©cup√©rer les communications concernant un √©tudiant&quot;&quot;&quot;
     try:
-        communications = ParentCommunication.query.filter_by(
-            student_id=student_id
-        ).order_by(ParentCommunication.created_at.desc()).all()
+        communications = (
+            ParentCommunication.query.filter_by(student_id=student_id)
+            .order_by(ParentCommunication.created_at.desc())
+            .all()
+        )
 
         communications_data = []
         for comm in communications:
-            communications_data.append({
-                &#x27;id&#x27;: comm.id,
-                &#x27;sender_type&#x27;: comm.sender_type,
-                &#x27;sender_id&#x27;: comm.sender_id,
-                &#x27;recipient_type&#x27;: comm.recipient_type,
-                &#x27;recipient_id&#x27;: comm.recipient_id,
-                &#x27;subject&#x27;: comm.subject,
-                &#x27;message&#x27;: comm.message,
-                &#x27;is_read&#x27;: comm.is_read,
-                &#x27;priority&#x27;: comm.priority,
-                &#x27;created_at&#x27;: comm.created_at.isoformat()
-            })
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;communications&#x27;: communications_data
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/students/&lt;int:student_id&gt;/objectives&#x27;, methods=[&#x27;GET&#x27;])
+            communications_data.append(
+                {
+                    &quot;id&quot;: comm.id,
+                    &quot;sender_type&quot;: comm.sender_type,
+                    &quot;sender_id&quot;: comm.sender_id,
+                    &quot;recipient_type&quot;: comm.recipient_type,
+                    &quot;recipient_id&quot;: comm.recipient_id,
+                    &quot;subject&quot;: comm.subject,
+                    &quot;message&quot;: comm.message,
+                    &quot;is_read&quot;: comm.is_read,
+                    &quot;priority&quot;: comm.priority,
+                    &quot;created_at&quot;: comm.created_at.isoformat(),
+                }
+            )
+
+        return jsonify({&quot;success&quot;: True, &quot;communications&quot;: communications_data})
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/students/&lt;int:student_id&gt;/objectives&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_objectives(student_id):
     &quot;&quot;&quot;R√©cup√©rer les objectifs d&#x27;un √©tudiant&quot;&quot;&quot;
     try:
-        objectives = StudentObjective.query.filter_by(student_id=student_id).order_by(
-            StudentObjective.target_date.asc()
-        ).all()
+        objectives = (
+            StudentObjective.query.filter_by(student_id=student_id)
+            .order_by(StudentObjective.target_date.asc())
+            .all()
+        )
 
         objectives_data = []
         for obj in objectives:
-            objectives_data.append({
-                &#x27;id&#x27;: obj.id,
-                &#x27;subject&#x27;: obj.subject,
-                &#x27;objective_text&#x27;: obj.objective_text,
-                &#x27;target_date&#x27;: obj.target_date.isoformat(),
-                &#x27;is_achieved&#x27;: obj.is_achieved,
-                &#x27;achievement_date&#x27;: obj.achievement_date.isoformat() if obj.achievement_date else None,
-                &#x27;progress_percentage&#x27;: obj.progress_percentage,
-                &#x27;created_by&#x27;: obj.created_by,
-                &#x27;created_at&#x27;: obj.created_at.isoformat(),
-                &#x27;updated_at&#x27;: obj.updated_at.isoformat()
-            })
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;objectives&#x27;: objectives_data
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
-@formulas_bp.route(&#x27;/api/students/&lt;int:student_id&gt;/dashboard&#x27;, methods=[&#x27;GET&#x27;])
+            objectives_data.append(
+                {
+                    &quot;id&quot;: obj.id,
+                    &quot;subject&quot;: obj.subject,
+                    &quot;objective_text&quot;: obj.objective_text,
+                    &quot;target_date&quot;: obj.target_date.isoformat(),
+                    &quot;is_achieved&quot;: obj.is_achieved,
+                    &quot;achievement_date&quot;: (
+                        obj.achievement_date.isoformat()
+                        if obj.achievement_date
+                        else None
+                    ),
+                    &quot;progress_percentage&quot;: obj.progress_percentage,
+                    &quot;created_by&quot;: obj.created_by,
+                    &quot;created_at&quot;: obj.created_at.isoformat(),
+                    &quot;updated_at&quot;: obj.updated_at.isoformat(),
+                }
+            )
+
+        return jsonify({&quot;success&quot;: True, &quot;objectives&quot;: objectives_data})
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
+
+
+@formulas_bp.route(&quot;/api/students/&lt;int:student_id&gt;/dashboard&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_dashboard(student_id):
     &quot;&quot;&quot;R√©cup√©rer les donn√©es du tableau de bord pour un √©tudiant&quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;success&quot;: False, &quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         # Inscription active
-        enrollment = Enrollment.query.filter_by(student_id=student_id, is_active=True).first()
+        enrollment = Enrollment.query.filter_by(
+            student_id=student_id, is_active=True
+        ).first()
 
         # Prochaine s√©ance
         next_session = None
         if enrollment:
             if enrollment.group_id:
                 # S√©ance de groupe
-                next_group_session = GroupSession.query.filter(
-                    GroupSession.group_id == enrollment.group_id,
-                    GroupSession.scheduled_at &gt; datetime.utcnow(),
-                    GroupSession.status == &#x27;scheduled&#x27;
-                ).order_by(GroupSession.scheduled_at.asc()).first()
+                next_group_session = (
+                    GroupSession.query.filter(
+                        GroupSession.group_id == enrollment.group_id,
+                        GroupSession.scheduled_at &gt; datetime.utcnow(),
+                        GroupSession.status == &quot;scheduled&quot;,
+                    )
+                    .order_by(GroupSession.scheduled_at.asc())
+                    .first()
+                )
 
                 if next_group_session:
                     group = Group.query.get(enrollment.group_id)
                     teacher = Teacher.query.get(group.teacher_id) if group else None
                     next_session = {
-                        &#x27;type&#x27;: &#x27;group&#x27;,
-                        &#x27;date&#x27;: next_group_session.scheduled_at.date().isoformat(),
-                        &#x27;time&#x27;: next_group_session.scheduled_at.time().strftime(&#x27;%H:%M&#x27;),
-                        &#x27;subject&#x27;: next_group_session.subject,
-                        &#x27;teacher&#x27;: f&quot;{teacher.first_name} {teacher.last_name}&quot; if teacher else &quot;Non assign√©&quot;,
-                        &#x27;group_name&#x27;: group.name if group else None
+                        &quot;type&quot;: &quot;group&quot;,
+                        &quot;date&quot;: next_group_session.scheduled_at.date().isoformat(),
+                        &quot;time&quot;: next_group_session.scheduled_at.time().strftime(
+                            &quot;%H:%M&quot;
+                        ),
+                        &quot;subject&quot;: next_group_session.subject,
+                        &quot;teacher&quot;: (
+                            f&quot;{teacher.first_name} {teacher.last_name}&quot;
+                            if teacher
+                            else &quot;Non assign√©&quot;
+                        ),
+                        &quot;group_name&quot;: group.name if group else None,
                     }
             else:
                 # S√©ance individuelle
-                next_individual_session = IndividualSession.query.filter(
-                    IndividualSession.student_id == student_id,
-                    IndividualSession.scheduled_at &gt; datetime.utcnow(),
-                    IndividualSession.status == &#x27;scheduled&#x27;
-                ).order_by(IndividualSession.scheduled_at.asc()).first()
+                next_individual_session = (
+                    IndividualSession.query.filter(
+                        IndividualSession.student_id == student_id,
+                        IndividualSession.scheduled_at &gt; datetime.utcnow(),
+                        IndividualSession.status == &quot;scheduled&quot;,
+                    )
+                    .order_by(IndividualSession.scheduled_at.asc())
+                    .first()
+                )
 
                 if next_individual_session:
                     teacher = Teacher.query.get(next_individual_session.teacher_id)
                     next_session = {
-                        &#x27;type&#x27;: &#x27;individual&#x27;,
-                        &#x27;date&#x27;: next_individual_session.scheduled_at.date().isoformat(),
-                        &#x27;time&#x27;: next_individual_session.scheduled_at.time().strftime(&#x27;%H:%M&#x27;),
-                        &#x27;subject&#x27;: next_individual_session.subject,
-                        &#x27;teacher&#x27;: f&quot;{teacher.first_name} {teacher.last_name}&quot; if teacher else &quot;Non assign√©&quot;
+                        &quot;type&quot;: &quot;individual&quot;,
+                        &quot;date&quot;: next_individual_session.scheduled_at.date().isoformat(),
+                        &quot;time&quot;: next_individual_session.scheduled_at.time().strftime(
+                            &quot;%H:%M&quot;
+                        ),
+                        &quot;subject&quot;: next_individual_session.subject,
+                        &quot;teacher&quot;: (
+                            f&quot;{teacher.first_name} {teacher.last_name}&quot;
+                            if teacher
+                            else &quot;Non assign√©&quot;
+                        ),
                     }
 
         # Statistiques du mois
         current_month_start = date.today().replace(day=1)
         sessions_this_month = 0
@@ -434,52 +534,58 @@
         if enrollment:
             if enrollment.group_id:
                 group_sessions = GroupSession.query.filter(
                     GroupSession.group_id == enrollment.group_id,
                     GroupSession.scheduled_at &gt;= current_month_start,
-                    GroupSession.status == &#x27;completed&#x27;
+                    GroupSession.status == &quot;completed&quot;,
                 ).count()
                 sessions_this_month += group_sessions
             else:
                 individual_sessions = IndividualSession.query.filter(
                     IndividualSession.student_id == student_id,
                     IndividualSession.scheduled_at &gt;= current_month_start,
-                    IndividualSession.status == &#x27;completed&#x27;
+                    IndividualSession.status == &quot;completed&quot;,
                 ).count()
                 sessions_this_month += individual_sessions
 
         # Objectifs atteints
-        total_objectives = StudentObjective.query.filter_by(student_id=student_id).count()
+        total_objectives = StudentObjective.query.filter_by(
+            student_id=student_id
+        ).count()
         achieved_objectives = StudentObjective.query.filter_by(
-            student_id=student_id,
-            is_achieved=True
+            student_id=student_id, is_achieved=True
         ).count()
 
         # Progression globale (simul√©e pour la d√©mo)
         global_progress = 87  # √Ä calculer selon la logique m√©tier
 
         # Confiance ARIA (simul√©e)
         aria_confidence = 94  # √Ä calculer selon l&#x27;IA
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;dashboard&#x27;: {
-                &#x27;student&#x27;: {
-                    &#x27;id&#x27;: student.id,
-                    &#x27;name&#x27;: f&quot;{student.first_name} {student.last_name}&quot;,
-                    &#x27;grade&#x27;: student.grade_level,
-                    &#x27;school&#x27;: student.school,
-                    &#x27;formula&#x27;: enrollment.formula.name if enrollment and enrollment.formula else None
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;dashboard&quot;: {
+                    &quot;student&quot;: {
+                        &quot;id&quot;: student.id,
+                        &quot;name&quot;: f&quot;{student.first_name} {student.last_name}&quot;,
+                        &quot;grade&quot;: student.grade_level,
+                        &quot;school&quot;: student.school,
+                        &quot;formula&quot;: (
+                            enrollment.formula.name
+                            if enrollment and enrollment.formula
+                            else None
+                        ),
+                    },
+                    &quot;next_session&quot;: next_session,
+                    &quot;stats&quot;: {
+                        &quot;global_progress&quot;: global_progress,
+                        &quot;sessions_this_month&quot;: sessions_this_month,
+                        &quot;objectives_achieved&quot;: achieved_objectives,
+                        &quot;total_objectives&quot;: total_objectives,
+                        &quot;aria_confidence&quot;: aria_confidence,
+                    },
                 },
-                &#x27;next_session&#x27;: next_session,
-                &#x27;stats&#x27;: {
-                    &#x27;global_progress&#x27;: global_progress,
-                    &#x27;sessions_this_month&#x27;: sessions_this_month,
-                    &#x27;objectives_achieved&#x27;: achieved_objectives,
-                    &#x27;total_objectives&#x27;: total_objectives,
-                    &#x27;aria_confidence&#x27;: aria_confidence
-                }
-            }
-        })
-    except Exception as e:
-        return jsonify({&#x27;success&#x27;: False, &#x27;error&#x27;: str(e)}), 500
-
+            }
+        )
+    except Exception as e:
+        return jsonify({&quot;success&quot;: False, &quot;error&quot;: str(e)}), 500
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/user.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/user.py	2025-07-24 20:54:02.374429+00:00
@@ -1,34 +1,39 @@
 &quot;&quot;&quot;
 Mod√®le utilisateur pour la plateforme NSI
 &quot;&quot;&quot;
+
 from datetime import datetime
 from enum import Enum
 
 from werkzeug.security import generate_password_hash, check_password_hash
 
 from ..database import db
 
 
 class UserRole(Enum):
     &quot;&quot;&quot;√ânum√©ration des r√¥les utilisateur&quot;&quot;&quot;
+
     STUDENT = &quot;student&quot;
     PARENT = &quot;parent&quot;
     TEACHER = &quot;teacher&quot;
     ADMIN = &quot;admin&quot;
 
 
 class UserStatus(Enum):
     &quot;&quot;&quot;√ânum√©ration des statuts utilisateur&quot;&quot;&quot;
+
     ACTIVE = &quot;active&quot;
     INACTIVE = &quot;inactive&quot;
     PENDING = &quot;pending&quot;
     SUSPENDED = &quot;suspended&quot;
 
+
 class User(db.Model):
     &quot;&quot;&quot;Mod√®le utilisateur unifi√© pour tous les types d&#x27;utilisateurs&quot;&quot;&quot;
-    __tablename__ = &#x27;users&#x27;
+
+    __tablename__ = &quot;users&quot;
 
     id = db.Column(db.Integer, primary_key=True)
     email = db.Column(db.String(120), unique=True, nullable=False, index=True)
     password_hash = db.Column(db.String(255), nullable=False)
 
@@ -48,31 +53,56 @@
     email_verification_token = db.Column(db.String(100), nullable=True)
     password_reset_token = db.Column(db.String(100), nullable=True)
     password_reset_expires = db.Column(db.DateTime, nullable=True)
 
     # Pr√©f√©rences utilisateur
-    preferences = db.Column(db.JSON, nullable=True)  # Pr√©f√©rences UI, notifications, etc.
-    timezone = db.Column(db.String(50), default=&#x27;Africa/Tunis&#x27;)
-    language = db.Column(db.String(5), default=&#x27;fr&#x27;)
+    preferences = db.Column(
+        db.JSON, nullable=True
+    )  # Pr√©f√©rences UI, notifications, etc.
+    timezone = db.Column(db.String(50), default=&quot;Africa/Tunis&quot;)
+    language = db.Column(db.String(5), default=&quot;fr&quot;)
 
     # Timestamps
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
 
     # Relations selon le r√¥le
-    student_profile = db.relationship(&#x27;StudentProfile&#x27;, backref=&#x27;user&#x27;, uselist=False, lazy=True,
-                                    cascade=&#x27;all, delete-orphan&#x27;)
-    parent_profile = db.relationship(&#x27;ParentProfile&#x27;, backref=&#x27;user&#x27;, uselist=False, lazy=True,
-                                   cascade=&#x27;all, delete-orphan&#x27;)
-    teacher_profile = db.relationship(&#x27;TeacherProfile&#x27;, backref=&#x27;user&#x27;, uselist=False, lazy=True,
-                                    cascade=&#x27;all, delete-orphan&#x27;)
-    admin_profile = db.relationship(&#x27;AdminProfile&#x27;, backref=&#x27;user&#x27;, uselist=False, lazy=True,
-                                  cascade=&#x27;all, delete-orphan&#x27;)
+    student_profile = db.relationship(
+        &quot;StudentProfile&quot;,
+        backref=&quot;user&quot;,
+        uselist=False,
+        lazy=True,
+        cascade=&quot;all, delete-orphan&quot;,
+    )
+    parent_profile = db.relationship(
+        &quot;ParentProfile&quot;,
+        backref=&quot;user&quot;,
+        uselist=False,
+        lazy=True,
+        cascade=&quot;all, delete-orphan&quot;,
+    )
+    teacher_profile = db.relationship(
+        &quot;TeacherProfile&quot;,
+        backref=&quot;user&quot;,
+        uselist=False,
+        lazy=True,
+        cascade=&quot;all, delete-orphan&quot;,
+    )
+    admin_profile = db.relationship(
+        &quot;AdminProfile&quot;,
+        backref=&quot;user&quot;,
+        uselist=False,
+        lazy=True,
+        cascade=&quot;all, delete-orphan&quot;,
+    )
 
     # Sessions et tokens
-    user_sessions = db.relationship(&#x27;UserSession&#x27;, backref=&#x27;user&#x27;, lazy=True,
-                                  cascade=&#x27;all, delete-orphan&#x27;)
+    user_sessions = db.relationship(
+        &quot;UserSession&quot;, backref=&quot;user&quot;, lazy=True, cascade=&quot;all, delete-orphan&quot;
+    )
 
     def __init__(self, email, password, first_name, last_name, role, **kwargs):
         self.email = email.lower().strip()
         self.set_password(password)
         self.first_name = first_name
@@ -103,134 +133,158 @@
         return self.status == UserStatus.ACTIVE
 
     def to_dict(self, include_sensitive=False):  # pylint: disable=unused-argument
         &quot;&quot;&quot;Convertit l&#x27;utilisateur en dictionnaire&quot;&quot;&quot;
         data = {
-            &#x27;id&#x27;: self.id,
-            &#x27;email&#x27;: self.email,
-            &#x27;first_name&#x27;: self.first_name,
-            &#x27;last_name&#x27;: self.last_name,
-            &#x27;full_name&#x27;: self.full_name,
-            &#x27;phone&#x27;: self.phone,
-            &#x27;avatar_url&#x27;: self.avatar_url,
-            &#x27;role&#x27;: self.role.value,
-            &#x27;status&#x27;: self.status.value if self.status else &#x27;active&#x27;,
-            &#x27;email_verified&#x27;: self.email_verified,
-            &#x27;preferences&#x27;: self.preferences,
-            &#x27;timezone&#x27;: self.timezone,
-            &#x27;language&#x27;: self.language,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None,
-            &#x27;last_login&#x27;: self.last_login.isoformat() if self.last_login else None
+            &quot;id&quot;: self.id,
+            &quot;email&quot;: self.email,
+            &quot;first_name&quot;: self.first_name,
+            &quot;last_name&quot;: self.last_name,
+            &quot;full_name&quot;: self.full_name,
+            &quot;phone&quot;: self.phone,
+            &quot;avatar_url&quot;: self.avatar_url,
+            &quot;role&quot;: self.role.value,
+            &quot;status&quot;: self.status.value if self.status else &quot;active&quot;,
+            &quot;email_verified&quot;: self.email_verified,
+            &quot;preferences&quot;: self.preferences,
+            &quot;timezone&quot;: self.timezone,
+            &quot;language&quot;: self.language,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+            &quot;last_login&quot;: self.last_login.isoformat() if self.last_login else None,
         }
 
         # Ajouter le profil sp√©cifique selon le r√¥le
         if self.role == UserRole.STUDENT and self.student_profile:
-            data[&#x27;profile&#x27;] = self.student_profile.to_dict()
+            data[&quot;profile&quot;] = self.student_profile.to_dict()
         elif self.role == UserRole.PARENT and self.parent_profile:
-            data[&#x27;profile&#x27;] = self.parent_profile.to_dict()
+            data[&quot;profile&quot;] = self.parent_profile.to_dict()
         elif self.role == UserRole.TEACHER and self.teacher_profile:
-            data[&#x27;profile&#x27;] = self.teacher_profile.to_dict()
+            data[&quot;profile&quot;] = self.teacher_profile.to_dict()
         elif self.role == UserRole.ADMIN and self.admin_profile:
-            data[&#x27;profile&#x27;] = self.admin_profile.to_dict()
+            data[&quot;profile&quot;] = self.admin_profile.to_dict()
 
         return data
+
 
 class StudentProfile(db.Model):
     &quot;&quot;&quot;Profil sp√©cifique pour les √©tudiants&quot;&quot;&quot;
-    __tablename__ = &#x27;student_profiles&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False, unique=True)
+
+    __tablename__ = &quot;student_profiles&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    user_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False, unique=True
+    )
 
     # Informations acad√©miques
-    grade_level = db.Column(db.String(20), nullable=False)  # seconde, premiere, terminale
+    grade_level = db.Column(
+        db.String(20), nullable=False
+    )  # seconde, premiere, terminale
     school = db.Column(db.String(100), nullable=True)
     specialties = db.Column(db.JSON, nullable=True)  # Sp√©cialit√©s choisies
 
     # Profil d&#x27;apprentissage ARIA
-    learning_style = db.Column(db.String(50), nullable=True)  # visual, auditory, kinesthetic, mixed
+    learning_style = db.Column(
+        db.String(50), nullable=True
+    )  # visual, auditory, kinesthetic, mixed
     cognitive_profile = db.Column(db.JSON, nullable=True)  # Profil cognitif d√©taill√©
     performance_data = db.Column(db.JSON, nullable=True)  # Historique de performance
 
     # Objectifs et motivation
     goals = db.Column(db.JSON, nullable=True)  # Objectifs scolaires et de carri√®re
     interests = db.Column(db.JSON, nullable=True)  # Centres d&#x27;int√©r√™t
-    motivation_level = db.Column(db.String(20), default=&#x27;medium&#x27;)  # low, medium, high
+    motivation_level = db.Column(db.String(20), default=&quot;medium&quot;)  # low, medium, high
 
     # Relations avec les parents
     parent_ids = db.Column(db.JSON, nullable=True)  # IDs des parents li√©s
 
     # M√©tadonn√©es
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit le profil √©tudiant en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;user_id&#x27;: self.user_id,
-            &#x27;grade_level&#x27;: self.grade_level,
-            &#x27;school&#x27;: self.school,
-            &#x27;specialties&#x27;: self.specialties,
-            &#x27;learning_style&#x27;: self.learning_style,
-            &#x27;cognitive_profile&#x27;: self.cognitive_profile,
-            &#x27;performance_data&#x27;: self.performance_data,
-            &#x27;goals&#x27;: self.goals,
-            &#x27;interests&#x27;: self.interests,
-            &#x27;motivation_level&#x27;: self.motivation_level,
-            &#x27;parent_ids&#x27;: self.parent_ids,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+            &quot;id&quot;: self.id,
+            &quot;user_id&quot;: self.user_id,
+            &quot;grade_level&quot;: self.grade_level,
+            &quot;school&quot;: self.school,
+            &quot;specialties&quot;: self.specialties,
+            &quot;learning_style&quot;: self.learning_style,
+            &quot;cognitive_profile&quot;: self.cognitive_profile,
+            &quot;performance_data&quot;: self.performance_data,
+            &quot;goals&quot;: self.goals,
+            &quot;interests&quot;: self.interests,
+            &quot;motivation_level&quot;: self.motivation_level,
+            &quot;parent_ids&quot;: self.parent_ids,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 class ParentProfile(db.Model):
     &quot;&quot;&quot;Profil sp√©cifique pour les parents&quot;&quot;&quot;
-    __tablename__ = &#x27;parent_profiles&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False, unique=True)
+
+    __tablename__ = &quot;parent_profiles&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    user_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False, unique=True
+    )
 
     # Informations personnelles
     profession = db.Column(db.String(100), nullable=True)
     address = db.Column(db.Text, nullable=True)
     emergency_contact = db.Column(db.String(20), nullable=True)
 
     # Relations avec les enfants
     children_ids = db.Column(db.JSON, nullable=True)  # IDs des enfants suivis
 
     # Pr√©f√©rences de communication
-    preferred_contact_method = db.Column(db.String(20), default=&#x27;email&#x27;)  # email, phone, sms
+    preferred_contact_method = db.Column(
+        db.String(20), default=&quot;email&quot;
+    )  # email, phone, sms
     notification_preferences = db.Column(db.JSON, nullable=True)
-    report_frequency = db.Column(db.String(20), default=&#x27;weekly&#x27;)  # daily, weekly, monthly
-
-    # M√©tadonn√©es
-    created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
+    report_frequency = db.Column(
+        db.String(20), default=&quot;weekly&quot;
+    )  # daily, weekly, monthly
+
+    # M√©tadonn√©es
+    created_at = db.Column(db.DateTime, default=datetime.utcnow)
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit le profil parent en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;user_id&#x27;: self.user_id,
-            &#x27;profession&#x27;: self.profession,
-            &#x27;address&#x27;: self.address,
-            &#x27;emergency_contact&#x27;: self.emergency_contact,
-            &#x27;children_ids&#x27;: self.children_ids,
-            &#x27;preferred_contact_method&#x27;: self.preferred_contact_method,
-            &#x27;notification_preferences&#x27;: self.notification_preferences,
-            &#x27;report_frequency&#x27;: self.report_frequency,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+            &quot;id&quot;: self.id,
+            &quot;user_id&quot;: self.user_id,
+            &quot;profession&quot;: self.profession,
+            &quot;address&quot;: self.address,
+            &quot;emergency_contact&quot;: self.emergency_contact,
+            &quot;children_ids&quot;: self.children_ids,
+            &quot;preferred_contact_method&quot;: self.preferred_contact_method,
+            &quot;notification_preferences&quot;: self.notification_preferences,
+            &quot;report_frequency&quot;: self.report_frequency,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 class TeacherProfile(db.Model):
     &quot;&quot;&quot;Profil sp√©cifique pour les enseignants&quot;&quot;&quot;
-    __tablename__ = &#x27;teacher_profiles&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False, unique=True)
+
+    __tablename__ = &quot;teacher_profiles&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    user_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False, unique=True
+    )
 
     # Qualifications
     subjects = db.Column(db.JSON, nullable=False)  # Mati√®res enseign√©es
     qualifications = db.Column(db.JSON, nullable=True)  # Dipl√¥mes, certifications
     experience_years = db.Column(db.Integer, nullable=True)
@@ -262,47 +316,53 @@
 
     # M√©tadonn√©es
     hire_date = db.Column(db.Date, nullable=True)
     is_active_teacher = db.Column(db.Boolean, default=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit le profil enseignant en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;user_id&#x27;: self.user_id,
-            &#x27;subjects&#x27;: self.subjects,
-            &#x27;qualifications&#x27;: self.qualifications,
-            &#x27;experience_years&#x27;: self.experience_years,
-            &#x27;is_aefe_certified&#x27;: self.is_aefe_certified,
-            &#x27;is_nsi_diu&#x27;: self.is_nsi_diu,
-            &#x27;can_teach_online&#x27;: self.can_teach_online,
-            &#x27;can_teach_in_person&#x27;: self.can_teach_in_person,
-            &#x27;preferred_formats&#x27;: self.preferred_formats,
-            &#x27;hourly_rate_online&#x27;: self.hourly_rate_online,
-            &#x27;hourly_rate_in_person&#x27;: self.hourly_rate_in_person,
-            &#x27;hourly_rate_group&#x27;: self.hourly_rate_group,
-            &#x27;default_availability&#x27;: self.default_availability,
-            &#x27;max_hours_per_week&#x27;: self.max_hours_per_week,
-            &#x27;rating&#x27;: self.rating,
-            &#x27;total_reviews&#x27;: self.total_reviews,
-            &#x27;total_hours_taught&#x27;: self.total_hours_taught,
-            &#x27;bio&#x27;: self.bio,
-            &#x27;specialties_description&#x27;: self.specialties_description,
-            &#x27;hire_date&#x27;: self.hire_date.isoformat() if self.hire_date else None,
-            &#x27;is_active_teacher&#x27;: self.is_active_teacher,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+            &quot;id&quot;: self.id,
+            &quot;user_id&quot;: self.user_id,
+            &quot;subjects&quot;: self.subjects,
+            &quot;qualifications&quot;: self.qualifications,
+            &quot;experience_years&quot;: self.experience_years,
+            &quot;is_aefe_certified&quot;: self.is_aefe_certified,
+            &quot;is_nsi_diu&quot;: self.is_nsi_diu,
+            &quot;can_teach_online&quot;: self.can_teach_online,
+            &quot;can_teach_in_person&quot;: self.can_teach_in_person,
+            &quot;preferred_formats&quot;: self.preferred_formats,
+            &quot;hourly_rate_online&quot;: self.hourly_rate_online,
+            &quot;hourly_rate_in_person&quot;: self.hourly_rate_in_person,
+            &quot;hourly_rate_group&quot;: self.hourly_rate_group,
+            &quot;default_availability&quot;: self.default_availability,
+            &quot;max_hours_per_week&quot;: self.max_hours_per_week,
+            &quot;rating&quot;: self.rating,
+            &quot;total_reviews&quot;: self.total_reviews,
+            &quot;total_hours_taught&quot;: self.total_hours_taught,
+            &quot;bio&quot;: self.bio,
+            &quot;specialties_description&quot;: self.specialties_description,
+            &quot;hire_date&quot;: self.hire_date.isoformat() if self.hire_date else None,
+            &quot;is_active_teacher&quot;: self.is_active_teacher,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 class AdminProfile(db.Model):
     &quot;&quot;&quot;Profil sp√©cifique pour les administrateurs&quot;&quot;&quot;
-    __tablename__ = &#x27;admin_profiles&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False, unique=True)
+
+    __tablename__ = &quot;admin_profiles&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    user_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False, unique=True
+    )
 
     # Permissions et r√¥les
     permissions = db.Column(db.JSON, nullable=True)  # Permissions sp√©cifiques
     department = db.Column(db.String(50), nullable=True)  # Service de rattachement
     is_super_admin = db.Column(db.Boolean, default=False)
@@ -313,34 +373,38 @@
     can_view_reports = db.Column(db.Boolean, default=True)
     can_manage_billing = db.Column(db.Boolean, default=False)
 
     # M√©tadonn√©es
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit le profil administrateur en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;user_id&#x27;: self.user_id,
-            &#x27;permissions&#x27;: self.permissions,
-            &#x27;department&#x27;: self.department,
-            &#x27;is_super_admin&#x27;: self.is_super_admin,
-            &#x27;can_manage_users&#x27;: self.can_manage_users,
-            &#x27;can_manage_content&#x27;: self.can_manage_content,
-            &#x27;can_view_reports&#x27;: self.can_view_reports,
-            &#x27;can_manage_billing&#x27;: self.can_manage_billing,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+            &quot;id&quot;: self.id,
+            &quot;user_id&quot;: self.user_id,
+            &quot;permissions&quot;: self.permissions,
+            &quot;department&quot;: self.department,
+            &quot;is_super_admin&quot;: self.is_super_admin,
+            &quot;can_manage_users&quot;: self.can_manage_users,
+            &quot;can_manage_content&quot;: self.can_manage_content,
+            &quot;can_view_reports&quot;: self.can_view_reports,
+            &quot;can_manage_billing&quot;: self.can_manage_billing,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 class UserSession(db.Model):
     &quot;&quot;&quot;Sessions utilisateur pour la gestion des tokens JWT&quot;&quot;&quot;
-    __tablename__ = &#x27;user_sessions&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;user_sessions&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    user_id = db.Column(db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False)
 
     # Informations de session
     session_token = db.Column(db.String(255), nullable=False, unique=True)
     refresh_token = db.Column(db.String(255), nullable=True, unique=True)
     expires_at = db.Column(db.DateTime, nullable=False)
@@ -359,72 +423,86 @@
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit la session utilisateur en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;user_id&#x27;: self.user_id,
-            &#x27;expires_at&#x27;: self.expires_at.isoformat() if self.expires_at else None,
-            &#x27;ip_address&#x27;: self.ip_address,
-            &#x27;user_agent&#x27;: self.user_agent,
-            &#x27;device_type&#x27;: self.device_type,
-            &#x27;location&#x27;: self.location,
-            &#x27;is_active&#x27;: self.is_active,
-            &#x27;last_activity&#x27;: self.last_activity.isoformat() if self.last_activity else None,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None
-        }
+            &quot;id&quot;: self.id,
+            &quot;user_id&quot;: self.user_id,
+            &quot;expires_at&quot;: self.expires_at.isoformat() if self.expires_at else None,
+            &quot;ip_address&quot;: self.ip_address,
+            &quot;user_agent&quot;: self.user_agent,
+            &quot;device_type&quot;: self.device_type,
+            &quot;location&quot;: self.location,
+            &quot;is_active&quot;: self.is_active,
+            &quot;last_activity&quot;: (
+                self.last_activity.isoformat() if self.last_activity else None
+            ),
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+        }
+
 
 class ParentChildRelation(db.Model):
     &quot;&quot;&quot;Table de liaison entre parents et enfants&quot;&quot;&quot;
-    __tablename__ = &#x27;parent_child_relations&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    parent_user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False)
-    child_user_id = db.Column(db.Integer, db.ForeignKey(&#x27;users.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;parent_child_relations&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    parent_user_id = db.Column(db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False)
+    child_user_id = db.Column(db.Integer, db.ForeignKey(&quot;users.id&quot;), nullable=False)
 
     # Type de relation
     # parent, guardian, tutor
-    relation_type = db.Column(db.String(20), default=&#x27;parent&#x27;)
+    relation_type = db.Column(db.String(20), default=&quot;parent&quot;)
     is_primary_contact = db.Column(db.Boolean, default=False)
     can_view_grades = db.Column(db.Boolean, default=True)
     can_book_sessions = db.Column(db.Boolean, default=True)
     can_receive_reports = db.Column(db.Boolean, default=True)
 
     # M√©tadonn√©es
-    confirmed_at = db.Column(db.DateTime, nullable=True)  # Quand la relation a √©t√© confirm√©e
+    confirmed_at = db.Column(
+        db.DateTime, nullable=True
+    )  # Quand la relation a √©t√© confirm√©e
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     # Contrainte d&#x27;unicit√©
-    __table_args__ = (db.UniqueConstraint(&#x27;parent_user_id&#x27;, &#x27;child_user_id&#x27;,
-                                          name=&#x27;unique_parent_child&#x27;),)
+    __table_args__ = (
+        db.UniqueConstraint(
+            &quot;parent_user_id&quot;, &quot;child_user_id&quot;, name=&quot;unique_parent_child&quot;
+        ),
+    )
 
     def to_dict(self):
         &quot;&quot;&quot;Convertit la relation parent-enfant en dictionnaire&quot;&quot;&quot;
         return {
-            &#x27;id&#x27;: self.id,
-            &#x27;parent_user_id&#x27;: self.parent_user_id,
-            &#x27;child_user_id&#x27;: self.child_user_id,
-            &#x27;relation_type&#x27;: self.relation_type,
-            &#x27;is_primary_contact&#x27;: self.is_primary_contact,
-            &#x27;can_view_grades&#x27;: self.can_view_grades,
-            &#x27;can_book_sessions&#x27;: self.can_book_sessions,
-            &#x27;can_receive_reports&#x27;: self.can_receive_reports,
-            &#x27;confirmed_at&#x27;: self.confirmed_at.isoformat() if self.confirmed_at else None,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None
-        }
+            &quot;id&quot;: self.id,
+            &quot;parent_user_id&quot;: self.parent_user_id,
+            &quot;child_user_id&quot;: self.child_user_id,
+            &quot;relation_type&quot;: self.relation_type,
+            &quot;is_primary_contact&quot;: self.is_primary_contact,
+            &quot;can_view_grades&quot;: self.can_view_grades,
+            &quot;can_book_sessions&quot;: self.can_book_sessions,
+            &quot;can_receive_reports&quot;: self.can_receive_reports,
+            &quot;confirmed_at&quot;: (
+                self.confirmed_at.isoformat() if self.confirmed_at else None
+            ),
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+        }
+
 
 # Fonctions utilitaires
-def create_user_with_profile(email, password, first_name, last_name, role, profile_data=None):
+def create_user_with_profile(
+    email, password, first_name, last_name, role, profile_data=None
+):
     &quot;&quot;&quot;Cr√©e un utilisateur avec son profil sp√©cifique&quot;&quot;&quot;
 
     # Cr√©er l&#x27;utilisateur principal
     user = User(
         email=email,
         password=password,
         first_name=first_name,
         last_name=last_name,
-        role=role
+        role=role,
     )
 
     db.session.add(user)
     db.session.flush()  # Pour obtenir l&#x27;ID
 
@@ -433,42 +511,42 @@
         profile_data = {}
 
     if role == UserRole.STUDENT:
         profile = StudentProfile(
             user_id=user.id,
-            grade_level=profile_data.get(&#x27;grade_level&#x27;, &#x27;terminale&#x27;),
-            school=profile_data.get(&#x27;school&#x27;),
-            specialties=profile_data.get(&#x27;specialties&#x27;, []),
-            learning_style=profile_data.get(&#x27;learning_style&#x27;),
-            goals=profile_data.get(&#x27;goals&#x27;, []),
-            interests=profile_data.get(&#x27;interests&#x27;, [])
+            grade_level=profile_data.get(&quot;grade_level&quot;, &quot;terminale&quot;),
+            school=profile_data.get(&quot;school&quot;),
+            specialties=profile_data.get(&quot;specialties&quot;, []),
+            learning_style=profile_data.get(&quot;learning_style&quot;),
+            goals=profile_data.get(&quot;goals&quot;, []),
+            interests=profile_data.get(&quot;interests&quot;, []),
         )
     elif role == UserRole.PARENT:
         profile = ParentProfile(
             user_id=user.id,
-            profession=profile_data.get(&#x27;profession&#x27;),
-            address=profile_data.get(&#x27;address&#x27;),
-            emergency_contact=profile_data.get(&#x27;emergency_contact&#x27;),
-            children_ids=profile_data.get(&#x27;children_ids&#x27;, [])
+            profession=profile_data.get(&quot;profession&quot;),
+            address=profile_data.get(&quot;address&quot;),
+            emergency_contact=profile_data.get(&quot;emergency_contact&quot;),
+            children_ids=profile_data.get(&quot;children_ids&quot;, []),
         )
     elif role == UserRole.TEACHER:
         profile = TeacherProfile(
             user_id=user.id,
-            subjects=profile_data.get(&#x27;subjects&#x27;, []),
-            qualifications=profile_data.get(&#x27;qualifications&#x27;, []),
-            experience_years=profile_data.get(&#x27;experience_years&#x27;),
-            is_aefe_certified=profile_data.get(&#x27;is_aefe_certified&#x27;, False),
-            can_teach_online=profile_data.get(&#x27;can_teach_online&#x27;, True),
-            can_teach_in_person=profile_data.get(&#x27;can_teach_in_person&#x27;, True),
-            bio=profile_data.get(&#x27;bio&#x27;)
+            subjects=profile_data.get(&quot;subjects&quot;, []),
+            qualifications=profile_data.get(&quot;qualifications&quot;, []),
+            experience_years=profile_data.get(&quot;experience_years&quot;),
+            is_aefe_certified=profile_data.get(&quot;is_aefe_certified&quot;, False),
+            can_teach_online=profile_data.get(&quot;can_teach_online&quot;, True),
+            can_teach_in_person=profile_data.get(&quot;can_teach_in_person&quot;, True),
+            bio=profile_data.get(&quot;bio&quot;),
         )
     elif role == UserRole.ADMIN:
         profile = AdminProfile(
             user_id=user.id,
-            permissions=profile_data.get(&#x27;permissions&#x27;, []),
-            department=profile_data.get(&#x27;department&#x27;),
-            is_super_admin=profile_data.get(&#x27;is_super_admin&#x27;, False)
+            permissions=profile_data.get(&quot;permissions&quot;, []),
+            department=profile_data.get(&quot;department&quot;),
+            is_super_admin=profile_data.get(&quot;is_super_admin&quot;, False),
         )
     else:
         raise ValueError(f&quot;R√¥le non support√©: {role}&quot;)
 
     db.session.add(profile)
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/document_database.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/document_database.py	2025-07-24 20:54:02.421594+00:00
@@ -5,10 +5,11 @@
 
 import json
 import sqlite3
 from typing import List, Dict, Optional
 from datetime import datetime
+
 
 class DocumentDatabase:
     def __init__(self, db_path: str = &quot;documents.db&quot;):
         self.db_path = db_path
         self.init_database()
@@ -18,11 +19,12 @@
         &quot;&quot;&quot;Initialise la base de donn√©es documentaire&quot;&quot;&quot;
         conn = sqlite3.connect(self.db_path)
         cursor = conn.cursor()
 
         # Table des documents
-        cursor.execute(&#x27;&#x27;&#x27;
+        cursor.execute(
+            &quot;&quot;&quot;
             CREATE TABLE IF NOT EXISTS documents (
                 id INTEGER PRIMARY KEY AUTOINCREMENT,
                 title TEXT NOT NULL,
                 content TEXT NOT NULL,
                 subject TEXT NOT NULL,
@@ -31,28 +33,32 @@
                 tags TEXT,
                 difficulty_level INTEGER,
                 url TEXT,
                 created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
             )
-        &#x27;&#x27;&#x27;)
+        &quot;&quot;&quot;
+        )
 
         # Table des liens utiles
-        cursor.execute(&#x27;&#x27;&#x27;
+        cursor.execute(
+            &quot;&quot;&quot;
             CREATE TABLE IF NOT EXISTS useful_links (
                 id INTEGER PRIMARY KEY AUTOINCREMENT,
                 title TEXT NOT NULL,
                 url TEXT NOT NULL,
                 description TEXT,
                 subject TEXT NOT NULL,
                 grade_level TEXT,
                 category TEXT,
                 created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
             )
-        &#x27;&#x27;&#x27;)
+        &quot;&quot;&quot;
+        )
 
         # Table des exercices
-        cursor.execute(&#x27;&#x27;&#x27;
+        cursor.execute(
+            &quot;&quot;&quot;
             CREATE TABLE IF NOT EXISTS exercises (
                 id INTEGER PRIMARY KEY AUTOINCREMENT,
                 title TEXT NOT NULL,
                 content TEXT NOT NULL,
                 solution TEXT,
@@ -60,11 +66,12 @@
                 grade_level TEXT NOT NULL,
                 difficulty_level INTEGER,
                 tags TEXT,
                 created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
             )
-        &#x27;&#x27;&#x27;)
+        &quot;&quot;&quot;
+        )
 
         conn.commit()
         conn.close()
 
     def populate_sample_data(self):
@@ -86,120 +93,156 @@
                 &quot;subject&quot;: &quot;mathematiques&quot;,
                 &quot;grade_level&quot;: &quot;terminale&quot;,
                 &quot;document_type&quot;: &quot;cours&quot;,
                 &quot;tags&quot;: &quot;exponentielles,derivees,limites&quot;,
                 &quot;difficulty_level&quot;: 3,
-                &quot;url&quot;: &quot;/documents/maths/exponentielles-cours.pdf&quot;
+                &quot;url&quot;: &quot;/documents/maths/exponentielles-cours.pdf&quot;,
             },
             {
                 &quot;title&quot;: &quot;Algorithmes de Tri - Python&quot;,
                 &quot;content&quot;: &quot;Impl√©mentation des algorithmes de tri en Python : tri par s√©lection, tri par insertion, tri rapide. Complexit√© temporelle et spatiale.&quot;,
                 &quot;subject&quot;: &quot;nsi&quot;,
                 &quot;grade_level&quot;: &quot;terminale&quot;,
                 &quot;document_type&quot;: &quot;cours&quot;,
                 &quot;tags&quot;: &quot;algorithmes,tri,python,complexite&quot;,
                 &quot;difficulty_level&quot;: 4,
-                &quot;url&quot;: &quot;/documents/nsi/algorithmes-tri.py&quot;
+                &quot;url&quot;: &quot;/documents/nsi/algorithmes-tri.py&quot;,
             },
             {
                 &quot;title&quot;: &quot;M√©canique Quantique - Introduction&quot;,
                 &quot;content&quot;: &quot;Principes de base de la m√©canique quantique : dualit√© onde-particule, principe d&#x27;incertitude, √©quation de Schr√∂dinger simplifi√©e.&quot;,
                 &quot;subject&quot;: &quot;physique&quot;,
                 &quot;grade_level&quot;: &quot;terminale&quot;,
                 &quot;document_type&quot;: &quot;cours&quot;,
                 &quot;tags&quot;: &quot;quantique,onde,particule,schrodinger&quot;,
                 &quot;difficulty_level&quot;: 5,
-                &quot;url&quot;: &quot;/documents/physique/mecanique-quantique.pdf&quot;
+                &quot;url&quot;: &quot;/documents/physique/mecanique-quantique.pdf&quot;,
             },
             {
                 &quot;title&quot;: &quot;M√©thodologie Dissertation Fran√ßais&quot;,
                 &quot;content&quot;: &quot;Structure d&#x27;une dissertation : introduction avec accroche, probl√©matique, plan ; d√©veloppement en 3 parties ; conclusion avec ouverture.&quot;,
                 &quot;subject&quot;: &quot;francais&quot;,
                 &quot;grade_level&quot;: &quot;premiere&quot;,
                 &quot;document_type&quot;: &quot;methodologie&quot;,
                 &quot;tags&quot;: &quot;dissertation,methodologie,plan,argumentation&quot;,
                 &quot;difficulty_level&quot;: 2,
-                &quot;url&quot;: &quot;/documents/francais/methodologie-dissertation.pdf&quot;
-            }
+                &quot;url&quot;: &quot;/documents/francais/methodologie-dissertation.pdf&quot;,
+            },
         ]
 
         for doc in sample_documents:
-            cursor.execute(&#x27;&#x27;&#x27;
+            cursor.execute(
+                &quot;&quot;&quot;
                 INSERT INTO documents (title, content, subject, grade_level, document_type, tags, difficulty_level, url)
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?)
-            &#x27;&#x27;&#x27;, (doc[&quot;title&quot;], doc[&quot;content&quot;], doc[&quot;subject&quot;], doc[&quot;grade_level&quot;],
-                  doc[&quot;document_type&quot;], doc[&quot;tags&quot;], doc[&quot;difficulty_level&quot;], doc[&quot;url&quot;]))
+            &quot;&quot;&quot;,
+                (
+                    doc[&quot;title&quot;],
+                    doc[&quot;content&quot;],
+                    doc[&quot;subject&quot;],
+                    doc[&quot;grade_level&quot;],
+                    doc[&quot;document_type&quot;],
+                    doc[&quot;tags&quot;],
+                    doc[&quot;difficulty_level&quot;],
+                    doc[&quot;url&quot;],
+                ),
+            )
 
         # Liens utiles d&#x27;exemple
         sample_links = [
             {
                 &quot;title&quot;: &quot;Khan Academy - Math√©matiques&quot;,
                 &quot;url&quot;: &quot;https://fr.khanacademy.org/math&quot;,
                 &quot;description&quot;: &quot;Cours interactifs et exercices en math√©matiques&quot;,
                 &quot;subject&quot;: &quot;mathematiques&quot;,
                 &quot;grade_level&quot;: &quot;tous&quot;,
-                &quot;category&quot;: &quot;plateforme_apprentissage&quot;
+                &quot;category&quot;: &quot;plateforme_apprentissage&quot;,
             },
             {
                 &quot;title&quot;: &quot;France IOI - Programmation&quot;,
                 &quot;url&quot;: &quot;http://www.france-ioi.org/&quot;,
                 &quot;description&quot;: &quot;Plateforme d&#x27;apprentissage de la programmation&quot;,
                 &quot;subject&quot;: &quot;nsi&quot;,
                 &quot;grade_level&quot;: &quot;tous&quot;,
-                &quot;category&quot;: &quot;exercices_en_ligne&quot;
+                &quot;category&quot;: &quot;exercices_en_ligne&quot;,
             },
             {
                 &quot;title&quot;: &quot;PhET Simulations&quot;,
                 &quot;url&quot;: &quot;https://phet.colorado.edu/fr/&quot;,
                 &quot;description&quot;: &quot;Simulations interactives en physique et chimie&quot;,
                 &quot;subject&quot;: &quot;physique&quot;,
                 &quot;grade_level&quot;: &quot;tous&quot;,
-                &quot;category&quot;: &quot;simulation&quot;
-            }
+                &quot;category&quot;: &quot;simulation&quot;,
+            },
         ]
 
         for link in sample_links:
-            cursor.execute(&#x27;&#x27;&#x27;
+            cursor.execute(
+                &quot;&quot;&quot;
                 INSERT INTO useful_links (title, url, description, subject, grade_level, category)
                 VALUES (?, ?, ?, ?, ?, ?)
-            &#x27;&#x27;&#x27;, (link[&quot;title&quot;], link[&quot;url&quot;], link[&quot;description&quot;],
-                  link[&quot;subject&quot;], link[&quot;grade_level&quot;], link[&quot;category&quot;]))
+            &quot;&quot;&quot;,
+                (
+                    link[&quot;title&quot;],
+                    link[&quot;url&quot;],
+                    link[&quot;description&quot;],
+                    link[&quot;subject&quot;],
+                    link[&quot;grade_level&quot;],
+                    link[&quot;category&quot;],
+                ),
+            )
 
         # Exercices d&#x27;exemple
         sample_exercises = [
             {
                 &quot;title&quot;: &quot;D√©riv√©e de fonctions compos√©es&quot;,
                 &quot;content&quot;: &quot;Calculer la d√©riv√©e de f(x) = ln(x¬≤ + 1)&quot;,
                 &quot;solution&quot;: &quot;f&#x27;(x) = (2x)/(x¬≤ + 1) en utilisant la d√©riv√©e de ln(u) = u&#x27;/u&quot;,
                 &quot;subject&quot;: &quot;mathematiques&quot;,
                 &quot;grade_level&quot;: &quot;terminale&quot;,
                 &quot;difficulty_level&quot;: 3,
-                &quot;tags&quot;: &quot;derivees,logarithme,fonctions_composees&quot;
+                &quot;tags&quot;: &quot;derivees,logarithme,fonctions_composees&quot;,
             },
             {
                 &quot;title&quot;: &quot;Algorithme de recherche dichotomique&quot;,
                 &quot;content&quot;: &quot;Impl√©menter une fonction de recherche dichotomique dans un tableau tri√©&quot;,
                 &quot;solution&quot;: &quot;def recherche_dichotomique(tab, x): ...&quot;,
                 &quot;subject&quot;: &quot;nsi&quot;,
                 &quot;grade_level&quot;: &quot;terminale&quot;,
                 &quot;difficulty_level&quot;: 3,
-                &quot;tags&quot;: &quot;algorithmes,recherche,dichotomie&quot;
-            }
+                &quot;tags&quot;: &quot;algorithmes,recherche,dichotomie&quot;,
+            },
         ]
 
         for exercise in sample_exercises:
-            cursor.execute(&#x27;&#x27;&#x27;
+            cursor.execute(
+                &quot;&quot;&quot;
                 INSERT INTO exercises (title, content, solution, subject, grade_level, difficulty_level, tags)
                 VALUES (?, ?, ?, ?, ?, ?, ?)
-            &#x27;&#x27;&#x27;, (exercise[&quot;title&quot;], exercise[&quot;content&quot;], exercise[&quot;solution&quot;],
-                  exercise[&quot;subject&quot;], exercise[&quot;grade_level&quot;], exercise[&quot;difficulty_level&quot;], exercise[&quot;tags&quot;]))
+            &quot;&quot;&quot;,
+                (
+                    exercise[&quot;title&quot;],
+                    exercise[&quot;content&quot;],
+                    exercise[&quot;solution&quot;],
+                    exercise[&quot;subject&quot;],
+                    exercise[&quot;grade_level&quot;],
+                    exercise[&quot;difficulty_level&quot;],
+                    exercise[&quot;tags&quot;],
+                ),
+            )
 
         conn.commit()
         conn.close()
 
-    def search_documents(self, query: str, subject: str = None, grade_level: str = None,
-                        document_type: str = None, max_results: int = 10) -&gt; List[Dict]:
+    def search_documents(
+        self,
+        query: str,
+        subject: str = None,
+        grade_level: str = None,
+        document_type: str = None,
+        max_results: int = 10,
+    ) -&gt; List[Dict]:
         &quot;&quot;&quot;Recherche des documents selon les crit√®res&quot;&quot;&quot;
         conn = sqlite3.connect(self.db_path)
         cursor = conn.cursor()
 
         sql = &quot;SELECT * FROM documents WHERE (title LIKE ? OR content LIKE ? OR tags LIKE ?)&quot;
@@ -223,89 +266,149 @@
         cursor.execute(sql, params)
         results = cursor.fetchall()
         conn.close()
 
         # Convertir en dictionnaires
-        columns = [&quot;id&quot;, &quot;title&quot;, &quot;content&quot;, &quot;subject&quot;, &quot;grade_level&quot;, &quot;document_type&quot;,
-                  &quot;tags&quot;, &quot;difficulty_level&quot;, &quot;url&quot;, &quot;created_at&quot;]
+        columns = [
+            &quot;id&quot;,
+            &quot;title&quot;,
+            &quot;content&quot;,
+            &quot;subject&quot;,
+            &quot;grade_level&quot;,
+            &quot;document_type&quot;,
+            &quot;tags&quot;,
+            &quot;difficulty_level&quot;,
+            &quot;url&quot;,
+            &quot;created_at&quot;,
+        ]
         return [dict(zip(columns, row)) for row in results]
 
     def get_recommendations_for_profile(self, student_profile: Dict) -&gt; Dict:
         &quot;&quot;&quot;G√©n√®re des recommandations bas√©es sur le profil de l&#x27;√©l√®ve&quot;&quot;&quot;
         subject = student_profile.get(&quot;current_subject&quot;, &quot;mathematiques&quot;)
         grade_level = student_profile.get(&quot;grade_level&quot;, &quot;terminale&quot;)
         difficulty = student_profile.get(&quot;difficulty_preference&quot;, 3)
         learning_style = student_profile.get(&quot;learning_style&quot;, &quot;visual&quot;)
 
-        recommendations = {
-            &quot;documents&quot;: [],
-            &quot;exercises&quot;: [],
-            &quot;links&quot;: []
-        }
+        recommendations = {&quot;documents&quot;: [], &quot;exercises&quot;: [], &quot;links&quot;: []}
 
         # Documents recommand√©s
-        documents = self.search_documents(&quot;&quot;, subject=subject, grade_level=grade_level, max_results=5)
+        documents = self.search_documents(
+            &quot;&quot;, subject=subject, grade_level=grade_level, max_results=5
+        )
         recommendations[&quot;documents&quot;] = documents
 
         # Exercices adapt√©s au niveau
         conn = sqlite3.connect(self.db_path)
         cursor = conn.cursor()
 
-        cursor.execute(&#x27;&#x27;&#x27;
+        cursor.execute(
+            &quot;&quot;&quot;
             SELECT * FROM exercises
             WHERE subject = ? AND grade_level = ? AND difficulty_level &lt;= ?
             ORDER BY difficulty_level ASC LIMIT 3
-        &#x27;&#x27;&#x27;, (subject, grade_level, difficulty))
+        &quot;&quot;&quot;,
+            (subject, grade_level, difficulty),
+        )
 
         exercise_results = cursor.fetchall()
-        exercise_columns = [&quot;id&quot;, &quot;title&quot;, &quot;content&quot;, &quot;solution&quot;, &quot;subject&quot;, &quot;grade_level&quot;,
-                           &quot;difficulty_level&quot;, &quot;tags&quot;, &quot;created_at&quot;]
-        recommendations[&quot;exercises&quot;] = [dict(zip(exercise_columns, row)) for row in exercise_results]
+        exercise_columns = [
+            &quot;id&quot;,
+            &quot;title&quot;,
+            &quot;content&quot;,
+            &quot;solution&quot;,
+            &quot;subject&quot;,
+            &quot;grade_level&quot;,
+            &quot;difficulty_level&quot;,
+            &quot;tags&quot;,
+            &quot;created_at&quot;,
+        ]
+        recommendations[&quot;exercises&quot;] = [
+            dict(zip(exercise_columns, row)) for row in exercise_results
+        ]
 
         # Liens utiles
-        cursor.execute(&#x27;&#x27;&#x27;
+        cursor.execute(
+            &quot;&quot;&quot;
             SELECT * FROM useful_links
             WHERE subject = ? OR grade_level = &#x27;tous&#x27;
             LIMIT 3
-        &#x27;&#x27;&#x27;, (subject,))
+        &quot;&quot;&quot;,
+            (subject,),
+        )
 
         link_results = cursor.fetchall()
-        link_columns = [&quot;id&quot;, &quot;title&quot;, &quot;url&quot;, &quot;description&quot;, &quot;subject&quot;, &quot;grade_level&quot;,
-                       &quot;category&quot;, &quot;created_at&quot;]
-        recommendations[&quot;links&quot;] = [dict(zip(link_columns, row)) for row in link_results]
+        link_columns = [
+            &quot;id&quot;,
+            &quot;title&quot;,
+            &quot;url&quot;,
+            &quot;description&quot;,
+            &quot;subject&quot;,
+            &quot;grade_level&quot;,
+            &quot;category&quot;,
+            &quot;created_at&quot;,
+        ]
+        recommendations[&quot;links&quot;] = [
+            dict(zip(link_columns, row)) for row in link_results
+        ]
 
         conn.close()
         return recommendations
 
-    def add_document(self, title: str, content: str, subject: str, grade_level: str,
-                    document_type: str, tags: str = &quot;&quot;, difficulty_level: int = 3, url: str = &quot;&quot;) -&gt; int:
+    def add_document(
+        self,
+        title: str,
+        content: str,
+        subject: str,
+        grade_level: str,
+        document_type: str,
+        tags: str = &quot;&quot;,
+        difficulty_level: int = 3,
+        url: str = &quot;&quot;,
+    ) -&gt; int:
         &quot;&quot;&quot;Ajoute un nouveau document √† la base&quot;&quot;&quot;
         conn = sqlite3.connect(self.db_path)
         cursor = conn.cursor()
 
-        cursor.execute(&#x27;&#x27;&#x27;
+        cursor.execute(
+            &quot;&quot;&quot;
             INSERT INTO documents (title, content, subject, grade_level, document_type, tags, difficulty_level, url)
             VALUES (?, ?, ?, ?, ?, ?, ?, ?)
-        &#x27;&#x27;&#x27;, (title, content, subject, grade_level, document_type, tags, difficulty_level, url))
+        &quot;&quot;&quot;,
+            (
+                title,
+                content,
+                subject,
+                grade_level,
+                document_type,
+                tags,
+                difficulty_level,
+                url,
+            ),
+        )
 
         doc_id = cursor.lastrowid
         conn.commit()
         conn.close()
         return doc_id
 
-    def get_contextual_suggestions(self, context: str, student_profile: Dict) -&gt; List[Dict]:
+    def get_contextual_suggestions(
+        self, context: str, student_profile: Dict
+    ) -&gt; List[Dict]:
         &quot;&quot;&quot;Suggestions contextuelles bas√©es sur la conversation en cours&quot;&quot;&quot;
         subject = student_profile.get(&quot;current_subject&quot;, &quot;mathematiques&quot;)
         grade_level = student_profile.get(&quot;grade_level&quot;, &quot;terminale&quot;)
 
         # Analyser le contexte pour extraire des mots-cl√©s
         keywords = context.lower().split()
 
         suggestions = []
         for keyword in keywords:
             if len(keyword) &gt; 3:  # Ignorer les mots trop courts
-                docs = self.search_documents(keyword, subject=subject, grade_level=grade_level, max_results=2)
+                docs = self.search_documents(
+                    keyword, subject=subject, grade_level=grade_level, max_results=2
+                )
                 suggestions.extend(docs)
 
         # Supprimer les doublons
         seen_ids = set()
         unique_suggestions = []
@@ -313,6 +416,5 @@
             if doc[&quot;id&quot;] not in seen_ids:
                 unique_suggestions.append(doc)
                 seen_ids.add(doc[&quot;id&quot;])
 
         return unique_suggestions[:5]  # Limiter √† 5 suggestions
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/students.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/students.py	2025-07-24 20:54:02.436666+00:00
@@ -3,151 +3,159 @@
 import json
 from datetime import datetime
 from src.models.student import db, Student, LearningSession, Assessment
 from sqlalchemy import or_
 
-students_bp = Blueprint(&#x27;students&#x27;, __name__)
-
-@students_bp.route(&#x27;/register&#x27;, methods=[&#x27;POST&#x27;])
+students_bp = Blueprint(&quot;students&quot;, __name__)
+
+
+@students_bp.route(&quot;/register&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def register_student():
     &quot;&quot;&quot;
     Inscription d&#x27;un nouveau √©tudiant
     &quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation des donn√©es requises
-        required_fields = [&#x27;full_name&#x27;, &#x27;email&#x27;, &#x27;grade_level&#x27;]
+        required_fields = [&quot;full_name&quot;, &quot;email&quot;, &quot;grade_level&quot;]
         for field in required_fields:
             if not data.get(field):
-                return jsonify({&#x27;error&#x27;: f&#x27;{field} est requis&#x27;}), 400
+                return jsonify({&quot;error&quot;: f&quot;{field} est requis&quot;}), 400
 
         # V√©rification de l&#x27;unicit√© de l&#x27;email
-        existing_student = Student.query.filter_by(email=data[&#x27;email&#x27;]).first()
+        existing_student = Student.query.filter_by(email=data[&quot;email&quot;]).first()
         if existing_student:
-            return jsonify({&#x27;error&#x27;: &#x27;Un √©tudiant avec cet email existe d√©j√†&#x27;}), 409
+            return jsonify({&quot;error&quot;: &quot;Un √©tudiant avec cet email existe d√©j√†&quot;}), 409
 
         # Traitement des mati√®res pr√©f√©r√©es
-        preferred_subjects = data.get(&#x27;preferred_subjects&#x27;, [])
+        preferred_subjects = data.get(&quot;preferred_subjects&quot;, [])
         if isinstance(preferred_subjects, str):
             preferred_subjects = [preferred_subjects]
 
         # Cr√©ation du nouvel √©tudiant
         student = Student(
-            full_name=data[&#x27;full_name&#x27;],
-            email=data[&#x27;email&#x27;],
-            phone=data.get(&#x27;phone&#x27;),
-            grade_level=data[&#x27;grade_level&#x27;],
-            school=data.get(&#x27;school&#x27;),
-            preferred_subjects=preferred_subjects
+            full_name=data[&quot;full_name&quot;],
+            email=data[&quot;email&quot;],
+            phone=data.get(&quot;phone&quot;),
+            grade_level=data[&quot;grade_level&quot;],
+            school=data.get(&quot;school&quot;),
+            preferred_subjects=preferred_subjects,
         )
 
         # Initialisation du profil cognitif de base
         initial_profile = {
-            &#x27;registration_date&#x27;: datetime.utcnow().isoformat(),
-            &#x27;initial_preferences&#x27;: {
-                &#x27;subjects&#x27;: preferred_subjects,
-                &#x27;grade_level&#x27;: data[&#x27;grade_level&#x27;],
-                &#x27;school&#x27;: data.get(&#x27;school&#x27;)
+            &quot;registration_date&quot;: datetime.utcnow().isoformat(),
+            &quot;initial_preferences&quot;: {
+                &quot;subjects&quot;: preferred_subjects,
+                &quot;grade_level&quot;: data[&quot;grade_level&quot;],
+                &quot;school&quot;: data.get(&quot;school&quot;),
             },
-            &#x27;learning_style&#x27;: &#x27;unknown&#x27;,  # Sera d√©termin√© par ARIA
-            &#x27;onboarding_completed&#x27;: False
+            &quot;learning_style&quot;: &quot;unknown&quot;,  # Sera d√©termin√© par ARIA
+            &quot;onboarding_completed&quot;: False,
         }
 
         student.cognitive_profile = json.dumps(initial_profile)
 
         # Sauvegarde en base
         db.session.add(student)
         db.session.commit()
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;√âtudiant inscrit avec succ√®s&#x27;,
-            &#x27;student&#x27;: student.to_dict()
-        }), 201
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;message&quot;: &quot;√âtudiant inscrit avec succ√®s&quot;,
+                    &quot;student&quot;: student.to_dict(),
+                }
+            ),
+            201,
+        )
 
     except Exception as e:
         db.session.rollback()
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de l\&#x27;inscription: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/&lt;int:student_id&gt;&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: f&quot;Erreur lors de l&#x27;inscription: {str(e)}&quot;}), 500
+
+
+@students_bp.route(&quot;/&lt;int:student_id&gt;&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student(student_id):
     &quot;&quot;&quot;
     R√©cup√®re les informations d&#x27;un √©tudiant
     &quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;student&#x27;: student.to_dict()
-        })
-
-    except Exception as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la r√©cup√©ration: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/&lt;int:student_id&gt;&#x27;, methods=[&#x27;PUT&#x27;])
+            return jsonify({&quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
+
+        return jsonify({&quot;success&quot;: True, &quot;student&quot;: student.to_dict()})
+
+    except Exception as e:
+        return jsonify({&quot;error&quot;: f&quot;Erreur lors de la r√©cup√©ration: {str(e)}&quot;}), 500
+
+
+@students_bp.route(&quot;/&lt;int:student_id&gt;&quot;, methods=[&quot;PUT&quot;])
 @cross_origin()
 def update_student(student_id):
     &quot;&quot;&quot;
     Met √† jour les informations d&#x27;un √©tudiant
     &quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         data = request.get_json()
 
         # Mise √† jour des champs modifiables
-        updatable_fields = [&#x27;full_name&#x27;, &#x27;phone&#x27;, &#x27;grade_level&#x27;, &#x27;school&#x27;]
+        updatable_fields = [&quot;full_name&quot;, &quot;phone&quot;, &quot;grade_level&quot;, &quot;school&quot;]
         for field in updatable_fields:
             if field in data:
                 setattr(student, field, data[field])
 
         # Mise √† jour des mati√®res pr√©f√©r√©es
-        if &#x27;preferred_subjects&#x27; in data:
-            preferred_subjects = data[&#x27;preferred_subjects&#x27;]
+        if &quot;preferred_subjects&quot; in data:
+            preferred_subjects = data[&quot;preferred_subjects&quot;]
             if isinstance(preferred_subjects, str):
                 preferred_subjects = [preferred_subjects]
             student.preferred_subjects = json.dumps(preferred_subjects)
 
         # Mise √† jour du timestamp
         student.updated_at = datetime.utcnow()
 
         db.session.commit()
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;√âtudiant mis √† jour avec succ√®s&#x27;,
-            &#x27;student&#x27;: student.to_dict()
-        })
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;message&quot;: &quot;√âtudiant mis √† jour avec succ√®s&quot;,
+                &quot;student&quot;: student.to_dict(),
+            }
+        )
 
     except Exception as e:
         db.session.rollback()
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la mise √† jour: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: f&quot;Erreur lors de la mise √† jour: {str(e)}&quot;}), 500
+
+
+@students_bp.route(&quot;/&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def list_students():
     &quot;&quot;&quot;
     Liste tous les √©tudiants avec pagination et filtres
     &quot;&quot;&quot;
     try:
         # Param√®tres de pagination
-        page = request.args.get(&#x27;page&#x27;, 1, type=int)
-        per_page = request.args.get(&#x27;per_page&#x27;, 20, type=int)
+        page = request.args.get(&quot;page&quot;, 1, type=int)
+        per_page = request.args.get(&quot;per_page&quot;, 20, type=int)
 
         # Param√®tres de filtrage
-        grade_level = request.args.get(&#x27;grade_level&#x27;)
-        school = request.args.get(&#x27;school&#x27;)
-        search = request.args.get(&#x27;search&#x27;)  # Recherche par nom ou email
-        active_only = request.args.get(&#x27;active_only&#x27;, &#x27;true&#x27;).lower() == &#x27;true&#x27;
+        grade_level = request.args.get(&quot;grade_level&quot;)
+        school = request.args.get(&quot;school&quot;)
+        search = request.args.get(&quot;search&quot;)  # Recherche par nom ou email
+        active_only = request.args.get(&quot;active_only&quot;, &quot;true&quot;).lower() == &quot;true&quot;
 
         # Construction de la requ√™te
         query = Student.query
 
         if active_only:
@@ -158,71 +166,75 @@
 
         if school:
             query = query.filter_by(school=school)
 
         if search:
-            search_pattern = f&#x27;%{search}%&#x27;
+            search_pattern = f&quot;%{search}%&quot;
             query = query.filter(
                 or_(
                     Student.full_name.ilike(search_pattern),
-                    Student.email.ilike(search_pattern)
+                    Student.email.ilike(search_pattern),
                 )
             )
 
         # Tri par date de cr√©ation (plus r√©cents en premier)
         query = query.order_by(Student.created_at.desc())
 
         # Pagination
-        students = query.paginate(
-            page=page,
-            per_page=per_page,
-            error_out=False
-        )
+        students = query.paginate(page=page, per_page=per_page, error_out=False)
 
         # Statistiques g√©n√©rales
         total_students = Student.query.filter_by(is_active=True).count()
-        grade_distribution = db.session.query(
-            Student.grade_level,
-            db.func.count(Student.id)
-        ).filter_by(is_active=True).group_by(Student.grade_level).all()
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;students&#x27;: [student.to_dict() for student in students.items],
-            &#x27;pagination&#x27;: {
-                &#x27;page&#x27;: page,
-                &#x27;per_page&#x27;: per_page,
-                &#x27;total&#x27;: students.total,
-                &#x27;pages&#x27;: students.pages,
-                &#x27;has_next&#x27;: students.has_next,
-                &#x27;has_prev&#x27;: students.has_prev
-            },
-            &#x27;statistics&#x27;: {
-                &#x27;total_active_students&#x27;: total_students,
-                &#x27;grade_distribution&#x27;: dict(grade_distribution)
+        grade_distribution = (
+            db.session.query(Student.grade_level, db.func.count(Student.id))
+            .filter_by(is_active=True)
+            .group_by(Student.grade_level)
+            .all()
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;students&quot;: [student.to_dict() for student in students.items],
+                &quot;pagination&quot;: {
+                    &quot;page&quot;: page,
+                    &quot;per_page&quot;: per_page,
+                    &quot;total&quot;: students.total,
+                    &quot;pages&quot;: students.pages,
+                    &quot;has_next&quot;: students.has_next,
+                    &quot;has_prev&quot;: students.has_prev,
+                },
+                &quot;statistics&quot;: {
+                    &quot;total_active_students&quot;: total_students,
+                    &quot;grade_distribution&quot;: dict(grade_distribution),
+                },
             }
-        })
-
-    except Exception as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la r√©cup√©ration de la liste: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/&lt;int:student_id&gt;/sessions&#x27;, methods=[&#x27;GET&#x27;])
+        )
+
+    except Exception as e:
+        return (
+            jsonify({&quot;error&quot;: f&quot;Erreur lors de la r√©cup√©ration de la liste: {str(e)}&quot;}),
+            500,
+        )
+
+
+@students_bp.route(&quot;/&lt;int:student_id&gt;/sessions&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_sessions(student_id):
     &quot;&quot;&quot;
     R√©cup√®re les sessions d&#x27;apprentissage d&#x27;un √©tudiant
     &quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         # Param√®tres de pagination et filtrage
-        page = request.args.get(&#x27;page&#x27;, 1, type=int)
-        per_page = request.args.get(&#x27;per_page&#x27;, 20, type=int)
-        subject = request.args.get(&#x27;subject&#x27;)
-        session_type = request.args.get(&#x27;session_type&#x27;)
+        page = request.args.get(&quot;page&quot;, 1, type=int)
+        per_page = request.args.get(&quot;per_page&quot;, 20, type=int)
+        subject = request.args.get(&quot;subject&quot;)
+        session_type = request.args.get(&quot;session_type&quot;)
 
         # Construction de la requ√™te
         query = LearningSession.query.filter_by(student_id=student_id)
 
         if subject:
@@ -232,64 +244,74 @@
             query = query.filter_by(session_type=session_type)
 
         query = query.order_by(LearningSession.created_at.desc())
 
         # Pagination
-        sessions = query.paginate(
-            page=page,
-            per_page=per_page,
-            error_out=False
-        )
+        sessions = query.paginate(page=page, per_page=per_page, error_out=False)
 
         # Statistiques des sessions
         total_sessions = LearningSession.query.filter_by(student_id=student_id).count()
-        avg_completion = db.session.query(
-            db.func.avg(LearningSession.completion_rate)
-        ).filter_by(student_id=student_id).scalar() or 0
-
-        total_time = db.session.query(
-            db.func.sum(LearningSession.duration_minutes)
-        ).filter_by(student_id=student_id).scalar() or 0
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;sessions&#x27;: [session.to_dict() for session in sessions.items],
-            &#x27;pagination&#x27;: {
-                &#x27;page&#x27;: page,
-                &#x27;per_page&#x27;: per_page,
-                &#x27;total&#x27;: sessions.total,
-                &#x27;pages&#x27;: sessions.pages,
-                &#x27;has_next&#x27;: sessions.has_next,
-                &#x27;has_prev&#x27;: sessions.has_prev
-            },
-            &#x27;statistics&#x27;: {
-                &#x27;total_sessions&#x27;: total_sessions,
-                &#x27;avg_completion_rate&#x27;: float(avg_completion),
-                &#x27;total_time_minutes&#x27;: int(total_time)
+        avg_completion = (
+            db.session.query(db.func.avg(LearningSession.completion_rate))
+            .filter_by(student_id=student_id)
+            .scalar()
+            or 0
+        )
+
+        total_time = (
+            db.session.query(db.func.sum(LearningSession.duration_minutes))
+            .filter_by(student_id=student_id)
+            .scalar()
+            or 0
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;sessions&quot;: [session.to_dict() for session in sessions.items],
+                &quot;pagination&quot;: {
+                    &quot;page&quot;: page,
+                    &quot;per_page&quot;: per_page,
+                    &quot;total&quot;: sessions.total,
+                    &quot;pages&quot;: sessions.pages,
+                    &quot;has_next&quot;: sessions.has_next,
+                    &quot;has_prev&quot;: sessions.has_prev,
+                },
+                &quot;statistics&quot;: {
+                    &quot;total_sessions&quot;: total_sessions,
+                    &quot;avg_completion_rate&quot;: float(avg_completion),
+                    &quot;total_time_minutes&quot;: int(total_time),
+                },
             }
-        })
-
-    except Exception as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la r√©cup√©ration des sessions: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/&lt;int:student_id&gt;/assessments&#x27;, methods=[&#x27;GET&#x27;])
+        )
+
+    except Exception as e:
+        return (
+            jsonify(
+                {&quot;error&quot;: f&quot;Erreur lors de la r√©cup√©ration des sessions: {str(e)}&quot;}
+            ),
+            500,
+        )
+
+
+@students_bp.route(&quot;/&lt;int:student_id&gt;/assessments&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_assessments(student_id):
     &quot;&quot;&quot;
     R√©cup√®re les √©valuations d&#x27;un √©tudiant
     &quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         # Param√®tres de pagination et filtrage
-        page = request.args.get(&#x27;page&#x27;, 1, type=int)
-        per_page = request.args.get(&#x27;per_page&#x27;, 10, type=int)
-        subject = request.args.get(&#x27;subject&#x27;)
-        assessment_type = request.args.get(&#x27;assessment_type&#x27;)
-        completed_only = request.args.get(&#x27;completed_only&#x27;, &#x27;false&#x27;).lower() == &#x27;true&#x27;
+        page = request.args.get(&quot;page&quot;, 1, type=int)
+        per_page = request.args.get(&quot;per_page&quot;, 10, type=int)
+        subject = request.args.get(&quot;subject&quot;)
+        assessment_type = request.args.get(&quot;assessment_type&quot;)
+        completed_only = request.args.get(&quot;completed_only&quot;, &quot;false&quot;).lower() == &quot;true&quot;
 
         # Construction de la requ√™te
         query = Assessment.query.filter_by(student_id=student_id)
 
         if subject:
@@ -302,216 +324,271 @@
             query = query.filter_by(is_completed=True)
 
         query = query.order_by(Assessment.created_at.desc())
 
         # Pagination
-        assessments = query.paginate(
-            page=page,
-            per_page=per_page,
-            error_out=False
-        )
+        assessments = query.paginate(page=page, per_page=per_page, error_out=False)
 
         # Statistiques des √©valuations
         completed_assessments = Assessment.query.filter_by(
-            student_id=student_id,
-            is_completed=True
+            student_id=student_id, is_completed=True
         ).all()
 
-        avg_score = sum([a.score for a in completed_assessments if a.score]) / len(completed_assessments) if completed_assessments else 0
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;assessments&#x27;: [assessment.to_dict() for assessment in assessments.items],
-            &#x27;pagination&#x27;: {
-                &#x27;page&#x27;: page,
-                &#x27;per_page&#x27;: per_page,
-                &#x27;total&#x27;: assessments.total,
-                &#x27;pages&#x27;: assessments.pages,
-                &#x27;has_next&#x27;: assessments.has_next,
-                &#x27;has_prev&#x27;: assessments.has_prev
-            },
-            &#x27;statistics&#x27;: {
-                &#x27;total_assessments&#x27;: assessments.total,
-                &#x27;completed_assessments&#x27;: len(completed_assessments),
-                &#x27;avg_score&#x27;: avg_score
+        avg_score = (
+            sum([a.score for a in completed_assessments if a.score])
+            / len(completed_assessments)
+            if completed_assessments
+            else 0
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;assessments&quot;: [
+                    assessment.to_dict() for assessment in assessments.items
+                ],
+                &quot;pagination&quot;: {
+                    &quot;page&quot;: page,
+                    &quot;per_page&quot;: per_page,
+                    &quot;total&quot;: assessments.total,
+                    &quot;pages&quot;: assessments.pages,
+                    &quot;has_next&quot;: assessments.has_next,
+                    &quot;has_prev&quot;: assessments.has_prev,
+                },
+                &quot;statistics&quot;: {
+                    &quot;total_assessments&quot;: assessments.total,
+                    &quot;completed_assessments&quot;: len(completed_assessments),
+                    &quot;avg_score&quot;: avg_score,
+                },
             }
-        })
-
-    except Exception as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la r√©cup√©ration des √©valuations: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/&lt;int:student_id&gt;/dashboard&#x27;, methods=[&#x27;GET&#x27;])
+        )
+
+    except Exception as e:
+        return (
+            jsonify(
+                {&quot;error&quot;: f&quot;Erreur lors de la r√©cup√©ration des √©valuations: {str(e)}&quot;}
+            ),
+            500,
+        )
+
+
+@students_bp.route(&quot;/&lt;int:student_id&gt;/dashboard&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_student_dashboard(student_id):
     &quot;&quot;&quot;
     R√©cup√®re les donn√©es du tableau de bord d&#x27;un √©tudiant
     &quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         # Sessions r√©centes (7 derniers jours)
         from datetime import timedelta
+
         week_ago = datetime.utcnow() - timedelta(days=7)
 
-        recent_sessions = LearningSession.query.filter(
-            LearningSession.student_id == student_id,
-            LearningSession.created_at &gt;= week_ago
-        ).order_by(LearningSession.created_at.desc()).limit(5).all()
+        recent_sessions = (
+            LearningSession.query.filter(
+                LearningSession.student_id == student_id,
+                LearningSession.created_at &gt;= week_ago,
+            )
+            .order_by(LearningSession.created_at.desc())
+            .limit(5)
+            .all()
+        )
 
         # √âvaluations r√©centes
-        recent_assessments = Assessment.query.filter(
-            Assessment.student_id == student_id,
-            Assessment.is_completed == True
-        ).order_by(Assessment.completed_at.desc()).limit(3).all()
+        recent_assessments = (
+            Assessment.query.filter(
+                Assessment.student_id == student_id, Assessment.is_completed == True
+            )
+            .order_by(Assessment.completed_at.desc())
+            .limit(3)
+            .all()
+        )
 
         # Statistiques de progression
         total_sessions = LearningSession.query.filter_by(student_id=student_id).count()
-        total_time = db.session.query(
-            db.func.sum(LearningSession.duration_minutes)
-        ).filter_by(student_id=student_id).scalar() or 0
+        total_time = (
+            db.session.query(db.func.sum(LearningSession.duration_minutes))
+            .filter_by(student_id=student_id)
+            .scalar()
+            or 0
+        )
 
         # Progression par mati√®re
-        subject_stats = db.session.query(
-            LearningSession.subject,
-            db.func.count(LearningSession.id).label(&#x27;session_count&#x27;),
-            db.func.avg(LearningSession.completion_rate).label(&#x27;avg_completion&#x27;),
-            db.func.avg(LearningSession.accuracy_rate).label(&#x27;avg_accuracy&#x27;)
-        ).filter_by(student_id=student_id).group_by(LearningSession.subject).all()
+        subject_stats = (
+            db.session.query(
+                LearningSession.subject,
+                db.func.count(LearningSession.id).label(&quot;session_count&quot;),
+                db.func.avg(LearningSession.completion_rate).label(&quot;avg_completion&quot;),
+                db.func.avg(LearningSession.accuracy_rate).label(&quot;avg_accuracy&quot;),
+            )
+            .filter_by(student_id=student_id)
+            .group_by(LearningSession.subject)
+            .all()
+        )
 
         subject_progress = {}
         for stat in subject_stats:
             subject_progress[stat.subject] = {
-                &#x27;session_count&#x27;: stat.session_count,
-                &#x27;avg_completion&#x27;: float(stat.avg_completion or 0),
-                &#x27;avg_accuracy&#x27;: float(stat.avg_accuracy or 0)
+                &quot;session_count&quot;: stat.session_count,
+                &quot;avg_completion&quot;: float(stat.avg_completion or 0),
+                &quot;avg_accuracy&quot;: float(stat.avg_accuracy or 0),
             }
 
         # Objectifs et recommandations (bas√©s sur le profil ARIA)
-        cognitive_profile = json.loads(student.cognitive_profile) if student.cognitive_profile else {}
-        performance_data = json.loads(student.performance_data) if student.performance_data else {}
+        cognitive_profile = (
+            json.loads(student.cognitive_profile) if student.cognitive_profile else {}
+        )
+        performance_data = (
+            json.loads(student.performance_data) if student.performance_data else {}
+        )
 
         # Calcul du niveau de progression global
         if recent_assessments:
             recent_scores = [a.score for a in recent_assessments if a.score]
-            progress_trend = &#x27;improving&#x27; if len(recent_scores) &gt;= 2 and recent_scores[0] &gt; recent_scores[-1] else &#x27;stable&#x27;
+            progress_trend = (
+                &quot;improving&quot;
+                if len(recent_scores) &gt;= 2 and recent_scores[0] &gt; recent_scores[-1]
+                else &quot;stable&quot;
+            )
         else:
-            progress_trend = &#x27;new&#x27;
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;student_profile&#x27;: student.to_dict(),
-            &#x27;recent_activity&#x27;: {
-                &#x27;sessions&#x27;: [session.to_dict() for session in recent_sessions],
-                &#x27;assessments&#x27;: [assessment.to_dict() for assessment in recent_assessments]
-            },
-            &#x27;statistics&#x27;: {
-                &#x27;total_sessions&#x27;: total_sessions,
-                &#x27;total_time_hours&#x27;: round(total_time / 60, 1),
-                &#x27;subject_progress&#x27;: subject_progress,
-                &#x27;progress_trend&#x27;: progress_trend
-            },
-            &#x27;recommendations&#x27;: {
-                &#x27;next_session_suggestion&#x27;: self._get_next_session_suggestion(student, subject_progress),
-                &#x27;focus_areas&#x27;: self._get_focus_areas(performance_data),
-                &#x27;study_tips&#x27;: self._get_personalized_study_tips(student.learning_style)
+            progress_trend = &quot;new&quot;
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;student_profile&quot;: student.to_dict(),
+                &quot;recent_activity&quot;: {
+                    &quot;sessions&quot;: [session.to_dict() for session in recent_sessions],
+                    &quot;assessments&quot;: [
+                        assessment.to_dict() for assessment in recent_assessments
+                    ],
+                },
+                &quot;statistics&quot;: {
+                    &quot;total_sessions&quot;: total_sessions,
+                    &quot;total_time_hours&quot;: round(total_time / 60, 1),
+                    &quot;subject_progress&quot;: subject_progress,
+                    &quot;progress_trend&quot;: progress_trend,
+                },
+                &quot;recommendations&quot;: {
+                    &quot;next_session_suggestion&quot;: self._get_next_session_suggestion(
+                        student, subject_progress
+                    ),
+                    &quot;focus_areas&quot;: self._get_focus_areas(performance_data),
+                    &quot;study_tips&quot;: self._get_personalized_study_tips(
+                        student.learning_style
+                    ),
+                },
             }
-        })
-
-    except Exception as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la r√©cup√©ration du tableau de bord: {str(e)}&#x27;}), 500
+        )
+
+    except Exception as e:
+        return (
+            jsonify(
+                {
+                    &quot;error&quot;: f&quot;Erreur lors de la r√©cup√©ration du tableau de bord: {str(e)}&quot;
+                }
+            ),
+            500,
+        )
+
 
 def _get_next_session_suggestion(student, subject_progress):
     &quot;&quot;&quot;Sugg√®re la prochaine session bas√©e sur l&#x27;historique&quot;&quot;&quot;
     if not subject_progress:
         return {
-            &#x27;subject&#x27;: &#x27;mathematiques&#x27;,
-            &#x27;topic&#x27;: &#x27;√âvaluation diagnostique&#x27;,
-            &#x27;reason&#x27;: &#x27;Commen√ßons par √©valuer votre niveau actuel&#x27;
+            &quot;subject&quot;: &quot;mathematiques&quot;,
+            &quot;topic&quot;: &quot;√âvaluation diagnostique&quot;,
+            &quot;reason&quot;: &quot;Commen√ßons par √©valuer votre niveau actuel&quot;,
         }
 
     # Trouve la mati√®re avec le plus faible taux de r√©ussite
-    weakest_subject = min(subject_progress.items(), key=lambda x: x[1][&#x27;avg_accuracy&#x27;])
+    weakest_subject = min(subject_progress.items(), key=lambda x: x[1][&quot;avg_accuracy&quot;])
 
     return {
-        &#x27;subject&#x27;: weakest_subject[0],
-        &#x27;topic&#x27;: &#x27;R√©vision cibl√©e&#x27;,
-        &#x27;reason&#x27;: f&#x27;Am√©liorons vos r√©sultats en {weakest_subject[0]}&#x27;
+        &quot;subject&quot;: weakest_subject[0],
+        &quot;topic&quot;: &quot;R√©vision cibl√©e&quot;,
+        &quot;reason&quot;: f&quot;Am√©liorons vos r√©sultats en {weakest_subject[0]}&quot;,
     }
+
 
 def _get_focus_areas(performance_data):
     &quot;&quot;&quot;Identifie les domaines n√©cessitant une attention particuli√®re&quot;&quot;&quot;
     focus_areas = []
 
-    last_assessment = performance_data.get(&#x27;last_assessment&#x27;, {})
-    error_patterns = last_assessment.get(&#x27;error_patterns&#x27;, {})
-
-    topics_with_errors = error_patterns.get(&#x27;topics_with_errors&#x27;, {})
+    last_assessment = performance_data.get(&quot;last_assessment&quot;, {})
+    error_patterns = last_assessment.get(&quot;error_patterns&quot;, {})
+
+    topics_with_errors = error_patterns.get(&quot;topics_with_errors&quot;, {})
     if topics_with_errors:
         # Les 2 sujets avec le plus d&#x27;erreurs
-        sorted_topics = sorted(topics_with_errors.items(), key=lambda x: x[1], reverse=True)
+        sorted_topics = sorted(
+            topics_with_errors.items(), key=lambda x: x[1], reverse=True
+        )
         focus_areas = [topic for topic, _ in sorted_topics[:2]]
 
     if not focus_areas:
-        focus_areas = [&#x27;Consolidation des acquis&#x27;, &#x27;Pr√©paration m√©thodologique&#x27;]
+        focus_areas = [&quot;Consolidation des acquis&quot;, &quot;Pr√©paration m√©thodologique&quot;]
 
     return focus_areas
+
 
 def _get_personalized_study_tips(learning_style):
     &quot;&quot;&quot;Retourne des conseils d&#x27;√©tude personnalis√©s selon le style d&#x27;apprentissage&quot;&quot;&quot;
     tips = {
-        &#x27;visual&#x27;: [
+        &quot;visual&quot;: [
             &quot;Utilisez des diagrammes et des cartes mentales&quot;,
             &quot;Surlignez les informations importantes avec des couleurs&quot;,
-            &quot;Cr√©ez des sch√©mas pour organiser vos id√©es&quot;
+            &quot;Cr√©ez des sch√©mas pour organiser vos id√©es&quot;,
         ],
-        &#x27;auditory&#x27;: [
+        &quot;auditory&quot;: [
             &quot;Lisez vos notes √† voix haute&quot;,
             &quot;Enregistrez-vous en expliquant les concepts&quot;,
-            &quot;Participez √† des groupes d&#x27;√©tude pour discuter&quot;
+            &quot;Participez √† des groupes d&#x27;√©tude pour discuter&quot;,
         ],
-        &#x27;kinesthetic&#x27;: [
+        &quot;kinesthetic&quot;: [
             &quot;Prenez des pauses r√©guli√®res pendant l&#x27;√©tude&quot;,
             &quot;Utilisez des objets manipulables pour les concepts abstraits&quot;,
-            &quot;Alternez entre diff√©rents environnements d&#x27;√©tude&quot;
+            &quot;Alternez entre diff√©rents environnements d&#x27;√©tude&quot;,
         ],
-        &#x27;reading_writing&#x27;: [
+        &quot;reading_writing&quot;: [
             &quot;R√©digez des r√©sum√©s d√©taill√©s apr√®s chaque le√ßon&quot;,
             &quot;Cr√©ez des listes et des plans structur√©s&quot;,
-            &quot;Tenez un journal de vos progr√®s&quot;
-        ]
+            &quot;Tenez un journal de vos progr√®s&quot;,
+        ],
     }
 
-    return tips.get(learning_style, tips[&#x27;visual&#x27;])
-
-@students_bp.route(&#x27;/&lt;int:student_id&gt;/deactivate&#x27;, methods=[&#x27;POST&#x27;])
+    return tips.get(learning_style, tips[&quot;visual&quot;])
+
+
+@students_bp.route(&quot;/&lt;int:student_id&gt;/deactivate&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def deactivate_student(student_id):
     &quot;&quot;&quot;
     D√©sactive un √©tudiant (soft delete)
     &quot;&quot;&quot;
     try:
         student = Student.query.get(student_id)
         if not student:
-            return jsonify({&#x27;error&#x27;: &#x27;√âtudiant non trouv√©&#x27;}), 404
+            return jsonify({&quot;error&quot;: &quot;√âtudiant non trouv√©&quot;}), 404
 
         student.is_active = False
         student.updated_at = datetime.utcnow()
 
         db.session.commit()
 
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;√âtudiant d√©sactiv√© avec succ√®s&#x27;
-        })
+        return jsonify({&quot;success&quot;: True, &quot;message&quot;: &quot;√âtudiant d√©sactiv√© avec succ√®s&quot;})
 
     except Exception as e:
         db.session.rollback()
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la d√©sactivation: {str(e)}&#x27;}), 500
-
-@students_bp.route(&#x27;/statistics&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: f&quot;Erreur lors de la d√©sactivation: {str(e)}&quot;}), 500
+
+
+@students_bp.route(&quot;/statistics&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_global_statistics():
     &quot;&quot;&quot;
     R√©cup√®re les statistiques globales des √©tudiants
     &quot;&quot;&quot;
@@ -520,50 +597,63 @@
         total_students = Student.query.filter_by(is_active=True).count()
         total_sessions = LearningSession.query.count()
         total_assessments = Assessment.query.filter_by(is_completed=True).count()
 
         # R√©partition par niveau
-        grade_distribution = db.session.query(
-            Student.grade_level,
-            db.func.count(Student.id)
-        ).filter_by(is_active=True).group_by(Student.grade_level).all()
+        grade_distribution = (
+            db.session.query(Student.grade_level, db.func.count(Student.id))
+            .filter_by(is_active=True)
+            .group_by(Student.grade_level)
+            .all()
+        )
 
         # R√©partition par √©cole
-        school_distribution = db.session.query(
-            Student.school,
-            db.func.count(Student.id)
-        ).filter(Student.is_active == True, Student.school.isnot(None)).group_by(Student.school).all()
+        school_distribution = (
+            db.session.query(Student.school, db.func.count(Student.id))
+            .filter(Student.is_active == True, Student.school.isnot(None))
+            .group_by(Student.school)
+            .all()
+        )
 
         # Mati√®res les plus populaires
-        subject_popularity = db.session.query(
-            LearningSession.subject,
-            db.func.count(LearningSession.id)
-        ).group_by(LearningSession.subject).order_by(db.func.count(LearningSession.id).desc()).limit(5).all()
+        subject_popularity = (
+            db.session.query(LearningSession.subject, db.func.count(LearningSession.id))
+            .group_by(LearningSession.subject)
+            .order_by(db.func.count(LearningSession.id).desc())
+            .limit(5)
+            .all()
+        )
 
         # Performances moyennes
-        avg_completion = db.session.query(
-            db.func.avg(LearningSession.completion_rate)
-        ).scalar() or 0
-
-        avg_accuracy = db.session.query(
-            db.func.avg(LearningSession.accuracy_rate)
-        ).scalar() or 0
-
-        return jsonify({
-            &#x27;success&#x27;: True,
-            &#x27;global_statistics&#x27;: {
-                &#x27;total_students&#x27;: total_students,
-                &#x27;total_sessions&#x27;: total_sessions,
-                &#x27;total_assessments&#x27;: total_assessments,
-                &#x27;avg_completion_rate&#x27;: float(avg_completion),
-                &#x27;avg_accuracy_rate&#x27;: float(avg_accuracy)
-            },
-            &#x27;distributions&#x27;: {
-                &#x27;grade_levels&#x27;: dict(grade_distribution),
-                &#x27;schools&#x27;: dict(school_distribution),
-                &#x27;popular_subjects&#x27;: dict(subject_popularity)
+        avg_completion = (
+            db.session.query(db.func.avg(LearningSession.completion_rate)).scalar() or 0
+        )
+
+        avg_accuracy = (
+            db.session.query(db.func.avg(LearningSession.accuracy_rate)).scalar() or 0
+        )
+
+        return jsonify(
+            {
+                &quot;success&quot;: True,
+                &quot;global_statistics&quot;: {
+                    &quot;total_students&quot;: total_students,
+                    &quot;total_sessions&quot;: total_sessions,
+                    &quot;total_assessments&quot;: total_assessments,
+                    &quot;avg_completion_rate&quot;: float(avg_completion),
+                    &quot;avg_accuracy_rate&quot;: float(avg_accuracy),
+                },
+                &quot;distributions&quot;: {
+                    &quot;grade_levels&quot;: dict(grade_distribution),
+                    &quot;schools&quot;: dict(school_distribution),
+                    &quot;popular_subjects&quot;: dict(subject_popularity),
+                },
             }
-        })
-
-    except Exception as e:
-        return jsonify({&#x27;error&#x27;: f&#x27;Erreur lors de la r√©cup√©ration des statistiques: {str(e)}&#x27;}), 500
-
+        )
+
+    except Exception as e:
+        return (
+            jsonify(
+                {&quot;error&quot;: f&quot;Erreur lors de la r√©cup√©ration des statistiques: {str(e)}&quot;}
+            ),
+            500,
+        )
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/openai_routes.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/openai_routes.py	2025-07-24 20:54:02.463713+00:00
@@ -10,21 +10,22 @@
     openai_service,
     chat_with_aria,
     generate_personalized_document,
     create_adaptive_quiz,
     StudentProfile,
-    ConversationContext
+    ConversationContext,
 )
 
 # Configuration du logging
 logging.basicConfig(level=logging.INFO)
 logger = logging.getLogger(__name__)
 
 # Blueprint pour les routes OpenAI
-openai_bp = Blueprint(&#x27;openai&#x27;, __name__, url_prefix=&#x27;/api/openai&#x27;)
-
-@openai_bp.route(&#x27;/health&#x27;, methods=[&#x27;GET&#x27;])
+openai_bp = Blueprint(&quot;openai&quot;, __name__, url_prefix=&quot;/api/openai&quot;)
+
+
+@openai_bp.route(&quot;/health&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def health_check():
     &quot;&quot;&quot;V√©rification de l&#x27;√©tat du service OpenAI&quot;&quot;&quot;
     try:
         status = {
@@ -33,42 +34,45 @@
             &quot;api_configured&quot;: bool(openai_service.api_key),
             &quot;models&quot;: {
                 &quot;chat&quot;: openai_service.model_chat,
                 &quot;vision&quot;: openai_service.model_vision,
                 &quot;embedding&quot;: openai_service.model_embedding,
-                &quot;image&quot;: openai_service.model_image
+                &quot;image&quot;: openai_service.model_image,
             },
-            &quot;timestamp&quot;: datetime.now().isoformat()
+            &quot;timestamp&quot;: datetime.now().isoformat(),
         }
 
         return jsonify(status), 200
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la v√©rification de sant√©: {e}&quot;)
         return jsonify({&quot;error&quot;: &quot;Service unavailable&quot;}), 503
 
-@openai_bp.route(&#x27;/chat&#x27;, methods=[&#x27;POST&#x27;])
+
+@openai_bp.route(&quot;/chat&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def chat_endpoint():
     &quot;&quot;&quot;Endpoint principal pour le chat avec ARIA&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation des donn√©es requises
-        if not data or &#x27;message&#x27; not in data:
+        if not data or &quot;message&quot; not in data:
             return jsonify({&quot;error&quot;: &quot;Message is required&quot;}), 400
 
-        message = data[&#x27;message&#x27;]
-        student_id = data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;)
+        message = data[&quot;message&quot;]
+        student_id = data.get(&quot;student_id&quot;, &quot;anonymous&quot;)
 
         # Construction du contexte
         context = {
-            &#x27;session_id&#x27;: data.get(&#x27;session_id&#x27;, f&#x27;session_{datetime.now().timestamp()}&#x27;),
-            &#x27;subject&#x27;: data.get(&#x27;subject&#x27;, &#x27;g√©n√©ral&#x27;),
-            &#x27;topic&#x27;: data.get(&#x27;topic&#x27;),
-            &#x27;type&#x27;: data.get(&#x27;conversation_type&#x27;, &#x27;tutoring&#x27;),
-            &#x27;difficulty_level&#x27;: data.get(&#x27;difficulty&#x27;, &#x27;medium&#x27;)
+            &quot;session_id&quot;: data.get(
+                &quot;session_id&quot;, f&quot;session_{datetime.now().timestamp()}&quot;
+            ),
+            &quot;subject&quot;: data.get(&quot;subject&quot;, &quot;g√©n√©ral&quot;),
+            &quot;topic&quot;: data.get(&quot;topic&quot;),
+            &quot;type&quot;: data.get(&quot;conversation_type&quot;, &quot;tutoring&quot;),
+            &quot;difficulty_level&quot;: data.get(&quot;difficulty&quot;, &quot;medium&quot;),
         }
 
         # Appel asynchrone au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
@@ -76,67 +80,72 @@
         try:
             response = loop.run_until_complete(
                 chat_with_aria(message, student_id, context)
             )
 
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans le chat endpoint: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/chat/advanced&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/chat/advanced&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def advanced_chat_endpoint():
     &quot;&quot;&quot;Endpoint avanc√© pour le chat avec profil √©tudiant complet&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;message&#x27;, &#x27;student_profile&#x27;, &#x27;context&#x27;]
+        required_fields = [&quot;message&quot;, &quot;student_profile&quot;, &quot;context&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        message = data[&#x27;message&#x27;]
+        message = data[&quot;message&quot;]
 
         # Construction du profil √©tudiant
-        profile_data = data[&#x27;student_profile&#x27;]
+        profile_data = data[&quot;student_profile&quot;]
         student_profile = StudentProfile(
-            id=profile_data.get(&#x27;id&#x27;, &#x27;anonymous&#x27;),
-            name=profile_data.get(&#x27;name&#x27;, &#x27;√âtudiant&#x27;),
-            level=profile_data.get(&#x27;level&#x27;, &#x27;terminale&#x27;),
-            specialties=profile_data.get(&#x27;specialties&#x27;, [&#x27;g√©n√©ral&#x27;]),
-            learning_style=profile_data.get(&#x27;learning_style&#x27;, &#x27;mixed&#x27;),
-            strengths=profile_data.get(&#x27;strengths&#x27;, []),
-            weaknesses=profile_data.get(&#x27;weaknesses&#x27;, []),
-            goals=profile_data.get(&#x27;goals&#x27;, []),
-            preferred_difficulty=profile_data.get(&#x27;preferred_difficulty&#x27;, &#x27;medium&#x27;)
+            id=profile_data.get(&quot;id&quot;, &quot;anonymous&quot;),
+            name=profile_data.get(&quot;name&quot;, &quot;√âtudiant&quot;),
+            level=profile_data.get(&quot;level&quot;, &quot;terminale&quot;),
+            specialties=profile_data.get(&quot;specialties&quot;, [&quot;g√©n√©ral&quot;]),
+            learning_style=profile_data.get(&quot;learning_style&quot;, &quot;mixed&quot;),
+            strengths=profile_data.get(&quot;strengths&quot;, []),
+            weaknesses=profile_data.get(&quot;weaknesses&quot;, []),
+            goals=profile_data.get(&quot;goals&quot;, []),
+            preferred_difficulty=profile_data.get(&quot;preferred_difficulty&quot;, &quot;medium&quot;),
         )
 
         # Construction du contexte
-        context_data = data[&#x27;context&#x27;]
+        context_data = data[&quot;context&quot;]
         context = ConversationContext(
             student_id=student_profile.id,
-            session_id=context_data.get(&#x27;session_id&#x27;, f&#x27;session_{datetime.now().timestamp()}&#x27;),
-            subject=context_data.get(&#x27;subject&#x27;, &#x27;g√©n√©ral&#x27;),
-            topic=context_data.get(&#x27;topic&#x27;),
-            difficulty_level=context_data.get(&#x27;difficulty_level&#x27;, &#x27;medium&#x27;),
-            conversation_type=context_data.get(&#x27;conversation_type&#x27;, &#x27;tutoring&#x27;),
-            previous_messages=context_data.get(&#x27;previous_messages&#x27;, []),
-            learning_objectives=context_data.get(&#x27;learning_objectives&#x27;, []),
-            time_limit=context_data.get(&#x27;time_limit&#x27;)
+            session_id=context_data.get(
+                &quot;session_id&quot;, f&quot;session_{datetime.now().timestamp()}&quot;
+            ),
+            subject=context_data.get(&quot;subject&quot;, &quot;g√©n√©ral&quot;),
+            topic=context_data.get(&quot;topic&quot;),
+            difficulty_level=context_data.get(&quot;difficulty_level&quot;, &quot;medium&quot;),
+            conversation_type=context_data.get(&quot;conversation_type&quot;, &quot;tutoring&quot;),
+            previous_messages=context_data.get(&quot;previous_messages&quot;, []),
+            learning_objectives=context_data.get(&quot;learning_objectives&quot;, []),
+            time_limit=context_data.get(&quot;time_limit&quot;),
         )
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
@@ -144,98 +153,106 @@
         try:
             response = loop.run_until_complete(
                 openai_service.chat_with_aria(message, context, student_profile)
             )
 
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans l&#x27;advanced chat endpoint: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/document/generate&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/document/generate&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_document_endpoint():
     &quot;&quot;&quot;G√©n√©ration de documents p√©dagogiques personnalis√©s&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;document_type&#x27;, &#x27;subject&#x27;, &#x27;topic&#x27;]
+        required_fields = [&quot;document_type&quot;, &quot;subject&quot;, &quot;topic&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        document_type = data[&#x27;document_type&#x27;]
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
-        student_id = data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;)
+        document_type = data[&quot;document_type&quot;]
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
+        student_id = data.get(&quot;student_id&quot;, &quot;anonymous&quot;)
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
 
         try:
             response = loop.run_until_complete(
-                generate_personalized_document(document_type, subject, topic, student_id)
-            )
-
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+                generate_personalized_document(
+                    document_type, subject, topic, student_id
+                )
+            )
+
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans la g√©n√©ration de document: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/document/generate/advanced&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/document/generate/advanced&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_advanced_document_endpoint():
     &quot;&quot;&quot;G√©n√©ration avanc√©e de documents avec profil complet&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;document_type&#x27;, &#x27;subject&#x27;, &#x27;topic&#x27;, &#x27;student_profile&#x27;]
+        required_fields = [&quot;document_type&quot;, &quot;subject&quot;, &quot;topic&quot;, &quot;student_profile&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        document_type = data[&#x27;document_type&#x27;]
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
-        specifications = data.get(&#x27;specifications&#x27;, {})
+        document_type = data[&quot;document_type&quot;]
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
+        specifications = data.get(&quot;specifications&quot;, {})
 
         # Construction du profil √©tudiant
-        profile_data = data[&#x27;student_profile&#x27;]
+        profile_data = data[&quot;student_profile&quot;]
         student_profile = StudentProfile(
-            id=profile_data.get(&#x27;id&#x27;, &#x27;anonymous&#x27;),
-            name=profile_data.get(&#x27;name&#x27;, &#x27;√âtudiant&#x27;),
-            level=profile_data.get(&#x27;level&#x27;, &#x27;terminale&#x27;),
-            specialties=profile_data.get(&#x27;specialties&#x27;, [subject.lower()]),
-            learning_style=profile_data.get(&#x27;learning_style&#x27;, &#x27;mixed&#x27;),
-            strengths=profile_data.get(&#x27;strengths&#x27;, []),
-            weaknesses=profile_data.get(&#x27;weaknesses&#x27;, []),
-            goals=profile_data.get(&#x27;goals&#x27;, [])
+            id=profile_data.get(&quot;id&quot;, &quot;anonymous&quot;),
+            name=profile_data.get(&quot;name&quot;, &quot;√âtudiant&quot;),
+            level=profile_data.get(&quot;level&quot;, &quot;terminale&quot;),
+            specialties=profile_data.get(&quot;specialties&quot;, [subject.lower()]),
+            learning_style=profile_data.get(&quot;learning_style&quot;, &quot;mixed&quot;),
+            strengths=profile_data.get(&quot;strengths&quot;, []),
+            weaknesses=profile_data.get(&quot;weaknesses&quot;, []),
+            goals=profile_data.get(&quot;goals&quot;, []),
         )
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
@@ -245,206 +262,243 @@
                 openai_service.generate_document(
                     document_type, subject, topic, student_profile, specifications
                 )
             )
 
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans la g√©n√©ration avanc√©e de document: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/quiz/generate&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/quiz/generate&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_quiz_endpoint():
     &quot;&quot;&quot;G√©n√©ration de quiz adaptatifs&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;subject&#x27;, &#x27;topic&#x27;, &#x27;difficulty&#x27;, &#x27;num_questions&#x27;]
+        required_fields = [&quot;subject&quot;, &quot;topic&quot;, &quot;difficulty&quot;, &quot;num_questions&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
-        difficulty = data[&#x27;difficulty&#x27;]
-        num_questions = data[&#x27;num_questions&#x27;]
-        student_id = data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;)
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
+        difficulty = data[&quot;difficulty&quot;]
+        num_questions = data[&quot;num_questions&quot;]
+        student_id = data.get(&quot;student_id&quot;, &quot;anonymous&quot;)
 
         # Validation des valeurs
-        if difficulty not in [&#x27;easy&#x27;, &#x27;medium&#x27;, &#x27;hard&#x27;]:
-            return jsonify({&quot;error&quot;: &quot;Difficulty must be &#x27;easy&#x27;, &#x27;medium&#x27;, or &#x27;hard&#x27;&quot;}), 400
-
-        if not isinstance(num_questions, int) or num_questions &lt; 1 or num_questions &gt; 20:
+        if difficulty not in [&quot;easy&quot;, &quot;medium&quot;, &quot;hard&quot;]:
+            return (
+                jsonify({&quot;error&quot;: &quot;Difficulty must be &#x27;easy&#x27;, &#x27;medium&#x27;, or &#x27;hard&#x27;&quot;}),
+                400,
+            )
+
+        if (
+            not isinstance(num_questions, int)
+            or num_questions &lt; 1
+            or num_questions &gt; 20
+        ):
             return jsonify({&quot;error&quot;: &quot;num_questions must be between 1 and 20&quot;}), 400
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
 
         try:
             response = loop.run_until_complete(
-                create_adaptive_quiz(subject, topic, difficulty, num_questions, student_id)
-            )
-
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+                create_adaptive_quiz(
+                    subject, topic, difficulty, num_questions, student_id
+                )
+            )
+
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans la g√©n√©ration de quiz: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/quiz/generate/advanced&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/quiz/generate/advanced&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_advanced_quiz_endpoint():
     &quot;&quot;&quot;G√©n√©ration avanc√©e de quiz avec profil complet&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;subject&#x27;, &#x27;topic&#x27;, &#x27;difficulty&#x27;, &#x27;num_questions&#x27;, &#x27;student_profile&#x27;]
+        required_fields = [
+            &quot;subject&quot;,
+            &quot;topic&quot;,
+            &quot;difficulty&quot;,
+            &quot;num_questions&quot;,
+            &quot;student_profile&quot;,
+        ]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
-        difficulty = data[&#x27;difficulty&#x27;]
-        num_questions = data[&#x27;num_questions&#x27;]
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
+        difficulty = data[&quot;difficulty&quot;]
+        num_questions = data[&quot;num_questions&quot;]
 
         # Construction du profil √©tudiant
-        profile_data = data[&#x27;student_profile&#x27;]
+        profile_data = data[&quot;student_profile&quot;]
         student_profile = StudentProfile(
-            id=profile_data.get(&#x27;id&#x27;, &#x27;anonymous&#x27;),
-            name=profile_data.get(&#x27;name&#x27;, &#x27;√âtudiant&#x27;),
-            level=profile_data.get(&#x27;level&#x27;, &#x27;terminale&#x27;),
-            specialties=profile_data.get(&#x27;specialties&#x27;, [subject.lower()]),
-            learning_style=profile_data.get(&#x27;learning_style&#x27;, &#x27;mixed&#x27;),
-            strengths=profile_data.get(&#x27;strengths&#x27;, []),
-            weaknesses=profile_data.get(&#x27;weaknesses&#x27;, []),
-            goals=profile_data.get(&#x27;goals&#x27;, [])
+            id=profile_data.get(&quot;id&quot;, &quot;anonymous&quot;),
+            name=profile_data.get(&quot;name&quot;, &quot;√âtudiant&quot;),
+            level=profile_data.get(&quot;level&quot;, &quot;terminale&quot;),
+            specialties=profile_data.get(&quot;specialties&quot;, [subject.lower()]),
+            learning_style=profile_data.get(&quot;learning_style&quot;, &quot;mixed&quot;),
+            strengths=profile_data.get(&quot;strengths&quot;, []),
+            weaknesses=profile_data.get(&quot;weaknesses&quot;, []),
+            goals=profile_data.get(&quot;goals&quot;, []),
         )
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
 
         try:
             response = loop.run_until_complete(
-                openai_service.generate_quiz(subject, topic, difficulty, num_questions, student_profile)
-            )
-
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+                openai_service.generate_quiz(
+                    subject, topic, difficulty, num_questions, student_profile
+                )
+            )
+
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans la g√©n√©ration avanc√©e de quiz: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/image/generate&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/image/generate&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_image_endpoint():
     &quot;&quot;&quot;G√©n√©ration d&#x27;images p√©dagogiques&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        if not data or &#x27;prompt&#x27; not in data:
+        if not data or &quot;prompt&quot; not in data:
             return jsonify({&quot;error&quot;: &quot;Prompt is required&quot;}), 400
 
-        prompt = data[&#x27;prompt&#x27;]
-        style = data.get(&#x27;style&#x27;, &#x27;educational&#x27;)
-        size = data.get(&#x27;size&#x27;, &#x27;1024x1024&#x27;)
+        prompt = data[&quot;prompt&quot;]
+        style = data.get(&quot;style&quot;, &quot;educational&quot;)
+        size = data.get(&quot;size&quot;, &quot;1024x1024&quot;)
 
         # Validation de la taille
-        valid_sizes = [&#x27;256x256&#x27;, &#x27;512x512&#x27;, &#x27;1024x1024&#x27;, &#x27;1792x1024&#x27;, &#x27;1024x1792&#x27;]
+        valid_sizes = [&quot;256x256&quot;, &quot;512x512&quot;, &quot;1024x1024&quot;, &quot;1792x1024&quot;, &quot;1024x1792&quot;]
         if size not in valid_sizes:
-            return jsonify({&quot;error&quot;: f&quot;Size must be one of: {&#x27;, &#x27;.join(valid_sizes)}&quot;}), 400
+            return (
+                jsonify({&quot;error&quot;: f&quot;Size must be one of: {&#x27;, &#x27;.join(valid_sizes)}&quot;}),
+                400,
+            )
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
 
         try:
             response = loop.run_until_complete(
                 openai_service.generate_image(prompt, style, size)
             )
 
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans la g√©n√©ration d&#x27;image: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/analyze/work&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/analyze/work&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def analyze_work_endpoint():
     &quot;&quot;&quot;Analyse du travail d&#x27;un √©tudiant&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;work_content&#x27;, &#x27;subject&#x27;, &#x27;assignment_type&#x27;, &#x27;student_profile&#x27;]
+        required_fields = [
+            &quot;work_content&quot;,
+            &quot;subject&quot;,
+            &quot;assignment_type&quot;,
+            &quot;student_profile&quot;,
+        ]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        work_content = data[&#x27;work_content&#x27;]
-        subject = data[&#x27;subject&#x27;]
-        assignment_type = data[&#x27;assignment_type&#x27;]
+        work_content = data[&quot;work_content&quot;]
+        subject = data[&quot;subject&quot;]
+        assignment_type = data[&quot;assignment_type&quot;]
 
         # Construction du profil √©tudiant
-        profile_data = data[&#x27;student_profile&#x27;]
+        profile_data = data[&quot;student_profile&quot;]
         student_profile = StudentProfile(
-            id=profile_data.get(&#x27;id&#x27;, &#x27;anonymous&#x27;),
-            name=profile_data.get(&#x27;name&#x27;, &#x27;√âtudiant&#x27;),
-            level=profile_data.get(&#x27;level&#x27;, &#x27;terminale&#x27;),
-            specialties=profile_data.get(&#x27;specialties&#x27;, [subject.lower()]),
-            learning_style=profile_data.get(&#x27;learning_style&#x27;, &#x27;mixed&#x27;),
-            strengths=profile_data.get(&#x27;strengths&#x27;, []),
-            weaknesses=profile_data.get(&#x27;weaknesses&#x27;, []),
-            goals=profile_data.get(&#x27;goals&#x27;, [])
+            id=profile_data.get(&quot;id&quot;, &quot;anonymous&quot;),
+            name=profile_data.get(&quot;name&quot;, &quot;√âtudiant&quot;),
+            level=profile_data.get(&quot;level&quot;, &quot;terminale&quot;),
+            specialties=profile_data.get(&quot;specialties&quot;, [subject.lower()]),
+            learning_style=profile_data.get(&quot;learning_style&quot;, &quot;mixed&quot;),
+            strengths=profile_data.get(&quot;strengths&quot;, []),
+            weaknesses=profile_data.get(&quot;weaknesses&quot;, []),
+            goals=profile_data.get(&quot;goals&quot;, []),
         )
 
         # Appel au service
         loop = asyncio.new_event_loop()
         asyncio.set_event_loop(loop)
@@ -454,134 +508,162 @@
                 openai_service.analyze_student_work(
                     work_content, subject, assignment_type, student_profile
                 )
             )
 
-            return jsonify({
-                &quot;success&quot;: True,
-                &quot;data&quot;: response,
-                &quot;timestamp&quot;: datetime.now().isoformat()
-            }), 200
+            return (
+                jsonify(
+                    {
+                        &quot;success&quot;: True,
+                        &quot;data&quot;: response,
+                        &quot;timestamp&quot;: datetime.now().isoformat(),
+                    }
+                ),
+                200,
+            )
 
         finally:
             loop.close()
 
     except Exception as e:
         logger.error(f&quot;Erreur dans l&#x27;analyse de travail: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/usage/stats&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/usage/stats&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def usage_stats_endpoint():
     &quot;&quot;&quot;Statistiques d&#x27;utilisation de l&#x27;API OpenAI&quot;&quot;&quot;
     try:
         stats = openai_service.get_usage_statistics()
 
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: stats,
-            &quot;timestamp&quot;: datetime.now().isoformat()
-        }), 200
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;data&quot;: stats,
+                    &quot;timestamp&quot;: datetime.now().isoformat(),
+                }
+            ),
+            200,
+        )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la r√©cup√©ration des statistiques: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/models/available&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/models/available&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def available_models_endpoint():
     &quot;&quot;&quot;Liste des mod√®les disponibles&quot;&quot;&quot;
     try:
         models = {
             &quot;chat&quot;: {
                 &quot;model&quot;: openai_service.model_chat,
                 &quot;description&quot;: &quot;Mod√®le principal pour les conversations avec ARIA&quot;,
-                &quot;capabilities&quot;: [&quot;text_generation&quot;, &quot;reasoning&quot;, &quot;tutoring&quot;]
+                &quot;capabilities&quot;: [&quot;text_generation&quot;, &quot;reasoning&quot;, &quot;tutoring&quot;],
             },
             &quot;vision&quot;: {
                 &quot;model&quot;: openai_service.model_vision,
                 &quot;description&quot;: &quot;Mod√®le pour l&#x27;analyse d&#x27;images et documents&quot;,
-                &quot;capabilities&quot;: [&quot;image_analysis&quot;, &quot;document_reading&quot;, &quot;diagram_interpretation&quot;]
+                &quot;capabilities&quot;: [
+                    &quot;image_analysis&quot;,
+                    &quot;document_reading&quot;,
+                    &quot;diagram_interpretation&quot;,
+                ],
             },
             &quot;embedding&quot;: {
                 &quot;model&quot;: openai_service.model_embedding,
                 &quot;description&quot;: &quot;Mod√®le pour la recherche s√©mantique&quot;,
-                &quot;capabilities&quot;: [&quot;text_embedding&quot;, &quot;similarity_search&quot;, &quot;content_matching&quot;]
+                &quot;capabilities&quot;: [
+                    &quot;text_embedding&quot;,
+                    &quot;similarity_search&quot;,
+                    &quot;content_matching&quot;,
+                ],
             },
             &quot;image&quot;: {
                 &quot;model&quot;: openai_service.model_image,
                 &quot;description&quot;: &quot;Mod√®le pour la g√©n√©ration d&#x27;images p√©dagogiques&quot;,
-                &quot;capabilities&quot;: [&quot;image_generation&quot;, &quot;educational_diagrams&quot;, &quot;illustrations&quot;]
-            }
+                &quot;capabilities&quot;: [
+                    &quot;image_generation&quot;,
+                    &quot;educational_diagrams&quot;,
+                    &quot;illustrations&quot;,
+                ],
+            },
         }
 
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: {
-                &quot;models&quot;: models,
-                &quot;api_configured&quot;: bool(openai_service.api_key),
-                &quot;service_status&quot;: &quot;operational&quot; if openai_service.client else &quot;simulation_mode&quot;
-            },
-            &quot;timestamp&quot;: datetime.now().isoformat()
-        }), 200
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;data&quot;: {
+                        &quot;models&quot;: models,
+                        &quot;api_configured&quot;: bool(openai_service.api_key),
+                        &quot;service_status&quot;: (
+                            &quot;operational&quot;
+                            if openai_service.client
+                            else &quot;simulation_mode&quot;
+                        ),
+                    },
+                    &quot;timestamp&quot;: datetime.now().isoformat(),
+                }
+            ),
+            200,
+        )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la r√©cup√©ration des mod√®les: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/conversation/context&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/conversation/context&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def save_conversation_context():
     &quot;&quot;&quot;Sauvegarde le contexte de conversation pour la continuit√©&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;session_id&#x27;, &#x27;student_id&#x27;, &#x27;messages&#x27;]
+        required_fields = [&quot;session_id&quot;, &quot;student_id&quot;, &quot;messages&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        session_id = data[&#x27;session_id&#x27;]
-        student_id = data[&#x27;student_id&#x27;]
-        messages = data[&#x27;messages&#x27;]
-        context_metadata = data.get(&#x27;metadata&#x27;, {})
+        session_id = data[&quot;session_id&quot;]
+        student_id = data[&quot;student_id&quot;]
+        messages = data[&quot;messages&quot;]
+        context_metadata = data.get(&quot;metadata&quot;, {})
 
         # En production, sauvegarder en base de donn√©es
         # Pour la d√©mo, on simule la sauvegarde
         saved_context = {
             &quot;session_id&quot;: session_id,
             &quot;student_id&quot;: student_id,
             &quot;messages&quot;: messages,
             &quot;metadata&quot;: context_metadata,
             &quot;saved_at&quot;: datetime.now().isoformat(),
-            &quot;status&quot;: &quot;saved&quot;
+            &quot;status&quot;: &quot;saved&quot;,
         }
 
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: saved_context,
-            &quot;message&quot;: &quot;Context saved successfully&quot;
-        }), 200
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;data&quot;: saved_context,
+                    &quot;message&quot;: &quot;Context saved successfully&quot;,
+                }
+            ),
+            200,
+        )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la sauvegarde du contexte: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/conversation/context/&lt;session_id&gt;&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/conversation/context/&lt;session_id&gt;&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_conversation_context(session_id):
     &quot;&quot;&quot;R√©cup√®re le contexte de conversation sauvegard√©&quot;&quot;&quot;
     try:
         # En production, r√©cup√©rer depuis la base de donn√©es
@@ -591,53 +673,47 @@
             &quot;student_id&quot;: &quot;demo_student&quot;,
             &quot;messages&quot;: [
                 {
                     &quot;role&quot;: &quot;assistant&quot;,
                     &quot;content&quot;: &quot;Bonjour ! Comment puis-je vous aider aujourd&#x27;hui ?&quot;,
-                    &quot;timestamp&quot;: datetime.now().isoformat()
+                    &quot;timestamp&quot;: datetime.now().isoformat(),
                 }
             ],
             &quot;metadata&quot;: {
                 &quot;subject&quot;: &quot;math√©matiques&quot;,
                 &quot;topic&quot;: &quot;fonctions&quot;,
-                &quot;difficulty_level&quot;: &quot;medium&quot;
+                &quot;difficulty_level&quot;: &quot;medium&quot;,
             },
             &quot;created_at&quot;: datetime.now().isoformat(),
-            &quot;last_updated&quot;: datetime.now().isoformat()
+            &quot;last_updated&quot;: datetime.now().isoformat(),
         }
 
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: demo_context,
-            &quot;found&quot;: True
-        }), 200
+        return jsonify({&quot;success&quot;: True, &quot;data&quot;: demo_context, &quot;found&quot;: True}), 200
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la r√©cup√©ration du contexte: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@openai_bp.route(&#x27;/feedback&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@openai_bp.route(&quot;/feedback&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def submit_feedback():
     &quot;&quot;&quot;Soumission de feedback sur les r√©ponses d&#x27;ARIA&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;session_id&#x27;, &#x27;message_id&#x27;, &#x27;rating&#x27;]
+        required_fields = [&quot;session_id&quot;, &quot;message_id&quot;, &quot;rating&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        session_id = data[&#x27;session_id&#x27;]
-        message_id = data[&#x27;message_id&#x27;]
-        rating = data[&#x27;rating&#x27;]  # 1-5 stars
-        comment = data.get(&#x27;comment&#x27;, &#x27;&#x27;)
-        student_id = data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;)
+        session_id = data[&quot;session_id&quot;]
+        message_id = data[&quot;message_id&quot;]
+        rating = data[&quot;rating&quot;]  # 1-5 stars
+        comment = data.get(&quot;comment&quot;, &quot;&quot;)
+        student_id = data.get(&quot;student_id&quot;, &quot;anonymous&quot;)
 
         # Validation du rating
         if not isinstance(rating, int) or rating &lt; 1 or rating &gt; 5:
             return jsonify({&quot;error&quot;: &quot;Rating must be between 1 and 5&quot;}), 400
 
@@ -647,55 +723,74 @@
             &quot;message_id&quot;: message_id,
             &quot;student_id&quot;: student_id,
             &quot;rating&quot;: rating,
             &quot;comment&quot;: comment,
             &quot;submitted_at&quot;: datetime.now().isoformat(),
-            &quot;status&quot;: &quot;received&quot;
+            &quot;status&quot;: &quot;received&quot;,
         }
 
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: feedback_data,
-            &quot;message&quot;: &quot;Feedback received successfully&quot;
-        }), 200
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;data&quot;: feedback_data,
+                    &quot;message&quot;: &quot;Feedback received successfully&quot;,
+                }
+            ),
+            200,
+        )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la soumission du feedback: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
 
 # Gestionnaire d&#x27;erreurs pour le blueprint
 @openai_bp.errorhandler(404)
 def not_found(error):
-    return jsonify({
-        &quot;error&quot;: &quot;Endpoint not found&quot;,
-        &quot;available_endpoints&quot;: [
-            &quot;/api/openai/health&quot;,
-            &quot;/api/openai/chat&quot;,
-            &quot;/api/openai/chat/advanced&quot;,
-            &quot;/api/openai/document/generate&quot;,
-            &quot;/api/openai/document/generate/advanced&quot;,
-            &quot;/api/openai/quiz/generate&quot;,
-            &quot;/api/openai/quiz/generate/advanced&quot;,
-            &quot;/api/openai/image/generate&quot;,
-            &quot;/api/openai/analyze/work&quot;,
-            &quot;/api/openai/usage/stats&quot;,
-            &quot;/api/openai/models/available&quot;
-        ]
-    }), 404
+    return (
+        jsonify(
+            {
+                &quot;error&quot;: &quot;Endpoint not found&quot;,
+                &quot;available_endpoints&quot;: [
+                    &quot;/api/openai/health&quot;,
+                    &quot;/api/openai/chat&quot;,
+                    &quot;/api/openai/chat/advanced&quot;,
+                    &quot;/api/openai/document/generate&quot;,
+                    &quot;/api/openai/document/generate/advanced&quot;,
+                    &quot;/api/openai/quiz/generate&quot;,
+                    &quot;/api/openai/quiz/generate/advanced&quot;,
+                    &quot;/api/openai/image/generate&quot;,
+                    &quot;/api/openai/analyze/work&quot;,
+                    &quot;/api/openai/usage/stats&quot;,
+                    &quot;/api/openai/models/available&quot;,
+                ],
+            }
+        ),
+        404,
+    )
+
 
 @openai_bp.errorhandler(405)
 def method_not_allowed(error):
-    return jsonify({
-        &quot;error&quot;: &quot;Method not allowed&quot;,
-        &quot;message&quot;: &quot;Check the HTTP method for this endpoint&quot;
-    }), 405
+    return (
+        jsonify(
+            {
+                &quot;error&quot;: &quot;Method not allowed&quot;,
+                &quot;message&quot;: &quot;Check the HTTP method for this endpoint&quot;,
+            }
+        ),
+        405,
+    )
+
 
 @openai_bp.errorhandler(500)
 def internal_error(error):
-    return jsonify({
-        &quot;error&quot;: &quot;Internal server error&quot;,
-        &quot;message&quot;: &quot;An unexpected error occurred&quot;
-    }), 500
-
+    return (
+        jsonify(
+            {
+                &quot;error&quot;: &quot;Internal server error&quot;,
+                &quot;message&quot;: &quot;An unexpected error occurred&quot;,
+            }
+        ),
+        500,
+    )
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/documents.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/documents.py	2025-07-24 20:54:02.486100+00:00
@@ -12,23 +12,24 @@
     pdf_generator,
     create_revision_sheet_pdf,
     create_exercise_sheet_pdf,
     create_evaluation_report_pdf,
     create_progress_report_pdf,
-    DocumentMetadata
+    DocumentMetadata,
 )
 from ..services.openai_integration import openai_service, StudentProfile
 from ..services.content_engine import content_engine
 
 # Configuration du logging
 logging.basicConfig(level=logging.INFO)
 logger = logging.getLogger(__name__)
 
 # Blueprint pour les routes de documents
-documents_bp = Blueprint(&#x27;documents&#x27;, __name__, url_prefix=&#x27;/api/documents&#x27;)
-
-@documents_bp.route(&#x27;/health&#x27;, methods=[&#x27;GET&#x27;])
+documents_bp = Blueprint(&quot;documents&quot;, __name__, url_prefix=&quot;/api/documents&quot;)
+
+
+@documents_bp.route(&quot;/health&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def health_check():
     &quot;&quot;&quot;V√©rification de l&#x27;√©tat du service de g√©n√©ration de documents&quot;&quot;&quot;
     try:
         status = {
@@ -40,162 +41,177 @@
             &quot;supported_types&quot;: [
                 &quot;revision_sheet&quot;,
                 &quot;exercise_sheet&quot;,
                 &quot;evaluation_report&quot;,
                 &quot;progress_report&quot;,
-                &quot;custom_document&quot;
+                &quot;custom_document&quot;,
             ],
-            &quot;timestamp&quot;: datetime.now().isoformat()
+            &quot;timestamp&quot;: datetime.now().isoformat(),
         }
 
         return jsonify(status), 200
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la v√©rification de sant√©: {e}&quot;)
         return jsonify({&quot;error&quot;: &quot;Service unavailable&quot;}), 503
 
-@documents_bp.route(&#x27;/generate/revision-sheet&#x27;, methods=[&#x27;POST&#x27;])
+
+@documents_bp.route(&quot;/generate/revision-sheet&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_revision_sheet():
     &quot;&quot;&quot;G√©n√®re une fiche de r√©vision personnalis√©e&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation des donn√©es requises
-        required_fields = [&#x27;subject&#x27;, &#x27;topic&#x27;, &#x27;student_name&#x27;]
+        required_fields = [&quot;subject&quot;, &quot;topic&quot;, &quot;student_name&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
-        student_name = data[&#x27;student_name&#x27;]
-        student_level = data.get(&#x27;student_level&#x27;, &#x27;Terminale&#x27;)
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
+        student_name = data[&quot;student_name&quot;]
+        student_level = data.get(&quot;student_level&quot;, &quot;Terminale&quot;)
 
         # G√©n√©ration du contenu avec l&#x27;IA si disponible
         if openai_service.client:
             try:
                 # Construction du profil √©tudiant
                 student_profile = StudentProfile(
-                    id=data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;),
+                    id=data.get(&quot;student_id&quot;, &quot;anonymous&quot;),
                     name=student_name,
                     level=student_level,
                     specialties=[subject.lower()],
-                    learning_style=data.get(&#x27;learning_style&#x27;, &#x27;mixed&#x27;)
+                    learning_style=data.get(&quot;learning_style&quot;, &quot;mixed&quot;),
                 )
 
                 # G√©n√©ration du contenu avec OpenAI
                 loop = asyncio.new_event_loop()
                 asyncio.set_event_loop(loop)
 
                 try:
                     ai_content = loop.run_until_complete(
                         openai_service.generate_document(
-                            &#x27;revision_sheet&#x27;, subject, topic, student_profile
+                            &quot;revision_sheet&quot;, subject, topic, student_profile
                         )
                     )
 
                     # Extraction du contenu structur√©
-                    if &#x27;structured_content&#x27; in ai_content:
-                        content = ai_content[&#x27;structured_content&#x27;]
+                    if &quot;structured_content&quot; in ai_content:
+                        content = ai_content[&quot;structured_content&quot;]
                     else:
                         # Fallback: structure basique
                         content = {
-                            &#x27;title&#x27;: f&quot;Fiche de r√©vision - {topic}&quot;,
-                            &#x27;objectives&#x27;: [f&quot;Ma√Ætriser les concepts cl√©s de {topic}&quot;],
-                            &#x27;definitions&#x27;: {},
-                            &#x27;key_points&#x27;: [ai_content.get(&#x27;content&#x27;, &#x27;Contenu g√©n√©r√© par IA&#x27;)],
-                            &#x27;examples&#x27;: [],
-                            &#x27;tips&#x27;: [&quot;Relire r√©guli√®rement&quot;, &quot;Faire des exercices d&#x27;application&quot;]
+                            &quot;title&quot;: f&quot;Fiche de r√©vision - {topic}&quot;,
+                            &quot;objectives&quot;: [f&quot;Ma√Ætriser les concepts cl√©s de {topic}&quot;],
+                            &quot;definitions&quot;: {},
+                            &quot;key_points&quot;: [
+                                ai_content.get(&quot;content&quot;, &quot;Contenu g√©n√©r√© par IA&quot;)
+                            ],
+                            &quot;examples&quot;: [],
+                            &quot;tips&quot;: [
+                                &quot;Relire r√©guli√®rement&quot;,
+                                &quot;Faire des exercices d&#x27;application&quot;,
+                            ],
                         }
 
                 finally:
                     loop.close()
 
             except Exception as e:
                 logger.warning(f&quot;Erreur IA, utilisation du contenu par d√©faut: {e}&quot;)
                 content = _get_default_revision_content(subject, topic)
         else:
             # Utilisation du moteur de contenu par d√©faut
-            content = content_engine.generate_revision_sheet_content(subject, topic, student_level)
+            content = content_engine.generate_revision_sheet_content(
+                subject, topic, student_level
+            )
 
         # G√©n√©ration du PDF
         pdf_bytes = create_revision_sheet_pdf(content, student_name, subject, topic)
 
         # Cr√©ation d&#x27;un buffer pour l&#x27;envoi
         pdf_buffer = io.BytesIO(pdf_bytes)
         pdf_buffer.seek(0)
 
         # Nom du fichier
-        filename = f&quot;fiche_revision_{subject}_{topic}_{student_name}.pdf&quot;.replace(&#x27; &#x27;, &#x27;_&#x27;)
+        filename = f&quot;fiche_revision_{subject}_{topic}_{student_name}.pdf&quot;.replace(
+            &quot; &quot;, &quot;_&quot;
+        )
 
         return send_file(
             pdf_buffer,
-            mimetype=&#x27;application/pdf&#x27;,
+            mimetype=&quot;application/pdf&quot;,
             as_attachment=True,
-            download_name=filename
+            download_name=filename,
         )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la g√©n√©ration de fiche de r√©vision: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@documents_bp.route(&#x27;/generate/exercise-sheet&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@documents_bp.route(&quot;/generate/exercise-sheet&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_exercise_sheet():
     &quot;&quot;&quot;G√©n√®re une feuille d&#x27;exercices personnalis√©e&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;subject&#x27;, &#x27;topic&#x27;, &#x27;student_name&#x27;]
+        required_fields = [&quot;subject&quot;, &quot;topic&quot;, &quot;student_name&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
-        student_name = data[&#x27;student_name&#x27;]
-        difficulty = data.get(&#x27;difficulty&#x27;, &#x27;medium&#x27;)
-        num_exercises = data.get(&#x27;num_exercises&#x27;, 5)
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
+        student_name = data[&quot;student_name&quot;]
+        difficulty = data.get(&quot;difficulty&quot;, &quot;medium&quot;)
+        num_exercises = data.get(&quot;num_exercises&quot;, 5)
 
         # G√©n√©ration du contenu
         if openai_service.client:
             try:
                 student_profile = StudentProfile(
-                    id=data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;),
+                    id=data.get(&quot;student_id&quot;, &quot;anonymous&quot;),
                     name=student_name,
-                    level=data.get(&#x27;student_level&#x27;, &#x27;Terminale&#x27;),
+                    level=data.get(&quot;student_level&quot;, &quot;Terminale&quot;),
                     specialties=[subject.lower()],
-                    preferred_difficulty=difficulty
+                    preferred_difficulty=difficulty,
                 )
 
                 loop = asyncio.new_event_loop()
                 asyncio.set_event_loop(loop)
 
                 try:
                     ai_content = loop.run_until_complete(
                         openai_service.generate_document(
-                            &#x27;exercise_sheet&#x27;, subject, topic, student_profile,
-                            {&#x27;num_exercises&#x27;: num_exercises, &#x27;difficulty&#x27;: difficulty}
+                            &quot;exercise_sheet&quot;,
+                            subject,
+                            topic,
+                            student_profile,
+                            {&quot;num_exercises&quot;: num_exercises, &quot;difficulty&quot;: difficulty},
                         )
                     )
 
-                    if &#x27;structured_content&#x27; in ai_content:
-                        content = ai_content[&#x27;structured_content&#x27;]
+                    if &quot;structured_content&quot; in ai_content:
+                        content = ai_content[&quot;structured_content&quot;]
                     else:
-                        content = _get_default_exercise_content(subject, topic, difficulty, num_exercises)
+                        content = _get_default_exercise_content(
+                            subject, topic, difficulty, num_exercises
+                        )
 
                 finally:
                     loop.close()
 
             except Exception as e:
                 logger.warning(f&quot;Erreur IA, utilisation du contenu par d√©faut: {e}&quot;)
-                content = _get_default_exercise_content(subject, topic, difficulty, num_exercises)
+                content = _get_default_exercise_content(
+                    subject, topic, difficulty, num_exercises
+                )
         else:
             content = content_engine.generate_exercise_sheet_content(
                 subject, topic, difficulty, num_exercises
             )
 
@@ -203,71 +219,72 @@
         pdf_bytes = create_exercise_sheet_pdf(content, student_name, subject, topic)
 
         pdf_buffer = io.BytesIO(pdf_bytes)
         pdf_buffer.seek(0)
 
-        filename = f&quot;exercices_{subject}_{topic}_{student_name}.pdf&quot;.replace(&#x27; &#x27;, &#x27;_&#x27;)
+        filename = f&quot;exercices_{subject}_{topic}_{student_name}.pdf&quot;.replace(&quot; &quot;, &quot;_&quot;)
 
         return send_file(
             pdf_buffer,
-            mimetype=&#x27;application/pdf&#x27;,
+            mimetype=&quot;application/pdf&quot;,
             as_attachment=True,
-            download_name=filename
+            download_name=filename,
         )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la g√©n√©ration d&#x27;exercices: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@documents_bp.route(&#x27;/generate/evaluation-report&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@documents_bp.route(&quot;/generate/evaluation-report&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_evaluation_report():
     &quot;&quot;&quot;G√©n√®re un rapport d&#x27;√©valuation personnalis√©&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;student_name&#x27;, &#x27;subject&#x27;, &#x27;evaluation_data&#x27;]
+        required_fields = [&quot;student_name&quot;, &quot;subject&quot;, &quot;evaluation_data&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        student_name = data[&#x27;student_name&#x27;]
-        subject = data[&#x27;subject&#x27;]
-        evaluation_data = data[&#x27;evaluation_data&#x27;]
+        student_name = data[&quot;student_name&quot;]
+        subject = data[&quot;subject&quot;]
+        evaluation_data = data[&quot;evaluation_data&quot;]
 
         # G√©n√©ration du contenu du rapport
         if openai_service.client:
             try:
                 student_profile = StudentProfile(
-                    id=data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;),
+                    id=data.get(&quot;student_id&quot;, &quot;anonymous&quot;),
                     name=student_name,
-                    level=data.get(&#x27;student_level&#x27;, &#x27;Terminale&#x27;),
-                    specialties=[subject.lower()]
+                    level=data.get(&quot;student_level&quot;, &quot;Terminale&quot;),
+                    specialties=[subject.lower()],
                 )
 
                 loop = asyncio.new_event_loop()
                 asyncio.set_event_loop(loop)
 
                 try:
                     ai_content = loop.run_until_complete(
                         openai_service.analyze_student_work(
-                            json.dumps(evaluation_data), subject, &#x27;evaluation&#x27;, student_profile
+                            json.dumps(evaluation_data),
+                            subject,
+                            &quot;evaluation&quot;,
+                            student_profile,
                         )
                     )
 
                     # Structuration du contenu pour le PDF
                     content = {
-                        &#x27;title&#x27;: f&quot;Rapport d&#x27;√©valuation - {subject}&quot;,
-                        &#x27;summary&#x27;: ai_content.get(&#x27;summary&#x27;, &#x27;Analyse de l\&#x27;√©valuation&#x27;),
-                        &#x27;overall_results&#x27;: ai_content.get(&#x27;detailed_analysis&#x27;, {}),
-                        &#x27;strengths&#x27;: ai_content.get(&#x27;strengths&#x27;, []),
-                        &#x27;improvements&#x27;: ai_content.get(&#x27;areas_for_improvement&#x27;, []),
-                        &#x27;recommendations&#x27;: ai_content.get(&#x27;recommendations&#x27;, [])
+                        &quot;title&quot;: f&quot;Rapport d&#x27;√©valuation - {subject}&quot;,
+                        &quot;summary&quot;: ai_content.get(&quot;summary&quot;, &quot;Analyse de l&#x27;√©valuation&quot;),
+                        &quot;overall_results&quot;: ai_content.get(&quot;detailed_analysis&quot;, {}),
+                        &quot;strengths&quot;: ai_content.get(&quot;strengths&quot;, []),
+                        &quot;improvements&quot;: ai_content.get(&quot;areas_for_improvement&quot;, []),
+                        &quot;recommendations&quot;: ai_content.get(&quot;recommendations&quot;, []),
                     }
 
                 finally:
                     loop.close()
 
@@ -281,71 +298,78 @@
         pdf_bytes = create_evaluation_report_pdf(content, student_name, subject)
 
         pdf_buffer = io.BytesIO(pdf_bytes)
         pdf_buffer.seek(0)
 
-        filename = f&quot;rapport_evaluation_{subject}_{student_name}.pdf&quot;.replace(&#x27; &#x27;, &#x27;_&#x27;)
+        filename = f&quot;rapport_evaluation_{subject}_{student_name}.pdf&quot;.replace(&quot; &quot;, &quot;_&quot;)
 
         return send_file(
             pdf_buffer,
-            mimetype=&#x27;application/pdf&#x27;,
+            mimetype=&quot;application/pdf&quot;,
             as_attachment=True,
-            download_name=filename
+            download_name=filename,
         )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la g√©n√©ration du rapport d&#x27;√©valuation: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@documents_bp.route(&#x27;/generate/progress-report&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@documents_bp.route(&quot;/generate/progress-report&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_progress_report():
     &quot;&quot;&quot;G√©n√®re un rapport de progression pour les parents&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;student_name&#x27;, &#x27;progress_data&#x27;]
+        required_fields = [&quot;student_name&quot;, &quot;progress_data&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        student_name = data[&#x27;student_name&#x27;]
-        progress_data = data[&#x27;progress_data&#x27;]
+        student_name = data[&quot;student_name&quot;]
+        progress_data = data[&quot;progress_data&quot;]
 
         # Enrichissement du rapport avec l&#x27;IA si disponible
         if openai_service.client:
             try:
                 student_profile = StudentProfile(
-                    id=data.get(&#x27;student_id&#x27;, &#x27;anonymous&#x27;),
+                    id=data.get(&quot;student_id&quot;, &quot;anonymous&quot;),
                     name=student_name,
-                    level=data.get(&#x27;student_level&#x27;, &#x27;Terminale&#x27;)
+                    level=data.get(&quot;student_level&quot;, &quot;Terminale&quot;),
                 )
 
                 loop = asyncio.new_event_loop()
                 asyncio.set_event_loop(loop)
 
                 try:
                     # G√©n√©ration d&#x27;insights avec l&#x27;IA
                     ai_insights = loop.run_until_complete(
                         openai_service.generate_document(
-                            &#x27;progress_report&#x27;, &#x27;g√©n√©ral&#x27;, &#x27;progression&#x27;, student_profile,
-                            {&#x27;progress_data&#x27;: progress_data}
+                            &quot;progress_report&quot;,
+                            &quot;g√©n√©ral&quot;,
+                            &quot;progression&quot;,
+                            student_profile,
+                            {&quot;progress_data&quot;: progress_data},
                         )
                     )
 
                     # Enrichissement des donn√©es de progression
-                    if &#x27;structured_content&#x27; in ai_insights:
-                        ai_content = ai_insights[&#x27;structured_content&#x27;]
-                        progress_data.update({
-                            &#x27;overview&#x27;: ai_content.get(&#x27;overview&#x27;, progress_data.get(&#x27;overview&#x27;, &#x27;&#x27;)),
-                            &#x27;parent_recommendations&#x27;: ai_content.get(&#x27;parent_recommendations&#x27;, []),
-                            &#x27;next_steps&#x27;: ai_content.get(&#x27;next_steps&#x27;, [])
-                        })
+                    if &quot;structured_content&quot; in ai_insights:
+                        ai_content = ai_insights[&quot;structured_content&quot;]
+                        progress_data.update(
+                            {
+                                &quot;overview&quot;: ai_content.get(
+                                    &quot;overview&quot;, progress_data.get(&quot;overview&quot;, &quot;&quot;)
+                                ),
+                                &quot;parent_recommendations&quot;: ai_content.get(
+                                    &quot;parent_recommendations&quot;, []
+                                ),
+                                &quot;next_steps&quot;: ai_content.get(&quot;next_steps&quot;, []),
+                            }
+                        )
 
                 finally:
                     loop.close()
 
             except Exception as e:
@@ -355,85 +379,86 @@
         pdf_bytes = create_progress_report_pdf(progress_data, student_name)
 
         pdf_buffer = io.BytesIO(pdf_bytes)
         pdf_buffer.seek(0)
 
-        filename = f&quot;rapport_progression_{student_name}.pdf&quot;.replace(&#x27; &#x27;, &#x27;_&#x27;)
+        filename = f&quot;rapport_progression_{student_name}.pdf&quot;.replace(&quot; &quot;, &quot;_&quot;)
 
         return send_file(
             pdf_buffer,
-            mimetype=&#x27;application/pdf&#x27;,
+            mimetype=&quot;application/pdf&quot;,
             as_attachment=True,
-            download_name=filename
+            download_name=filename,
         )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la g√©n√©ration du rapport de progression: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@documents_bp.route(&#x27;/generate/custom&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@documents_bp.route(&quot;/generate/custom&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def generate_custom_document():
     &quot;&quot;&quot;G√©n√®re un document personnalis√© selon les sp√©cifications&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;document_type&#x27;, &#x27;content&#x27;, &#x27;metadata&#x27;]
+        required_fields = [&quot;document_type&quot;, &quot;content&quot;, &quot;metadata&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        document_type = data[&#x27;document_type&#x27;]
-        content = data[&#x27;content&#x27;]
-        metadata_dict = data[&#x27;metadata&#x27;]
+        document_type = data[&quot;document_type&quot;]
+        content = data[&quot;content&quot;]
+        metadata_dict = data[&quot;metadata&quot;]
 
         # Construction des m√©tadonn√©es
         metadata = DocumentMetadata(
-            title=metadata_dict.get(&#x27;title&#x27;, &#x27;Document personnalis√©&#x27;),
-            subject=metadata_dict.get(&#x27;subject&#x27;, &#x27;G√©n√©ral&#x27;),
-            student_name=metadata_dict.get(&#x27;student_name&#x27;, &#x27;&#x27;),
-            student_level=metadata_dict.get(&#x27;student_level&#x27;, &#x27;&#x27;),
+            title=metadata_dict.get(&quot;title&quot;, &quot;Document personnalis√©&quot;),
+            subject=metadata_dict.get(&quot;subject&quot;, &quot;G√©n√©ral&quot;),
+            student_name=metadata_dict.get(&quot;student_name&quot;, &quot;&quot;),
+            student_level=metadata_dict.get(&quot;student_level&quot;, &quot;&quot;),
             document_type=document_type,
-            topic=metadata_dict.get(&#x27;topic&#x27;, &#x27;&#x27;)
+            topic=metadata_dict.get(&quot;topic&quot;, &quot;&quot;),
         )
 
         # G√©n√©ration selon le type
-        if document_type == &#x27;revision_sheet&#x27;:
+        if document_type == &quot;revision_sheet&quot;:
             pdf_bytes = pdf_generator.generate_revision_sheet(content, metadata)
-        elif document_type == &#x27;exercise_sheet&#x27;:
+        elif document_type == &quot;exercise_sheet&quot;:
             pdf_bytes = pdf_generator.generate_exercise_sheet(content, metadata)
-        elif document_type == &#x27;evaluation_report&#x27;:
+        elif document_type == &quot;evaluation_report&quot;:
             pdf_bytes = pdf_generator.generate_evaluation_report(content, metadata)
-        elif document_type == &#x27;progress_report&#x27;:
+        elif document_type == &quot;progress_report&quot;:
             pdf_bytes = pdf_generator.generate_progress_report(content, metadata)
         else:
-            return jsonify({&quot;error&quot;: f&quot;Unsupported document type: {document_type}&quot;}), 400
+            return (
+                jsonify({&quot;error&quot;: f&quot;Unsupported document type: {document_type}&quot;}),
+                400,
+            )
 
         pdf_buffer = io.BytesIO(pdf_bytes)
         pdf_buffer.seek(0)
 
-        filename = f&quot;{document_type}_{metadata.student_name or &#x27;document&#x27;}.pdf&quot;.replace(&#x27; &#x27;, &#x27;_&#x27;)
+        filename = f&quot;{document_type}_{metadata.student_name or &#x27;document&#x27;}.pdf&quot;.replace(
+            &quot; &quot;, &quot;_&quot;
+        )
 
         return send_file(
             pdf_buffer,
-            mimetype=&#x27;application/pdf&#x27;,
+            mimetype=&quot;application/pdf&quot;,
             as_attachment=True,
-            download_name=filename
+            download_name=filename,
         )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la g√©n√©ration du document personnalis√©: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@documents_bp.route(&#x27;/templates&#x27;, methods=[&#x27;GET&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@documents_bp.route(&quot;/templates&quot;, methods=[&quot;GET&quot;])
 @cross_origin()
 def get_document_templates():
     &quot;&quot;&quot;Retourne les templates disponibles pour chaque type de document&quot;&quot;&quot;
     try:
         templates = {
@@ -441,258 +466,318 @@
                 &quot;name&quot;: &quot;Fiche de r√©vision&quot;,
                 &quot;description&quot;: &quot;Fiche synth√©tique avec d√©finitions, formules et points cl√©s&quot;,
                 &quot;required_fields&quot;: [&quot;subject&quot;, &quot;topic&quot;, &quot;student_name&quot;],
                 &quot;optional_fields&quot;: [&quot;student_level&quot;, &quot;learning_style&quot;],
                 &quot;sections&quot;: [
-                    &quot;objectives&quot;, &quot;prerequisites&quot;, &quot;definitions&quot;,
-                    &quot;formulas&quot;, &quot;methods&quot;, &quot;examples&quot;, &quot;tips&quot;,
-                    &quot;warnings&quot;, &quot;key_points&quot;, &quot;further_reading&quot;
-                ]
+                    &quot;objectives&quot;,
+                    &quot;prerequisites&quot;,
+                    &quot;definitions&quot;,
+                    &quot;formulas&quot;,
+                    &quot;methods&quot;,
+                    &quot;examples&quot;,
+                    &quot;tips&quot;,
+                    &quot;warnings&quot;,
+                    &quot;key_points&quot;,
+                    &quot;further_reading&quot;,
+                ],
             },
             &quot;exercise_sheet&quot;: {
                 &quot;name&quot;: &quot;Feuille d&#x27;exercices&quot;,
                 &quot;description&quot;: &quot;S√©rie d&#x27;exercices progressifs avec espaces de r√©ponse&quot;,
                 &quot;required_fields&quot;: [&quot;subject&quot;, &quot;topic&quot;, &quot;student_name&quot;],
                 &quot;optional_fields&quot;: [&quot;difficulty&quot;, &quot;num_exercises&quot;, &quot;duration&quot;],
                 &quot;sections&quot;: [
-                    &quot;instructions&quot;, &quot;duration&quot;, &quot;total_points&quot;,
-                    &quot;exercises&quot;, &quot;hints&quot;
-                ]
+                    &quot;instructions&quot;,
+                    &quot;duration&quot;,
+                    &quot;total_points&quot;,
+                    &quot;exercises&quot;,
+                    &quot;hints&quot;,
+                ],
             },
             &quot;evaluation_report&quot;: {
                 &quot;name&quot;: &quot;Rapport d&#x27;√©valuation&quot;,
                 &quot;description&quot;: &quot;Analyse d√©taill√©e des performances avec recommandations&quot;,
                 &quot;required_fields&quot;: [&quot;student_name&quot;, &quot;subject&quot;, &quot;evaluation_data&quot;],
                 &quot;optional_fields&quot;: [&quot;student_level&quot;],
                 &quot;sections&quot;: [
-                    &quot;summary&quot;, &quot;overall_results&quot;, &quot;strengths&quot;,
-                    &quot;improvements&quot;, &quot;recommendations&quot;, &quot;action_plan&quot;
-                ]
+                    &quot;summary&quot;,
+                    &quot;overall_results&quot;,
+                    &quot;strengths&quot;,
+                    &quot;improvements&quot;,
+                    &quot;recommendations&quot;,
+                    &quot;action_plan&quot;,
+                ],
             },
             &quot;progress_report&quot;: {
                 &quot;name&quot;: &quot;Rapport de progression&quot;,
                 &quot;description&quot;: &quot;Suivi d√©taill√© de l&#x27;√©volution de l&#x27;√©l√®ve pour les parents&quot;,
                 &quot;required_fields&quot;: [&quot;student_name&quot;, &quot;progress_data&quot;],
                 &quot;optional_fields&quot;: [&quot;period&quot;, &quot;student_level&quot;],
                 &quot;sections&quot;: [
-                    &quot;overview&quot;, &quot;subjects_progress&quot;, &quot;achieved_goals&quot;,
-                    &quot;challenges&quot;, &quot;parent_recommendations&quot;, &quot;next_steps&quot;
-                ]
-            }
+                    &quot;overview&quot;,
+                    &quot;subjects_progress&quot;,
+                    &quot;achieved_goals&quot;,
+                    &quot;challenges&quot;,
+                    &quot;parent_recommendations&quot;,
+                    &quot;next_steps&quot;,
+                ],
+            },
         }
 
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: {
-                &quot;templates&quot;: templates,
-                &quot;supported_subjects&quot;: [
-                    &quot;Math√©matiques&quot;, &quot;NSI&quot;, &quot;Physique-Chimie&quot;,
-                    &quot;Fran√ßais&quot;, &quot;Philosophie&quot;, &quot;Histoire-G√©ographie&quot;,
-                    &quot;Anglais&quot;, &quot;Espagnol&quot;, &quot;SVT&quot;, &quot;SES&quot;
-                ],
-                &quot;difficulty_levels&quot;: [&quot;easy&quot;, &quot;medium&quot;, &quot;hard&quot;],
-                &quot;student_levels&quot;: [&quot;Seconde&quot;, &quot;Premi√®re&quot;, &quot;Terminale&quot;]
-            },
-            &quot;timestamp&quot;: datetime.now().isoformat()
-        }), 200
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;data&quot;: {
+                        &quot;templates&quot;: templates,
+                        &quot;supported_subjects&quot;: [
+                            &quot;Math√©matiques&quot;,
+                            &quot;NSI&quot;,
+                            &quot;Physique-Chimie&quot;,
+                            &quot;Fran√ßais&quot;,
+                            &quot;Philosophie&quot;,
+                            &quot;Histoire-G√©ographie&quot;,
+                            &quot;Anglais&quot;,
+                            &quot;Espagnol&quot;,
+                            &quot;SVT&quot;,
+                            &quot;SES&quot;,
+                        ],
+                        &quot;difficulty_levels&quot;: [&quot;easy&quot;, &quot;medium&quot;, &quot;hard&quot;],
+                        &quot;student_levels&quot;: [&quot;Seconde&quot;, &quot;Premi√®re&quot;, &quot;Terminale&quot;],
+                    },
+                    &quot;timestamp&quot;: datetime.now().isoformat(),
+                }
+            ),
+            200,
+        )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la r√©cup√©ration des templates: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
-
-@documents_bp.route(&#x27;/preview&#x27;, methods=[&#x27;POST&#x27;])
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
+
+@documents_bp.route(&quot;/preview&quot;, methods=[&quot;POST&quot;])
 @cross_origin()
 def preview_document():
     &quot;&quot;&quot;G√©n√®re un aper√ßu du document sans le t√©l√©charger&quot;&quot;&quot;
     try:
         data = request.get_json()
 
         # Validation
-        required_fields = [&#x27;document_type&#x27;, &#x27;subject&#x27;, &#x27;topic&#x27;]
+        required_fields = [&quot;document_type&quot;, &quot;subject&quot;, &quot;topic&quot;]
         for field in required_fields:
             if field not in data:
                 return jsonify({&quot;error&quot;: f&quot;{field} is required&quot;}), 400
 
-        document_type = data[&#x27;document_type&#x27;]
-        subject = data[&#x27;subject&#x27;]
-        topic = data[&#x27;topic&#x27;]
+        document_type = data[&quot;document_type&quot;]
+        subject = data[&quot;subject&quot;]
+        topic = data[&quot;topic&quot;]
 
         # G√©n√©ration d&#x27;un aper√ßu du contenu
-        if document_type == &#x27;revision_sheet&#x27;:
+        if document_type == &quot;revision_sheet&quot;:
             preview = {
                 &quot;title&quot;: f&quot;Fiche de r√©vision - {topic}&quot;,
                 &quot;sections&quot;: [
                     &quot;üéØ Objectifs d&#x27;apprentissage&quot;,
                     &quot;üìö Pr√©requis&quot;,
                     &quot;üìñ D√©finitions cl√©s&quot;,
                     &quot;üßÆ Formules importantes&quot;,
                     &quot;‚öôÔ∏è M√©thodes et techniques&quot;,
                     &quot;üí° Exemples types&quot;,
                     &quot;üí° Conseils et astuces&quot;,
-                    &quot;üîë Points cl√©s √† retenir&quot;
-                ],
-                &quot;estimated_pages&quot;: 2
+                    &quot;üîë Points cl√©s √† retenir&quot;,
+                ],
+                &quot;estimated_pages&quot;: 2,
             }
-        elif document_type == &#x27;exercise_sheet&#x27;:
+        elif document_type == &quot;exercise_sheet&quot;:
             preview = {
                 &quot;title&quot;: f&quot;Exercices - {topic}&quot;,
                 &quot;sections&quot;: [
                     &quot;üìã Instructions&quot;,
                     &quot;‚è±Ô∏è Dur√©e et bar√®me&quot;,
                     &quot;üìù Exercices progressifs&quot;,
-                    &quot;üí° Conseils par exercice&quot;
-                ],
-                &quot;estimated_pages&quot;: 3
+                    &quot;üí° Conseils par exercice&quot;,
+                ],
+                &quot;estimated_pages&quot;: 3,
             }
-        elif document_type == &#x27;evaluation_report&#x27;:
+        elif document_type == &quot;evaluation_report&quot;:
             preview = {
                 &quot;title&quot;: &quot;Rapport d&#x27;√©valuation&quot;,
                 &quot;sections&quot;: [
                     &quot;üìä R√©sum√© ex√©cutif&quot;,
                     &quot;üìà R√©sultats globaux&quot;,
                     &quot;‚úÖ Points forts&quot;,
                     &quot;üìà Axes d&#x27;am√©lioration&quot;,
                     &quot;üéØ Recommandations&quot;,
-                    &quot;üìã Plan d&#x27;action&quot;
-                ],
-                &quot;estimated_pages&quot;: 4
+                    &quot;üìã Plan d&#x27;action&quot;,
+                ],
+                &quot;estimated_pages&quot;: 4,
             }
-        elif document_type == &#x27;progress_report&#x27;:
+        elif document_type == &quot;progress_report&quot;:
             preview = {
                 &quot;title&quot;: &quot;Rapport de progression&quot;,
                 &quot;sections&quot;: [
                     &quot;üìä Vue d&#x27;ensemble&quot;,
                     &quot;üìö Progression par mati√®re&quot;,
                     &quot;üéØ Objectifs atteints&quot;,
                     &quot;üöÄ D√©fis √† relever&quot;,
                     &quot;üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Recommandations parents&quot;,
-                    &quot;‚û°Ô∏è Prochaines √©tapes&quot;
-                ],
-                &quot;estimated_pages&quot;: 5
+                    &quot;‚û°Ô∏è Prochaines √©tapes&quot;,
+                ],
+                &quot;estimated_pages&quot;: 5,
             }
         else:
-            return jsonify({&quot;error&quot;: f&quot;Unsupported document type: {document_type}&quot;}), 400
-
-        return jsonify({
-            &quot;success&quot;: True,
-            &quot;data&quot;: {
-                &quot;preview&quot;: preview,
-                &quot;document_type&quot;: document_type,
-                &quot;subject&quot;: subject,
-                &quot;topic&quot;: topic
-            },
-            &quot;timestamp&quot;: datetime.now().isoformat()
-        }), 200
+            return (
+                jsonify({&quot;error&quot;: f&quot;Unsupported document type: {document_type}&quot;}),
+                400,
+            )
+
+        return (
+            jsonify(
+                {
+                    &quot;success&quot;: True,
+                    &quot;data&quot;: {
+                        &quot;preview&quot;: preview,
+                        &quot;document_type&quot;: document_type,
+                        &quot;subject&quot;: subject,
+                        &quot;topic&quot;: topic,
+                    },
+                    &quot;timestamp&quot;: datetime.now().isoformat(),
+                }
+            ),
+            200,
+        )
 
     except Exception as e:
         logger.error(f&quot;Erreur lors de la g√©n√©ration de l&#x27;aper√ßu: {e}&quot;)
-        return jsonify({
-            &quot;error&quot;: &quot;Internal server error&quot;,
-            &quot;message&quot;: str(e)
-        }), 500
+        return jsonify({&quot;error&quot;: &quot;Internal server error&quot;, &quot;message&quot;: str(e)}), 500
+
 
 # Fonctions utilitaires pour le contenu par d√©faut
 def _get_default_revision_content(subject: str, topic: str) -&gt; Dict[str, Any]:
     &quot;&quot;&quot;G√©n√®re un contenu de r√©vision par d√©faut&quot;&quot;&quot;
     return {
-        &#x27;title&#x27;: f&quot;Fiche de r√©vision - {topic}&quot;,
-        &#x27;objectives&#x27;: [
+        &quot;title&quot;: f&quot;Fiche de r√©vision - {topic}&quot;,
+        &quot;objectives&quot;: [
             f&quot;Comprendre les concepts fondamentaux de {topic}&quot;,
             f&quot;Ma√Ætriser les m√©thodes de r√©solution en {subject}&quot;,
-            &quot;Savoir appliquer les connaissances dans des exercices&quot;
+            &quot;Savoir appliquer les connaissances dans des exercices&quot;,
         ],
-        &#x27;definitions&#x27;: {
-            topic: f&quot;Concept cl√© en {subject} √† ma√Ætriser&quot;
-        },
-        &#x27;key_points&#x27;: [
+        &quot;definitions&quot;: {topic: f&quot;Concept cl√© en {subject} √† ma√Ætriser&quot;},
+        &quot;key_points&quot;: [
             f&quot;Point essentiel 1 sur {topic}&quot;,
             f&quot;Point essentiel 2 sur {topic}&quot;,
-            f&quot;Point essentiel 3 sur {topic}&quot;
+            f&quot;Point essentiel 3 sur {topic}&quot;,
         ],
-        &#x27;tips&#x27;: [
+        &quot;tips&quot;: [
             &quot;Relire r√©guli√®rement les d√©finitions&quot;,
             &quot;Faire des exercices d&#x27;application&quot;,
-            &quot;Cr√©er des sch√©mas de synth√®se&quot;
-        ]
+            &quot;Cr√©er des sch√©mas de synth√®se&quot;,
+        ],
     }
 
-def _get_default_exercise_content(subject: str, topic: str, difficulty: str, num_exercises: int) -&gt; Dict[str, Any]:
+
+def _get_default_exercise_content(
+    subject: str, topic: str, difficulty: str, num_exercises: int
+) -&gt; Dict[str, Any]:
     &quot;&quot;&quot;G√©n√®re un contenu d&#x27;exercices par d√©faut&quot;&quot;&quot;
     exercises = []
     for i in range(num_exercises):
-        exercises.append({
-            &#x27;statement&#x27;: f&quot;Exercice {i+1} sur {topic} - niveau {difficulty}&quot;,
-            &#x27;questions&#x27;: [
-                f&quot;Question 1 de l&#x27;exercice {i+1}&quot;,
-                f&quot;Question 2 de l&#x27;exercice {i+1}&quot;
-            ],
-            &#x27;points&#x27;: 4,
-            &#x27;difficulty&#x27;: difficulty,
-            &#x27;hints&#x27;: [f&quot;Conseil pour l&#x27;exercice {i+1}&quot;]
-        })
+        exercises.append(
+            {
+                &quot;statement&quot;: f&quot;Exercice {i+1} sur {topic} - niveau {difficulty}&quot;,
+                &quot;questions&quot;: [
+                    f&quot;Question 1 de l&#x27;exercice {i+1}&quot;,
+                    f&quot;Question 2 de l&#x27;exercice {i+1}&quot;,
+                ],
+                &quot;points&quot;: 4,
+                &quot;difficulty&quot;: difficulty,
+                &quot;hints&quot;: [f&quot;Conseil pour l&#x27;exercice {i+1}&quot;],
+            }
+        )
 
     return {
-        &#x27;title&#x27;: f&quot;Exercices - {topic}&quot;,
-        &#x27;instructions&#x27;: f&quot;R√©solvez les exercices suivants sur {topic}&quot;,
-        &#x27;duration&#x27;: &quot;2 heures&quot;,
-        &#x27;total_points&#x27;: num_exercises * 4,
-        &#x27;exercises&#x27;: exercises
+        &quot;title&quot;: f&quot;Exercices - {topic}&quot;,
+        &quot;instructions&quot;: f&quot;R√©solvez les exercices suivants sur {topic}&quot;,
+        &quot;duration&quot;: &quot;2 heures&quot;,
+        &quot;total_points&quot;: num_exercises * 4,
+        &quot;exercises&quot;: exercises,
     }
 
-def _get_default_evaluation_content(evaluation_data: Dict, subject: str) -&gt; Dict[str, Any]:
+
+def _get_default_evaluation_content(
+    evaluation_data: Dict, subject: str
+) -&gt; Dict[str, Any]:
     &quot;&quot;&quot;G√©n√®re un contenu d&#x27;√©valuation par d√©faut&quot;&quot;&quot;
     return {
-        &#x27;title&#x27;: f&quot;Rapport d&#x27;√©valuation - {subject}&quot;,
-        &#x27;summary&#x27;: &quot;Analyse des r√©sultats de l&#x27;√©valuation&quot;,
-        &#x27;overall_results&#x27;: {
-            &#x27;Compr√©hension&#x27;: {&#x27;score&#x27;: &#x27;15/20&#x27;, &#x27;comment&#x27;: &#x27;Bonne compr√©hension g√©n√©rale&#x27;},
-            &#x27;Application&#x27;: {&#x27;score&#x27;: &#x27;12/20&#x27;, &#x27;comment&#x27;: &#x27;√Ä am√©liorer&#x27;},
-            &#x27;Raisonnement&#x27;: {&#x27;score&#x27;: &#x27;14/20&#x27;, &#x27;comment&#x27;: &#x27;Satisfaisant&#x27;}
+        &quot;title&quot;: f&quot;Rapport d&#x27;√©valuation - {subject}&quot;,
+        &quot;summary&quot;: &quot;Analyse des r√©sultats de l&#x27;√©valuation&quot;,
+        &quot;overall_results&quot;: {
+            &quot;Compr√©hension&quot;: {
+                &quot;score&quot;: &quot;15/20&quot;,
+                &quot;comment&quot;: &quot;Bonne compr√©hension g√©n√©rale&quot;,
+            },
+            &quot;Application&quot;: {&quot;score&quot;: &quot;12/20&quot;, &quot;comment&quot;: &quot;√Ä am√©liorer&quot;},
+            &quot;Raisonnement&quot;: {&quot;score&quot;: &quot;14/20&quot;, &quot;comment&quot;: &quot;Satisfaisant&quot;},
         },
-        &#x27;strengths&#x27;: [
+        &quot;strengths&quot;: [
             &quot;Bonne ma√Ætrise des concepts de base&quot;,
-            &quot;Capacit√© de raisonnement d√©velopp√©e&quot;
+            &quot;Capacit√© de raisonnement d√©velopp√©e&quot;,
         ],
-        &#x27;improvements&#x27;: [
+        &quot;improvements&quot;: [
             &quot;Travailler l&#x27;application pratique&quot;,
-            &quot;Am√©liorer la rapidit√© d&#x27;ex√©cution&quot;
+            &quot;Am√©liorer la rapidit√© d&#x27;ex√©cution&quot;,
         ],
-        &#x27;recommendations&#x27;: [
+        &quot;recommendations&quot;: [
             &quot;Faire plus d&#x27;exercices d&#x27;application&quot;,
-            &quot;Revoir les m√©thodes de r√©solution&quot;
-        ]
+            &quot;Revoir les m√©thodes de r√©solution&quot;,
+        ],
     }
+
 
 # Gestionnaires d&#x27;erreurs
 @documents_bp.errorhandler(404)
 def not_found(error):
-    return jsonify({
-        &quot;error&quot;: &quot;Endpoint not found&quot;,
-        &quot;available_endpoints&quot;: [
-            &quot;/api/documents/health&quot;,
-            &quot;/api/documents/generate/revision-sheet&quot;,
-            &quot;/api/documents/generate/exercise-sheet&quot;,
-            &quot;/api/documents/generate/evaluation-report&quot;,
-            &quot;/api/documents/generate/progress-report&quot;,
-            &quot;/api/documents/generate/custom&quot;,
-            &quot;/api/documents/templates&quot;,
-            &quot;/api/documents/preview&quot;
-        ]
-    }), 404
+    return (
+        jsonify(
+            {
+                &quot;error&quot;: &quot;Endpoint not found&quot;,
+                &quot;available_endpoints&quot;: [
+                    &quot;/api/documents/health&quot;,
+                    &quot;/api/documents/generate/revision-sheet&quot;,
+                    &quot;/api/documents/generate/exercise-sheet&quot;,
+                    &quot;/api/documents/generate/evaluation-report&quot;,
+                    &quot;/api/documents/generate/progress-report&quot;,
+                    &quot;/api/documents/generate/custom&quot;,
+                    &quot;/api/documents/templates&quot;,
+                    &quot;/api/documents/preview&quot;,
+                ],
+            }
+        ),
+        404,
+    )
+
 
 @documents_bp.errorhandler(405)
 def method_not_allowed(error):
-    return jsonify({
-        &quot;error&quot;: &quot;Method not allowed&quot;,
-        &quot;message&quot;: &quot;Check the HTTP method for this endpoint&quot;
-    }), 405
+    return (
+        jsonify(
+            {
+                &quot;error&quot;: &quot;Method not allowed&quot;,
+                &quot;message&quot;: &quot;Check the HTTP method for this endpoint&quot;,
+            }
+        ),
+        405,
+    )
+
 
 @documents_bp.errorhandler(500)
 def internal_error(error):
-    return jsonify({
-        &quot;error&quot;: &quot;Internal server error&quot;,
-        &quot;message&quot;: &quot;An unexpected error occurred&quot;
-    }), 500
-
+    return (
+        jsonify(
+            {
+                &quot;error&quot;: &quot;Internal server error&quot;,
+                &quot;message&quot;: &quot;An unexpected error occurred&quot;,
+            }
+        ),
+        500,
+    )
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/content_engine.py	2025-07-24 07:24:17.026976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/content_engine.py	2025-07-24 20:54:02.491572+00:00
@@ -7,14 +7,20 @@
 import random
 from typing import List, Dict, Any, Optional, Tuple
 from datetime import datetime
 import uuid
 from ..models.content_system import (
-    ContentBrick, BrickType, Subject, TargetProfile,
-    LearningStep, DocumentRequest, GeneratedDocument
+    ContentBrick,
+    BrickType,
+    Subject,
+    TargetProfile,
+    LearningStep,
+    DocumentRequest,
+    GeneratedDocument,
 )
 from .content_bank import ContentBankService
+
 
 class ContentAssemblyEngine:
     &quot;&quot;&quot;Moteur d&#x27;assemblage intelligent pour la g√©n√©ration de contenu personnalis√©&quot;&quot;&quot;
 
     def __init__(self, content_bank: ContentBankService):
@@ -29,55 +35,59 @@
                 &quot;structure&quot;: [
                     {&quot;type&quot;: BrickType.DEFINITION, &quot;count&quot;: 2, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.THEOREME, &quot;count&quot;: 1, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.EXEMPLE, &quot;count&quot;: 2, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.CONSEIL_METHODE, &quot;count&quot;: 1, &quot;required&quot;: False},
-                    {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 3, &quot;required&quot;: True}
+                    {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 3, &quot;required&quot;: True},
                 ],
-                &quot;estimated_duration&quot;: 45
+                &quot;estimated_duration&quot;: 45,
             },
             &quot;exercices_entrainement&quot;: {
                 &quot;name&quot;: &quot;S√©rie d&#x27;Exercices d&#x27;Entra√Ænement&quot;,
                 &quot;structure&quot;: [
                     {&quot;type&quot;: BrickType.DEFINITION, &quot;count&quot;: 1, &quot;required&quot;: False},
                     {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 5, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.CORRECTION, &quot;count&quot;: 3, &quot;required&quot;: True},
-                    {&quot;type&quot;: BrickType.CONSEIL_METHODE, &quot;count&quot;: 2, &quot;required&quot;: True}
+                    {&quot;type&quot;: BrickType.CONSEIL_METHODE, &quot;count&quot;: 2, &quot;required&quot;: True},
                 ],
-                &quot;estimated_duration&quot;: 60
+                &quot;estimated_duration&quot;: 60,
             },
             &quot;cours_complet&quot;: {
                 &quot;name&quot;: &quot;Cours Complet&quot;,
                 &quot;structure&quot;: [
                     {&quot;type&quot;: BrickType.DEFINITION, &quot;count&quot;: 3, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.THEOREME, &quot;count&quot;: 2, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.PROPRIETE, &quot;count&quot;: 2, &quot;required&quot;: False},
                     {&quot;type&quot;: BrickType.EXEMPLE, &quot;count&quot;: 4, &quot;required&quot;: True},
-                    {&quot;type&quot;: BrickType.HISTOIRE_SCIENCES, &quot;count&quot;: 1, &quot;required&quot;: False},
+                    {
+                        &quot;type&quot;: BrickType.HISTOIRE_SCIENCES,
+                        &quot;count&quot;: 1,
+                        &quot;required&quot;: False,
+                    },
                     {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 2, &quot;required&quot;: True},
-                    {&quot;type&quot;: BrickType.CONSEIL_METHODE, &quot;count&quot;: 2, &quot;required&quot;: True}
+                    {&quot;type&quot;: BrickType.CONSEIL_METHODE, &quot;count&quot;: 2, &quot;required&quot;: True},
                 ],
-                &quot;estimated_duration&quot;: 90
+                &quot;estimated_duration&quot;: 90,
             },
             &quot;evaluation_diagnostique&quot;: {
                 &quot;name&quot;: &quot;√âvaluation Diagnostique&quot;,
                 &quot;structure&quot;: [
                     {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 8, &quot;required&quot;: True},
-                    {&quot;type&quot;: BrickType.CORRECTION, &quot;count&quot;: 8, &quot;required&quot;: True}
+                    {&quot;type&quot;: BrickType.CORRECTION, &quot;count&quot;: 8, &quot;required&quot;: True},
                 ],
-                &quot;estimated_duration&quot;: 120
+                &quot;estimated_duration&quot;: 120,
             },
             &quot;fiche_methode&quot;: {
                 &quot;name&quot;: &quot;Fiche M√©thode&quot;,
                 &quot;structure&quot;: [
                     {&quot;type&quot;: BrickType.DEFINITION, &quot;count&quot;: 1, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.CONSEIL_METHODE, &quot;count&quot;: 4, &quot;required&quot;: True},
                     {&quot;type&quot;: BrickType.EXEMPLE, &quot;count&quot;: 3, &quot;required&quot;: True},
-                    {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 2, &quot;required&quot;: True}
+                    {&quot;type&quot;: BrickType.EXERCICE, &quot;count&quot;: 2, &quot;required&quot;: True},
                 ],
-                &quot;estimated_duration&quot;: 30
-            }
+                &quot;estimated_duration&quot;: 30,
+            },
         }
 
     def generate_document(self, request: DocumentRequest) -&gt; GeneratedDocument:
         &quot;&quot;&quot;G√©n√®re un document personnalis√© selon la requ√™te&quot;&quot;&quot;
         start_time = datetime.now()
@@ -111,20 +121,22 @@
             title=self._generate_title(request, template),
             estimated_duration=estimated_duration,
             difficulty_level=difficulty_level,
             generated_at=datetime.now(),
             generation_time_ms=int(generation_time),
-            template_used=request.document_type
+            template_used=request.document_type,
         )
 
         # Mise √† jour des statistiques d&#x27;utilisation
         for brick in selected_bricks:
             self.content_bank.increment_usage(brick.id)
 
         return document
 
-    def _select_content_bricks(self, request: DocumentRequest, template: Dict[str, Any]) -&gt; List[ContentBrick]:
+    def _select_content_bricks(
+        self, request: DocumentRequest, template: Dict[str, Any]
+    ) -&gt; List[ContentBrick]:
         &quot;&quot;&quot;S√©lectionne les briques de contenu appropri√©es pour la requ√™te&quot;&quot;&quot;
         selected_bricks = []
 
         for brick_spec in template[&quot;structure&quot;]:
             brick_type = brick_spec[&quot;type&quot;]
@@ -138,19 +150,22 @@
                 brick_type=brick_type,
                 difficulty_min=request.difficulty_range[0],
                 difficulty_max=request.difficulty_range[1],
                 target_profile=request.student_profile,
                 learning_step=request.learning_step,
-                tags=request.specific_topics if request.specific_topics else None
+                tags=request.specific_topics if request.specific_topics else None,
             )
 
             # Filtrage des sujets √† exclure
             if request.exclude_topics:
                 candidates = [
-                    brick for brick in candidates
-                    if not any(topic.lower() in [tag.lower() for tag in brick.tags]
-                             for topic in request.exclude_topics)
+                    brick
+                    for brick in candidates
+                    if not any(
+                        topic.lower() in [tag.lower() for tag in brick.tags]
+                        for topic in request.exclude_topics
+                    )
                 ]
 
             # S√©lection intelligente
             if candidates:
                 # Tri par pertinence (rating, usage, difficult√© adapt√©e)
@@ -163,21 +178,24 @@
             elif required:
                 # Si aucune brique trouv√©e pour un type requis, on cherche plus largement
                 fallback_candidates = self.content_bank.search_bricks(
                     subject=request.subject,
                     brick_type=brick_type,
-                    target_profile=request.student_profile
+                    target_profile=request.student_profile,
                 )
                 if fallback_candidates:
                     selected_count = min(count, len(fallback_candidates))
                     selected = fallback_candidates[:selected_count]
                     selected_bricks.extend(selected)
 
         return selected_bricks
 
-    def _rank_candidates(self, candidates: List[ContentBrick], request: DocumentRequest) -&gt; List[ContentBrick]:
+    def _rank_candidates(
+        self, candidates: List[ContentBrick], request: DocumentRequest
+    ) -&gt; List[ContentBrick]:
         &quot;&quot;&quot;Classe les candidats par pertinence pour la requ√™te&quot;&quot;&quot;
+
         def calculate_score(brick: ContentBrick) -&gt; float:
             score = 0.0
 
             # Score bas√© sur la note moyenne
             score += brick.average_rating * 2
@@ -190,12 +208,15 @@
             difficulty_diff = abs(brick.difficulty - target_difficulty)
             score += max(0, 3 - difficulty_diff)  # Plus proche = meilleur score
 
             # Score bas√© sur les tags correspondants
             if request.specific_topics:
-                matching_tags = sum(1 for topic in request.specific_topics
-                                  if any(topic.lower() in tag.lower() for tag in brick.tags))
+                matching_tags = sum(
+                    1
+                    for topic in request.specific_topics
+                    if any(topic.lower() in tag.lower() for tag in brick.tags)
+                )
                 score += matching_tags * 1.5
 
             # Score bas√© sur l&#x27;√©tape d&#x27;apprentissage
             if request.learning_step in brick.learning_steps:
                 score += 2
@@ -208,12 +229,16 @@
 
         # Tri par score d√©croissant
         candidates.sort(key=calculate_score, reverse=True)
         return candidates
 
-    def _assemble_content(self, bricks: List[ContentBrick], template: Dict[str, Any],
-                         request: DocumentRequest) -&gt; Tuple[str, str]:
+    def _assemble_content(
+        self,
+        bricks: List[ContentBrick],
+        template: Dict[str, Any],
+        request: DocumentRequest,
+    ) -&gt; Tuple[str, str]:
         &quot;&quot;&quot;Assemble le contenu des briques s√©lectionn√©es&quot;&quot;&quot;
 
         # Organisation des briques par type
         bricks_by_type = {}
         for brick in bricks:
@@ -247,11 +272,11 @@
             BrickType.EXERCICE: &quot;## üìù Exercices d&#x27;Application&quot;,
             BrickType.CORRECTION: &quot;## ‚úÖ Corrections D√©taill√©es&quot;,
             BrickType.CONSEIL_METHODE: &quot;## üîß Conseils M√©thodologiques&quot;,
             BrickType.HISTOIRE_SCIENCES: &quot;## üèõÔ∏è Contexte Historique&quot;,
             BrickType.SCHEMA: &quot;## üìä Sch√©mas et Diagrammes&quot;,
-            BrickType.FORMULE: &quot;## üßÆ Formulaire&quot;
+            BrickType.FORMULE: &quot;## üßÆ Formulaire&quot;,
         }
 
         for brick_type, section_title in section_order.items():
             if brick_type in bricks_by_type:
                 content_sections.append(f&quot;\n{section_title}\n&quot;)
@@ -296,29 +321,32 @@
         html = html.replace(&quot;## &quot;, &quot;&lt;h2&gt;&quot;).replace(&quot;\n&quot;, &quot;&lt;/h2&gt;\n&quot;)
         html = html.replace(&quot;### &quot;, &quot;&lt;h3&gt;&quot;).replace(&quot;\n&quot;, &quot;&lt;/h3&gt;\n&quot;)
 
         # Conversion du gras
         import re
-        html = re.sub(r&#x27;\*\*(.*?)\*\*&#x27;, r&#x27;&lt;strong&gt;\1&lt;/strong&gt;&#x27;, html)
-        html = re.sub(r&#x27;\*(.*?)\*&#x27;, r&#x27;&lt;em&gt;\1&lt;/em&gt;&#x27;, html)
+
+        html = re.sub(r&quot;\*\*(.*?)\*\*&quot;, r&quot;&lt;strong&gt;\1&lt;/strong&gt;&quot;, html)
+        html = re.sub(r&quot;\*(.*?)\*&quot;, r&quot;&lt;em&gt;\1&lt;/em&gt;&quot;, html)
 
         # Conversion des listes
-        html = re.sub(r&#x27;^- (.*?)$&#x27;, r&#x27;&lt;li&gt;\1&lt;/li&gt;&#x27;, html, flags=re.MULTILINE)
-        html = re.sub(r&#x27;(&lt;li&gt;.*?&lt;/li&gt;)&#x27;, r&#x27;&lt;ul&gt;\1&lt;/ul&gt;&#x27;, html, flags=re.DOTALL)
+        html = re.sub(r&quot;^- (.*?)$&quot;, r&quot;&lt;li&gt;\1&lt;/li&gt;&quot;, html, flags=re.MULTILINE)
+        html = re.sub(r&quot;(&lt;li&gt;.*?&lt;/li&gt;)&quot;, r&quot;&lt;ul&gt;\1&lt;/ul&gt;&quot;, html, flags=re.DOTALL)
 
         # Conversion des paragraphes
-        paragraphs = html.split(&#x27;\n\n&#x27;)
+        paragraphs = html.split(&quot;\n\n&quot;)
         html_paragraphs = []
         for p in paragraphs:
-            if p.strip() and not p.startswith(&#x27;&lt;&#x27;):
-                html_paragraphs.append(f&#x27;&lt;p&gt;{p.strip()}&lt;/p&gt;&#x27;)
+            if p.strip() and not p.startswith(&quot;&lt;&quot;):
+                html_paragraphs.append(f&quot;&lt;p&gt;{p.strip()}&lt;/p&gt;&quot;)
             else:
                 html_paragraphs.append(p)
 
-        return &#x27;\n&#x27;.join(html_paragraphs)
-
-    def _generate_title(self, request: DocumentRequest, template: Dict[str, Any]) -&gt; str:
+        return &quot;\n&quot;.join(html_paragraphs)
+
+    def _generate_title(
+        self, request: DocumentRequest, template: Dict[str, Any]
+    ) -&gt; str:
         &quot;&quot;&quot;G√©n√®re un titre pour le document&quot;&quot;&quot;
         base_title = template[&quot;name&quot;]
         return f&quot;{base_title} - {request.chapter} ({request.subject.value.title()})&quot;
 
     def _calculate_estimated_duration(self, bricks: List[ContentBrick]) -&gt; int:
@@ -333,27 +361,32 @@
 
     def get_available_templates(self) -&gt; Dict[str, Dict[str, Any]]:
         &quot;&quot;&quot;Retourne la liste des templates disponibles&quot;&quot;&quot;
         return self.document_templates
 
-    def suggest_document_type(self, student_profile: TargetProfile,
-                            learning_step: LearningStep) -&gt; str:
+    def suggest_document_type(
+        self, student_profile: TargetProfile, learning_step: LearningStep
+    ) -&gt; str:
         &quot;&quot;&quot;Sugg√®re un type de document selon le profil et l&#x27;√©tape d&#x27;apprentissage&quot;&quot;&quot;
 
         suggestions = {
             (TargetProfile.STRUGGLING, LearningStep.DISCOVERY): &quot;cours_complet&quot;,
             (TargetProfile.STRUGGLING, LearningStep.TRAINING): &quot;fiche_methode&quot;,
             (TargetProfile.STRUGGLING, LearningStep.REVISION): &quot;fiche_revision&quot;,
-
             (TargetProfile.AVERAGE, LearningStep.DISCOVERY): &quot;cours_complet&quot;,
             (TargetProfile.AVERAGE, LearningStep.TRAINING): &quot;exercices_entrainement&quot;,
             (TargetProfile.AVERAGE, LearningStep.REVISION): &quot;fiche_revision&quot;,
             (TargetProfile.AVERAGE, LearningStep.EVALUATION): &quot;evaluation_diagnostique&quot;,
-
             (TargetProfile.EXCELLENCE, LearningStep.TRAINING): &quot;exercices_entrainement&quot;,
-            (TargetProfile.EXCELLENCE, LearningStep.DEEPENING): &quot;exercices_entrainement&quot;,
-            (TargetProfile.EXCELLENCE, LearningStep.EVALUATION): &quot;evaluation_diagnostique&quot;,
+            (
+                TargetProfile.EXCELLENCE,
+                LearningStep.DEEPENING,
+            ): &quot;exercices_entrainement&quot;,
+            (
+                TargetProfile.EXCELLENCE,
+                LearningStep.EVALUATION,
+            ): &quot;evaluation_diagnostique&quot;,
         }
 
         return suggestions.get((student_profile, learning_step), &quot;fiche_revision&quot;)
 
     def analyze_content_gaps(self, subject: Subject, chapter: str) -&gt; Dict[str, Any]:
@@ -362,26 +395,25 @@
         all_bricks = self.content_bank.search_bricks(subject=subject, chapter=chapter)
 
         # Analyse par type de brique
         type_counts = {}
         for brick_type in BrickType:
-            type_counts[brick_type.value] = len([
-                b for b in all_bricks if b.type == brick_type
-            ])
+            type_counts[brick_type.value] = len(
+                [b for b in all_bricks if b.type == brick_type]
+            )
 
         # Analyse par niveau de difficult√©
         difficulty_counts = {i: 0 for i in range(1, 6)}
         for brick in all_bricks:
             difficulty_counts[brick.difficulty] += 1
 
         # Analyse par profil cible
         profile_counts = {}
         for profile in TargetProfile:
-            profile_counts[profile.value] = len([
-                b for b in all_bricks
-                if profile in b.target_profiles
-            ])
+            profile_counts[profile.value] = len(
+                [b for b in all_bricks if profile in b.target_profiles]
+            )
 
         # Identification des lacunes
         gaps = []
 
         # Lacunes par type
@@ -398,13 +430,15 @@
             &quot;total_bricks&quot;: len(all_bricks),
             &quot;by_type&quot;: type_counts,
             &quot;by_difficulty&quot;: difficulty_counts,
             &quot;by_profile&quot;: profile_counts,
             &quot;identified_gaps&quot;: gaps,
-            &quot;coverage_score&quot;: min(100, (len(all_bricks) / 20) * 100)  # Score sur 20 briques minimum
+            &quot;coverage_score&quot;: min(
+                100, (len(all_bricks) / 20) * 100
+            ),  # Score sur 20 briques minimum
         }
 
 
 # Instance globale pour compatibilit√© avec les imports existants
 from .content_bank import ContentBankService
+
 content_engine = ContentAssemblyEngine(ContentBankService())
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/formulas.py	2025-07-24 07:24:17.021976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/formulas.py	2025-07-24 20:54:02.498559+00:00
@@ -1,38 +1,44 @@
 from ..database import db
 from datetime import datetime
 from enum import Enum
+
 
 class FormulaType(Enum):
     INDIVIDUAL = &quot;individual&quot;
     GROUP = &quot;group&quot;
     WORKSHOP = &quot;workshop&quot;
     INTENSIVE = &quot;intensive&quot;
 
+
 class FormulaLevel(Enum):
     BEGINNER = &quot;beginner&quot;
     INTERMEDIATE = &quot;intermediate&quot;
     ADVANCED = &quot;advanced&quot;
     EXPERT = &quot;expert&quot;
 
+
 class SessionFormat(Enum):
     ONLINE = &quot;online&quot;
     IN_PERSON = &quot;in_person&quot;
     HYBRID = &quot;hybrid&quot;
+
 
 class BookingStatus(Enum):
     PENDING = &quot;pending&quot;
     CONFIRMED = &quot;confirmed&quot;
     CANCELLED = &quot;cancelled&quot;
     COMPLETED = &quot;completed&quot;
 
+
 # ================================
 # MOD√àLES EXISTANTS AM√âLIOR√âS
 # ================================
 
+
 class Formula(db.Model):
-    __tablename__ = &#x27;formulas&#x27;
+    __tablename__ = &quot;formulas&quot;
 
     id = db.Column(db.Integer, primary_key=True)
     name = db.Column(db.String(100), nullable=False)
     type = db.Column(db.Enum(FormulaType), nullable=False)
     level = db.Column(db.Enum(FormulaLevel), nullable=False)
@@ -42,107 +48,134 @@
     description = db.Column(db.Text)
     features = db.Column(db.JSON)  # Liste des fonctionnalit√©s
     supports_online = db.Column(db.Boolean, default=True)
     supports_in_person = db.Column(db.Boolean, default=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
-
-    # Relations
-    enrollments = db.relationship(&#x27;Enrollment&#x27;, backref=&#x27;formula&#x27;, lazy=True)
-
-    def to_dict(self):
-        return {
-            &#x27;id&#x27;: self.id,
-            &#x27;name&#x27;: self.name,
-            &#x27;type&#x27;: self.type.value,
-            &#x27;level&#x27;: self.level.value,
-            &#x27;price_dt&#x27;: self.price_dt,
-            &#x27;hours_per_month&#x27;: self.hours_per_month,
-            &#x27;max_students&#x27;: self.max_students,
-            &#x27;description&#x27;: self.description,
-            &#x27;features&#x27;: self.features,
-            &#x27;supports_online&#x27;: self.supports_online,
-            &#x27;supports_in_person&#x27;: self.supports_in_person,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
+
+    # Relations
+    enrollments = db.relationship(&quot;Enrollment&quot;, backref=&quot;formula&quot;, lazy=True)
+
+    def to_dict(self):
+        return {
+            &quot;id&quot;: self.id,
+            &quot;name&quot;: self.name,
+            &quot;type&quot;: self.type.value,
+            &quot;level&quot;: self.level.value,
+            &quot;price_dt&quot;: self.price_dt,
+            &quot;hours_per_month&quot;: self.hours_per_month,
+            &quot;max_students&quot;: self.max_students,
+            &quot;description&quot;: self.description,
+            &quot;features&quot;: self.features,
+            &quot;supports_online&quot;: self.supports_online,
+            &quot;supports_in_person&quot;: self.supports_in_person,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 # ================================
 # NOUVEAUX MOD√àLES POUR LE SYST√àME HYBRIDE
 # ================================
+
 
 class Location(db.Model):
     &quot;&quot;&quot;Mod√®le pour les salles/lieux de cours en pr√©sentiel&quot;&quot;&quot;
-    __tablename__ = &#x27;locations&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    name = db.Column(db.String(100), nullable=False)  # Ex: &quot;Salle Alpha&quot;, &quot;Laboratoire NSI&quot;
+
+    __tablename__ = &quot;locations&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    name = db.Column(
+        db.String(100), nullable=False
+    )  # Ex: &quot;Salle Alpha&quot;, &quot;Laboratoire NSI&quot;
     capacity = db.Column(db.Integer, nullable=False, default=1)  # Nombre max d&#x27;√©l√®ves
-    address = db.Column(db.String(200), nullable=True)  # Adresse si diff√©rente du centre principal
+    address = db.Column(
+        db.String(200), nullable=True
+    )  # Adresse si diff√©rente du centre principal
     equipment = db.Column(db.JSON, nullable=True)  # √âquipements disponibles
     is_active = db.Column(db.Boolean, default=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
-
-    # Relations
-    bookings = db.relationship(&#x27;Booking&#x27;, backref=&#x27;location&#x27;, lazy=True)
-
-    def to_dict(self):
-        return {
-            &#x27;id&#x27;: self.id,
-            &#x27;name&#x27;: self.name,
-            &#x27;capacity&#x27;: self.capacity,
-            &#x27;address&#x27;: self.address,
-            &#x27;equipment&#x27;: self.equipment,
-            &#x27;is_active&#x27;: self.is_active,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
+
+    # Relations
+    bookings = db.relationship(&quot;Booking&quot;, backref=&quot;location&quot;, lazy=True)
+
+    def to_dict(self):
+        return {
+            &quot;id&quot;: self.id,
+            &quot;name&quot;: self.name,
+            &quot;capacity&quot;: self.capacity,
+            &quot;address&quot;: self.address,
+            &quot;equipment&quot;: self.equipment,
+            &quot;is_active&quot;: self.is_active,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 class Availability(db.Model):
     &quot;&quot;&quot;Mod√®le pour les disponibilit√©s des enseignants&quot;&quot;&quot;
-    __tablename__ = &#x27;availabilities&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    teacher_id = db.Column(db.Integer, db.ForeignKey(&#x27;teachers.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;availabilities&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    teacher_id = db.Column(db.Integer, db.ForeignKey(&quot;teachers.id&quot;), nullable=False)
     start_time = db.Column(db.DateTime, nullable=False)
     end_time = db.Column(db.DateTime, nullable=False)
-    is_for_in_person = db.Column(db.Boolean, nullable=False)  # True = pr√©sentiel, False = en ligne
-    is_recurring = db.Column(db.Boolean, default=False)  # Si c&#x27;est une r√©currence hebdomadaire
+    is_for_in_person = db.Column(
+        db.Boolean, nullable=False
+    )  # True = pr√©sentiel, False = en ligne
+    is_recurring = db.Column(
+        db.Boolean, default=False
+    )  # Si c&#x27;est une r√©currence hebdomadaire
     recurring_pattern = db.Column(db.JSON, nullable=True)  # Pattern de r√©currence
     is_booked = db.Column(db.Boolean, default=False)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
-
-    def to_dict(self):
-        return {
-            &#x27;id&#x27;: self.id,
-            &#x27;teacher_id&#x27;: self.teacher_id,
-            &#x27;start_time&#x27;: self.start_time.isoformat() if self.start_time else None,
-            &#x27;end_time&#x27;: self.end_time.isoformat() if self.end_time else None,
-            &#x27;is_for_in_person&#x27;: self.is_for_in_person,
-            &#x27;is_recurring&#x27;: self.is_recurring,
-            &#x27;recurring_pattern&#x27;: self.recurring_pattern,
-            &#x27;is_booked&#x27;: self.is_booked,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None
-        }
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
+
+    def to_dict(self):
+        return {
+            &quot;id&quot;: self.id,
+            &quot;teacher_id&quot;: self.teacher_id,
+            &quot;start_time&quot;: self.start_time.isoformat() if self.start_time else None,
+            &quot;end_time&quot;: self.end_time.isoformat() if self.end_time else None,
+            &quot;is_for_in_person&quot;: self.is_for_in_person,
+            &quot;is_recurring&quot;: self.is_recurring,
+            &quot;recurring_pattern&quot;: self.recurring_pattern,
+            &quot;is_booked&quot;: self.is_booked,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+        }
+
 
 class Booking(db.Model):
     &quot;&quot;&quot;Mod√®le pour les r√©servations de cours (hybrides)&quot;&quot;&quot;
-    __tablename__ = &#x27;bookings&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
-    teacher_id = db.Column(db.Integer, db.ForeignKey(&#x27;teachers.id&#x27;), nullable=False)
-    availability_id = db.Column(db.Integer, db.ForeignKey(&#x27;availabilities.id&#x27;), nullable=True)
+
+    __tablename__ = &quot;bookings&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
+    teacher_id = db.Column(db.Integer, db.ForeignKey(&quot;teachers.id&quot;), nullable=False)
+    availability_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;availabilities.id&quot;), nullable=True
+    )
 
     # Informations de la session
     start_time = db.Column(db.DateTime, nullable=False)
     end_time = db.Column(db.DateTime, nullable=False)
-    format = db.Column(db.Enum(SessionFormat), nullable=False)  # ONLINE, IN_PERSON, HYBRID
-    location_id = db.Column(db.Integer, db.ForeignKey(&#x27;locations.id&#x27;), nullable=True)  # Obligatoire si IN_PERSON
+    format = db.Column(
+        db.Enum(SessionFormat), nullable=False
+    )  # ONLINE, IN_PERSON, HYBRID
+    location_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;locations.id&quot;), nullable=True
+    )  # Obligatoire si IN_PERSON
 
     # D√©tails du cours
     subject = db.Column(db.String(50), nullable=False)
     topic = db.Column(db.String(100), nullable=True)
     description = db.Column(db.Text, nullable=True)
@@ -157,46 +190,52 @@
     meeting_url = db.Column(db.String(500), nullable=True)  # Lien Zoom/Meet
     meeting_password = db.Column(db.String(50), nullable=True)
 
     # M√©tadonn√©es
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
-    created_by = db.Column(db.String(50), default=&#x27;student&#x27;)  # student, teacher, admin
-
-    # Relations
-    session_report = db.relationship(&#x27;SessionReport&#x27;, backref=&#x27;booking&#x27;, uselist=False, lazy=True)
-
-    def to_dict(self):
-        return {
-            &#x27;id&#x27;: self.id,
-            &#x27;student_id&#x27;: self.student_id,
-            &#x27;teacher_id&#x27;: self.teacher_id,
-            &#x27;availability_id&#x27;: self.availability_id,
-            &#x27;start_time&#x27;: self.start_time.isoformat() if self.start_time else None,
-            &#x27;end_time&#x27;: self.end_time.isoformat() if self.end_time else None,
-            &#x27;format&#x27;: self.format.value,
-            &#x27;location_id&#x27;: self.location_id,
-            &#x27;subject&#x27;: self.subject,
-            &#x27;topic&#x27;: self.topic,
-            &#x27;description&#x27;: self.description,
-            &#x27;duration_minutes&#x27;: self.duration_minutes,
-            &#x27;status&#x27;: self.status.value,
-            &#x27;booking_notes&#x27;: self.booking_notes,
-            &#x27;cancellation_reason&#x27;: self.cancellation_reason,
-            &#x27;meeting_url&#x27;: self.meeting_url,
-            &#x27;meeting_password&#x27;: self.meeting_password,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;updated_at&#x27;: self.updated_at.isoformat() if self.updated_at else None,
-            &#x27;created_by&#x27;: self.created_by
-        }
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
+    created_by = db.Column(db.String(50), default=&quot;student&quot;)  # student, teacher, admin
+
+    # Relations
+    session_report = db.relationship(
+        &quot;SessionReport&quot;, backref=&quot;booking&quot;, uselist=False, lazy=True
+    )
+
+    def to_dict(self):
+        return {
+            &quot;id&quot;: self.id,
+            &quot;student_id&quot;: self.student_id,
+            &quot;teacher_id&quot;: self.teacher_id,
+            &quot;availability_id&quot;: self.availability_id,
+            &quot;start_time&quot;: self.start_time.isoformat() if self.start_time else None,
+            &quot;end_time&quot;: self.end_time.isoformat() if self.end_time else None,
+            &quot;format&quot;: self.format.value,
+            &quot;location_id&quot;: self.location_id,
+            &quot;subject&quot;: self.subject,
+            &quot;topic&quot;: self.topic,
+            &quot;description&quot;: self.description,
+            &quot;duration_minutes&quot;: self.duration_minutes,
+            &quot;status&quot;: self.status.value,
+            &quot;booking_notes&quot;: self.booking_notes,
+            &quot;cancellation_reason&quot;: self.cancellation_reason,
+            &quot;meeting_url&quot;: self.meeting_url,
+            &quot;meeting_password&quot;: self.meeting_password,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;updated_at&quot;: self.updated_at.isoformat() if self.updated_at else None,
+            &quot;created_by&quot;: self.created_by,
+        }
+
 
 class SessionReport(db.Model):
     &quot;&quot;&quot;Rapport de session apr√®s un cours&quot;&quot;&quot;
-    __tablename__ = &#x27;session_reports&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    booking_id = db.Column(db.Integer, db.ForeignKey(&#x27;bookings.id&#x27;), nullable=False)
+
+    __tablename__ = &quot;session_reports&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    booking_id = db.Column(db.Integer, db.ForeignKey(&quot;bookings.id&quot;), nullable=False)
 
     # Contenu du rapport
     topics_covered = db.Column(db.JSON)  # Liste des sujets abord√©s
     student_performance = db.Column(db.Integer)  # Note sur 20
     participation_level = db.Column(db.String(20))  # high, medium, low
@@ -208,53 +247,58 @@
     next_session_recommendations = db.Column(db.Text)
     parent_feedback_requested = db.Column(db.Boolean, default=False)
 
     # M√©tadonn√©es
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    teacher_id = db.Column(db.Integer, db.ForeignKey(&#x27;teachers.id&#x27;), nullable=False)
-
-    def to_dict(self):
-        return {
-            &#x27;id&#x27;: self.id,
-            &#x27;booking_id&#x27;: self.booking_id,
-            &#x27;topics_covered&#x27;: self.topics_covered,
-            &#x27;student_performance&#x27;: self.student_performance,
-            &#x27;participation_level&#x27;: self.participation_level,
-            &#x27;comprehension_level&#x27;: self.comprehension_level,
-            &#x27;teacher_notes&#x27;: self.teacher_notes,
-            &#x27;homework_assigned&#x27;: self.homework_assigned,
-            &#x27;next_session_recommendations&#x27;: self.next_session_recommendations,
-            &#x27;parent_feedback_requested&#x27;: self.parent_feedback_requested,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None,
-            &#x27;teacher_id&#x27;: self.teacher_id
-        }
+    teacher_id = db.Column(db.Integer, db.ForeignKey(&quot;teachers.id&quot;), nullable=False)
+
+    def to_dict(self):
+        return {
+            &quot;id&quot;: self.id,
+            &quot;booking_id&quot;: self.booking_id,
+            &quot;topics_covered&quot;: self.topics_covered,
+            &quot;student_performance&quot;: self.student_performance,
+            &quot;participation_level&quot;: self.participation_level,
+            &quot;comprehension_level&quot;: self.comprehension_level,
+            &quot;teacher_notes&quot;: self.teacher_notes,
+            &quot;homework_assigned&quot;: self.homework_assigned,
+            &quot;next_session_recommendations&quot;: self.next_session_recommendations,
+            &quot;parent_feedback_requested&quot;: self.parent_feedback_requested,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+            &quot;teacher_id&quot;: self.teacher_id,
+        }
+
 
 # ================================
 # MOD√àLES EXISTANTS (inchang√©s mais ajout des relations)
 # ================================
 
+
 class Group(db.Model):
-    __tablename__ = &#x27;groups&#x27;
+    __tablename__ = &quot;groups&quot;
 
     id = db.Column(db.Integer, primary_key=True)
     name = db.Column(db.String(100), nullable=False)
     subject = db.Column(db.String(50), nullable=False)
     level = db.Column(db.String(50), nullable=False)  # Seconde, Premi√®re, Terminale
     max_students = db.Column(db.Integer, default=6)
     current_students = db.Column(db.Integer, default=0)
-    teacher_id = db.Column(db.Integer, db.ForeignKey(&#x27;teachers.id&#x27;), nullable=False)
-    default_location_id = db.Column(db.Integer, db.ForeignKey(&#x27;locations.id&#x27;), nullable=True)
+    teacher_id = db.Column(db.Integer, db.ForeignKey(&quot;teachers.id&quot;), nullable=False)
+    default_location_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;locations.id&quot;), nullable=True
+    )
     supports_online = db.Column(db.Boolean, default=True)
     schedule = db.Column(db.JSON)  # Horaires des cours
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     # Relations
-    enrollments = db.relationship(&#x27;Enrollment&#x27;, backref=&#x27;group&#x27;, lazy=True)
-    sessions = db.relationship(&#x27;GroupSession&#x27;, backref=&#x27;group&#x27;, lazy=True)
+    enrollments = db.relationship(&quot;Enrollment&quot;, backref=&quot;group&quot;, lazy=True)
+    sessions = db.relationship(&quot;GroupSession&quot;, backref=&quot;group&quot;, lazy=True)
+
 
 class Teacher(db.Model):
-    __tablename__ = &#x27;teachers&#x27;
+    __tablename__ = &quot;teachers&quot;
 
     id = db.Column(db.Integer, primary_key=True)
     first_name = db.Column(db.String(50), nullable=False)
     last_name = db.Column(db.String(50), nullable=False)
     email = db.Column(db.String(120), unique=True, nullable=False)
@@ -269,140 +313,154 @@
     hourly_rate_online = db.Column(db.Float, nullable=True)
     hourly_rate_in_person = db.Column(db.Float, nullable=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     # Relations
-    groups = db.relationship(&#x27;Group&#x27;, backref=&#x27;teacher&#x27;, lazy=True)
-    individual_sessions = db.relationship(&#x27;IndividualSession&#x27;, backref=&#x27;teacher&#x27;, lazy=True)
-    availabilities = db.relationship(&#x27;Availability&#x27;, backref=&#x27;teacher&#x27;, lazy=True)
-    bookings = db.relationship(&#x27;Booking&#x27;, backref=&#x27;teacher&#x27;, lazy=True)
-    session_reports = db.relationship(&#x27;SessionReport&#x27;, backref=&#x27;teacher&#x27;, lazy=True)
-
-    def to_dict(self):
-        return {
-            &#x27;id&#x27;: self.id,
-            &#x27;first_name&#x27;: self.first_name,
-            &#x27;last_name&#x27;: self.last_name,
-            &#x27;full_name&#x27;: f&quot;{self.first_name} {self.last_name}&quot;,
-            &#x27;email&#x27;: self.email,
-            &#x27;phone&#x27;: self.phone,
-            &#x27;subjects&#x27;: self.subjects,
-            &#x27;qualifications&#x27;: self.qualifications,
-            &#x27;experience_years&#x27;: self.experience_years,
-            &#x27;is_aefe_certified&#x27;: self.is_aefe_certified,
-            &#x27;is_nsi_diu&#x27;: self.is_nsi_diu,
-            &#x27;can_teach_online&#x27;: self.can_teach_online,
-            &#x27;can_teach_in_person&#x27;: self.can_teach_in_person,
-            &#x27;hourly_rate_online&#x27;: self.hourly_rate_online,
-            &#x27;hourly_rate_in_person&#x27;: self.hourly_rate_in_person,
-            &#x27;created_at&#x27;: self.created_at.isoformat() if self.created_at else None
-        }
+    groups = db.relationship(&quot;Group&quot;, backref=&quot;teacher&quot;, lazy=True)
+    individual_sessions = db.relationship(
+        &quot;IndividualSession&quot;, backref=&quot;teacher&quot;, lazy=True
+    )
+    availabilities = db.relationship(&quot;Availability&quot;, backref=&quot;teacher&quot;, lazy=True)
+    bookings = db.relationship(&quot;Booking&quot;, backref=&quot;teacher&quot;, lazy=True)
+    session_reports = db.relationship(&quot;SessionReport&quot;, backref=&quot;teacher&quot;, lazy=True)
+
+    def to_dict(self):
+        return {
+            &quot;id&quot;: self.id,
+            &quot;first_name&quot;: self.first_name,
+            &quot;last_name&quot;: self.last_name,
+            &quot;full_name&quot;: f&quot;{self.first_name} {self.last_name}&quot;,
+            &quot;email&quot;: self.email,
+            &quot;phone&quot;: self.phone,
+            &quot;subjects&quot;: self.subjects,
+            &quot;qualifications&quot;: self.qualifications,
+            &quot;experience_years&quot;: self.experience_years,
+            &quot;is_aefe_certified&quot;: self.is_aefe_certified,
+            &quot;is_nsi_diu&quot;: self.is_nsi_diu,
+            &quot;can_teach_online&quot;: self.can_teach_online,
+            &quot;can_teach_in_person&quot;: self.can_teach_in_person,
+            &quot;hourly_rate_online&quot;: self.hourly_rate_online,
+            &quot;hourly_rate_in_person&quot;: self.hourly_rate_in_person,
+            &quot;created_at&quot;: self.created_at.isoformat() if self.created_at else None,
+        }
+
 
 class Enrollment(db.Model):
-    __tablename__ = &#x27;enrollments&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
-    formula_id = db.Column(db.Integer, db.ForeignKey(&#x27;formulas.id&#x27;), nullable=False)
-    group_id = db.Column(db.Integer, db.ForeignKey(&#x27;groups.id&#x27;), nullable=True)
-    teacher_id = db.Column(db.Integer, db.ForeignKey(&#x27;teachers.id&#x27;), nullable=True)
+    __tablename__ = &quot;enrollments&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
+    formula_id = db.Column(db.Integer, db.ForeignKey(&quot;formulas.id&quot;), nullable=False)
+    group_id = db.Column(db.Integer, db.ForeignKey(&quot;groups.id&quot;), nullable=True)
+    teacher_id = db.Column(db.Integer, db.ForeignKey(&quot;teachers.id&quot;), nullable=True)
     start_date = db.Column(db.Date, nullable=False)
     end_date = db.Column(db.Date, nullable=True)
     is_active = db.Column(db.Boolean, default=True)
     preferred_format = db.Column(db.Enum(SessionFormat), default=SessionFormat.HYBRID)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
+
 class IndividualSession(db.Model):
-    __tablename__ = &#x27;individual_sessions&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
-    teacher_id = db.Column(db.Integer, db.ForeignKey(&#x27;teachers.id&#x27;), nullable=False)
+    __tablename__ = &quot;individual_sessions&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
+    teacher_id = db.Column(db.Integer, db.ForeignKey(&quot;teachers.id&quot;), nullable=False)
     subject = db.Column(db.String(50), nullable=False)
     scheduled_at = db.Column(db.DateTime, nullable=False)
     duration_minutes = db.Column(db.Integer, default=60)
     format = db.Column(db.Enum(SessionFormat), default=SessionFormat.ONLINE)
-    location_id = db.Column(db.Integer, db.ForeignKey(&#x27;locations.id&#x27;), nullable=True)
-    status = db.Column(db.String(20), default=&#x27;scheduled&#x27;)  # scheduled, completed, cancelled
+    location_id = db.Column(db.Integer, db.ForeignKey(&quot;locations.id&quot;), nullable=True)
+    status = db.Column(
+        db.String(20), default=&quot;scheduled&quot;
+    )  # scheduled, completed, cancelled
     topics_covered = db.Column(db.JSON)
     homework_assigned = db.Column(db.Text)
     teacher_notes = db.Column(db.Text)
     student_performance = db.Column(db.Integer)  # Note sur 20
     meeting_url = db.Column(db.String(500), nullable=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
+
 class GroupSession(db.Model):
-    __tablename__ = &#x27;group_sessions&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    group_id = db.Column(db.Integer, db.ForeignKey(&#x27;groups.id&#x27;), nullable=False)
+    __tablename__ = &quot;group_sessions&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    group_id = db.Column(db.Integer, db.ForeignKey(&quot;groups.id&quot;), nullable=False)
     subject = db.Column(db.String(50), nullable=False)
     scheduled_at = db.Column(db.DateTime, nullable=False)
     duration_minutes = db.Column(db.Integer, default=90)
     format = db.Column(db.Enum(SessionFormat), default=SessionFormat.IN_PERSON)
-    location_id = db.Column(db.Integer, db.ForeignKey(&#x27;locations.id&#x27;), nullable=True)
-    status = db.Column(db.String(20), default=&#x27;scheduled&#x27;)
+    location_id = db.Column(db.Integer, db.ForeignKey(&quot;locations.id&quot;), nullable=True)
+    status = db.Column(db.String(20), default=&quot;scheduled&quot;)
     topics_covered = db.Column(db.JSON)
     homework_assigned = db.Column(db.Text)
     teacher_notes = db.Column(db.Text)
     meeting_url = db.Column(db.String(500), nullable=True)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
     # Relations
-    attendances = db.relationship(&#x27;SessionAttendance&#x27;, backref=&#x27;session&#x27;, lazy=True)
+    attendances = db.relationship(&quot;SessionAttendance&quot;, backref=&quot;session&quot;, lazy=True)
+
 
 class SessionAttendance(db.Model):
-    __tablename__ = &#x27;session_attendances&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    session_id = db.Column(db.Integer, db.ForeignKey(&#x27;group_sessions.id&#x27;), nullable=False)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+    __tablename__ = &quot;session_attendances&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    session_id = db.Column(
+        db.Integer, db.ForeignKey(&quot;group_sessions.id&quot;), nullable=False
+    )
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
     is_present = db.Column(db.Boolean, default=True)
     participation_score = db.Column(db.Integer)  # Note de participation sur 20
     individual_notes = db.Column(db.Text)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
+
 class WeeklyReport(db.Model):
-    __tablename__ = &#x27;weekly_reports&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+    __tablename__ = &quot;weekly_reports&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
     week_start_date = db.Column(db.Date, nullable=False)
     week_end_date = db.Column(db.Date, nullable=False)
     subjects_progress = db.Column(db.JSON)  # Progression par mati√®re
     aria_insights = db.Column(db.Text)
     teacher_comments = db.Column(db.JSON)  # Commentaires par enseignant
     next_week_objectives = db.Column(db.JSON)
     parent_feedback = db.Column(db.Text)
     is_sent_to_parents = db.Column(db.Boolean, default=False)
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
 
+
 class ParentCommunication(db.Model):
-    __tablename__ = &#x27;parent_communications&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+    __tablename__ = &quot;parent_communications&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
     sender_type = db.Column(db.String(20), nullable=False)  # teacher, parent, admin
     sender_id = db.Column(db.Integer, nullable=False)
     recipient_type = db.Column(db.String(20), nullable=False)
     recipient_id = db.Column(db.Integer, nullable=False)
     subject = db.Column(db.String(200), nullable=False)
     message = db.Column(db.Text, nullable=False)
     is_read = db.Column(db.Boolean, default=False)
-    priority = db.Column(db.String(10), default=&#x27;normal&#x27;)  # low, normal, high, urgent
-    created_at = db.Column(db.DateTime, default=datetime.utcnow)
+    priority = db.Column(db.String(10), default=&quot;normal&quot;)  # low, normal, high, urgent
+    created_at = db.Column(db.DateTime, default=datetime.utcnow)
+
 
 class StudentObjective(db.Model):
-    __tablename__ = &#x27;student_objectives&#x27;
-
-    id = db.Column(db.Integer, primary_key=True)
-    student_id = db.Column(db.Integer, db.ForeignKey(&#x27;students.id&#x27;), nullable=False)
+    __tablename__ = &quot;student_objectives&quot;
+
+    id = db.Column(db.Integer, primary_key=True)
+    student_id = db.Column(db.Integer, db.ForeignKey(&quot;students.id&quot;), nullable=False)
     subject = db.Column(db.String(50), nullable=False)
     objective_text = db.Column(db.Text, nullable=False)
     target_date = db.Column(db.Date, nullable=False)
     is_achieved = db.Column(db.Boolean, default=False)
     achievement_date = db.Column(db.Date, nullable=True)
     progress_percentage = db.Column(db.Integer, default=0)
     created_by = db.Column(db.String(50), nullable=False)  # teacher, aria, parent
     created_at = db.Column(db.DateTime, default=datetime.utcnow)
-    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
-
+    updated_at = db.Column(
+        db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow
+    )
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/aria_ai.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/aria_ai.py	2025-07-24 20:54:02.509055+00:00
@@ -11,106 +11,165 @@
 from typing import Any, Dict, List
 
 # Configuration du logging
 logger = logging.getLogger(__name__)
 
+
 class ARIAService:
     &quot;&quot;&quot;
     Service IA ARIA - Assistant d&#x27;Apprentissage Adaptatif
     Intelligence artificielle qui s&#x27;adapte au profil cognitif de chaque √©l√®ve
     Fonctionne avec ou sans API OpenAI
     &quot;&quot;&quot;
 
     def __init__(self):
         self.client = None
-        self.api_key = os.getenv(&#x27;OPENAI_API_KEY&#x27;)
+        self.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)
         self.has_openai = False
 
         # Configuration des styles et niveaux
-        self.learning_styles = [&#x27;visual&#x27;, &#x27;auditory&#x27;, &#x27;kinesthetic&#x27;, &#x27;reading_writing&#x27;]
-        self.difficulty_levels = [&#x27;beginner&#x27;, &#x27;intermediate&#x27;, &#x27;advanced&#x27;, &#x27;expert&#x27;]
+        self.learning_styles = [&quot;visual&quot;, &quot;auditory&quot;, &quot;kinesthetic&quot;, &quot;reading_writing&quot;]
+        self.difficulty_levels = [&quot;beginner&quot;, &quot;intermediate&quot;, &quot;advanced&quot;, &quot;expert&quot;]
 
         # Base de connaissances par mati√®re
         self.subjects = {
-            &#x27;mathematiques&#x27;: [&#x27;alg√®bre&#x27;, &#x27;g√©om√©trie&#x27;, &#x27;analyse&#x27;, &#x27;probabilit√©s&#x27;,
-                              &#x27;statistiques&#x27;],
-            &#x27;physique&#x27;: [&#x27;m√©canique&#x27;, &#x27;thermodynamique&#x27;, &#x27;√©lectricit√©&#x27;, &#x27;optique&#x27;,
-                         &#x27;physique_moderne&#x27;],
-            &#x27;chimie&#x27;: [&#x27;chimie_organique&#x27;, &#x27;chimie_inorganique&#x27;, &#x27;thermochimie&#x27;,
-                       &#x27;cin√©tique&#x27;],
-            &#x27;francais&#x27;: [&#x27;litt√©rature&#x27;, &#x27;grammaire&#x27;, &#x27;expression_√©crite&#x27;,
-                         &#x27;analyse_texte&#x27;],
-            &#x27;nsi&#x27;: [&#x27;algorithmique&#x27;, &#x27;programmation&#x27;, &#x27;bases_donn√©es&#x27;, &#x27;r√©seaux&#x27;,
-                    &#x27;architecture&#x27;],
-            &#x27;philosophie&#x27;: [&#x27;m√©taphysique&#x27;, &#x27;√©pist√©mologie&#x27;, &#x27;√©thique&#x27;, &#x27;politique&#x27;,
-                            &#x27;esth√©tique&#x27;]
+            &quot;mathematiques&quot;: [
+                &quot;alg√®bre&quot;,
+                &quot;g√©om√©trie&quot;,
+                &quot;analyse&quot;,
+                &quot;probabilit√©s&quot;,
+                &quot;statistiques&quot;,
+            ],
+            &quot;physique&quot;: [
+                &quot;m√©canique&quot;,
+                &quot;thermodynamique&quot;,
+                &quot;√©lectricit√©&quot;,
+                &quot;optique&quot;,
+                &quot;physique_moderne&quot;,
+            ],
+            &quot;chimie&quot;: [
+                &quot;chimie_organique&quot;,
+                &quot;chimie_inorganique&quot;,
+                &quot;thermochimie&quot;,
+                &quot;cin√©tique&quot;,
+            ],
+            &quot;francais&quot;: [
+                &quot;litt√©rature&quot;,
+                &quot;grammaire&quot;,
+                &quot;expression_√©crite&quot;,
+                &quot;analyse_texte&quot;,
+            ],
+            &quot;nsi&quot;: [
+                &quot;algorithmique&quot;,
+                &quot;programmation&quot;,
+                &quot;bases_donn√©es&quot;,
+                &quot;r√©seaux&quot;,
+                &quot;architecture&quot;,
+            ],
+            &quot;philosophie&quot;: [
+                &quot;m√©taphysique&quot;,
+                &quot;√©pist√©mologie&quot;,
+                &quot;√©thique&quot;,
+                &quot;politique&quot;,
+                &quot;esth√©tique&quot;,
+            ],
         }
 
         # Templates de r√©ponses pour fallback
         self.response_templates = {
-            &#x27;greeting&#x27;: [
-                (&quot;Bonjour ! Je suis ARIA, votre assistant IA personnel de Nexus &quot;
-                 &quot;R√©ussite. Comment puis-je vous aider aujourd&#x27;hui ?&quot;),
-                (&quot;Salut ! Pr√™t(e) √† apprendre ensemble ? Je suis l√† pour vous &quot;
-                 &quot;accompagner dans votre parcours d&#x27;excellence.&quot;),
-                (&quot;Bienvenue ! Je suis ARIA, votre coach IA adaptatif. Que &quot;
-                 &quot;souhaitez-vous √©tudier aujourd&#x27;hui ?&quot;)
-            ],
-            &#x27;math&#x27;: [
-                (&quot;Les math√©matiques sont passionnantes ! Avec votre style &quot;
-                 &quot;d&#x27;apprentissage, nous allons d√©composer le probl√®me √©tape par &quot;
-                 &quot;√©tape.&quot;),
-                (&quot;Excellente question en math√©matiques ! Je vais adapter mon &quot;
-                 &quot;explication √† votre profil d&#x27;apprentissage.&quot;),
-                (&quot;Les maths deviennent plus faciles quand on utilise la bonne &quot;
-                 &quot;m√©thode. Laissez-moi vous guider !&quot;)
-            ],
-            &#x27;study_tips&#x27;: [
-                (&quot;Pour am√©liorer vos notes, je recommande une approche &quot;
-                 &quot;personnalis√©e bas√©e sur votre style d&#x27;apprentissage.&quot;),
-                (&quot;Voici mes conseils adapt√©s √† votre profil : planification, &quot;
-                 &quot;r√©visions actives et pratique r√©guli√®re.&quot;),
-                (&quot;L&#x27;excellence vient de la r√©gularit√© et de la m√©thode. Cr√©ons &quot;
-                 &quot;ensemble votre plan d&#x27;√©tude personnalis√© !&quot;)
-            ],
-            &#x27;bac_prep&#x27;: [
-                (&quot;La pr√©paration au bac n√©cessite une strat√©gie bien d√©finie. Je &quot;
-                 &quot;vais vous aider √† cr√©er un plan d&#x27;√©tude optimal.&quot;),
-                (&quot;Pour r√©ussir votre bac, nous allons travailler sur vos points &quot;
-                 &quot;forts et renforcer vos faiblesses.&quot;),
-                (&quot;Le bac se pr√©pare m√©thodiquement. Analysons ensemble vos &quot;
-                 &quot;besoins et cr√©ons votre feuille de route !&quot;)
-            ],
-            &#x27;default&#x27;: [
-                (&quot;C&#x27;est une excellente question ! Adaptons notre approche √† votre &quot;
-                 &quot;style d&#x27;apprentissage.&quot;),
-                (&quot;Je vais vous aider avec une m√©thode personnalis√©e selon votre &quot;
-                 &quot;profil cognitif.&quot;),
-                (&quot;Int√©ressant ! Laissez-moi vous proposer une approche adapt√©e √† &quot;
-                 &quot;vos besoins sp√©cifiques.&quot;)
-            ]
+            &quot;greeting&quot;: [
+                (
+                    &quot;Bonjour ! Je suis ARIA, votre assistant IA personnel de Nexus &quot;
+                    &quot;R√©ussite. Comment puis-je vous aider aujourd&#x27;hui ?&quot;
+                ),
+                (
+                    &quot;Salut ! Pr√™t(e) √† apprendre ensemble ? Je suis l√† pour vous &quot;
+                    &quot;accompagner dans votre parcours d&#x27;excellence.&quot;
+                ),
+                (
+                    &quot;Bienvenue ! Je suis ARIA, votre coach IA adaptatif. Que &quot;
+                    &quot;souhaitez-vous √©tudier aujourd&#x27;hui ?&quot;
+                ),
+            ],
+            &quot;math&quot;: [
+                (
+                    &quot;Les math√©matiques sont passionnantes ! Avec votre style &quot;
+                    &quot;d&#x27;apprentissage, nous allons d√©composer le probl√®me √©tape par &quot;
+                    &quot;√©tape.&quot;
+                ),
+                (
+                    &quot;Excellente question en math√©matiques ! Je vais adapter mon &quot;
+                    &quot;explication √† votre profil d&#x27;apprentissage.&quot;
+                ),
+                (
+                    &quot;Les maths deviennent plus faciles quand on utilise la bonne &quot;
+                    &quot;m√©thode. Laissez-moi vous guider !&quot;
+                ),
+            ],
+            &quot;study_tips&quot;: [
+                (
+                    &quot;Pour am√©liorer vos notes, je recommande une approche &quot;
+                    &quot;personnalis√©e bas√©e sur votre style d&#x27;apprentissage.&quot;
+                ),
+                (
+                    &quot;Voici mes conseils adapt√©s √† votre profil : planification, &quot;
+                    &quot;r√©visions actives et pratique r√©guli√®re.&quot;
+                ),
+                (
+                    &quot;L&#x27;excellence vient de la r√©gularit√© et de la m√©thode. Cr√©ons &quot;
+                    &quot;ensemble votre plan d&#x27;√©tude personnalis√© !&quot;
+                ),
+            ],
+            &quot;bac_prep&quot;: [
+                (
+                    &quot;La pr√©paration au bac n√©cessite une strat√©gie bien d√©finie. Je &quot;
+                    &quot;vais vous aider √† cr√©er un plan d&#x27;√©tude optimal.&quot;
+                ),
+                (
+                    &quot;Pour r√©ussir votre bac, nous allons travailler sur vos points &quot;
+                    &quot;forts et renforcer vos faiblesses.&quot;
+                ),
+                (
+                    &quot;Le bac se pr√©pare m√©thodiquement. Analysons ensemble vos &quot;
+                    &quot;besoins et cr√©ons votre feuille de route !&quot;
+                ),
+            ],
+            &quot;default&quot;: [
+                (
+                    &quot;C&#x27;est une excellente question ! Adaptons notre approche √† votre &quot;
+                    &quot;style d&#x27;apprentissage.&quot;
+                ),
+                (
+                    &quot;Je vais vous aider avec une m√©thode personnalis√©e selon votre &quot;
+                    &quot;profil cognitif.&quot;
+                ),
+                (
+                    &quot;Int√©ressant ! Laissez-moi vous proposer une approche adapt√©e √† &quot;
+                    &quot;vos besoins sp√©cifiques.&quot;
+                ),
+            ],
         }
 
         # Initialisation du client OpenAI si possible
         self._initialize_openai()
 
     def _initialize_openai(self):
         &quot;&quot;&quot;Initialise le client OpenAI si la cl√© API est disponible&quot;&quot;&quot;
         # pylint: disable=import-outside-toplevel,reimported,redefined-outer-name
         try:
-            if self.api_key and self.api_key.startswith(&#x27;sk-&#x27;):
+            if self.api_key and self.api_key.startswith(&quot;sk-&quot;):
                 from openai import OpenAI
+
                 self.client = OpenAI(api_key=self.api_key)
                 self.has_openai = True
                 logger.info(&quot;Service ARIA initialis√© avec OpenAI API&quot;)
             else:
                 # Ne pas afficher d&#x27;avertissement en mode test
                 import os
-                if os.environ.get(&#x27;FLASK_ENV&#x27;) != &#x27;testing&#x27;:
-                    logger.warning(
-                        &quot;Cl√© OpenAI non configur√©e - Mode simulation activ√©&quot;
-                    )
+
+                if os.environ.get(&quot;FLASK_ENV&quot;) != &quot;testing&quot;:
+                    logger.warning(&quot;Cl√© OpenAI non configur√©e - Mode simulation activ√©&quot;)
                 self.has_openai = False
         except ImportError:
             logger.error(&quot;Package openai non install√© - Mode simulation activ√©&quot;)
             self.has_openai = False
         except Exception as exc:  # pylint: disable=broad-exception-caught
@@ -121,59 +180,70 @@
 
     def detect_message_type(self, message: str) -&gt; str:
         &quot;&quot;&quot;D√©tecte le type de message pour choisir la r√©ponse appropri√©e&quot;&quot;&quot;
         message_lower = message.lower()
 
-        if any(word in message_lower
-               for word in [&#x27;bonjour&#x27;, &#x27;salut&#x27;, &#x27;hello&#x27;, &#x27;bonsoir&#x27;]):
-            return &#x27;greeting&#x27;
-        if any(word in message_lower
-               for word in [&#x27;math√©matiques&#x27;, &#x27;maths&#x27;, &#x27;calcul&#x27;,
-                            &#x27;√©quation&#x27;, &#x27;fonction&#x27;]):
-            return &#x27;math&#x27;
-        if any(word in message_lower for word in [&#x27;am√©liorer&#x27;, &#x27;notes&#x27;, &#x27;r√©sultats&#x27;, &#x27;conseils&#x27;]):
-            return &#x27;study_tips&#x27;
-        if any(word in message_lower for word in [&#x27;bac&#x27;, &#x27;baccalaur√©at&#x27;, &#x27;examen&#x27;, &#x27;pr√©parer&#x27;]):
-            return &#x27;bac_prep&#x27;
-        return &#x27;default&#x27;
+        if any(
+            word in message_lower for word in [&quot;bonjour&quot;, &quot;salut&quot;, &quot;hello&quot;, &quot;bonsoir&quot;]
+        ):
+            return &quot;greeting&quot;
+        if any(
+            word in message_lower
+            for word in [&quot;math√©matiques&quot;, &quot;maths&quot;, &quot;calcul&quot;, &quot;√©quation&quot;, &quot;fonction&quot;]
+        ):
+            return &quot;math&quot;
+        if any(
+            word in message_lower
+            for word in [&quot;am√©liorer&quot;, &quot;notes&quot;, &quot;r√©sultats&quot;, &quot;conseils&quot;]
+        ):
+            return &quot;study_tips&quot;
+        if any(
+            word in message_lower
+            for word in [&quot;bac&quot;, &quot;baccalaur√©at&quot;, &quot;examen&quot;, &quot;pr√©parer&quot;]
+        ):
+            return &quot;bac_prep&quot;
+        return &quot;default&quot;
 
     def generate_response(
         self,
         message: str,
         student_profile: Dict,
         context: str = &quot;&quot;,
-        relevant_documents: List = None
+        relevant_documents: List = None,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re une r√©ponse ARIA avec OpenAI ou fallback&quot;&quot;&quot;
 
         if self.has_openai:
-            return self._generate_openai_response(message, student_profile, context,
-                                                  relevant_documents)
+            return self._generate_openai_response(
+                message, student_profile, context, relevant_documents
+            )
         return self._generate_fallback_response(message, student_profile, context)
 
     def _generate_openai_response(
         self,
         message: str,
         student_profile: Dict,
         context: str,
-        relevant_documents: List
+        relevant_documents: List,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re une r√©ponse avec OpenAI API&quot;&quot;&quot;
         try:
             # Construction du prompt personnalis√©
             system_prompt = self._build_system_prompt(student_profile)
-            user_message = self._build_user_message(message, context, relevant_documents)
+            user_message = self._build_user_message(
+                message, context, relevant_documents
+            )
 
             response = self.client.chat.completions.create(
                 model=&quot;gpt-4o-mini&quot;,  # Mod√®le plus √©conomique
                 messages=[
                     {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_prompt},
-                    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_message}
+                    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_message},
                 ],
                 temperature=0.7,
                 max_tokens=1000,
-                top_p=0.9
+                top_p=0.9,
             )
 
             aria_response = response.choices[0].message.content
 
             return {
@@ -185,132 +255,148 @@
                 &quot;personalized&quot;: True,
                 &quot;source&quot;: &quot;openai&quot;,
                 &quot;token_usage&quot;: {
                     &quot;prompt_tokens&quot;: response.usage.prompt_tokens,
                     &quot;completion_tokens&quot;: response.usage.completion_tokens,
-                    &quot;total_tokens&quot;: response.usage.total_tokens
-                }
+                    &quot;total_tokens&quot;: response.usage.total_tokens,
+                },
             }
 
         except Exception as exc:  # pylint: disable=broad-exception-caught
             logger.error(&quot;Erreur OpenAI API: %s&quot;, exc)
             return self._generate_fallback_response(message, student_profile, context)
 
     def _generate_fallback_response(
         self,
         message: str,
         student_profile: Dict,
-        context: str  # pylint: disable=unused-argument
+        context: str,  # pylint: disable=unused-argument
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re une r√©ponse de fallback sans OpenAI&quot;&quot;&quot;
 
         message_type = self.detect_message_type(message)
-        responses = self.response_templates.get(message_type,
-                                                self.response_templates[&#x27;default&#x27;])
+        responses = self.response_templates.get(
+            message_type, self.response_templates[&quot;default&quot;]
+        )
         response_text = random.choice(responses)
 
         # Personnalisation selon le profil (style d&#x27;apprentissage non utilis√© actuellement)
-        _ = student_profile.get(&#x27;learning_style&#x27;, &#x27;adaptatif&#x27;)  # pylint: disable=unused-variable
+        _ = student_profile.get(
+            &quot;learning_style&quot;, &quot;adaptatif&quot;
+        )  # pylint: disable=unused-variable
 
         return {
             &quot;response&quot;: response_text,
             &quot;badges&quot;: self._generate_badges(student_profile, message),
             &quot;confidence_score&quot;: random.uniform(0.85, 0.95),
             &quot;processing_time_ms&quot;: random.randint(150, 800),
             &quot;message_type&quot;: message_type,
             &quot;personalized&quot;: True,
-            &quot;source&quot;: &quot;fallback&quot;
+            &quot;source&quot;: &quot;fallback&quot;,
         }
 
     def _build_system_prompt(self, student_profile: Dict) -&gt; str:
         &quot;&quot;&quot;Construit le prompt syst√®me personnalis√©&quot;&quot;&quot;
-        learning_style = student_profile.get(&#x27;learning_style&#x27;, &#x27;mixed&#x27;)
-        grade_level = student_profile.get(&#x27;grade_level&#x27;, &#x27;terminale&#x27;)
-
-        return (&quot;Tu es ARIA, l&#x27;assistant IA personnel de Nexus R√©ussite, &quot;
-                &quot;sp√©cialis√© dans l&#x27;accompagnement des √©l√®ves du syst√®me fran√ßais &quot;
-                f&quot;en Tunisie.\n\nPROFIL DE L&#x27;√âL√àVE:\n- Niveau: {grade_level}\n&quot;
-                f&quot;- Style d&#x27;apprentissage: {learning_style}\n\n&quot;
-                f&quot;CARACT√âRISTIQUES DE TES R√âPONSES:\n- Adapte ton langage au &quot;
-                f&quot;niveau {grade_level}\n- Utilise des approches {learning_style} &quot;
-                &quot;dans tes explications\n- Sois encourageant et bienveillant\n&quot;
-                &quot;- Propose des solutions concr√®tes et personnalis√©es\n- Reste &quot;
-                &quot;concis mais informatif (maximum 200 mots)\n\nMISSION:\n&quot;
-                &quot;Accompagner l&#x27;√©l√®ve vers l&#x27;excellence acad√©mique en pr√©parant &quot;
-                &quot;au Bac fran√ßais ET aux √©tudes sup√©rieures.&quot;)
-
-    def _build_user_message(self, message: str, context: str, relevant_documents: List) -&gt; str:
+        learning_style = student_profile.get(&quot;learning_style&quot;, &quot;mixed&quot;)
+        grade_level = student_profile.get(&quot;grade_level&quot;, &quot;terminale&quot;)
+
+        return (
+            &quot;Tu es ARIA, l&#x27;assistant IA personnel de Nexus R√©ussite, &quot;
+            &quot;sp√©cialis√© dans l&#x27;accompagnement des √©l√®ves du syst√®me fran√ßais &quot;
+            f&quot;en Tunisie.\n\nPROFIL DE L&#x27;√âL√àVE:\n- Niveau: {grade_level}\n&quot;
+            f&quot;- Style d&#x27;apprentissage: {learning_style}\n\n&quot;
+            f&quot;CARACT√âRISTIQUES DE TES R√âPONSES:\n- Adapte ton langage au &quot;
+            f&quot;niveau {grade_level}\n- Utilise des approches {learning_style} &quot;
+            &quot;dans tes explications\n- Sois encourageant et bienveillant\n&quot;
+            &quot;- Propose des solutions concr√®tes et personnalis√©es\n- Reste &quot;
+            &quot;concis mais informatif (maximum 200 mots)\n\nMISSION:\n&quot;
+            &quot;Accompagner l&#x27;√©l√®ve vers l&#x27;excellence acad√©mique en pr√©parant &quot;
+            &quot;au Bac fran√ßais ET aux √©tudes sup√©rieures.&quot;
+        )
+
+    def _build_user_message(
+        self, message: str, context: str, relevant_documents: List
+    ) -&gt; str:
         &quot;&quot;&quot;Construit le message utilisateur avec contexte&quot;&quot;&quot;
         user_message = f&quot;Question: {message}&quot;
 
         if context:
             user_message += f&quot;\nContexte: {context}&quot;
 
         if relevant_documents:
-            docs_content = &quot;\n&quot;.join([
-                doc.get(&#x27;content&#x27;, &#x27;&#x27;)[:200] + &quot;...&quot;
-                for doc in relevant_documents[:2]
-            ])
+            docs_content = &quot;\n&quot;.join(
+                [doc.get(&quot;content&quot;, &quot;&quot;)[:200] + &quot;...&quot; for doc in relevant_documents[:2]]
+            )
             user_message += f&quot;\nDocuments pertinents:\n{docs_content}&quot;
 
         return user_message
 
     def _generate_badges(self, student_profile: Dict, message: str) -&gt; List[Dict]:
         &quot;&quot;&quot;G√©n√®re des badges contextuels&quot;&quot;&quot;
-        learning_style = student_profile.get(&#x27;learning_style&#x27;, &#x27;adaptatif&#x27;)
+        learning_style = student_profile.get(&quot;learning_style&quot;, &quot;adaptatif&quot;)
         message_type = self.detect_message_type(message)
 
         badges = [
-            {&quot;text&quot;: f&quot;üéØ Style: {learning_style.title()}&quot;,
-             &quot;class&quot;: &quot;bg-blue-100 text-blue-800&quot;},
-            {&quot;text&quot;: f&quot;üìä Confiance: {random.randint(85, 98)}%&quot;,
-             &quot;class&quot;: &quot;bg-green-100 text-green-800&quot;}
+            {
+                &quot;text&quot;: f&quot;üéØ Style: {learning_style.title()}&quot;,
+                &quot;class&quot;: &quot;bg-blue-100 text-blue-800&quot;,
+            },
+            {
+                &quot;text&quot;: f&quot;üìä Confiance: {random.randint(85, 98)}%&quot;,
+                &quot;class&quot;: &quot;bg-green-100 text-green-800&quot;,
+            },
         ]
 
-        if message_type == &#x27;math&#x27;:
-            badges.append({&quot;text&quot;: &quot;üî¢ Sp√©cialiste Maths&quot;,
-                          &quot;class&quot;: &quot;bg-purple-100 text-purple-800&quot;})
-        elif message_type == &#x27;bac_prep&#x27;:
-            badges.append({&quot;text&quot;: &quot;üéì Coach Bac&quot;,
-                          &quot;class&quot;: &quot;bg-orange-100 text-orange-800&quot;})
+        if message_type == &quot;math&quot;:
+            badges.append(
+                {
+                    &quot;text&quot;: &quot;üî¢ Sp√©cialiste Maths&quot;,
+                    &quot;class&quot;: &quot;bg-purple-100 text-purple-800&quot;,
+                }
+            )
+        elif message_type == &quot;bac_prep&quot;:
+            badges.append(
+                {&quot;text&quot;: &quot;üéì Coach Bac&quot;, &quot;class&quot;: &quot;bg-orange-100 text-orange-800&quot;}
+            )
 
         return badges
 
     def generate_personalized_content(
-        self,
-        student_profile: Dict,
-        subject: str,
-        topic: str
+        self, student_profile: Dict, subject: str, topic: str
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re du contenu personnalis√© pour un sujet donn√©&quot;&quot;&quot;
-        learning_style = student_profile.get(&#x27;learning_style&#x27;, &#x27;adaptatif&#x27;)
-        difficulty_level = student_profile.get(&#x27;difficulty_level&#x27;, &#x27;intermediate&#x27;)
+        learning_style = student_profile.get(&quot;learning_style&quot;, &quot;adaptatif&quot;)
+        difficulty_level = student_profile.get(&quot;difficulty_level&quot;, &quot;intermediate&quot;)
 
         if self.has_openai:
             return self._generate_openai_content(student_profile, subject, topic)
-        return self._generate_fallback_content(learning_style, subject, topic,
-                                               difficulty_level)
-
-    def _generate_openai_content(self, student_profile: Dict, subject: str,
-                                 topic: str) -&gt; Dict[str, Any]:
+        return self._generate_fallback_content(
+            learning_style, subject, topic, difficulty_level
+        )
+
+    def _generate_openai_content(
+        self, student_profile: Dict, subject: str, topic: str
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re du contenu avec OpenAI&quot;&quot;&quot;
         try:
-            prompt = (f&quot;G√©n√®re du contenu √©ducatif personnalis√© pour:\n&quot;
-                     f&quot;- Sujet: {topic} en {subject}\n&quot;
-                     f&quot;- Style d&#x27;apprentissage: &quot;
-                     f&quot;{student_profile.get(&#x27;learning_style&#x27;)}\n&quot;
-                     f&quot;- Niveau: {student_profile.get(&#x27;grade_level&#x27;, &#x27;terminale&#x27;)}\n\n&quot;
-                     &quot;Inclus:\n1. Une explication adapt√©e (100 mots max)\n&quot;
-                     &quot;2. 2 exercices progressifs\n3. 2 conseils m√©thodologiques\n&quot;
-                     &quot;4. 1 ressource recommand√©e\n\nFormat JSON avec cl√©s: &quot;
-                     &quot;explanation, exercises, methodology_tips, resources&quot;)
+            prompt = (
+                f&quot;G√©n√®re du contenu √©ducatif personnalis√© pour:\n&quot;
+                f&quot;- Sujet: {topic} en {subject}\n&quot;
+                f&quot;- Style d&#x27;apprentissage: &quot;
+                f&quot;{student_profile.get(&#x27;learning_style&#x27;)}\n&quot;
+                f&quot;- Niveau: {student_profile.get(&#x27;grade_level&#x27;, &#x27;terminale&#x27;)}\n\n&quot;
+                &quot;Inclus:\n1. Une explication adapt√©e (100 mots max)\n&quot;
+                &quot;2. 2 exercices progressifs\n3. 2 conseils m√©thodologiques\n&quot;
+                &quot;4. 1 ressource recommand√©e\n\nFormat JSON avec cl√©s: &quot;
+                &quot;explanation, exercises, methodology_tips, resources&quot;
+            )
 
             response = self.client.chat.completions.create(
                 model=&quot;gpt-4o-mini&quot;,
                 messages=[{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}],
                 temperature=0.7,
-                max_tokens=800
+                max_tokens=800,
             )
 
             content_text = response.choices[0].message.content
 
             try:
@@ -320,172 +406,185 @@
 
             return {
                 &quot;content&quot;: content,
                 &quot;generated_at&quot;: datetime.utcnow().isoformat(),
                 &quot;source&quot;: &quot;openai&quot;,
-                &quot;personalized&quot;: True
+                &quot;personalized&quot;: True,
             }
 
         except Exception as exc:  # pylint: disable=broad-exception-caught
             logger.error(&quot;Erreur g√©n√©ration contenu OpenAI: %s&quot;, exc)
             return self._generate_fallback_content(
-                student_profile.get(&#x27;learning_style&#x27;),
+                student_profile.get(&quot;learning_style&quot;),
                 subject,
                 topic,
-                student_profile.get(&#x27;difficulty_level&#x27;, &#x27;intermediate&#x27;)
-            )
-
-    def _generate_fallback_content(self, learning_style: str, subject: str,
-                                   topic: str,
-                                   difficulty: str) -&gt; Dict[str, Any]:  # pylint: disable=unused-argument
+                student_profile.get(&quot;difficulty_level&quot;, &quot;intermediate&quot;),
+            )
+
+    def _generate_fallback_content(
+        self, learning_style: str, subject: str, topic: str, difficulty: str
+    ) -&gt; Dict[str, Any]:  # pylint: disable=unused-argument
         &quot;&quot;&quot;G√©n√®re du contenu de fallback&quot;&quot;&quot;
 
         style_adaptations = {
-            &#x27;visual&#x27;: {
-                &#x27;explanation&#x27;: (f&quot;Approche visuelle pour {topic} en {subject}. &quot;
-                               &quot;Utilisez des sch√©mas et diagrammes pour visualiser &quot;
-                               &quot;les concepts cl√©s.&quot;),
-                &#x27;exercises&#x27;: [
+            &quot;visual&quot;: {
+                &quot;explanation&quot;: (
+                    f&quot;Approche visuelle pour {topic} en {subject}. &quot;
+                    &quot;Utilisez des sch√©mas et diagrammes pour visualiser &quot;
+                    &quot;les concepts cl√©s.&quot;
+                ),
+                &quot;exercises&quot;: [
                     &quot;Cr√©ez un sch√©ma repr√©sentant les concepts&quot;,
-                    &quot;Utilisez des couleurs pour organiser l&#x27;information&quot;
-                ]
+                    &quot;Utilisez des couleurs pour organiser l&#x27;information&quot;,
+                ],
             },
-            &#x27;auditory&#x27;: {
-                &#x27;explanation&#x27;: (f&quot;Approche auditive pour {topic} en {subject}. &quot;
-                               &quot;√âcoutez attentivement les explications structur√©es.&quot;),
-                &#x27;exercises&#x27;: [
+            &quot;auditory&quot;: {
+                &quot;explanation&quot;: (
+                    f&quot;Approche auditive pour {topic} en {subject}. &quot;
+                    &quot;√âcoutez attentivement les explications structur√©es.&quot;
+                ),
+                &quot;exercises&quot;: [
                     &quot;Expliquez le concept √† voix haute&quot;,
-                    &quot;Participez √† des discussions sur le sujet&quot;
-                ]
+                    &quot;Participez √† des discussions sur le sujet&quot;,
+                ],
             },
-            &#x27;kinesthetic&#x27;: {
-                &#x27;explanation&#x27;: (f&quot;Approche pratique pour {topic} en {subject}. &quot;
-                               &quot;Apprenez par l&#x27;exp√©rimentation et la manipulation.&quot;),
-                &#x27;exercises&#x27;: [
+            &quot;kinesthetic&quot;: {
+                &quot;explanation&quot;: (
+                    f&quot;Approche pratique pour {topic} en {subject}. &quot;
+                    &quot;Apprenez par l&#x27;exp√©rimentation et la manipulation.&quot;
+                ),
+                &quot;exercises&quot;: [
                     &quot;R√©alisez des exercices pratiques&quot;,
-                    &quot;Manipulez des objets ou mod√®les concrets&quot;
-                ]
+                    &quot;Manipulez des objets ou mod√®les concrets&quot;,
+                ],
             },
-            &#x27;reading_writing&#x27;: {
-                &#x27;explanation&#x27;: (f&quot;Approche textuelle pour {topic} en {subject}. &quot;
-                               &quot;Lisez et √©crivez pour mieux comprendre.&quot;),
-                &#x27;exercises&#x27;: [
+            &quot;reading_writing&quot;: {
+                &quot;explanation&quot;: (
+                    f&quot;Approche textuelle pour {topic} en {subject}. &quot;
+                    &quot;Lisez et √©crivez pour mieux comprendre.&quot;
+                ),
+                &quot;exercises&quot;: [
                     &quot;R√©digez un r√©sum√© du concept&quot;,
-                    &quot;Cr√©ez des fiches de r√©vision d√©taill√©es&quot;
-                ]
-            }
-        }
-
-        adaptation = style_adaptations.get(learning_style, style_adaptations[&#x27;visual&#x27;])
+                    &quot;Cr√©ez des fiches de r√©vision d√©taill√©es&quot;,
+                ],
+            },
+        }
+
+        adaptation = style_adaptations.get(learning_style, style_adaptations[&quot;visual&quot;])
 
         content = {
-            &quot;explanation&quot;: adaptation[&#x27;explanation&#x27;],
-            &quot;exercises&quot;: adaptation[&#x27;exercises&#x27;],
+            &quot;explanation&quot;: adaptation[&quot;explanation&quot;],
+            &quot;exercises&quot;: adaptation[&quot;exercises&quot;],
             &quot;methodology_tips&quot;: [
                 f&quot;Adaptez votre m√©thode au style {learning_style}&quot;,
-                &quot;Pratiquez r√©guli√®rement avec des exercices vari√©s&quot;
+                &quot;Pratiquez r√©guli√®rement avec des exercices vari√©s&quot;,
             ],
             &quot;resources&quot;: [
                 f&quot;Ressources {learning_style}es recommand√©es&quot;,
-                &quot;Supports compl√©mentaires adapt√©s&quot;
-            ]
+                &quot;Supports compl√©mentaires adapt√©s&quot;,
+            ],
         }
 
         return {
             &quot;content&quot;: content,
             &quot;generated_at&quot;: datetime.utcnow().isoformat(),
             &quot;source&quot;: &quot;fallback&quot;,
-            &quot;personalized&quot;: True
+            &quot;personalized&quot;: True,
         }
 
     def _parse_content_text(self, text: str) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Parse le contenu textuel en structure JSON&quot;&quot;&quot;
         return {
             &quot;explanation&quot;: text[:200] + &quot;...&quot;,
             &quot;exercises&quot;: [&quot;Exercice g√©n√©r√© automatiquement&quot;],
             &quot;methodology_tips&quot;: [&quot;Conseil m√©thodologique adapt√©&quot;],
-            &quot;resources&quot;: [&quot;Ressource recommand√©e&quot;]
+            &quot;resources&quot;: [&quot;Ressource recommand√©e&quot;],
         }
 
     def analyze_learning_style(self, responses: Dict) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Analyse le style d&#x27;apprentissage bas√© sur les r√©ponses&quot;&quot;&quot;
 
         # Scores par style (simulation bas√©e sur les r√©ponses)
-        scores = {
-            &#x27;visual&#x27;: 0,
-            &#x27;auditory&#x27;: 0,
-            &#x27;kinesthetic&#x27;: 0,
-            &#x27;reading_writing&#x27;: 0
-        }
+        scores = {&quot;visual&quot;: 0, &quot;auditory&quot;: 0, &quot;kinesthetic&quot;: 0, &quot;reading_writing&quot;: 0}
 
         # Analyse simplifi√©e des r√©ponses
         for _question, answer in responses.items():  # pylint: disable=unused-variable
             if isinstance(answer, str):
                 answer_lower = answer.lower()
 
                 # Patterns visuels
-                if any(word in answer_lower
-                       for word in [&#x27;voir&#x27;, &#x27;sch√©ma&#x27;, &#x27;couleur&#x27;, &#x27;image&#x27;]):
-                    scores[&#x27;visual&#x27;] += 1
+                if any(
+                    word in answer_lower
+                    for word in [&quot;voir&quot;, &quot;sch√©ma&quot;, &quot;couleur&quot;, &quot;image&quot;]
+                ):
+                    scores[&quot;visual&quot;] += 1
 
                 # Patterns auditifs
-                if any(word in answer_lower
-                       for word in [&#x27;√©couter&#x27;, &#x27;expliquer&#x27;, &#x27;dire&#x27;, &#x27;entendre&#x27;]):
-                    scores[&#x27;auditory&#x27;] += 1
+                if any(
+                    word in answer_lower
+                    for word in [&quot;√©couter&quot;, &quot;expliquer&quot;, &quot;dire&quot;, &quot;entendre&quot;]
+                ):
+                    scores[&quot;auditory&quot;] += 1
 
                 # Patterns kinesth√©siques
-                if any(word in answer_lower
-                       for word in [&#x27;faire&#x27;, &#x27;manipuler&#x27;, &#x27;bouger&#x27;, &#x27;pratiquer&#x27;]):
-                    scores[&#x27;kinesthetic&#x27;] += 1
+                if any(
+                    word in answer_lower
+                    for word in [&quot;faire&quot;, &quot;manipuler&quot;, &quot;bouger&quot;, &quot;pratiquer&quot;]
+                ):
+                    scores[&quot;kinesthetic&quot;] += 1
 
                 # Patterns lecture/√©criture
-                if any(word in answer_lower for word in [&#x27;lire&#x27;, &#x27;√©crire&#x27;, &#x27;texte&#x27;, &#x27;noter&#x27;]):
-                    scores[&#x27;reading_writing&#x27;] += 1
+                if any(
+                    word in answer_lower
+                    for word in [&quot;lire&quot;, &quot;√©crire&quot;, &quot;texte&quot;, &quot;noter&quot;]
+                ):
+                    scores[&quot;reading_writing&quot;] += 1
 
         # D√©termination du style dominant
         dominant_style = max(scores.keys(), key=lambda k: scores[k])
 
         return {
-            &#x27;dominant_style&#x27;: dominant_style,
-            &#x27;scores&#x27;: scores,
-            &#x27;recommendations&#x27;: self._get_style_recommendations(dominant_style),
-            &#x27;analyzed_at&#x27;: datetime.utcnow().isoformat()
+            &quot;dominant_style&quot;: dominant_style,
+            &quot;scores&quot;: scores,
+            &quot;recommendations&quot;: self._get_style_recommendations(dominant_style),
+            &quot;analyzed_at&quot;: datetime.utcnow().isoformat(),
         }
 
     def _get_style_recommendations(self, style: str) -&gt; List[str]:
         &quot;&quot;&quot;Recommandations selon le style d&#x27;apprentissage&quot;&quot;&quot;
         recommendations = {
-            &#x27;visual&#x27;: [
+            &quot;visual&quot;: [
                 &quot;Utilisez des diagrammes et sch√©mas&quot;,
                 &quot;Surlignez et organisez visuellement vos notes&quot;,
-                &quot;Cr√©ez des cartes mentales&quot;
-            ],
-            &#x27;auditory&#x27;: [
+                &quot;Cr√©ez des cartes mentales&quot;,
+            ],
+            &quot;auditory&quot;: [
                 &quot;Lisez vos cours √† voix haute&quot;,
                 &quot;Participez aux discussions en classe&quot;,
-                &quot;Enregistrez-vous en r√©visant&quot;
-            ],
-            &#x27;kinesthetic&#x27;: [
+                &quot;Enregistrez-vous en r√©visant&quot;,
+            ],
+            &quot;kinesthetic&quot;: [
                 &quot;Prenez des pauses actives&quot;,
                 &quot;Utilisez des manipulations concr√®tes&quot;,
-                &quot;Variez vos positions de travail&quot;
-            ],
-            &#x27;reading_writing&#x27;: [
+                &quot;Variez vos positions de travail&quot;,
+            ],
+            &quot;reading_writing&quot;: [
                 &quot;Prenez des notes d√©taill√©es&quot;,
                 &quot;R√©digez des r√©sum√©s&quot;,
-                &quot;Faites des fiches de r√©vision&quot;
-            ]
-        }
-
-        return recommendations.get(style, recommendations[&#x27;visual&#x27;])
-
-    def assess_student_performance(self, student_id: int,  # pylint: disable=unused-argument
-                                   session_data: Dict) -&gt; Dict[str, Any]:
+                &quot;Faites des fiches de r√©vision&quot;,
+            ],
+        }
+
+        return recommendations.get(style, recommendations[&quot;visual&quot;])
+
+    def assess_student_performance(
+        self, student_id: int, session_data: Dict  # pylint: disable=unused-argument
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;√âvalue la performance d&#x27;un √©tudiant&quot;&quot;&quot;
-        answers = session_data.get(&#x27;answers&#x27;, [])
-        questions = session_data.get(&#x27;questions&#x27;, [])
-        time_spent = session_data.get(&#x27;time_spent_seconds&#x27;, 0)
+        answers = session_data.get(&quot;answers&quot;, [])
+        questions = session_data.get(&quot;questions&quot;, [])
+        time_spent = session_data.get(&quot;time_spent_seconds&quot;, 0)
 
         if not questions:
             return {&quot;error&quot;: &quot;Aucune question fournie pour l&#x27;√©valuation&quot;}
 
         # Calcul du score
@@ -496,71 +595,74 @@
         for i, (question, answer) in enumerate(zip(questions, answers)):
             is_correct = self._evaluate_answer(question, answer)
             if is_correct:
                 correct_answers += 1
 
-            detailed_analysis.append({
-                &#x27;question_id&#x27;: i + 1,
-                &#x27;question&#x27;: question.get(&#x27;text&#x27;, &#x27;&#x27;),
-                &#x27;student_answer&#x27;: answer,
-                &#x27;correct_answer&#x27;: question.get(&#x27;correct_answer&#x27;, &#x27;&#x27;),
-                &#x27;is_correct&#x27;: is_correct,
-                &#x27;topic&#x27;: question.get(&#x27;topic&#x27;, &#x27;&#x27;),
-                &#x27;difficulty&#x27;: question.get(&#x27;difficulty&#x27;, &#x27;medium&#x27;)
-            })
-
-        score = ((correct_answers / total_questions * 100)
-                 if total_questions &gt; 0 else 0)
+            detailed_analysis.append(
+                {
+                    &quot;question_id&quot;: i + 1,
+                    &quot;question&quot;: question.get(&quot;text&quot;, &quot;&quot;),
+                    &quot;student_answer&quot;: answer,
+                    &quot;correct_answer&quot;: question.get(&quot;correct_answer&quot;, &quot;&quot;),
+                    &quot;is_correct&quot;: is_correct,
+                    &quot;topic&quot;: question.get(&quot;topic&quot;, &quot;&quot;),
+                    &quot;difficulty&quot;: question.get(&quot;difficulty&quot;, &quot;medium&quot;),
+                }
+            )
+
+        score = (correct_answers / total_questions * 100) if total_questions &gt; 0 else 0
 
         # Analyse des patterns d&#x27;erreur
         error_patterns = self._analyze_error_patterns(detailed_analysis)
 
         # G√©n√©ration de recommandations
         recommendations = self._generate_performance_recommendations(
-            score, error_patterns, time_spent)
+            score, error_patterns, time_spent
+        )
 
         return {
-            &#x27;score&#x27;: score,
-            &#x27;correct_answers&#x27;: correct_answers,
-            &#x27;total_questions&#x27;: total_questions,
-            &#x27;time_spent_seconds&#x27;: time_spent,
-            &#x27;detailed_analysis&#x27;: detailed_analysis,
-            &#x27;error_patterns&#x27;: error_patterns,
-            &#x27;recommendations&#x27;: recommendations,
-            &#x27;next_difficulty_level&#x27;: self._suggest_next_difficulty(score),
-            &#x27;assessed_at&#x27;: datetime.utcnow().isoformat()
+            &quot;score&quot;: score,
+            &quot;correct_answers&quot;: correct_answers,
+            &quot;total_questions&quot;: total_questions,
+            &quot;time_spent_seconds&quot;: time_spent,
+            &quot;detailed_analysis&quot;: detailed_analysis,
+            &quot;error_patterns&quot;: error_patterns,
+            &quot;recommendations&quot;: recommendations,
+            &quot;next_difficulty_level&quot;: self._suggest_next_difficulty(score),
+            &quot;assessed_at&quot;: datetime.utcnow().isoformat(),
         }
 
     def _evaluate_answer(self, question: Dict, answer: str) -&gt; bool:
         &quot;&quot;&quot;√âvalue si une r√©ponse est correcte (simulation)&quot;&quot;&quot;
-        correct_answer = question.get(&#x27;correct_answer&#x27;, &#x27;&#x27;).lower().strip()
+        correct_answer = question.get(&quot;correct_answer&quot;, &quot;&quot;).lower().strip()
         student_answer = str(answer).lower().strip()
 
         # Simulation basique d&#x27;√©valuation
-        return (correct_answer == student_answer or
-                random.choice([True, False, True]))  # Biais positif
+        return correct_answer == student_answer or random.choice(
+            [True, False, True]
+        )  # Biais positif
 
     def _analyze_error_patterns(self, detailed_analysis: List) -&gt; Dict[str, int]:
         &quot;&quot;&quot;Analyse les patterns d&#x27;erreurs&quot;&quot;&quot;
         patterns = {
-            &#x27;calculation_errors&#x27;: 0,
-            &#x27;methodology_issues&#x27;: 0,
-            &#x27;comprehension_gaps&#x27;: 0,
-            &#x27;careless_mistakes&#x27;: 0
+            &quot;calculation_errors&quot;: 0,
+            &quot;methodology_issues&quot;: 0,
+            &quot;comprehension_gaps&quot;: 0,
+            &quot;careless_mistakes&quot;: 0,
         }
 
         for item in detailed_analysis:
-            if not item[&#x27;is_correct&#x27;]:
+            if not item[&quot;is_correct&quot;]:
                 # Simulation d&#x27;analyse des erreurs
                 error_type = random.choice(list(patterns.keys()))
                 patterns[error_type] += 1
 
         return patterns
 
-    def _generate_performance_recommendations(self, score: float,
-                                              error_patterns: Dict,
-                                              time_spent: int) -&gt; List[str]:
+    def _generate_performance_recommendations(
+        self, score: float, error_patterns: Dict, time_spent: int
+    ) -&gt; List[str]:
         &quot;&quot;&quot;G√©n√®re des recommandations bas√©es sur la performance&quot;&quot;&quot;
         recommendations = []
 
         if score &gt;= 85:
             recommendations.append(&quot;Excellent travail ! Continuez sur cette lanc√©e.&quot;)
@@ -570,67 +672,72 @@
             recommendations.append(
                 &quot;Il faut renforcer les bases. Ne vous d√©couragez pas !&quot;
             )
 
         # Recommandations selon les erreurs
-        if error_patterns.get(&#x27;calculation_errors&#x27;, 0) &gt; 2:
+        if error_patterns.get(&quot;calculation_errors&quot;, 0) &gt; 2:
             recommendations.append(&quot;Travaillez la pr√©cision des calculs.&quot;)
 
-        if error_patterns.get(&#x27;methodology_issues&#x27;, 0) &gt; 1:
+        if error_patterns.get(&quot;methodology_issues&quot;, 0) &gt; 1:
             recommendations.append(&quot;Revoyez la m√©thodologie de r√©solution.&quot;)
 
         if time_spent &lt; 300:  # Moins de 5 minutes
             recommendations.append(&quot;Prenez plus de temps pour r√©fl√©chir.&quot;)
         elif time_spent &gt; 1800:  # Plus de 30 minutes
-            recommendations.append(
-                &quot;Travaillez l&#x27;efficacit√© et la gestion du temps.&quot;
-            )
+            recommendations.append(&quot;Travaillez l&#x27;efficacit√© et la gestion du temps.&quot;)
 
         return recommendations
 
     def _suggest_next_difficulty(self, score: float) -&gt; str:
         &quot;&quot;&quot;Sugg√®re le niveau de difficult√© suivant&quot;&quot;&quot;
         if score &gt;= 85:
-            return &#x27;advanced&#x27;
+            return &quot;advanced&quot;
         if score &gt;= 70:
-            return &#x27;intermediate&#x27;
+            return &quot;intermediate&quot;
         if score &gt;= 50:
-            return &#x27;beginner&#x27;
-        return &#x27;foundation&#x27;
-
-    def evaluate_progress(self, student_id: int,  # pylint: disable=unused-argument
-                          subject: str, recent_scores: List[float]) -&gt; Dict[str, Any]:
+            return &quot;beginner&quot;
+        return &quot;foundation&quot;
+
+    def evaluate_progress(
+        self,
+        student_id: int,  # pylint: disable=unused-argument
+        subject: str,
+        recent_scores: List[float],
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;√âvalue les progr√®s d&#x27;un √©l√®ve bas√© sur ses scores r√©cents&quot;&quot;&quot;
         if not recent_scores:
             return {
                 &quot;status&quot;: &quot;insufficient_data&quot;,
                 &quot;message&quot;: &quot;Pas assez de donn√©es pour √©valuer les progr√®s&quot;,
                 &quot;recommendations&quot;: [
                     &quot;Commencer par faire quelques exercices pour obtenir une &quot;
                     &quot;√©valuation&quot;
-                ]
+                ],
             }
 
         # Calculs de base
         average_score = sum(recent_scores) / len(recent_scores)
         latest_score = recent_scores[-1]
 
         # Tendance (comparaison derni√®re moiti√© vs premi√®re moiti√©)
         if len(recent_scores) &gt;= 4:
             mid_point = len(recent_scores) // 2
             first_half_avg = sum(recent_scores[:mid_point]) / mid_point
-            second_half_avg = (sum(recent_scores[mid_point:]) /
-                               (len(recent_scores) - mid_point))
+            second_half_avg = sum(recent_scores[mid_point:]) / (
+                len(recent_scores) - mid_point
+            )
             if second_half_avg &gt; first_half_avg:
                 trend = &quot;am√©lioration&quot;
             elif second_half_avg &lt; first_half_avg:
                 trend = &quot;d√©clin&quot;
             else:
                 trend = &quot;stable&quot;
-            progress_percentage = (((second_half_avg - first_half_avg) /
-                                   first_half_avg) * 100
-                                   if first_half_avg &gt; 0 else 0)
+            progress_percentage = (
+                ((second_half_avg - first_half_avg) / first_half_avg) * 100
+                if first_half_avg &gt; 0
+                else 0
+            )
         else:
             trend = &quot;stable&quot;
             progress_percentage = 0
 
         # Niveau actuel bas√© sur la moyenne
@@ -661,12 +768,11 @@
                 &quot;reprendre confiance.&quot;
             )
         else:
             if average_score &gt;= 85:
                 recommendations.append(
-                    &quot;Performance stable et √©lev√©e. Essayez des d√©fis plus &quot;
-                    &quot;complexes.&quot;
+                    &quot;Performance stable et √©lev√©e. Essayez des d√©fis plus &quot; &quot;complexes.&quot;
                 )
             elif average_score &gt;= 70:
                 recommendations.append(
                     &quot;Performance correcte et stable. Continuez avec r√©gularit√©.&quot;
                 )
@@ -695,34 +801,40 @@
             &quot;statistics&quot;: {
                 &quot;average_score&quot;: round(average_score, 2),
                 &quot;latest_score&quot;: latest_score,
                 &quot;total_evaluations&quot;: len(recent_scores),
                 &quot;trend&quot;: trend,
-                &quot;progress_percentage&quot;: round(progress_percentage, 2)
+                &quot;progress_percentage&quot;: round(progress_percentage, 2),
             },
             &quot;assessment&quot;: {
                 &quot;current_level&quot;: level,
-                &quot;strengths&quot;: ([&quot;R√©gularit√© dans le travail&quot;]
-                              if trend != &quot;d√©clin&quot; else []),
-                &quot;areas_for_improvement&quot;: ([&quot;Consistency&quot;] if trend == &quot;d√©clin&quot;
-                                          else [&quot;Challenge level&quot;]
-                                          if average_score &gt;= 85
-                                          else [&quot;Core concepts&quot;])
+                &quot;strengths&quot;: (
+                    [&quot;R√©gularit√© dans le travail&quot;] if trend != &quot;d√©clin&quot; else []
+                ),
+                &quot;areas_for_improvement&quot;: (
+                    [&quot;Consistency&quot;]
+                    if trend == &quot;d√©clin&quot;
+                    else (
+                        [&quot;Challenge level&quot;]
+                        if average_score &gt;= 85
+                        else [&quot;Core concepts&quot;]
+                    )
+                ),
             },
             &quot;recommendations&quot;: recommendations,
             &quot;next_steps&quot;: next_steps,
-            &quot;timestamp&quot;: datetime.utcnow().isoformat()
+            &quot;timestamp&quot;: datetime.utcnow().isoformat(),
         }
 
     def get_health_status(self) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Retourne l&#x27;√©tat de sant√© du service ARIA&quot;&quot;&quot;
         return {
-            &#x27;status&#x27;: &#x27;healthy&#x27;,
-            &#x27;openai_available&#x27;: self.has_openai,
-            &#x27;api_key_configured&#x27;: bool(self.api_key),
-            &#x27;version&#x27;: &#x27;1.0.0&#x27;,
-            &#x27;timestamp&#x27;: datetime.utcnow().isoformat()
+            &quot;status&quot;: &quot;healthy&quot;,
+            &quot;openai_available&quot;: self.has_openai,
+            &quot;api_key_configured&quot;: bool(self.api_key),
+            &quot;version&quot;: &quot;1.0.0&quot;,
+            &quot;timestamp&quot;: datetime.utcnow().isoformat(),
         }
 
 
 # Instance globale du service
 aria_service = ARIAService()
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/parent_dashboard.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/parent_dashboard.py	2025-07-24 20:54:02.560385+00:00
@@ -1,12 +1,20 @@
 from datetime import datetime, date, timedelta
 from src.models.student import Student, LearningSession, Assessment
 from src.models.formulas import (
-    Enrollment, IndividualSession, GroupSession, SessionAttendance,
-    WeeklyReport, StudentObjective, Teacher, Group, Formula
+    Enrollment,
+    IndividualSession,
+    GroupSession,
+    SessionAttendance,
+    WeeklyReport,
+    StudentObjective,
+    Teacher,
+    Group,
+    Formula,
 )
 import json
+
 
 class ParentDashboardService:
     &quot;&quot;&quot;Service pour g√©n√©rer les donn√©es du tableau de bord parent&quot;&quot;&quot;
 
     def __init__(self):
@@ -18,78 +26,124 @@
             student = Student.query.get(student_id)
             if not student:
                 return None
 
             # Inscription active
-            enrollment = Enrollment.query.filter_by(student_id=student_id, is_active=True).first()
+            enrollment = Enrollment.query.filter_by(
+                student_id=student_id, is_active=True
+            ).first()
 
             # Informations de base
             overview = {
-                &#x27;student&#x27;: {
-                    &#x27;id&#x27;: student.id,
-                    &#x27;name&#x27;: f&quot;{student.first_name} {student.last_name}&quot;,
-                    &#x27;grade&#x27;: student.grade_level,
-                    &#x27;school&#x27;: student.school,
-                    &#x27;formula&#x27;: enrollment.formula.name if enrollment and enrollment.formula else None,
-                    &#x27;formula_type&#x27;: enrollment.formula.type.value if enrollment and enrollment.formula else None
+                &quot;student&quot;: {
+                    &quot;id&quot;: student.id,
+                    &quot;name&quot;: f&quot;{student.first_name} {student.last_name}&quot;,
+                    &quot;grade&quot;: student.grade_level,
+                    &quot;school&quot;: student.school,
+                    &quot;formula&quot;: (
+                        enrollment.formula.name
+                        if enrollment and enrollment.formula
+                        else None
+                    ),
+                    &quot;formula_type&quot;: (
+                        enrollment.formula.type.value
+                        if enrollment and enrollment.formula
+                        else None
+                    ),
                 },
-                &#x27;enrollment&#x27;: {
-                    &#x27;start_date&#x27;: enrollment.start_date.isoformat() if enrollment else None,
-                    &#x27;formula_level&#x27;: enrollment.formula.level.value if enrollment and enrollment.formula else None,
-                    &#x27;group_name&#x27;: enrollment.group.name if enrollment and enrollment.group else None
-                } if enrollment else None
+                &quot;enrollment&quot;: (
+                    {
+                        &quot;start_date&quot;: (
+                            enrollment.start_date.isoformat() if enrollment else None
+                        ),
+                        &quot;formula_level&quot;: (
+                            enrollment.formula.level.value
+                            if enrollment and enrollment.formula
+                            else None
+                        ),
+                        &quot;group_name&quot;: (
+                            enrollment.group.name
+                            if enrollment and enrollment.group
+                            else None
+                        ),
+                    }
+                    if enrollment
+                    else None
+                ),
             }
 
             return overview
         except Exception as e:
             print(f&quot;Erreur dans get_student_overview: {e}&quot;)
             return None
 
     def get_next_session(self, student_id):
         &quot;&quot;&quot;R√©cup√©rer la prochaine s√©ance de l&#x27;√©tudiant&quot;&quot;&quot;
         try:
-            enrollment = Enrollment.query.filter_by(student_id=student_id, is_active=True).first()
+            enrollment = Enrollment.query.filter_by(
+                student_id=student_id, is_active=True
+            ).first()
             if not enrollment:
                 return None
 
             next_session = None
 
             if enrollment.group_id:
                 # S√©ance de groupe
-                next_group_session = GroupSession.query.filter(
-                    GroupSession.group_id == enrollment.group_id,
-                    GroupSession.scheduled_at &gt; datetime.utcnow(),
-                    GroupSession.status == &#x27;scheduled&#x27;
-                ).order_by(GroupSession.scheduled_at.asc()).first()
+                next_group_session = (
+                    GroupSession.query.filter(
+                        GroupSession.group_id == enrollment.group_id,
+                        GroupSession.scheduled_at &gt; datetime.utcnow(),
+                        GroupSession.status == &quot;scheduled&quot;,
+                    )
+                    .order_by(GroupSession.scheduled_at.asc())
+                    .first()
+                )
 
                 if next_group_session:
                     group = Group.query.get(enrollment.group_id)
                     teacher = Teacher.query.get(group.teacher_id) if group else None
                     next_session = {
-                        &#x27;type&#x27;: &#x27;group&#x27;,
-                        &#x27;date&#x27;: next_group_session.scheduled_at.date().isoformat(),
-                        &#x27;time&#x27;: next_group_session.scheduled_at.time().strftime(&#x27;%H:%M&#x27;),
-                        &#x27;subject&#x27;: next_group_session.subject,
-                        &#x27;teacher&#x27;: f&quot;{teacher.first_name} {teacher.last_name}&quot; if teacher else &quot;Non assign√©&quot;,
-                        &#x27;group_name&#x27;: group.name if group else None
+                        &quot;type&quot;: &quot;group&quot;,
+                        &quot;date&quot;: next_group_session.scheduled_at.date().isoformat(),
+                        &quot;time&quot;: next_group_session.scheduled_at.time().strftime(
+                            &quot;%H:%M&quot;
+                        ),
+                        &quot;subject&quot;: next_group_session.subject,
+                        &quot;teacher&quot;: (
+                            f&quot;{teacher.first_name} {teacher.last_name}&quot;
+                            if teacher
+                            else &quot;Non assign√©&quot;
+                        ),
+                        &quot;group_name&quot;: group.name if group else None,
                     }
             else:
                 # S√©ance individuelle
-                next_individual_session = IndividualSession.query.filter(
-                    IndividualSession.student_id == student_id,
-                    IndividualSession.scheduled_at &gt; datetime.utcnow(),
-                    IndividualSession.status == &#x27;scheduled&#x27;
-                ).order_by(IndividualSession.scheduled_at.asc()).first()
+                next_individual_session = (
+                    IndividualSession.query.filter(
+                        IndividualSession.student_id == student_id,
+                        IndividualSession.scheduled_at &gt; datetime.utcnow(),
+                        IndividualSession.status == &quot;scheduled&quot;,
+                    )
+                    .order_by(IndividualSession.scheduled_at.asc())
+                    .first()
+                )
 
                 if next_individual_session:
                     teacher = Teacher.query.get(next_individual_session.teacher_id)
                     next_session = {
-                        &#x27;type&#x27;: &#x27;individual&#x27;,
-                        &#x27;date&#x27;: next_individual_session.scheduled_at.date().isoformat(),
-                        &#x27;time&#x27;: next_individual_session.scheduled_at.time().strftime(&#x27;%H:%M&#x27;),
-                        &#x27;subject&#x27;: next_individual_session.subject,
-                        &#x27;teacher&#x27;: f&quot;{teacher.first_name} {teacher.last_name}&quot; if teacher else &quot;Non assign√©&quot;
+                        &quot;type&quot;: &quot;individual&quot;,
+                        &quot;date&quot;: next_individual_session.scheduled_at.date().isoformat(),
+                        &quot;time&quot;: next_individual_session.scheduled_at.time().strftime(
+                            &quot;%H:%M&quot;
+                        ),
+                        &quot;subject&quot;: next_individual_session.subject,
+                        &quot;teacher&quot;: (
+                            f&quot;{teacher.first_name} {teacher.last_name}&quot;
+                            if teacher
+                            else &quot;Non assign√©&quot;
+                        ),
                     }
 
             return next_session
         except Exception as e:
             print(f&quot;Erreur dans get_next_session: {e}&quot;)
@@ -97,109 +151,135 @@
 
     def get_monthly_stats(self, student_id):
         &quot;&quot;&quot;R√©cup√©rer les statistiques du mois&quot;&quot;&quot;
         try:
             current_month_start = date.today().replace(day=1)
-            enrollment = Enrollment.query.filter_by(student_id=student_id, is_active=True).first()
+            enrollment = Enrollment.query.filter_by(
+                student_id=student_id, is_active=True
+            ).first()
 
             stats = {
-                &#x27;sessions_this_month&#x27;: 0,
-                &#x27;individual_sessions&#x27;: 0,
-                &#x27;group_sessions&#x27;: 0,
-                &#x27;total_hours&#x27;: 0
+                &quot;sessions_this_month&quot;: 0,
+                &quot;individual_sessions&quot;: 0,
+                &quot;group_sessions&quot;: 0,
+                &quot;total_hours&quot;: 0,
             }
 
             if enrollment:
                 if enrollment.group_id:
                     # S√©ances de groupe
                     group_sessions = GroupSession.query.filter(
                         GroupSession.group_id == enrollment.group_id,
                         GroupSession.scheduled_at &gt;= current_month_start,
-                        GroupSession.status == &#x27;completed&#x27;
+                        GroupSession.status == &quot;completed&quot;,
                     ).all()
 
-                    stats[&#x27;group_sessions&#x27;] = len(group_sessions)
-                    stats[&#x27;sessions_this_month&#x27;] += len(group_sessions)
-                    stats[&#x27;total_hours&#x27;] += sum(s.duration_minutes for s in group_sessions) / 60
+                    stats[&quot;group_sessions&quot;] = len(group_sessions)
+                    stats[&quot;sessions_this_month&quot;] += len(group_sessions)
+                    stats[&quot;total_hours&quot;] += (
+                        sum(s.duration_minutes for s in group_sessions) / 60
+                    )
 
                 if enrollment.teacher_id:
                     # S√©ances individuelles
                     individual_sessions = IndividualSession.query.filter(
                         IndividualSession.student_id == student_id,
                         IndividualSession.scheduled_at &gt;= current_month_start,
-                        IndividualSession.status == &#x27;completed&#x27;
+                        IndividualSession.status == &quot;completed&quot;,
                     ).all()
 
-                    stats[&#x27;individual_sessions&#x27;] = len(individual_sessions)
-                    stats[&#x27;sessions_this_month&#x27;] += len(individual_sessions)
-                    stats[&#x27;total_hours&#x27;] += sum(s.duration_minutes for s in individual_sessions) / 60
+                    stats[&quot;individual_sessions&quot;] = len(individual_sessions)
+                    stats[&quot;sessions_this_month&quot;] += len(individual_sessions)
+                    stats[&quot;total_hours&quot;] += (
+                        sum(s.duration_minutes for s in individual_sessions) / 60
+                    )
 
             return stats
         except Exception as e:
             print(f&quot;Erreur dans get_monthly_stats: {e}&quot;)
-            return {&#x27;sessions_this_month&#x27;: 0, &#x27;individual_sessions&#x27;: 0, &#x27;group_sessions&#x27;: 0, &#x27;total_hours&#x27;: 0}
+            return {
+                &quot;sessions_this_month&quot;: 0,
+                &quot;individual_sessions&quot;: 0,
+                &quot;group_sessions&quot;: 0,
+                &quot;total_hours&quot;: 0,
+            }
 
     def get_objectives_progress(self, student_id):
         &quot;&quot;&quot;R√©cup√©rer la progression des objectifs&quot;&quot;&quot;
         try:
-            total_objectives = StudentObjective.query.filter_by(student_id=student_id).count()
+            total_objectives = StudentObjective.query.filter_by(
+                student_id=student_id
+            ).count()
             achieved_objectives = StudentObjective.query.filter_by(
-                student_id=student_id,
-                is_achieved=True
+                student_id=student_id, is_achieved=True
             ).count()
 
             # Objectifs en cours
-            current_objectives = StudentObjective.query.filter_by(
-                student_id=student_id,
-                is_achieved=False
-            ).filter(StudentObjective.target_date &gt;= date.today()).all()
+            current_objectives = (
+                StudentObjective.query.filter_by(
+                    student_id=student_id, is_achieved=False
+                )
+                .filter(StudentObjective.target_date &gt;= date.today())
+                .all()
+            )
 
             return {
-                &#x27;total_objectives&#x27;: total_objectives,
-                &#x27;achieved_objectives&#x27;: achieved_objectives,
-                &#x27;current_objectives&#x27;: len(current_objectives),
-                &#x27;achievement_rate&#x27;: (achieved_objectives / total_objectives * 100) if total_objectives &gt; 0 else 0
+                &quot;total_objectives&quot;: total_objectives,
+                &quot;achieved_objectives&quot;: achieved_objectives,
+                &quot;current_objectives&quot;: len(current_objectives),
+                &quot;achievement_rate&quot;: (
+                    (achieved_objectives / total_objectives * 100)
+                    if total_objectives &gt; 0
+                    else 0
+                ),
             }
         except Exception as e:
             print(f&quot;Erreur dans get_objectives_progress: {e}&quot;)
-            return {&#x27;total_objectives&#x27;: 0, &#x27;achieved_objectives&#x27;: 0, &#x27;current_objectives&#x27;: 0, &#x27;achievement_rate&#x27;: 0}
+            return {
+                &quot;total_objectives&quot;: 0,
+                &quot;achieved_objectives&quot;: 0,
+                &quot;current_objectives&quot;: 0,
+                &quot;achievement_rate&quot;: 0,
+            }
 
     def get_learning_style_analysis(self, student_id):
         &quot;&quot;&quot;R√©cup√©rer l&#x27;analyse du style d&#x27;apprentissage&quot;&quot;&quot;
         try:
             student = Student.query.get(student_id)
             if not student or not student.learning_profile:
                 # Donn√©es par d√©faut si pas de profil
                 return {
-                    &#x27;dominant_style&#x27;: &#x27;Visuel&#x27;,
-                    &#x27;confidence&#x27;: 85,
-                    &#x27;styles&#x27;: [
-                        {&#x27;style&#x27;: &#x27;Visuel&#x27;, &#x27;score&#x27;: 85},
-                        {&#x27;style&#x27;: &#x27;Auditif&#x27;, &#x27;score&#x27;: 60},
-                        {&#x27;style&#x27;: &#x27;Kinesth√©sique&#x27;, &#x27;score&#x27;: 45},
-                        {&#x27;style&#x27;: &#x27;Lecture/√âcriture&#x27;, &#x27;score&#x27;: 75}
+                    &quot;dominant_style&quot;: &quot;Visuel&quot;,
+                    &quot;confidence&quot;: 85,
+                    &quot;styles&quot;: [
+                        {&quot;style&quot;: &quot;Visuel&quot;, &quot;score&quot;: 85},
+                        {&quot;style&quot;: &quot;Auditif&quot;, &quot;score&quot;: 60},
+                        {&quot;style&quot;: &quot;Kinesth√©sique&quot;, &quot;score&quot;: 45},
+                        {&quot;style&quot;: &quot;Lecture/√âcriture&quot;, &quot;score&quot;: 75},
                     ],
-                    &#x27;recommendations&#x27;: [
+                    &quot;recommendations&quot;: [
                         &quot;Utiliser des diagrammes pour les concepts complexes&quot;,
                         &quot;Privil√©gier les couleurs pour organiser l&#x27;information&quot;,
                         &quot;Cr√©er des cartes mentales pour les r√©visions&quot;,
-                        &quot;Utiliser des vid√©os explicatives&quot;
-                    ]
+                        &quot;Utiliser des vid√©os explicatives&quot;,
+                    ],
                 }
 
             # Analyser le profil d&#x27;apprentissage existant
             profile = student.learning_profile
-            styles = profile.get(&#x27;learning_styles&#x27;, {})
+            styles = profile.get(&quot;learning_styles&quot;, {})
 
             # Trouver le style dominant
-            dominant_style = max(styles.items(), key=lambda x: x[1]) if styles else (&#x27;Visuel&#x27;, 85)
+            dominant_style = (
+                max(styles.items(), key=lambda x: x[1]) if styles else (&quot;Visuel&quot;, 85)
+            )
 
             return {
-                &#x27;dominant_style&#x27;: dominant_style[0],
-                &#x27;confidence&#x27;: dominant_style[1],
-                &#x27;styles&#x27;: [{&#x27;style&#x27;: k, &#x27;score&#x27;: v} for k, v in styles.items()],
-                &#x27;recommendations&#x27;: profile.get(&#x27;recommendations&#x27;, [])
+                &quot;dominant_style&quot;: dominant_style[0],
+                &quot;confidence&quot;: dominant_style[1],
+                &quot;styles&quot;: [{&quot;style&quot;: k, &quot;score&quot;: v} for k, v in styles.items()],
+                &quot;recommendations&quot;: profile.get(&quot;recommendations&quot;, []),
             }
         except Exception as e:
             print(f&quot;Erreur dans get_learning_style_analysis: {e}&quot;)
             return None
 
@@ -213,35 +293,41 @@
 
             for assessment in assessments:
                 subject = assessment.subject
                 if subject not in subjects_progress:
                     subjects_progress[subject] = {
-                        &#x27;subject&#x27;: subject,
-                        &#x27;current_grade&#x27;: 0,
-                        &#x27;progress_percentage&#x27;: 0,
-                        &#x27;recent_topics&#x27;: [],
-                        &#x27;status&#x27;: &#x27;En cours&#x27;
+                        &quot;subject&quot;: subject,
+                        &quot;current_grade&quot;: 0,
+                        &quot;progress_percentage&quot;: 0,
+                        &quot;recent_topics&quot;: [],
+                        &quot;status&quot;: &quot;En cours&quot;,
                     }
 
                 # Mettre √† jour avec la note la plus r√©cente
-                if assessment.score &gt; subjects_progress[subject][&#x27;current_grade&#x27;]:
-                    subjects_progress[subject][&#x27;current_grade&#x27;] = assessment.score
-                    subjects_progress[subject][&#x27;progress_percentage&#x27;] = min(assessment.score * 5, 100)
+                if assessment.score &gt; subjects_progress[subject][&quot;current_grade&quot;]:
+                    subjects_progress[subject][&quot;current_grade&quot;] = assessment.score
+                    subjects_progress[subject][&quot;progress_percentage&quot;] = min(
+                        assessment.score * 5, 100
+                    )
 
                 # Ajouter les sujets r√©cents
-                if assessment.topic and assessment.topic not in subjects_progress[subject][&#x27;recent_topics&#x27;]:
-                    subjects_progress[subject][&#x27;recent_topics&#x27;].append(assessment.topic)
+                if (
+                    assessment.topic
+                    and assessment.topic
+                    not in subjects_progress[subject][&quot;recent_topics&quot;]
+                ):
+                    subjects_progress[subject][&quot;recent_topics&quot;].append(assessment.topic)
 
             # D√©terminer le statut bas√© sur la note
             for subject_data in subjects_progress.values():
-                grade = subject_data[&#x27;current_grade&#x27;]
+                grade = subject_data[&quot;current_grade&quot;]
                 if grade &gt;= 16:
-                    subject_data[&#x27;status&#x27;] = &#x27;Ma√Ætris√©&#x27;
+                    subject_data[&quot;status&quot;] = &quot;Ma√Ætris√©&quot;
                 elif grade &gt;= 12:
-                    subject_data[&#x27;status&#x27;] = &#x27;En cours&#x27;
+                    subject_data[&quot;status&quot;] = &quot;En cours&quot;
                 else:
-                    subject_data[&#x27;status&#x27;] = &#x27;√Ä revoir&#x27;
+                    subject_data[&quot;status&quot;] = &quot;√Ä revoir&quot;
 
             return list(subjects_progress.values())
         except Exception as e:
             print(f&quot;Erreur dans get_subject_progress: {e}&quot;)
             return []
@@ -250,52 +336,64 @@
         &quot;&quot;&quot;R√©cup√©rer les notifications r√©centes&quot;&quot;&quot;
         try:
             notifications = []
 
             # Objectifs r√©cemment atteints
-            recent_achievements = StudentObjective.query.filter_by(
-                student_id=student_id,
-                is_achieved=True
-            ).filter(StudentObjective.achievement_date &gt;= date.today() - timedelta(days=7)).all()
+            recent_achievements = (
+                StudentObjective.query.filter_by(
+                    student_id=student_id, is_achieved=True
+                )
+                .filter(
+                    StudentObjective.achievement_date
+                    &gt;= date.today() - timedelta(days=7)
+                )
+                .all()
+            )
 
             for achievement in recent_achievements:
-                notifications.append({
-                    &#x27;type&#x27;: &#x27;success&#x27;,
-                    &#x27;title&#x27;: f&quot;Objectif atteint en {achievement.subject}&quot;,
-                    &#x27;message&#x27;: achievement.objective_text[:100] + &quot;...&quot;,
-                    &#x27;timestamp&#x27;: achievement.achievement_date.isoformat(),
-                    &#x27;icon&#x27;: &#x27;CheckCircle&#x27;
-                })
+                notifications.append(
+                    {
+                        &quot;type&quot;: &quot;success&quot;,
+                        &quot;title&quot;: f&quot;Objectif atteint en {achievement.subject}&quot;,
+                        &quot;message&quot;: achievement.objective_text[:100] + &quot;...&quot;,
+                        &quot;timestamp&quot;: achievement.achievement_date.isoformat(),
+                        &quot;icon&quot;: &quot;CheckCircle&quot;,
+                    }
+                )
 
             # S√©ances report√©es r√©centes
             cancelled_sessions = IndividualSession.query.filter(
                 IndividualSession.student_id == student_id,
-                IndividualSession.status == &#x27;cancelled&#x27;,
-                IndividualSession.scheduled_at &gt;= datetime.utcnow() - timedelta(days=7)
+                IndividualSession.status == &quot;cancelled&quot;,
+                IndividualSession.scheduled_at &gt;= datetime.utcnow() - timedelta(days=7),
             ).all()
 
             for session in cancelled_sessions:
-                notifications.append({
-                    &#x27;type&#x27;: &#x27;warning&#x27;,
-                    &#x27;title&#x27;: &quot;S√©ance report√©e&quot;,
-                    &#x27;message&#x27;: f&quot;{session.subject} du {session.scheduled_at.strftime(&#x27;%d/%m&#x27;)} report√©e&quot;,
-                    &#x27;timestamp&#x27;: session.scheduled_at.isoformat(),
-                    &#x27;icon&#x27;: &#x27;AlertCircle&#x27;
-                })
+                notifications.append(
+                    {
+                        &quot;type&quot;: &quot;warning&quot;,
+                        &quot;title&quot;: &quot;S√©ance report√©e&quot;,
+                        &quot;message&quot;: f&quot;{session.subject} du {session.scheduled_at.strftime(&#x27;%d/%m&#x27;)} report√©e&quot;,
+                        &quot;timestamp&quot;: session.scheduled_at.isoformat(),
+                        &quot;icon&quot;: &quot;AlertCircle&quot;,
+                    }
+                )
 
             # Messages r√©cents des enseignants
             # (Simulation pour la d√©mo)
-            notifications.append({
-                &#x27;type&#x27;: &#x27;info&#x27;,
-                &#x27;title&#x27;: &quot;Message de M. Dubois&quot;,
-                &#x27;message&#x27;: &quot;Nouveau plan de r√©vision disponible&quot;,
-                &#x27;timestamp&#x27;: (datetime.utcnow() - timedelta(days=1)).isoformat(),
-                &#x27;icon&#x27;: &#x27;MessageSquare&#x27;
-            })
+            notifications.append(
+                {
+                    &quot;type&quot;: &quot;info&quot;,
+                    &quot;title&quot;: &quot;Message de M. Dubois&quot;,
+                    &quot;message&quot;: &quot;Nouveau plan de r√©vision disponible&quot;,
+                    &quot;timestamp&quot;: (datetime.utcnow() - timedelta(days=1)).isoformat(),
+                    &quot;icon&quot;: &quot;MessageSquare&quot;,
+                }
+            )
 
             # Trier par timestamp et limiter
-            notifications.sort(key=lambda x: x[&#x27;timestamp&#x27;], reverse=True)
+            notifications.sort(key=lambda x: x[&quot;timestamp&quot;], reverse=True)
             return notifications[:limit]
         except Exception as e:
             print(f&quot;Erreur dans get_recent_notifications: {e}&quot;)
             return []
 
@@ -305,20 +403,23 @@
             # G√©n√©rer les donn√©es pour les derniers mois
             end_date = date.today()
             start_date = end_date - timedelta(days=30 * months)
 
             # R√©cup√©rer les √©valuations par mois
-            assessments = Assessment.query.filter(
-                Assessment.student_id == student_id,
-                Assessment.date &gt;= start_date
-            ).order_by(Assessment.date.asc()).all()
+            assessments = (
+                Assessment.query.filter(
+                    Assessment.student_id == student_id, Assessment.date &gt;= start_date
+                )
+                .order_by(Assessment.date.asc())
+                .all()
+            )
 
             # Organiser par mois et mati√®re
             monthly_data = {}
 
             for assessment in assessments:
-                month_key = assessment.date.strftime(&#x27;%Y-%m&#x27;)
+                month_key = assessment.date.strftime(&quot;%Y-%m&quot;)
                 if month_key not in monthly_data:
                     monthly_data[month_key] = {}
 
                 subject = assessment.subject
                 if subject not in monthly_data[month_key]:
@@ -326,99 +427,116 @@
 
                 monthly_data[month_key][subject].append(assessment.score)
 
             # Calculer les moyennes mensuelles
             chart_data = []
-            month_names = [&#x27;Sept&#x27;, &#x27;Oct&#x27;, &#x27;Nov&#x27;, &#x27;D√©c&#x27;, &#x27;Jan&#x27;, &#x27;F√©v&#x27;, &#x27;Mar&#x27;, &#x27;Avr&#x27;, &#x27;Mai&#x27;, &#x27;Juin&#x27;, &#x27;Juil&#x27;, &#x27;Ao√ªt&#x27;]
+            month_names = [
+                &quot;Sept&quot;,
+                &quot;Oct&quot;,
+                &quot;Nov&quot;,
+                &quot;D√©c&quot;,
+                &quot;Jan&quot;,
+                &quot;F√©v&quot;,
+                &quot;Mar&quot;,
+                &quot;Avr&quot;,
+                &quot;Mai&quot;,
+                &quot;Juin&quot;,
+                &quot;Juil&quot;,
+                &quot;Ao√ªt&quot;,
+            ]
 
             for i in range(months):
                 month_date = end_date - timedelta(days=30 * (months - 1 - i))
-                month_key = month_date.strftime(&#x27;%Y-%m&#x27;)
+                month_key = month_date.strftime(&quot;%Y-%m&quot;)
                 month_name = month_names[month_date.month - 1]
 
-                data_point = {&#x27;month&#x27;: month_name}
+                data_point = {&quot;month&quot;: month_name}
 
                 if month_key in monthly_data:
                     for subject, scores in monthly_data[month_key].items():
                         avg_score = sum(scores) / len(scores)
                         data_point[subject.lower()] = round(avg_score, 1)
                 else:
                     # Donn√©es par d√©faut si pas d&#x27;√©valuations
-                    data_point.update({
-                        &#x27;math&#x27;: 12 + i * 1.5,
-                        &#x27;physics&#x27;: 14 + i * 1,
-                        &#x27;french&#x27;: 16 + i * 0.5
-                    })
+                    data_point.update(
+                        {
+                            &quot;math&quot;: 12 + i * 1.5,
+                            &quot;physics&quot;: 14 + i * 1,
+                            &quot;french&quot;: 16 + i * 0.5,
+                        }
+                    )
 
                 chart_data.append(data_point)
 
             return chart_data
         except Exception as e:
             print(f&quot;Erreur dans get_progress_chart_data: {e}&quot;)
             # Donn√©es par d√©faut en cas d&#x27;erreur
             return [
-                {&#x27;month&#x27;: &#x27;Sept&#x27;, &#x27;math&#x27;: 12, &#x27;physics&#x27;: 14, &#x27;french&#x27;: 16},
-                {&#x27;month&#x27;: &#x27;Oct&#x27;, &#x27;math&#x27;: 14, &#x27;physics&#x27;: 15, &#x27;french&#x27;: 16},
-                {&#x27;month&#x27;: &#x27;Nov&#x27;, &#x27;math&#x27;: 16, &#x27;physics&#x27;: 16, &#x27;french&#x27;: 17},
-                {&#x27;month&#x27;: &#x27;D√©c&#x27;, &#x27;math&#x27;: 17, &#x27;physics&#x27;: 17, &#x27;french&#x27;: 18},
-                {&#x27;month&#x27;: &#x27;Jan&#x27;, &#x27;math&#x27;: 18, &#x27;physics&#x27;: 18, &#x27;french&#x27;: 18}
+                {&quot;month&quot;: &quot;Sept&quot;, &quot;math&quot;: 12, &quot;physics&quot;: 14, &quot;french&quot;: 16},
+                {&quot;month&quot;: &quot;Oct&quot;, &quot;math&quot;: 14, &quot;physics&quot;: 15, &quot;french&quot;: 16},
+                {&quot;month&quot;: &quot;Nov&quot;, &quot;math&quot;: 16, &quot;physics&quot;: 16, &quot;french&quot;: 17},
+                {&quot;month&quot;: &quot;D√©c&quot;, &quot;math&quot;: 17, &quot;physics&quot;: 17, &quot;french&quot;: 18},
+                {&quot;month&quot;: &quot;Jan&quot;, &quot;math&quot;: 18, &quot;physics&quot;: 18, &quot;french&quot;: 18},
             ]
 
     def calculate_aria_confidence(self, student_id):
         &quot;&quot;&quot;Calculer la confiance ARIA pour les pr√©dictions&quot;&quot;&quot;
         try:
             # Facteurs √† consid√©rer pour la confiance
             factors = {
-                &#x27;consistency&#x27;: 0,  # R√©gularit√© des performances
-                &#x27;progress_trend&#x27;: 0,  # Tendance de progression
-                &#x27;engagement&#x27;: 0,  # Niveau d&#x27;engagement
-                &#x27;completion_rate&#x27;: 0  # Taux de completion des objectifs
+                &quot;consistency&quot;: 0,  # R√©gularit√© des performances
+                &quot;progress_trend&quot;: 0,  # Tendance de progression
+                &quot;engagement&quot;: 0,  # Niveau d&#x27;engagement
+                &quot;completion_rate&quot;: 0,  # Taux de completion des objectifs
             }
 
             # Analyser la r√©gularit√© des performances
             recent_assessments = Assessment.query.filter(
                 Assessment.student_id == student_id,
-                Assessment.date &gt;= date.today() - timedelta(days=90)
+                Assessment.date &gt;= date.today() - timedelta(days=90),
             ).all()
 
             if recent_assessments:
                 scores = [a.score for a in recent_assessments]
                 # Calculer la variance (moins de variance = plus de r√©gularit√©)
                 mean_score = sum(scores) / len(scores)
-                variance = sum((score - mean_score) ** 2 for score in scores) / len(scores)
-                factors[&#x27;consistency&#x27;] = max(0, 100 - variance * 5)  # Normaliser
+                variance = sum((score - mean_score) ** 2 for score in scores) / len(
+                    scores
+                )
+                factors[&quot;consistency&quot;] = max(0, 100 - variance * 5)  # Normaliser
 
                 # Tendance de progression
                 if len(scores) &gt;= 3:
                     recent_avg = sum(scores[-3:]) / 3
                     older_avg = sum(scores[:3]) / 3
                     improvement = (recent_avg - older_avg) / older_avg * 100
-                    factors[&#x27;progress_trend&#x27;] = min(100, max(0, 50 + improvement * 10))
+                    factors[&quot;progress_trend&quot;] = min(100, max(0, 50 + improvement * 10))
 
             # Analyser l&#x27;engagement (bas√© sur la pr√©sence aux s√©ances)
-            total_sessions = IndividualSession.query.filter_by(student_id=student_id).count()
+            total_sessions = IndividualSession.query.filter_by(
+                student_id=student_id
+            ).count()
             completed_sessions = IndividualSession.query.filter_by(
-                student_id=student_id,
-                status=&#x27;completed&#x27;
+                student_id=student_id, status=&quot;completed&quot;
             ).count()
 
             if total_sessions &gt; 0:
-                factors[&#x27;engagement&#x27;] = (completed_sessions / total_sessions) * 100
+                factors[&quot;engagement&quot;] = (completed_sessions / total_sessions) * 100
 
             # Taux de completion des objectifs
             objectives_stats = self.get_objectives_progress(student_id)
-            factors[&#x27;completion_rate&#x27;] = objectives_stats[&#x27;achievement_rate&#x27;]
+            factors[&quot;completion_rate&quot;] = objectives_stats[&quot;achievement_rate&quot;]
 
             # Calculer la confiance globale (moyenne pond√©r√©e)
             weights = {
-                &#x27;consistency&#x27;: 0.3,
-                &#x27;progress_trend&#x27;: 0.3,
-                &#x27;engagement&#x27;: 0.2,
-                &#x27;completion_rate&#x27;: 0.2
+                &quot;consistency&quot;: 0.3,
+                &quot;progress_trend&quot;: 0.3,
+                &quot;engagement&quot;: 0.2,
+                &quot;completion_rate&quot;: 0.2,
             }
 
             confidence = sum(factors[key] * weights[key] for key in factors)
             return min(100, max(0, round(confidence)))
         except Exception as e:
             print(f&quot;Erreur dans calculate_aria_confidence: {e}&quot;)
             return 94  # Valeur par d√©faut
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/websocket_service.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/websocket_service.py	2025-07-24 20:54:02.593253+00:00
@@ -17,12 +17,14 @@
 
 # Configuration du logging
 logging.basicConfig(level=logging.INFO)
 logger = logging.getLogger(__name__)
 
+
 class NotificationType(Enum):
     &quot;&quot;&quot;Types de notifications support√©es&quot;&quot;&quot;
+
     STUDENT_PROGRESS = &quot;student_progress&quot;
     TEACHER_MESSAGE = &quot;teacher_message&quot;
     COURSE_UPDATE = &quot;course_update&quot;
     ARIA_RESPONSE = &quot;aria_response&quot;
     SYSTEM_ALERT = &quot;system_alert&quot;
@@ -30,20 +32,24 @@
     SCHEDULE_CHANGE = &quot;schedule_change&quot;
     ACHIEVEMENT_UNLOCKED = &quot;achievement_unlocked&quot;
     REMINDER = &quot;reminder&quot;
     EMERGENCY = &quot;emergency&quot;
 
+
 class UserRole(Enum):
     &quot;&quot;&quot;R√¥les utilisateur pour les notifications&quot;&quot;&quot;
+
     STUDENT = &quot;student&quot;
     PARENT = &quot;parent&quot;
     TEACHER = &quot;teacher&quot;
     ADMIN = &quot;admin&quot;
 
+
 @dataclass
 class Notification:
     &quot;&quot;&quot;Structure d&#x27;une notification&quot;&quot;&quot;
+
     id: str
     type: NotificationType
     title: str
     message: str
     recipient_id: str
@@ -59,30 +65,35 @@
             self.timestamp = datetime.utcnow().isoformat()
 
     def to_dict(self) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Convertit la notification en dictionnaire&quot;&quot;&quot;
         result = asdict(self)
-        result[&#x27;type&#x27;] = self.type.value
-        result[&#x27;recipient_role&#x27;] = self.recipient_role.value
+        result[&quot;type&quot;] = self.type.value
+        result[&quot;recipient_role&quot;] = self.recipient_role.value
         return result
+
 
 @dataclass
 class WebSocketConnection:
     &quot;&quot;&quot;Repr√©sente une connexion WebSocket active&quot;&quot;&quot;
+
     websocket: WebSocketServerProtocol
     user_id: str
     user_role: UserRole
     connected_at: datetime
     last_ping: datetime
 
+
 class WebSocketService:
     &quot;&quot;&quot;Service de gestion des WebSockets et notifications&quot;&quot;&quot;
 
     def __init__(self, jwt_secret: str = &quot;nexus_secret_key&quot;):
         self.jwt_secret = jwt_secret
         self.connections: Dict[str, WebSocketConnection] = {}
-        self.user_connections: Dict[str, Set[str]] = {}  # user_id -&gt; set of connection_ids
+        self.user_connections: Dict[str, Set[str]] = (
+            {}
+        )  # user_id -&gt; set of connection_ids
         self.notification_history: List[Notification] = []
         self.running = False
 
     def authenticate_token(self, token: str) -&gt; Optional[Dict[str, Any]]:
         &quot;&quot;&quot;Authentifie un token JWT&quot;&quot;&quot;
@@ -96,29 +107,33 @@
     def generate_connection_id(self, user_id: str) -&gt; str:
         &quot;&quot;&quot;G√©n√®re un ID unique pour une connexion&quot;&quot;&quot;
         timestamp = datetime.utcnow().timestamp()
         return f&quot;{user_id}_{int(timestamp * 1000)}&quot;
 
-    async def register_connection(self, websocket: WebSocketServerProtocol, user_id: str, user_role: UserRole) -&gt; str:
+    async def register_connection(
+        self, websocket: WebSocketServerProtocol, user_id: str, user_role: UserRole
+    ) -&gt; str:
         &quot;&quot;&quot;Enregistre une nouvelle connexion WebSocket&quot;&quot;&quot;
         connection_id = self.generate_connection_id(user_id)
 
         connection = WebSocketConnection(
             websocket=websocket,
             user_id=user_id,
             user_role=user_role,
             connected_at=datetime.utcnow(),
-            last_ping=datetime.utcnow()
+            last_ping=datetime.utcnow(),
         )
 
         self.connections[connection_id] = connection
 
         if user_id not in self.user_connections:
             self.user_connections[user_id] = set()
         self.user_connections[user_id].add(connection_id)
 
-        logger.info(f&quot;Nouvelle connexion WebSocket: {connection_id} pour {user_id} ({user_role.value})&quot;)
+        logger.info(
+            f&quot;Nouvelle connexion WebSocket: {connection_id} pour {user_id} ({user_role.value})&quot;
+        )
 
         # Envoyer les notifications non lues
         await self.send_unread_notifications(user_id, user_role)
 
         return connection_id
@@ -136,11 +151,13 @@
                 if not self.user_connections[user_id]:
                     del self.user_connections[user_id]
 
             logger.info(f&quot;Connexion WebSocket ferm√©e: {connection_id}&quot;)
 
-    async def send_to_connection(self, connection_id: str, message: Dict[str, Any]) -&gt; bool:
+    async def send_to_connection(
+        self, connection_id: str, message: Dict[str, Any]
+    ) -&gt; bool:
         &quot;&quot;&quot;Envoie un message √† une connexion sp√©cifique&quot;&quot;&quot;
         if connection_id not in self.connections:
             return False
 
         connection = self.connections[connection_id]
@@ -195,70 +212,72 @@
         &quot;&quot;&quot;Envoie une notification √† un utilisateur&quot;&quot;&quot;
         # Ajouter √† l&#x27;historique
         self.notification_history.append(notification)
 
         # Pr√©parer le message
-        message = {
-            &quot;type&quot;: &quot;notification&quot;,
-            &quot;data&quot;: notification.to_dict()
-        }
+        message = {&quot;type&quot;: &quot;notification&quot;, &quot;data&quot;: notification.to_dict()}
 
         # Envoyer √† l&#x27;utilisateur
         sent_count = await self.send_to_user(notification.recipient_id, message)
 
         if sent_count &gt; 0:
-            logger.info(f&quot;Notification envoy√©e √† {notification.recipient_id}: {notification.title}&quot;)
+            logger.info(
+                f&quot;Notification envoy√©e √† {notification.recipient_id}: {notification.title}&quot;
+            )
             return True
         else:
-            logger.warning(f&quot;Impossible d&#x27;envoyer la notification √† {notification.recipient_id}&quot;)
+            logger.warning(
+                f&quot;Impossible d&#x27;envoyer la notification √† {notification.recipient_id}&quot;
+            )
             return False
 
     async def send_unread_notifications(self, user_id: str, user_role: UserRole):
         &quot;&quot;&quot;Envoie les notifications non lues √† un utilisateur&quot;&quot;&quot;
         unread_notifications = [
-            notif for notif in self.notification_history
+            notif
+            for notif in self.notification_history
             if notif.recipient_id == user_id and not notif.read
         ]
 
         for notification in unread_notifications:
-            message = {
-                &quot;type&quot;: &quot;notification&quot;,
-                &quot;data&quot;: notification.to_dict()
-            }
+            message = {&quot;type&quot;: &quot;notification&quot;, &quot;data&quot;: notification.to_dict()}
             await self.send_to_user(user_id, message)
 
     def mark_notification_as_read(self, notification_id: str, user_id: str) -&gt; bool:
         &quot;&quot;&quot;Marque une notification comme lue&quot;&quot;&quot;
         for notification in self.notification_history:
-            if notification.id == notification_id and notification.recipient_id == user_id:
+            if (
+                notification.id == notification_id
+                and notification.recipient_id == user_id
+            ):
                 notification.read = True
                 return True
         return False
 
-    def get_user_notifications(self, user_id: str, limit: int = 50) -&gt; List[Dict[str, Any]]:
+    def get_user_notifications(
+        self, user_id: str, limit: int = 50
+    ) -&gt; List[Dict[str, Any]]:
         &quot;&quot;&quot;R√©cup√®re les notifications d&#x27;un utilisateur&quot;&quot;&quot;
         user_notifications = [
-            notif.to_dict() for notif in self.notification_history
+            notif.to_dict()
+            for notif in self.notification_history
             if notif.recipient_id == user_id
         ]
 
         # Trier par timestamp d√©croissant
-        user_notifications.sort(key=lambda x: x[&#x27;timestamp&#x27;], reverse=True)
+        user_notifications.sort(key=lambda x: x[&quot;timestamp&quot;], reverse=True)
 
         return user_notifications[:limit]
 
     async def ping_connections(self):
         &quot;&quot;&quot;Envoie un ping √† toutes les connexions pour v√©rifier leur √©tat&quot;&quot;&quot;
         current_time = datetime.utcnow()
         dead_connections = []
 
         for connection_id, connection in self.connections.items():
             try:
-                ping_message = {
-                    &quot;type&quot;: &quot;ping&quot;,
-                    &quot;timestamp&quot;: current_time.isoformat()
-                }
+                ping_message = {&quot;type&quot;: &quot;ping&quot;, &quot;timestamp&quot;: current_time.isoformat()}
                 await connection.websocket.send(json.dumps(ping_message))
                 connection.last_ping = current_time
             except websockets.exceptions.ConnectionClosed:
                 dead_connections.append(connection_id)
             except Exception as e:
@@ -277,57 +296,64 @@
             # Attendre le message d&#x27;authentification
             auth_message = await websocket.recv()
             auth_data = json.loads(auth_message)
 
             if auth_data.get(&quot;type&quot;) != &quot;auth&quot;:
-                await websocket.send(json.dumps({
-                    &quot;type&quot;: &quot;error&quot;,
-                    &quot;message&quot;: &quot;Message d&#x27;authentification requis&quot;
-                }))
+                await websocket.send(
+                    json.dumps(
+                        {
+                            &quot;type&quot;: &quot;error&quot;,
+                            &quot;message&quot;: &quot;Message d&#x27;authentification requis&quot;,
+                        }
+                    )
+                )
                 return
 
             # V√©rifier le token
             token = auth_data.get(&quot;token&quot;)
             if not token:
-                await websocket.send(json.dumps({
-                    &quot;type&quot;: &quot;error&quot;,
-                    &quot;message&quot;: &quot;Token manquant&quot;
-                }))
+                await websocket.send(
+                    json.dumps({&quot;type&quot;: &quot;error&quot;, &quot;message&quot;: &quot;Token manquant&quot;})
+                )
                 return
 
             user_data = self.authenticate_token(token)
             if not user_data:
-                await websocket.send(json.dumps({
-                    &quot;type&quot;: &quot;error&quot;,
-                    &quot;message&quot;: &quot;Token invalide&quot;
-                }))
+                await websocket.send(
+                    json.dumps({&quot;type&quot;: &quot;error&quot;, &quot;message&quot;: &quot;Token invalide&quot;})
+                )
                 return
 
             user_id = user_data.get(&quot;user_id&quot;)
             user_role = UserRole(user_data.get(&quot;role&quot;, &quot;student&quot;))
 
             # Enregistrer la connexion
-            connection_id = await self.register_connection(websocket, user_id, user_role)
+            connection_id = await self.register_connection(
+                websocket, user_id, user_role
+            )
 
             # Confirmer l&#x27;authentification
-            await websocket.send(json.dumps({
-                &quot;type&quot;: &quot;auth_success&quot;,
-                &quot;connection_id&quot;: connection_id,
-                &quot;user_id&quot;: user_id,
-                &quot;role&quot;: user_role.value
-            }))
+            await websocket.send(
+                json.dumps(
+                    {
+                        &quot;type&quot;: &quot;auth_success&quot;,
+                        &quot;connection_id&quot;: connection_id,
+                        &quot;user_id&quot;: user_id,
+                        &quot;role&quot;: user_role.value,
+                    }
+                )
+            )
 
             # Boucle de traitement des messages
             async for message in websocket:
                 try:
                     data = json.loads(message)
                     await self.handle_message(connection_id, data)
                 except json.JSONDecodeError:
-                    await websocket.send(json.dumps({
-                        &quot;type&quot;: &quot;error&quot;,
-                        &quot;message&quot;: &quot;Format JSON invalide&quot;
-                    }))
+                    await websocket.send(
+                        json.dumps({&quot;type&quot;: &quot;error&quot;, &quot;message&quot;: &quot;Format JSON invalide&quot;})
+                    )
                 except Exception as e:
                     logger.error(f&quot;Erreur lors du traitement du message: {e}&quot;)
 
         except websockets.exceptions.ConnectionClosed:
             logger.info(&quot;Connexion WebSocket ferm√©e&quot;)
@@ -354,11 +380,11 @@
                 success = self.mark_notification_as_read(notification_id, user_id)
 
                 response = {
                     &quot;type&quot;: &quot;mark_read_response&quot;,
                     &quot;notification_id&quot;: notification_id,
-                    &quot;success&quot;: success
+                    &quot;success&quot;: success,
                 }
                 await self.send_to_connection(connection_id, response)
 
         elif message_type == &quot;get_notifications&quot;:
             # R√©cup√©rer les notifications
@@ -367,11 +393,11 @@
                 limit = data.get(&quot;limit&quot;, 50)
                 notifications = self.get_user_notifications(user_id, limit)
 
                 response = {
                     &quot;type&quot;: &quot;notifications_list&quot;,
-                    &quot;notifications&quot;: notifications
+                    &quot;notifications&quot;: notifications,
                 }
                 await self.send_to_connection(connection_id, response)
 
     async def start_ping_task(self):
         &quot;&quot;&quot;D√©marre la t√¢che de ping p√©riodique&quot;&quot;&quot;
@@ -398,77 +424,93 @@
         except KeyboardInterrupt:
             logger.info(&quot;Arr√™t du serveur WebSocket&quot;)
         finally:
             self.running = False
 
+
 # Fonctions utilitaires pour cr√©er des notifications
 
-def create_student_progress_notification(student_id: str, subject: str, progress: float) -&gt; Notification:
+
+def create_student_progress_notification(
+    student_id: str, subject: str, progress: float
+) -&gt; Notification:
     &quot;&quot;&quot;Cr√©e une notification de progression d&#x27;√©l√®ve&quot;&quot;&quot;
     return Notification(
         id=f&quot;progress_{student_id}_{datetime.utcnow().timestamp()}&quot;,
         type=NotificationType.STUDENT_PROGRESS,
         title=&quot;Progression mise √† jour&quot;,
         message=f&quot;Votre progression en {subject} est maintenant de {progress}%&quot;,
         recipient_id=student_id,
         recipient_role=UserRole.STUDENT,
-        data={&quot;subject&quot;: subject, &quot;progress&quot;: progress}
+        data={&quot;subject&quot;: subject, &quot;progress&quot;: progress},
     )
 
-def create_teacher_message_notification(student_id: str, teacher_name: str, message: str) -&gt; Notification:
+
+def create_teacher_message_notification(
+    student_id: str, teacher_name: str, message: str
+) -&gt; Notification:
     &quot;&quot;&quot;Cr√©e une notification de message d&#x27;enseignant&quot;&quot;&quot;
     return Notification(
         id=f&quot;teacher_msg_{student_id}_{datetime.utcnow().timestamp()}&quot;,
         type=NotificationType.TEACHER_MESSAGE,
         title=f&quot;Message de {teacher_name}&quot;,
         message=message,
         recipient_id=student_id,
         recipient_role=UserRole.STUDENT,
         data={&quot;teacher_name&quot;: teacher_name},
-        priority=&quot;high&quot;
+        priority=&quot;high&quot;,
     )
 
-def create_achievement_notification(student_id: str, achievement_name: str, description: str) -&gt; Notification:
+
+def create_achievement_notification(
+    student_id: str, achievement_name: str, description: str
+) -&gt; Notification:
     &quot;&quot;&quot;Cr√©e une notification de r√©ussite d√©bloqu√©e&quot;&quot;&quot;
     return Notification(
         id=f&quot;achievement_{student_id}_{datetime.utcnow().timestamp()}&quot;,
         type=NotificationType.ACHIEVEMENT_UNLOCKED,
         title=&quot;Nouvelle r√©ussite d√©bloqu√©e !&quot;,
         message=f&quot;F√©licitations ! Vous avez d√©bloqu√© : {achievement_name}&quot;,
         recipient_id=student_id,
         recipient_role=UserRole.STUDENT,
         data={&quot;achievement_name&quot;: achievement_name, &quot;description&quot;: description},
-        priority=&quot;high&quot;
+        priority=&quot;high&quot;,
     )
 
-def create_parent_notification(parent_id: str, student_name: str, message: str, data: Dict[str, Any] = None) -&gt; Notification:
+
+def create_parent_notification(
+    parent_id: str, student_name: str, message: str, data: Dict[str, Any] = None
+) -&gt; Notification:
     &quot;&quot;&quot;Cr√©e une notification pour un parent&quot;&quot;&quot;
     return Notification(
         id=f&quot;parent_{parent_id}_{datetime.utcnow().timestamp()}&quot;,
         type=NotificationType.STUDENT_PROGRESS,
         title=f&quot;Mise √† jour - {student_name}&quot;,
         message=message,
         recipient_id=parent_id,
         recipient_role=UserRole.PARENT,
-        data=data or {}
+        data=data or {},
     )
 
-def create_system_alert(admin_id: str, title: str, message: str, priority: str = &quot;normal&quot;) -&gt; Notification:
+
+def create_system_alert(
+    admin_id: str, title: str, message: str, priority: str = &quot;normal&quot;
+) -&gt; Notification:
     &quot;&quot;&quot;Cr√©e une alerte syst√®me pour un administrateur&quot;&quot;&quot;
     return Notification(
         id=f&quot;system_{admin_id}_{datetime.utcnow().timestamp()}&quot;,
         type=NotificationType.SYSTEM_ALERT,
         title=title,
         message=message,
         recipient_id=admin_id,
         recipient_role=UserRole.ADMIN,
-        priority=priority
+        priority=priority,
     )
+
 
 # Instance globale du service
 websocket_service = WebSocketService()
 
 if __name__ == &quot;__main__&quot;:
     # Test du serveur WebSocket
     service = WebSocketService()
     service.start_server(&quot;0.0.0.0&quot;, 8765)
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/video_conference.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/video_conference.py	2025-07-24 20:54:02.601229+00:00
@@ -14,38 +14,46 @@
 from dataclasses import dataclass, asdict
 from enum import Enum
 import requests
 from urllib.parse import urlencode
 
+
 class ConferenceStatus(Enum):
     &quot;&quot;&quot;√âtats d&#x27;une conf√©rence&quot;&quot;&quot;
+
     SCHEDULED = &quot;scheduled&quot;
     ACTIVE = &quot;active&quot;
     ENDED = &quot;ended&quot;
     CANCELLED = &quot;cancelled&quot;
 
+
 class ParticipantRole(Enum):
     &quot;&quot;&quot;R√¥les des participants&quot;&quot;&quot;
+
     MODERATOR = &quot;moderator&quot;
     PARTICIPANT = &quot;participant&quot;
     OBSERVER = &quot;observer&quot;
 
+
 @dataclass
 class ConferenceParticipant:
     &quot;&quot;&quot;Participant √† une conf√©rence&quot;&quot;&quot;
+
     user_id: str
     name: str
     email: str
     role: ParticipantRole
     avatar_url: Optional[str] = None
     joined_at: Optional[datetime] = None
     left_at: Optional[datetime] = None
     duration: Optional[int] = None  # en secondes
 
+
 @dataclass
 class ConferenceRoom:
     &quot;&quot;&quot;Salle de conf√©rence&quot;&quot;&quot;
+
     room_id: str
     room_name: str
     subject: str
     teacher_id: str
     teacher_name: str
@@ -63,14 +71,17 @@
 
     def __post_init__(self):
         if self.participants is None:
             self.participants = []
 
+
 class VideoConferenceService:
     &quot;&quot;&quot;Service de gestion des visioconf√©rences&quot;&quot;&quot;
 
-    def __init__(self, jitsi_domain: str = &quot;meet.jit.si&quot;, app_id: str = &quot;nexus_reussite&quot;):
+    def __init__(
+        self, jitsi_domain: str = &quot;meet.jit.si&quot;, app_id: str = &quot;nexus_reussite&quot;
+    ):
         self.jitsi_domain = jitsi_domain
         self.app_id = app_id
         self.jwt_secret = &quot;nexus_jitsi_secret_key&quot;  # √Ä configurer en production
         self.active_rooms: Dict[str, ConferenceRoom] = {}
         self.room_history: List[ConferenceRoom] = []
@@ -79,65 +90,77 @@
         &quot;&quot;&quot;G√©n√®re un ID unique pour une salle&quot;&quot;&quot;
         timestamp = int(time.time())
         unique_string = f&quot;{teacher_id}_{subject}_{timestamp}&quot;
         return hashlib.md5(unique_string.encode()).hexdigest()[:12]
 
-    def generate_jwt_token(self, room_name: str, user_id: str, user_name: str,
-                          role: ParticipantRole = ParticipantRole.PARTICIPANT,
-                          avatar_url: str = None) -&gt; str:
+    def generate_jwt_token(
+        self,
+        room_name: str,
+        user_id: str,
+        user_name: str,
+        role: ParticipantRole = ParticipantRole.PARTICIPANT,
+        avatar_url: str = None,
+    ) -&gt; str:
         &quot;&quot;&quot;G√©n√®re un token JWT pour l&#x27;authentification Jitsi&quot;&quot;&quot;
 
         # Header JWT
-        header = {
-            &quot;alg&quot;: &quot;HS256&quot;,
-            &quot;typ&quot;: &quot;JWT&quot;
-        }
+        header = {&quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;}
 
         # Payload JWT
         now = int(time.time())
         payload = {
             &quot;iss&quot;: self.app_id,
             &quot;aud&quot;: &quot;jitsi&quot;,
             &quot;exp&quot;: now + 3600,  # Expire dans 1 heure
-            &quot;nbf&quot;: now - 10,    # Valide depuis 10 secondes avant
+            &quot;nbf&quot;: now - 10,  # Valide depuis 10 secondes avant
             &quot;sub&quot;: self.jitsi_domain,
             &quot;room&quot;: room_name,
             &quot;context&quot;: {
                 &quot;user&quot;: {
                     &quot;id&quot;: user_id,
                     &quot;name&quot;: user_name,
                     &quot;email&quot;: f&quot;{user_id}@nexusreussite.tn&quot;,
-                    &quot;avatar&quot;: avatar_url or f&quot;https://api.dicebear.com/7.x/initials/svg?seed={user_name}&quot;
+                    &quot;avatar&quot;: avatar_url
+                    or f&quot;https://api.dicebear.com/7.x/initials/svg?seed={user_name}&quot;,
                 },
                 &quot;features&quot;: {
                     &quot;livestreaming&quot;: role == ParticipantRole.MODERATOR,
                     &quot;recording&quot;: role == ParticipantRole.MODERATOR,
                     &quot;transcription&quot;: True,
-                    &quot;outbound-call&quot;: False
-                }
+                    &quot;outbound-call&quot;: False,
+                },
             },
-            &quot;moderator&quot;: role == ParticipantRole.MODERATOR
+            &quot;moderator&quot;: role == ParticipantRole.MODERATOR,
         }
 
         # Encoder le JWT
-        header_encoded = base64.urlsafe_b64encode(json.dumps(header).encode()).decode().rstrip(&#x27;=&#x27;)
-        payload_encoded = base64.urlsafe_b64encode(json.dumps(payload).encode()).decode().rstrip(&#x27;=&#x27;)
+        header_encoded = (
+            base64.urlsafe_b64encode(json.dumps(header).encode()).decode().rstrip(&quot;=&quot;)
+        )
+        payload_encoded = (
+            base64.urlsafe_b64encode(json.dumps(payload).encode()).decode().rstrip(&quot;=&quot;)
+        )
 
         # Cr√©er la signature
         message = f&quot;{header_encoded}.{payload_encoded}&quot;
         signature = hmac.new(
-            self.jwt_secret.encode(),
-            message.encode(),
-            hashlib.sha256
+            self.jwt_secret.encode(), message.encode(), hashlib.sha256
         ).digest()
-        signature_encoded = base64.urlsafe_b64encode(signature).decode().rstrip(&#x27;=&#x27;)
+        signature_encoded = base64.urlsafe_b64encode(signature).decode().rstrip(&quot;=&quot;)
 
         return f&quot;{message}.{signature_encoded}&quot;
 
-    def create_conference_room(self, teacher_id: str, teacher_name: str, subject: str,
-                             scheduled_start: datetime, duration_minutes: int = 60,
-                             max_participants: int = 10, description: str = None) -&gt; ConferenceRoom:
+    def create_conference_room(
+        self,
+        teacher_id: str,
+        teacher_name: str,
+        subject: str,
+        scheduled_start: datetime,
+        duration_minutes: int = 60,
+        max_participants: int = 10,
+        description: str = None,
+    ) -&gt; ConferenceRoom:
         &quot;&quot;&quot;Cr√©e une nouvelle salle de conf√©rence&quot;&quot;&quot;
 
         room_id = self.generate_room_id(teacher_id, subject)
         room_name = f&quot;nexus_{subject.lower().replace(&#x27; &#x27;, &#x27;_&#x27;)}_{room_id}&quot;
 
@@ -150,84 +173,128 @@
             teacher_id=teacher_id,
             teacher_name=teacher_name,
             scheduled_start=scheduled_start,
             scheduled_end=scheduled_end,
             max_participants=max_participants,
-            description=description or f&quot;Cours de {subject} avec {teacher_name}&quot;
+            description=description or f&quot;Cours de {subject} avec {teacher_name}&quot;,
         )
 
         self.active_rooms[room_id] = room
         return room
 
-    def get_conference_url(self, room: ConferenceRoom, user_id: str, user_name: str,
-                          role: ParticipantRole = ParticipantRole.PARTICIPANT) -&gt; str:
+    def get_conference_url(
+        self,
+        room: ConferenceRoom,
+        user_id: str,
+        user_name: str,
+        role: ParticipantRole = ParticipantRole.PARTICIPANT,
+    ) -&gt; str:
         &quot;&quot;&quot;G√©n√®re l&#x27;URL de la conf√©rence pour un utilisateur&quot;&quot;&quot;
 
         # G√©n√©rer le token JWT
         jwt_token = self.generate_jwt_token(room.room_name, user_id, user_name, role)
 
         # Param√®tres de configuration
         config_params = {
-            &#x27;jwt&#x27;: jwt_token,
-            &#x27;config.startWithAudioMuted&#x27;: &#x27;true&#x27; if role != ParticipantRole.MODERATOR else &#x27;false&#x27;,
-            &#x27;config.startWithVideoMuted&#x27;: &#x27;false&#x27;,
-            &#x27;config.requireDisplayName&#x27;: &#x27;true&#x27;,
-            &#x27;config.enableWelcomePage&#x27;: &#x27;false&#x27;,
-            &#x27;config.prejoinPageEnabled&#x27;: &#x27;true&#x27;,
-            &#x27;config.disableInviteFunctions&#x27;: &#x27;true&#x27; if role != ParticipantRole.MODERATOR else &#x27;false&#x27;,
-            &#x27;config.toolbarButtons&#x27;: json.dumps([
-                &#x27;microphone&#x27;, &#x27;camera&#x27;, &#x27;closedcaptions&#x27;, &#x27;desktop&#x27;, &#x27;fullscreen&#x27;,
-                &#x27;fodeviceselection&#x27;, &#x27;hangup&#x27;, &#x27;profile&#x27;, &#x27;chat&#x27;, &#x27;recording&#x27;,
-                &#x27;livestreaming&#x27;, &#x27;etherpad&#x27;, &#x27;sharedvideo&#x27;, &#x27;settings&#x27;, &#x27;raisehand&#x27;,
-                &#x27;videoquality&#x27;, &#x27;filmstrip&#x27;, &#x27;invite&#x27;, &#x27;feedback&#x27;, &#x27;stats&#x27;, &#x27;shortcuts&#x27;
-            ]) if role == ParticipantRole.MODERATOR else json.dumps([
-                &#x27;microphone&#x27;, &#x27;camera&#x27;, &#x27;closedcaptions&#x27;, &#x27;fullscreen&#x27;,
-                &#x27;hangup&#x27;, &#x27;profile&#x27;, &#x27;chat&#x27;, &#x27;raisehand&#x27;, &#x27;filmstrip&#x27;
-            ])
+            &quot;jwt&quot;: jwt_token,
+            &quot;config.startWithAudioMuted&quot;: (
+                &quot;true&quot; if role != ParticipantRole.MODERATOR else &quot;false&quot;
+            ),
+            &quot;config.startWithVideoMuted&quot;: &quot;false&quot;,
+            &quot;config.requireDisplayName&quot;: &quot;true&quot;,
+            &quot;config.enableWelcomePage&quot;: &quot;false&quot;,
+            &quot;config.prejoinPageEnabled&quot;: &quot;true&quot;,
+            &quot;config.disableInviteFunctions&quot;: (
+                &quot;true&quot; if role != ParticipantRole.MODERATOR else &quot;false&quot;
+            ),
+            &quot;config.toolbarButtons&quot;: (
+                json.dumps(
+                    [
+                        &quot;microphone&quot;,
+                        &quot;camera&quot;,
+                        &quot;closedcaptions&quot;,
+                        &quot;desktop&quot;,
+                        &quot;fullscreen&quot;,
+                        &quot;fodeviceselection&quot;,
+                        &quot;hangup&quot;,
+                        &quot;profile&quot;,
+                        &quot;chat&quot;,
+                        &quot;recording&quot;,
+                        &quot;livestreaming&quot;,
+                        &quot;etherpad&quot;,
+                        &quot;sharedvideo&quot;,
+                        &quot;settings&quot;,
+                        &quot;raisehand&quot;,
+                        &quot;videoquality&quot;,
+                        &quot;filmstrip&quot;,
+                        &quot;invite&quot;,
+                        &quot;feedback&quot;,
+                        &quot;stats&quot;,
+                        &quot;shortcuts&quot;,
+                    ]
+                )
+                if role == ParticipantRole.MODERATOR
+                else json.dumps(
+                    [
+                        &quot;microphone&quot;,
+                        &quot;camera&quot;,
+                        &quot;closedcaptions&quot;,
+                        &quot;fullscreen&quot;,
+                        &quot;hangup&quot;,
+                        &quot;profile&quot;,
+                        &quot;chat&quot;,
+                        &quot;raisehand&quot;,
+                        &quot;filmstrip&quot;,
+                    ]
+                )
+            ),
         }
 
         # Interface personnalis√©e
         interface_config = {
-            &#x27;BRAND_WATERMARK_LINK&#x27;: &#x27;https://nexusreussite.tn&#x27;,
-            &#x27;SHOW_BRAND_WATERMARK&#x27;: True,
-            &#x27;SHOW_JITSI_WATERMARK&#x27;: False,
-            &#x27;SHOW_POWERED_BY&#x27;: False,
-            &#x27;SHOW_PROMOTIONAL_CLOSE_PAGE&#x27;: False,
-            &#x27;TOOLBAR_BUTTONS&#x27;: config_params[&#x27;config.toolbarButtons&#x27;],
-            &#x27;SETTINGS_SECTIONS&#x27;: [&#x27;devices&#x27;, &#x27;language&#x27;, &#x27;moderator&#x27;, &#x27;profile&#x27;, &#x27;calendar&#x27;],
-            &#x27;VIDEO_LAYOUT_FIT&#x27;: &#x27;both&#x27;,
-            &#x27;filmStripOnly&#x27;: False,
-            &#x27;VERTICAL_FILMSTRIP&#x27;: True
+            &quot;BRAND_WATERMARK_LINK&quot;: &quot;https://nexusreussite.tn&quot;,
+            &quot;SHOW_BRAND_WATERMARK&quot;: True,
+            &quot;SHOW_JITSI_WATERMARK&quot;: False,
+            &quot;SHOW_POWERED_BY&quot;: False,
+            &quot;SHOW_PROMOTIONAL_CLOSE_PAGE&quot;: False,
+            &quot;TOOLBAR_BUTTONS&quot;: config_params[&quot;config.toolbarButtons&quot;],
+            &quot;SETTINGS_SECTIONS&quot;: [
+                &quot;devices&quot;,
+                &quot;language&quot;,
+                &quot;moderator&quot;,
+                &quot;profile&quot;,
+                &quot;calendar&quot;,
+            ],
+            &quot;VIDEO_LAYOUT_FIT&quot;: &quot;both&quot;,
+            &quot;filmStripOnly&quot;: False,
+            &quot;VERTICAL_FILMSTRIP&quot;: True,
         }
 
         # Construire l&#x27;URL
         base_url = f&quot;https://{self.jitsi_domain}/{room.room_name}&quot;
-        params = {
-            **config_params,
-            &#x27;interfaceConfig&#x27;: json.dumps(interface_config)
-        }
+        params = {**config_params, &quot;interfaceConfig&quot;: json.dumps(interface_config)}
 
         return f&quot;{base_url}#{urlencode(params)}&quot;
 
-    def join_conference(self, room_id: str, user_id: str, user_name: str, user_email: str,
-                       role: ParticipantRole = ParticipantRole.PARTICIPANT) -&gt; Dict[str, Any]:
+    def join_conference(
+        self,
+        room_id: str,
+        user_id: str,
+        user_name: str,
+        user_email: str,
+        role: ParticipantRole = ParticipantRole.PARTICIPANT,
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Fait rejoindre un utilisateur √† une conf√©rence&quot;&quot;&quot;
 
         if room_id not in self.active_rooms:
-            return {
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle de conf√©rence non trouv√©e&#x27;
-            }
+            return {&quot;success&quot;: False, &quot;error&quot;: &quot;Salle de conf√©rence non trouv√©e&quot;}
 
         room = self.active_rooms[room_id]
 
         # V√©rifier si la salle n&#x27;est pas pleine
         if len(room.participants) &gt;= room.max_participants:
-            return {
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle de conf√©rence pleine&#x27;
-            }
+            return {&quot;success&quot;: False, &quot;error&quot;: &quot;Salle de conf√©rence pleine&quot;}
 
         # V√©rifier si l&#x27;utilisateur n&#x27;est pas d√©j√† dans la salle
         existing_participant = next(
             (p for p in room.participants if p.user_id == user_id), None
         )
@@ -240,11 +307,11 @@
             participant = ConferenceParticipant(
                 user_id=user_id,
                 name=user_name,
                 email=user_email,
                 role=role,
-                joined_at=datetime.utcnow()
+                joined_at=datetime.utcnow(),
             )
             room.participants.append(participant)
 
         # D√©marrer la conf√©rence si c&#x27;est le premier participant
         if room.status == ConferenceStatus.SCHEDULED and len(room.participants) == 1:
@@ -253,48 +320,42 @@
 
         # G√©n√©rer l&#x27;URL de la conf√©rence
         conference_url = self.get_conference_url(room, user_id, user_name, role)
 
         return {
-            &#x27;success&#x27;: True,
-            &#x27;conference_url&#x27;: conference_url,
-            &#x27;room_info&#x27;: {
-                &#x27;room_id&#x27;: room.room_id,
-                &#x27;subject&#x27;: room.subject,
-                &#x27;teacher_name&#x27;: room.teacher_name,
-                &#x27;participants_count&#x27;: len(room.participants),
-                &#x27;max_participants&#x27;: room.max_participants,
-                &#x27;status&#x27;: room.status.value
-            }
+            &quot;success&quot;: True,
+            &quot;conference_url&quot;: conference_url,
+            &quot;room_info&quot;: {
+                &quot;room_id&quot;: room.room_id,
+                &quot;subject&quot;: room.subject,
+                &quot;teacher_name&quot;: room.teacher_name,
+                &quot;participants_count&quot;: len(room.participants),
+                &quot;max_participants&quot;: room.max_participants,
+                &quot;status&quot;: room.status.value,
+            },
         }
 
     def leave_conference(self, room_id: str, user_id: str) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Fait quitter un utilisateur d&#x27;une conf√©rence&quot;&quot;&quot;
 
         if room_id not in self.active_rooms:
-            return {
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle de conf√©rence non trouv√©e&#x27;
-            }
+            return {&quot;success&quot;: False, &quot;error&quot;: &quot;Salle de conf√©rence non trouv√©e&quot;}
 
         room = self.active_rooms[room_id]
 
         # Trouver le participant
-        participant = next(
-            (p for p in room.participants if p.user_id == user_id), None
-        )
+        participant = next((p for p in room.participants if p.user_id == user_id), None)
 
         if not participant:
-            return {
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Participant non trouv√© dans la salle&#x27;
-            }
+            return {&quot;success&quot;: False, &quot;error&quot;: &quot;Participant non trouv√© dans la salle&quot;}
 
         # Mettre √† jour les informations de d√©part
         participant.left_at = datetime.utcnow()
         if participant.joined_at:
-            participant.duration = int((participant.left_at - participant.joined_at).total_seconds())
+            participant.duration = int(
+                (participant.left_at - participant.joined_at).total_seconds()
+            )
 
         # Retirer le participant de la liste active
         room.participants = [p for p in room.participants if p.user_id != user_id]
 
         # Terminer la conf√©rence si plus de participants
@@ -304,31 +365,25 @@
 
             # D√©placer vers l&#x27;historique
             self.room_history.append(room)
             del self.active_rooms[room_id]
 
-        return {
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;Participant retir√© de la conf√©rence&#x27;
-        }
+        return {&quot;success&quot;: True, &quot;message&quot;: &quot;Participant retir√© de la conf√©rence&quot;}
 
     def end_conference(self, room_id: str, teacher_id: str) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Termine une conf√©rence (enseignant seulement)&quot;&quot;&quot;
 
         if room_id not in self.active_rooms:
-            return {
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Salle de conf√©rence non trouv√©e&#x27;
-            }
+            return {&quot;success&quot;: False, &quot;error&quot;: &quot;Salle de conf√©rence non trouv√©e&quot;}
 
         room = self.active_rooms[room_id]
 
         # V√©rifier que c&#x27;est l&#x27;enseignant qui termine la conf√©rence
         if room.teacher_id != teacher_id:
             return {
-                &#x27;success&#x27;: False,
-                &#x27;error&#x27;: &#x27;Seul l\&#x27;enseignant peut terminer la conf√©rence&#x27;
+                &quot;success&quot;: False,
+                &quot;error&quot;: &quot;Seul l&#x27;enseignant peut terminer la conf√©rence&quot;,
             }
 
         # Terminer la conf√©rence
         room.status = ConferenceStatus.ENDED
         room.actual_end = datetime.utcnow()
@@ -336,21 +391,27 @@
         # Mettre √† jour tous les participants encore connect√©s
         for participant in room.participants:
             if not participant.left_at:
                 participant.left_at = room.actual_end
                 if participant.joined_at:
-                    participant.duration = int((participant.left_at - participant.joined_at).total_seconds())
+                    participant.duration = int(
+                        (participant.left_at - participant.joined_at).total_seconds()
+                    )
 
         # D√©placer vers l&#x27;historique
         self.room_history.append(room)
         del self.active_rooms[room_id]
 
         return {
-            &#x27;success&#x27;: True,
-            &#x27;message&#x27;: &#x27;Conf√©rence termin√©e&#x27;,
-            &#x27;duration&#x27;: int((room.actual_end - room.actual_start).total_seconds()) if room.actual_start else 0,
-            &#x27;participants_count&#x27;: len(room.participants)
+            &quot;success&quot;: True,
+            &quot;message&quot;: &quot;Conf√©rence termin√©e&quot;,
+            &quot;duration&quot;: (
+                int((room.actual_end - room.actual_start).total_seconds())
+                if room.actual_start
+                else 0
+            ),
+            &quot;participants_count&quot;: len(room.participants),
         }
 
     def get_room_info(self, room_id: str) -&gt; Optional[Dict[str, Any]]:
         &quot;&quot;&quot;R√©cup√®re les informations d&#x27;une salle&quot;&quot;&quot;
 
@@ -361,38 +422,42 @@
 
         if not room:
             return None
 
         return {
-            &#x27;room_id&#x27;: room.room_id,
-            &#x27;subject&#x27;: room.subject,
-            &#x27;teacher_id&#x27;: room.teacher_id,
-            &#x27;teacher_name&#x27;: room.teacher_name,
-            &#x27;scheduled_start&#x27;: room.scheduled_start.isoformat(),
-            &#x27;scheduled_end&#x27;: room.scheduled_end.isoformat(),
-            &#x27;actual_start&#x27;: room.actual_start.isoformat() if room.actual_start else None,
-            &#x27;actual_end&#x27;: room.actual_end.isoformat() if room.actual_end else None,
-            &#x27;status&#x27;: room.status.value,
-            &#x27;participants_count&#x27;: len(room.participants),
-            &#x27;max_participants&#x27;: room.max_participants,
-            &#x27;description&#x27;: room.description,
-            &#x27;recording_enabled&#x27;: room.recording_enabled,
-            &#x27;recording_url&#x27;: room.recording_url,
-            &#x27;participants&#x27;: [
+            &quot;room_id&quot;: room.room_id,
+            &quot;subject&quot;: room.subject,
+            &quot;teacher_id&quot;: room.teacher_id,
+            &quot;teacher_name&quot;: room.teacher_name,
+            &quot;scheduled_start&quot;: room.scheduled_start.isoformat(),
+            &quot;scheduled_end&quot;: room.scheduled_end.isoformat(),
+            &quot;actual_start&quot;: (
+                room.actual_start.isoformat() if room.actual_start else None
+            ),
+            &quot;actual_end&quot;: room.actual_end.isoformat() if room.actual_end else None,
+            &quot;status&quot;: room.status.value,
+            &quot;participants_count&quot;: len(room.participants),
+            &quot;max_participants&quot;: room.max_participants,
+            &quot;description&quot;: room.description,
+            &quot;recording_enabled&quot;: room.recording_enabled,
+            &quot;recording_url&quot;: room.recording_url,
+            &quot;participants&quot;: [
                 {
-                    &#x27;user_id&#x27;: p.user_id,
-                    &#x27;name&#x27;: p.name,
-                    &#x27;role&#x27;: p.role.value,
-                    &#x27;joined_at&#x27;: p.joined_at.isoformat() if p.joined_at else None,
-                    &#x27;left_at&#x27;: p.left_at.isoformat() if p.left_at else None,
-                    &#x27;duration&#x27;: p.duration
+                    &quot;user_id&quot;: p.user_id,
+                    &quot;name&quot;: p.name,
+                    &quot;role&quot;: p.role.value,
+                    &quot;joined_at&quot;: p.joined_at.isoformat() if p.joined_at else None,
+                    &quot;left_at&quot;: p.left_at.isoformat() if p.left_at else None,
+                    &quot;duration&quot;: p.duration,
                 }
                 for p in room.participants
-            ]
+            ],
         }
 
-    def get_teacher_rooms(self, teacher_id: str, include_history: bool = False) -&gt; List[Dict[str, Any]]:
+    def get_teacher_rooms(
+        self, teacher_id: str, include_history: bool = False
+    ) -&gt; List[Dict[str, Any]]:
         &quot;&quot;&quot;R√©cup√®re les salles d&#x27;un enseignant&quot;&quot;&quot;
 
         rooms = []
 
         # Salles actives
@@ -405,11 +470,11 @@
             for room in self.room_history:
                 if room.teacher_id == teacher_id:
                     rooms.append(self.get_room_info(room.room_id))
 
         # Trier par date de d√©but
-        rooms.sort(key=lambda x: x[&#x27;scheduled_start&#x27;], reverse=True)
+        rooms.sort(key=lambda x: x[&quot;scheduled_start&quot;], reverse=True)
 
         return rooms
 
     def get_student_rooms(self, student_id: str) -&gt; List[Dict[str, Any]]:
         &quot;&quot;&quot;R√©cup√®re les salles auxquelles un √©l√®ve peut acc√©der&quot;&quot;&quot;
@@ -419,18 +484,25 @@
         # Pour l&#x27;instant, on retourne toutes les salles actives
         # TODO: Impl√©menter la logique d&#x27;inscription aux cours
         for room in self.active_rooms.values():
             room_info = self.get_room_info(room.room_id)
             # Masquer certaines informations sensibles pour les √©l√®ves
-            room_info.pop(&#x27;recording_url&#x27;, None)
+            room_info.pop(&quot;recording_url&quot;, None)
             rooms.append(room_info)
 
         return rooms
 
-    def schedule_recurring_conference(self, teacher_id: str, teacher_name: str, subject: str,
-                                    start_time: datetime, duration_minutes: int,
-                                    recurrence_days: List[int], end_date: datetime) -&gt; List[ConferenceRoom]:
+    def schedule_recurring_conference(
+        self,
+        teacher_id: str,
+        teacher_name: str,
+        subject: str,
+        start_time: datetime,
+        duration_minutes: int,
+        recurrence_days: List[int],
+        end_date: datetime,
+    ) -&gt; List[ConferenceRoom]:
         &quot;&quot;&quot;Programme des conf√©rences r√©currentes&quot;&quot;&quot;
 
         scheduled_rooms = []
         current_date = start_time.date()
 
@@ -442,11 +514,11 @@
                     teacher_id=teacher_id,
                     teacher_name=teacher_name,
                     subject=subject,
                     scheduled_start=scheduled_start,
                     duration_minutes=duration_minutes,
-                    description=f&quot;Cours r√©current de {subject} avec {teacher_name}&quot;
+                    description=f&quot;Cours r√©current de {subject} avec {teacher_name}&quot;,
                 )
 
                 scheduled_rooms.append(room)
 
             current_date += timedelta(days=1)
@@ -455,88 +527,94 @@
 
     def get_conference_statistics(self, teacher_id: str = None) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;R√©cup√®re les statistiques des conf√©rences&quot;&quot;&quot;
 
         stats = {
-            &#x27;total_conferences&#x27;: len(self.room_history),
-            &#x27;active_conferences&#x27;: len(self.active_rooms),
-            &#x27;total_participants&#x27;: 0,
-            &#x27;average_duration&#x27;: 0,
-            &#x27;conferences_by_subject&#x27;: {},
-            &#x27;participants_by_role&#x27;: {
-                &#x27;moderator&#x27;: 0,
-                &#x27;participant&#x27;: 0,
-                &#x27;observer&#x27;: 0
-            }
+            &quot;total_conferences&quot;: len(self.room_history),
+            &quot;active_conferences&quot;: len(self.active_rooms),
+            &quot;total_participants&quot;: 0,
+            &quot;average_duration&quot;: 0,
+            &quot;conferences_by_subject&quot;: {},
+            &quot;participants_by_role&quot;: {&quot;moderator&quot;: 0, &quot;participant&quot;: 0, &quot;observer&quot;: 0},
         }
 
         # Filtrer par enseignant si sp√©cifi√©
         rooms_to_analyze = self.room_history
         if teacher_id:
-            rooms_to_analyze = [r for r in self.room_history if r.teacher_id == teacher_id]
-            stats[&#x27;total_conferences&#x27;] = len(rooms_to_analyze)
+            rooms_to_analyze = [
+                r for r in self.room_history if r.teacher_id == teacher_id
+            ]
+            stats[&quot;total_conferences&quot;] = len(rooms_to_analyze)
 
         total_duration = 0
         conference_count = 0
 
         for room in rooms_to_analyze:
             # Compter les participants
-            stats[&#x27;total_participants&#x27;] += len(room.participants)
+            stats[&quot;total_participants&quot;] += len(room.participants)
 
             # Dur√©e moyenne
             if room.actual_start and room.actual_end:
                 duration = (room.actual_end - room.actual_start).total_seconds()
                 total_duration += duration
                 conference_count += 1
 
             # Par mati√®re
             subject = room.subject
-            if subject not in stats[&#x27;conferences_by_subject&#x27;]:
-                stats[&#x27;conferences_by_subject&#x27;][subject] = 0
-            stats[&#x27;conferences_by_subject&#x27;][subject] += 1
+            if subject not in stats[&quot;conferences_by_subject&quot;]:
+                stats[&quot;conferences_by_subject&quot;][subject] = 0
+            stats[&quot;conferences_by_subject&quot;][subject] += 1
 
             # Par r√¥le
             for participant in room.participants:
                 role = participant.role.value
-                stats[&#x27;participants_by_role&#x27;][role] += 1
+                stats[&quot;participants_by_role&quot;][role] += 1
 
         # Calculer la dur√©e moyenne
         if conference_count &gt; 0:
-            stats[&#x27;average_duration&#x27;] = int(total_duration / conference_count)
+            stats[&quot;average_duration&quot;] = int(total_duration / conference_count)
 
         return stats
+
 
 # Instance globale du service
 video_conference_service = VideoConferenceService()
 
 # Fonctions utilitaires
 
-def create_instant_meeting(teacher_id: str, teacher_name: str, subject: str) -&gt; Dict[str, Any]:
+
+def create_instant_meeting(
+    teacher_id: str, teacher_name: str, subject: str
+) -&gt; Dict[str, Any]:
     &quot;&quot;&quot;Cr√©e une r√©union instantan√©e&quot;&quot;&quot;
 
     start_time = datetime.utcnow()
     room = video_conference_service.create_conference_room(
         teacher_id=teacher_id,
         teacher_name=teacher_name,
         subject=subject,
         scheduled_start=start_time,
         duration_minutes=120,  # 2 heures par d√©faut
-        description=f&quot;R√©union instantan√©e - {subject}&quot;
+        description=f&quot;R√©union instantan√©e - {subject}&quot;,
     )
 
     return {
-        &#x27;success&#x27;: True,
-        &#x27;room_id&#x27;: room.room_id,
-        &#x27;room_info&#x27;: video_conference_service.get_room_info(room.room_id)
+        &quot;success&quot;: True,
+        &quot;room_id&quot;: room.room_id,
+        &quot;room_info&quot;: video_conference_service.get_room_info(room.room_id),
     }
 
-def get_meeting_link(room_id: str, user_id: str, user_name: str, is_teacher: bool = False) -&gt; str:
+
+def get_meeting_link(
+    room_id: str, user_id: str, user_name: str, is_teacher: bool = False
+) -&gt; str:
     &quot;&quot;&quot;G√©n√®re un lien de r√©union pour un utilisateur&quot;&quot;&quot;
 
     role = ParticipantRole.MODERATOR if is_teacher else ParticipantRole.PARTICIPANT
-    result = video_conference_service.join_conference(room_id, user_id, user_name, f&quot;{user_id}@nexusreussite.tn&quot;, role)
-
-    if result[&#x27;success&#x27;]:
-        return result[&#x27;conference_url&#x27;]
+    result = video_conference_service.join_conference(
+        room_id, user_id, user_name, f&quot;{user_id}@nexusreussite.tn&quot;, role
+    )
+
+    if result[&quot;success&quot;]:
+        return result[&quot;conference_url&quot;]
     else:
         return None
-
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/openai_integration.py	2025-07-24 07:24:17.027976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/openai_integration.py	2025-07-24 20:54:02.637923+00:00
@@ -14,13 +14,15 @@
 
 # Configuration du logging
 logging.basicConfig(level=logging.INFO)
 logger = logging.getLogger(__name__)
 
+
 @dataclass
 class StudentProfile:
     &quot;&quot;&quot;Profil d&#x27;√©tudiant pour la personnalisation IA&quot;&quot;&quot;
+
     id: str
     name: str
     level: str  # &quot;premiere&quot;, &quot;terminale&quot;
     specialties: List[str]  # [&quot;maths&quot;, &quot;nsi&quot;, &quot;physique&quot;, &quot;francais&quot;]
     learning_style: str  # &quot;visual&quot;, &quot;auditory&quot;, &quot;kinesthetic&quot;, &quot;mixed&quot;
@@ -29,36 +31,41 @@
     goals: List[str]
     preferred_difficulty: str  # &quot;easy&quot;, &quot;medium&quot;, &quot;hard&quot;, &quot;adaptive&quot;
     language: str = &quot;fr&quot;
     timezone: str = &quot;Africa/Tunis&quot;
 
+
 @dataclass
 class ConversationContext:
     &quot;&quot;&quot;Contexte de conversation avec ARIA&quot;&quot;&quot;
+
     student_id: str
     session_id: str
     subject: str
     topic: Optional[str] = None
     difficulty_level: str = &quot;medium&quot;
-    conversation_type: str = &quot;tutoring&quot;  # &quot;tutoring&quot;, &quot;evaluation&quot;, &quot;explanation&quot;, &quot;motivation&quot;
+    conversation_type: str = (
+        &quot;tutoring&quot;  # &quot;tutoring&quot;, &quot;evaluation&quot;, &quot;explanation&quot;, &quot;motivation&quot;
+    )
     previous_messages: List[Dict] = None
     learning_objectives: List[str] = None
     time_limit: Optional[int] = None  # minutes
 
     def __post_init__(self):
         if self.previous_messages is None:
             self.previous_messages = []
         if self.learning_objectives is None:
             self.learning_objectives = []
 
+
 class OpenAIIntegration:
     &quot;&quot;&quot;Service d&#x27;int√©gration OpenAI pour ARIA&quot;&quot;&quot;
 
     def __init__(self):
         self.client = None
-        self.api_key = os.getenv(&#x27;OPENAI_API_KEY&#x27;)
-        self.api_base = os.getenv(&#x27;OPENAI_API_BASE&#x27;, &#x27;https://api.openai.com/v1&#x27;)
+        self.api_key = os.getenv(&quot;OPENAI_API_KEY&quot;)
+        self.api_base = os.getenv(&quot;OPENAI_API_BASE&quot;, &quot;https://api.openai.com/v1&quot;)
         self.model_chat = &quot;gpt-4-turbo-preview&quot;
         self.model_vision = &quot;gpt-4-vision-preview&quot;
         self.model_embedding = &quot;text-embedding-3-small&quot;
         self.model_image = &quot;dall-e-3&quot;
         self.max_tokens = 4000
@@ -72,21 +79,18 @@
             &quot;tutoring&quot;: self._get_tutoring_prompt(),
             &quot;evaluation&quot;: self._get_evaluation_prompt(),
             &quot;explanation&quot;: self._get_explanation_prompt(),
             &quot;motivation&quot;: self._get_motivation_prompt(),
             &quot;document_generation&quot;: self._get_document_generation_prompt(),
-            &quot;quiz_generation&quot;: self._get_quiz_generation_prompt()
+            &quot;quiz_generation&quot;: self._get_quiz_generation_prompt(),
         }
 
     def _initialize_client(self):
         &quot;&quot;&quot;Initialise le client OpenAI&quot;&quot;&quot;
         try:
             if self.api_key:
-                self.client = OpenAI(
-                    api_key=self.api_key,
-                    base_url=self.api_base
-                )
+                self.client = OpenAI(api_key=self.api_key, base_url=self.api_base)
                 logger.info(&quot;Client OpenAI initialis√© avec succ√®s&quot;)
             else:
                 logger.warning(&quot;Cl√© API OpenAI non trouv√©e - Mode simulation activ√©&quot;)
                 self.client = None
         except Exception as e:
@@ -312,11 +316,11 @@
 
     async def chat_with_aria(
         self,
         message: str,
         context: ConversationContext,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Conversation principale avec ARIA&quot;&quot;&quot;
 
         if not self.client:
             return self._simulate_aria_response(message, context, student_profile)
@@ -327,15 +331,16 @@
 
             # Historique de conversation
             messages = [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_prompt}]
 
             # Ajout de l&#x27;historique
-            for msg in context.previous_messages[-10:]:  # Garde les 10 derniers messages
-                messages.append({
-                    &quot;role&quot;: msg.get(&quot;role&quot;, &quot;user&quot;),
-                    &quot;content&quot;: msg.get(&quot;content&quot;, &quot;&quot;)
-                })
+            for msg in context.previous_messages[
+                -10:
+            ]:  # Garde les 10 derniers messages
+                messages.append(
+                    {&quot;role&quot;: msg.get(&quot;role&quot;, &quot;user&quot;), &quot;content&quot;: msg.get(&quot;content&quot;, &quot;&quot;)}
+                )
 
             # Message actuel
             messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: message})
 
             # Appel √† l&#x27;API OpenAI
@@ -351,28 +356,28 @@
                 &quot;response&quot;: aria_response,
                 &quot;metadata&quot;: metadata,
                 &quot;usage&quot;: {
                     &quot;prompt_tokens&quot;: response.usage.prompt_tokens,
                     &quot;completion_tokens&quot;: response.usage.completion_tokens,
-                    &quot;total_tokens&quot;: response.usage.total_tokens
+                    &quot;total_tokens&quot;: response.usage.total_tokens,
                 },
                 &quot;model&quot;: response.model,
-                &quot;timestamp&quot;: datetime.now().isoformat()
+                &quot;timestamp&quot;: datetime.now().isoformat(),
             }
 
         except Exception as e:
             logger.error(f&quot;Erreur lors de la conversation avec ARIA: {e}&quot;)
             return self._simulate_aria_response(message, context, student_profile)
 
     def _build_personalized_prompt(
-        self,
-        context: ConversationContext,
-        student_profile: StudentProfile
+        self, context: ConversationContext, student_profile: StudentProfile
     ) -&gt; str:
         &quot;&quot;&quot;Construit un prompt personnalis√© selon le contexte et le profil&quot;&quot;&quot;
 
-        base_prompt = self.system_prompts.get(context.conversation_type, self.system_prompts[&quot;tutoring&quot;])
+        base_prompt = self.system_prompts.get(
+            context.conversation_type, self.system_prompts[&quot;tutoring&quot;]
+        )
 
         personalization = f&quot;&quot;&quot;
 PROFIL DE L&#x27;√âL√àVE:
 - Nom: {student_profile.name}
 - Niveau: {student_profile.level}
@@ -392,78 +397,90 @@
         if context.time_limit:
             personalization += f&quot;- Temps disponible: {context.time_limit} minutes\n&quot;
 
         return base_prompt + &quot;\n&quot; + personalization
 
-    async def _make_openai_request(self, messages: List[Dict], context: ConversationContext) -&gt; Any:
+    async def _make_openai_request(
+        self, messages: List[Dict], context: ConversationContext
+    ) -&gt; Any:
         &quot;&quot;&quot;Effectue la requ√™te vers l&#x27;API OpenAI&quot;&quot;&quot;
 
         # Param√®tres adaptatifs selon le contexte
         temperature = 0.3 if context.conversation_type == &quot;evaluation&quot; else 0.7
-        max_tokens = 2000 if context.time_limit and context.time_limit &lt; 30 else self.max_tokens
+        max_tokens = (
+            2000 if context.time_limit and context.time_limit &lt; 30 else self.max_tokens
+        )
 
         return await asyncio.to_thread(
             self.client.chat.completions.create,
             model=self.model_chat,
             messages=messages,
             temperature=temperature,
             max_tokens=max_tokens,
             top_p=0.9,
             frequency_penalty=0.1,
-            presence_penalty=0.1
+            presence_penalty=0.1,
         )
 
-    def _analyze_response(self, response: str, context: ConversationContext) -&gt; Dict[str, Any]:
+    def _analyze_response(
+        self, response: str, context: ConversationContext
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Analyse la r√©ponse d&#x27;ARIA pour extraire des m√©tadonn√©es&quot;&quot;&quot;
 
         metadata = {
             &quot;sentiment&quot;: &quot;positive&quot;,  # Analyse de sentiment basique
-            &quot;complexity&quot;: &quot;medium&quot;,   # Complexit√© de la r√©ponse
-            &quot;topics_covered&quot;: [],     # Sujets abord√©s
-            &quot;recommendations&quot;: [],    # Recommandations g√©n√©r√©es
-            &quot;next_steps&quot;: [],        # √âtapes suivantes sugg√©r√©es
-            &quot;difficulty_assessment&quot;: context.difficulty_level
+            &quot;complexity&quot;: &quot;medium&quot;,  # Complexit√© de la r√©ponse
+            &quot;topics_covered&quot;: [],  # Sujets abord√©s
+            &quot;recommendations&quot;: [],  # Recommandations g√©n√©r√©es
+            &quot;next_steps&quot;: [],  # √âtapes suivantes sugg√©r√©es
+            &quot;difficulty_assessment&quot;: context.difficulty_level,
         }
 
         # Analyse basique du contenu
-        if any(word in response.lower() for word in [&quot;excellent&quot;, &quot;parfait&quot;, &quot;bravo&quot;, &quot;f√©licitations&quot;]):
+        if any(
+            word in response.lower()
+            for word in [&quot;excellent&quot;, &quot;parfait&quot;, &quot;bravo&quot;, &quot;f√©licitations&quot;]
+        ):
             metadata[&quot;sentiment&quot;] = &quot;very_positive&quot;
-        elif any(word in response.lower() for word in [&quot;attention&quot;, &quot;erreur&quot;, &quot;incorrect&quot;, &quot;r√©viser&quot;]):
+        elif any(
+            word in response.lower()
+            for word in [&quot;attention&quot;, &quot;erreur&quot;, &quot;incorrect&quot;, &quot;r√©viser&quot;]
+        ):
             metadata[&quot;sentiment&quot;] = &quot;constructive&quot;
 
         # D√©tection de recommandations
         if &quot;je recommande&quot; in response.lower() or &quot;je sugg√®re&quot; in response.lower():
             # Extraction basique des recommandations
-            lines = response.split(&#x27;\n&#x27;)
+            lines = response.split(&quot;\n&quot;)
             for line in lines:
-                if any(word in line.lower() for word in [&quot;recommande&quot;, &quot;sugg√®re&quot;, &quot;conseil&quot;]):
+                if any(
+                    word in line.lower()
+                    for word in [&quot;recommande&quot;, &quot;sugg√®re&quot;, &quot;conseil&quot;]
+                ):
                     metadata[&quot;recommendations&quot;].append(line.strip())
 
         return metadata
 
     def _simulate_aria_response(
         self,
         message: str,
         context: ConversationContext,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Simule une r√©ponse d&#x27;ARIA quand l&#x27;API n&#x27;est pas disponible&quot;&quot;&quot;
 
         # R√©ponses simul√©es selon le contexte
         simulated_responses = {
             &quot;tutoring&quot;: f&quot;Bonjour {student_profile.name} ! Je comprends que vous travaillez sur {context.subject}. Pouvez-vous me dire o√π vous en √™tes dans votre apprentissage ? Je vais adapter mes explications √† votre style d&#x27;apprentissage {student_profile.learning_style}.&quot;,
-
             &quot;evaluation&quot;: f&quot;Tr√®s bien {student_profile.name}, commen√ßons cette √©valuation en {context.subject}. Je vais adapter les questions √† votre niveau {student_profile.level}. √ätes-vous pr√™t(e) ?&quot;,
-
             &quot;explanation&quot;: f&quot;Excellente question sur {context.topic} ! Laissez-moi vous expliquer cela de mani√®re claire et adapt√©e √† votre profil d&#x27;apprentissage {student_profile.learning_style}.&quot;,
-
-            &quot;motivation&quot;: f&quot;Je vois que vous travaillez dur, {student_profile.name} ! Vos efforts en {context.subject} vont porter leurs fruits. Continuons ensemble vers vos objectifs : {&#x27;, &#x27;.join(student_profile.goals[:2])}.&quot;
+            &quot;motivation&quot;: f&quot;Je vois que vous travaillez dur, {student_profile.name} ! Vos efforts en {context.subject} vont porter leurs fruits. Continuons ensemble vers vos objectifs : {&#x27;, &#x27;.join(student_profile.goals[:2])}.&quot;,
         }
 
         response = simulated_responses.get(
             context.conversation_type,
-            f&quot;Bonjour {student_profile.name} ! Comment puis-je vous aider aujourd&#x27;hui en {context.subject} ?&quot;
+            f&quot;Bonjour {student_profile.name} ! Comment puis-je vous aider aujourd&#x27;hui en {context.subject} ?&quot;,
         )
 
         return {
             &quot;response&quot;: response,
             &quot;metadata&quot;: {
@@ -471,46 +488,56 @@
                 &quot;complexity&quot;: &quot;medium&quot;,
                 &quot;topics_covered&quot;: [context.subject],
                 &quot;recommendations&quot;: [&quot;Continuez vos efforts !&quot;],
                 &quot;next_steps&quot;: [&quot;Posez-moi vos questions sp√©cifiques&quot;],
                 &quot;difficulty_assessment&quot;: context.difficulty_level,
-                &quot;simulated&quot;: True
+                &quot;simulated&quot;: True,
             },
             &quot;usage&quot;: {&quot;prompt_tokens&quot;: 0, &quot;completion_tokens&quot;: 0, &quot;total_tokens&quot;: 0},
             &quot;model&quot;: &quot;simulation&quot;,
-            &quot;timestamp&quot;: datetime.now().isoformat()
+            &quot;timestamp&quot;: datetime.now().isoformat(),
         }
 
     async def generate_document(
         self,
         document_type: str,
         subject: str,
         topic: str,
         student_profile: StudentProfile,
-        specifications: Dict[str, Any] = None
+        specifications: Dict[str, Any] = None,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re un document p√©dagogique personnalis√©&quot;&quot;&quot;
 
         if not self.client:
-            return self._simulate_document_generation(document_type, subject, topic, student_profile)
+            return self._simulate_document_generation(
+                document_type, subject, topic, student_profile
+            )
 
         try:
             # Construction du prompt pour la g√©n√©ration de document
-            prompt = self._build_document_prompt(document_type, subject, topic, student_profile, specifications)
+            prompt = self._build_document_prompt(
+                document_type, subject, topic, student_profile, specifications
+            )
 
             messages = [
-                {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: self.system_prompts[&quot;document_generation&quot;]},
-                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}
+                {
+                    &quot;role&quot;: &quot;system&quot;,
+                    &quot;content&quot;: self.system_prompts[&quot;document_generation&quot;],
+                },
+                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt},
             ]
 
-            response = await self._make_openai_request(messages, ConversationContext(
-                student_id=student_profile.id,
-                session_id=f&quot;doc_{datetime.now().timestamp()}&quot;,
-                subject=subject,
-                topic=topic,
-                conversation_type=&quot;document_generation&quot;
-            ))
+            response = await self._make_openai_request(
+                messages,
+                ConversationContext(
+                    student_id=student_profile.id,
+                    session_id=f&quot;doc_{datetime.now().timestamp()}&quot;,
+                    subject=subject,
+                    topic=topic,
+                    conversation_type=&quot;document_generation&quot;,
+                ),
+            )
 
             document_content = response.choices[0].message.content
 
             return {
                 &quot;content&quot;: document_content,
@@ -520,25 +547,27 @@
                 &quot;student_id&quot;: student_profile.id,
                 &quot;generated_at&quot;: datetime.now().isoformat(),
                 &quot;metadata&quot;: {
                     &quot;level&quot;: student_profile.level,
                     &quot;learning_style&quot;: student_profile.learning_style,
-                    &quot;personalized&quot;: True
-                }
+                    &quot;personalized&quot;: True,
+                },
             }
 
         except Exception as e:
             logger.error(f&quot;Erreur lors de la g√©n√©ration de document: {e}&quot;)
-            return self._simulate_document_generation(document_type, subject, topic, student_profile)
+            return self._simulate_document_generation(
+                document_type, subject, topic, student_profile
+            )
 
     def _build_document_prompt(
         self,
         document_type: str,
         subject: str,
         topic: str,
         student_profile: StudentProfile,
-        specifications: Dict[str, Any] = None
+        specifications: Dict[str, Any] = None,
     ) -&gt; str:
         &quot;&quot;&quot;Construit le prompt pour la g√©n√©ration de document&quot;&quot;&quot;
 
         base_prompt = f&quot;&quot;&quot;
 G√©n√®re un {document_type} en {subject} sur le sujet &quot;{topic}&quot; pour {student_profile.name}.
@@ -564,11 +593,11 @@
         # Sp√©cifications par type de document
         document_specs = {
             &quot;fiche_revision&quot;: &quot;Structure: D√©finitions, Formules cl√©s, M√©thodes, Exercices types, Points √† retenir&quot;,
             &quot;exercices&quot;: &quot;Inclure: √ânonc√©s vari√©s, Solutions d√©taill√©es, Bar√®me de notation, Conseils m√©thodologiques&quot;,
             &quot;cours&quot;: &quot;Organisation: Introduction, D√©veloppement structur√©, Exemples, Applications, Synth√®se&quot;,
-            &quot;evaluation&quot;: &quot;Composer: Questions progressives, Bar√®me d√©taill√©, Crit√®res d&#x27;√©valuation, Correction type&quot;
+            &quot;evaluation&quot;: &quot;Composer: Questions progressives, Bar√®me d√©taill√©, Crit√®res d&#x27;√©valuation, Correction type&quot;,
         }
 
         if document_type in document_specs:
             base_prompt += f&quot;\n{document_specs[document_type]}&quot;
 
@@ -577,11 +606,11 @@
     def _simulate_document_generation(
         self,
         document_type: str,
         subject: str,
         topic: str,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Simule la g√©n√©ration de document&quot;&quot;&quot;
 
         simulated_content = f&quot;&quot;&quot;
 # {document_type.replace(&#x27;_&#x27;, &#x27; &#x27;).title()} - {subject}
@@ -628,26 +657,28 @@
             &quot;generated_at&quot;: datetime.now().isoformat(),
             &quot;metadata&quot;: {
                 &quot;level&quot;: student_profile.level,
                 &quot;learning_style&quot;: student_profile.learning_style,
                 &quot;personalized&quot;: True,
-                &quot;simulated&quot;: True
-            }
+                &quot;simulated&quot;: True,
+            },
         }
 
     async def generate_quiz(
         self,
         subject: str,
         topic: str,
         difficulty: str,
         num_questions: int,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re un quiz personnalis√©&quot;&quot;&quot;
 
         if not self.client:
-            return self._simulate_quiz_generation(subject, topic, difficulty, num_questions, student_profile)
+            return self._simulate_quiz_generation(
+                subject, topic, difficulty, num_questions, student_profile
+            )
 
         try:
             prompt = f&quot;&quot;&quot;
 G√©n√®re un quiz de {num_questions} questions en {subject} sur &quot;{topic}&quot;
 pour un √©l√®ve de {student_profile.level} avec un niveau de difficult√© {difficulty}.
@@ -660,54 +691,61 @@
 Format de sortie JSON requis avec questions vari√©es (QCM, Vrai/Faux, r√©ponses courtes).
 &quot;&quot;&quot;
 
             messages = [
                 {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: self.system_prompts[&quot;quiz_generation&quot;]},
-                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}
+                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt},
             ]
 
-            response = await self._make_openai_request(messages, ConversationContext(
-                student_id=student_profile.id,
-                session_id=f&quot;quiz_{datetime.now().timestamp()}&quot;,
-                subject=subject,
-                topic=topic,
-                difficulty_level=difficulty,
-                conversation_type=&quot;evaluation&quot;
-            ))
+            response = await self._make_openai_request(
+                messages,
+                ConversationContext(
+                    student_id=student_profile.id,
+                    session_id=f&quot;quiz_{datetime.now().timestamp()}&quot;,
+                    subject=subject,
+                    topic=topic,
+                    difficulty_level=difficulty,
+                    conversation_type=&quot;evaluation&quot;,
+                ),
+            )
 
             quiz_content = response.choices[0].message.content
 
             # Tentative de parsing JSON
             try:
                 quiz_data = json.loads(quiz_content)
             except json.JSONDecodeError:
                 # Fallback vers simulation si le JSON n&#x27;est pas valide
-                return self._simulate_quiz_generation(subject, topic, difficulty, num_questions, student_profile)
+                return self._simulate_quiz_generation(
+                    subject, topic, difficulty, num_questions, student_profile
+                )
 
             return {
                 &quot;quiz&quot;: quiz_data,
                 &quot;generated_at&quot;: datetime.now().isoformat(),
                 &quot;metadata&quot;: {
                     &quot;subject&quot;: subject,
                     &quot;topic&quot;: topic,
                     &quot;difficulty&quot;: difficulty,
                     &quot;student_level&quot;: student_profile.level,
-                    &quot;personalized&quot;: True
-                }
+                    &quot;personalized&quot;: True,
+                },
             }
 
         except Exception as e:
             logger.error(f&quot;Erreur lors de la g√©n√©ration de quiz: {e}&quot;)
-            return self._simulate_quiz_generation(subject, topic, difficulty, num_questions, student_profile)
+            return self._simulate_quiz_generation(
+                subject, topic, difficulty, num_questions, student_profile
+            )
 
     def _simulate_quiz_generation(
         self,
         subject: str,
         topic: str,
         difficulty: str,
         num_questions: int,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Simule la g√©n√©ration de quiz&quot;&quot;&quot;
 
         simulated_quiz = {
             &quot;quiz_id&quot;: f&quot;quiz_{datetime.now().timestamp()}&quot;,
@@ -715,11 +753,11 @@
             &quot;subject&quot;: subject,
             &quot;topic&quot;: topic,
             &quot;level&quot;: student_profile.level,
             &quot;difficulty&quot;: difficulty,
             &quot;duration&quot;: num_questions * 2,  # 2 minutes par question
-            &quot;questions&quot;: []
+            &quot;questions&quot;: [],
         }
 
         # Questions simul√©es selon la mati√®re
         sample_questions = {
             &quot;mathematiques&quot;: [
@@ -729,11 +767,11 @@
                     &quot;question&quot;: f&quot;Quelle est la d√©riv√©e de la fonction f(x) = x¬≤ + 3x + 2 ?&quot;,
                     &quot;options&quot;: [&quot;2x + 3&quot;, &quot;x¬≤ + 3&quot;, &quot;2x + 2&quot;, &quot;x + 3&quot;],
                     &quot;correct_answer&quot;: &quot;2x + 3&quot;,
                     &quot;explanation&quot;: &quot;La d√©riv√©e de x¬≤ est 2x, la d√©riv√©e de 3x est 3, et la d√©riv√©e d&#x27;une constante est 0.&quot;,
                     &quot;difficulty&quot;: difficulty,
-                    &quot;points&quot;: 2
+                    &quot;points&quot;: 2,
                 }
             ],
             &quot;nsi&quot;: [
                 {
                     &quot;id&quot;: &quot;q1&quot;,
@@ -741,13 +779,13 @@
                     &quot;question&quot;: &quot;Quelle est la complexit√© temporelle de l&#x27;algorithme de tri par insertion ?&quot;,
                     &quot;options&quot;: [&quot;O(n)&quot;, &quot;O(n log n)&quot;, &quot;O(n¬≤)&quot;, &quot;O(2^n)&quot;],
                     &quot;correct_answer&quot;: &quot;O(n¬≤)&quot;,
                     &quot;explanation&quot;: &quot;Dans le pire cas, le tri par insertion compare chaque √©l√©ment avec tous les pr√©c√©dents.&quot;,
                     &quot;difficulty&quot;: difficulty,
-                    &quot;points&quot;: 3
+                    &quot;points&quot;: 3,
                 }
-            ]
+            ],
         }
 
         # G√©n√©ration des questions selon la mati√®re
         subject_key = subject.lower().replace(&quot; &quot;, &quot;&quot;).replace(&quot;-&quot;, &quot;&quot;)
         if subject_key in sample_questions:
@@ -759,11 +797,11 @@
                     &quot;type&quot;: &quot;short_answer&quot;,
                     &quot;question&quot;: f&quot;Expliquez bri√®vement le concept principal de {topic}.&quot;,
                     &quot;correct_answer&quot;: f&quot;R√©ponse attendue sur {topic}&quot;,
                     &quot;explanation&quot;: f&quot;Explication d√©taill√©e du concept {topic}.&quot;,
                     &quot;difficulty&quot;: difficulty,
-                    &quot;points&quot;: 5
+                    &quot;points&quot;: 5,
                 }
             ]
 
         # Duplication et adaptation des questions
         for i in range(min(num_questions, 5)):  # Maximum 5 questions simul√©es
@@ -778,19 +816,16 @@
                 &quot;subject&quot;: subject,
                 &quot;topic&quot;: topic,
                 &quot;difficulty&quot;: difficulty,
                 &quot;student_level&quot;: student_profile.level,
                 &quot;personalized&quot;: True,
-                &quot;simulated&quot;: True
-            }
+                &quot;simulated&quot;: True,
+            },
         }
 
     async def generate_image(
-        self,
-        prompt: str,
-        style: str = &quot;educational&quot;,
-        size: str = &quot;1024x1024&quot;
+        self, prompt: str, style: str = &quot;educational&quot;, size: str = &quot;1024x1024&quot;
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;G√©n√®re une image p√©dagogique avec DALL-E&quot;&quot;&quot;
 
         if not self.client:
             return self._simulate_image_generation(prompt, style, size)
@@ -808,57 +843,54 @@
                 self.client.images.generate,
                 model=self.model_image,
                 prompt=educational_prompt,
                 size=size,
                 quality=&quot;standard&quot;,
-                n=1
+                n=1,
             )
 
             image_url = response.data[0].url
 
             return {
                 &quot;image_url&quot;: image_url,
                 &quot;prompt&quot;: educational_prompt,
                 &quot;style&quot;: style,
                 &quot;size&quot;: size,
                 &quot;generated_at&quot;: datetime.now().isoformat(),
-                &quot;metadata&quot;: {
-                    &quot;educational&quot;: True,
-                    &quot;model&quot;: self.model_image
-                }
+                &quot;metadata&quot;: {&quot;educational&quot;: True, &quot;model&quot;: self.model_image},
             }
 
         except Exception as e:
             logger.error(f&quot;Erreur lors de la g√©n√©ration d&#x27;image: {e}&quot;)
             return self._simulate_image_generation(prompt, style, size)
 
-    def _simulate_image_generation(self, prompt: str, style: str, size: str) -&gt; Dict[str, Any]:
+    def _simulate_image_generation(
+        self, prompt: str, style: str, size: str
+    ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Simule la g√©n√©ration d&#x27;image&quot;&quot;&quot;
         return {
             &quot;image_url&quot;: &quot;https://via.placeholder.com/1024x1024/4F46E5/FFFFFF?text=Image+Educative&quot;,
             &quot;prompt&quot;: prompt,
             &quot;style&quot;: style,
             &quot;size&quot;: size,
             &quot;generated_at&quot;: datetime.now().isoformat(),
-            &quot;metadata&quot;: {
-                &quot;educational&quot;: True,
-                &quot;simulated&quot;: True,
-                &quot;model&quot;: &quot;simulation&quot;
-            }
+            &quot;metadata&quot;: {&quot;educational&quot;: True, &quot;simulated&quot;: True, &quot;model&quot;: &quot;simulation&quot;},
         }
 
     async def analyze_student_work(
         self,
         work_content: str,
         subject: str,
         assignment_type: str,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Analyse le travail d&#x27;un √©tudiant et fournit un feedback d√©taill√©&quot;&quot;&quot;
 
         if not self.client:
-            return self._simulate_work_analysis(work_content, subject, assignment_type, student_profile)
+            return self._simulate_work_analysis(
+                work_content, subject, assignment_type, student_profile
+            )
 
         try:
             analysis_prompt = f&quot;&quot;&quot;
 Analyse le travail suivant d&#x27;un √©l√®ve de {student_profile.level} en {subject}:
 
@@ -885,19 +917,22 @@
 Sois bienveillant mais rigoureux dans ton analyse.
 &quot;&quot;&quot;
 
             messages = [
                 {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: self.system_prompts[&quot;evaluation&quot;]},
-                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: analysis_prompt}
+                {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: analysis_prompt},
             ]
 
-            response = await self._make_openai_request(messages, ConversationContext(
-                student_id=student_profile.id,
-                session_id=f&quot;analysis_{datetime.now().timestamp()}&quot;,
-                subject=subject,
-                conversation_type=&quot;evaluation&quot;
-            ))
+            response = await self._make_openai_request(
+                messages,
+                ConversationContext(
+                    student_id=student_profile.id,
+                    session_id=f&quot;analysis_{datetime.now().timestamp()}&quot;,
+                    subject=subject,
+                    conversation_type=&quot;evaluation&quot;,
+                ),
+            )
 
             analysis = response.choices[0].message.content
 
             return {
                 &quot;analysis&quot;: analysis,
@@ -905,24 +940,26 @@
                 &quot;assignment_type&quot;: assignment_type,
                 &quot;student_id&quot;: student_profile.id,
                 &quot;analyzed_at&quot;: datetime.now().isoformat(),
                 &quot;metadata&quot;: {
                     &quot;personalized&quot;: True,
-                    &quot;student_level&quot;: student_profile.level
-                }
+                    &quot;student_level&quot;: student_profile.level,
+                },
             }
 
         except Exception as e:
             logger.error(f&quot;Erreur lors de l&#x27;analyse du travail: {e}&quot;)
-            return self._simulate_work_analysis(work_content, subject, assignment_type, student_profile)
+            return self._simulate_work_analysis(
+                work_content, subject, assignment_type, student_profile
+            )
 
     def _simulate_work_analysis(
         self,
         work_content: str,
         subject: str,
         assignment_type: str,
-        student_profile: StudentProfile
+        student_profile: StudentProfile,
     ) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Simule l&#x27;analyse de travail&quot;&quot;&quot;
 
         simulated_analysis = f&quot;&quot;&quot;
 # Analyse du travail de {student_profile.name}
@@ -963,12 +1000,12 @@
             &quot;student_id&quot;: student_profile.id,
             &quot;analyzed_at&quot;: datetime.now().isoformat(),
             &quot;metadata&quot;: {
                 &quot;personalized&quot;: True,
                 &quot;student_level&quot;: student_profile.level,
-                &quot;simulated&quot;: True
-            }
+                &quot;simulated&quot;: True,
+            },
         }
 
     def get_usage_statistics(self) -&gt; Dict[str, Any]:
         &quot;&quot;&quot;Retourne les statistiques d&#x27;utilisation de l&#x27;API&quot;&quot;&quot;
         # En production, ces donn√©es seraient stock√©es en base
@@ -978,19 +1015,21 @@
             &quot;requests_by_type&quot;: {
                 &quot;chat&quot;: 0,
                 &quot;document_generation&quot;: 0,
                 &quot;quiz_generation&quot;: 0,
                 &quot;image_generation&quot;: 0,
-                &quot;work_analysis&quot;: 0
+                &quot;work_analysis&quot;: 0,
             },
             &quot;average_response_time&quot;: 0,
             &quot;success_rate&quot;: 100,
-            &quot;last_updated&quot;: datetime.now().isoformat()
+            &quot;last_updated&quot;: datetime.now().isoformat(),
         }
+
 
 # Instance globale du service
 openai_service = OpenAIIntegration()
+
 
 # Fonctions utilitaires pour l&#x27;utilisation dans l&#x27;application
 async def chat_with_aria(message: str, student_id: str, context: Dict = None) -&gt; Dict:
     &quot;&quot;&quot;Interface simplifi√©e pour le chat avec ARIA&quot;&quot;&quot;
 
@@ -1001,29 +1040,33 @@
         level=&quot;terminale&quot;,
         specialties=[&quot;mathematiques&quot;, &quot;nsi&quot;],
         learning_style=&quot;mixed&quot;,
         strengths=[&quot;logique&quot;, &quot;analyse&quot;],
         weaknesses=[&quot;calcul mental&quot;, &quot;gestion du temps&quot;],
-        goals=[&quot;r√©ussir le bac&quot;, &quot;int√©grer une CPGE&quot;]
+        goals=[&quot;r√©ussir le bac&quot;, &quot;int√©grer une CPGE&quot;],
     )
 
     # Contexte par d√©faut
     default_context = ConversationContext(
         student_id=student_id,
-        session_id=context.get(&quot;session_id&quot;, f&quot;session_{datetime.now().timestamp()}&quot;) if context else f&quot;session_{datetime.now().timestamp()}&quot;,
+        session_id=(
+            context.get(&quot;session_id&quot;, f&quot;session_{datetime.now().timestamp()}&quot;)
+            if context
+            else f&quot;session_{datetime.now().timestamp()}&quot;
+        ),
         subject=context.get(&quot;subject&quot;, &quot;g√©n√©ral&quot;) if context else &quot;g√©n√©ral&quot;,
         topic=context.get(&quot;topic&quot;) if context else None,
-        conversation_type=context.get(&quot;type&quot;, &quot;tutoring&quot;) if context else &quot;tutoring&quot;
+        conversation_type=context.get(&quot;type&quot;, &quot;tutoring&quot;) if context else &quot;tutoring&quot;,
     )
 
-    return await openai_service.chat_with_aria(message, default_context, default_profile)
+    return await openai_service.chat_with_aria(
+        message, default_context, default_profile
+    )
+
 
 async def generate_personalized_document(
-    document_type: str,
-    subject: str,
-    topic: str,
-    student_id: str
+    document_type: str, subject: str, topic: str, student_id: str
 ) -&gt; Dict:
     &quot;&quot;&quot;Interface simplifi√©e pour la g√©n√©ration de documents&quot;&quot;&quot;
 
     default_profile = StudentProfile(
         id=student_id,
@@ -1031,21 +1074,20 @@
         level=&quot;terminale&quot;,
         specialties=[subject.lower()],
         learning_style=&quot;visual&quot;,
         strengths=[&quot;compr√©hension&quot;, &quot;m√©morisation&quot;],
         weaknesses=[&quot;application&quot;, &quot;rapidit√©&quot;],
-        goals=[&quot;ma√Ætriser le programme&quot;, &quot;obtenir une bonne note&quot;]
+        goals=[&quot;ma√Ætriser le programme&quot;, &quot;obtenir une bonne note&quot;],
     )
 
-    return await openai_service.generate_document(document_type, subject, topic, default_profile)
+    return await openai_service.generate_document(
+        document_type, subject, topic, default_profile
+    )
+
 
 async def create_adaptive_quiz(
-    subject: str,
-    topic: str,
-    difficulty: str,
-    num_questions: int,
-    student_id: str
+    subject: str, topic: str, difficulty: str, num_questions: int, student_id: str
 ) -&gt; Dict:
     &quot;&quot;&quot;Interface simplifi√©e pour la g√©n√©ration de quiz&quot;&quot;&quot;
 
     default_profile = StudentProfile(
         id=student_id,
@@ -1053,10 +1095,11 @@
         level=&quot;terminale&quot;,
         specialties=[subject.lower()],
         learning_style=&quot;mixed&quot;,
         strengths=[&quot;raisonnement&quot;],
         weaknesses=[&quot;rapidit√©&quot;],
-        goals=[&quot;progresser&quot;, &quot;r√©ussir&quot;]
+        goals=[&quot;progresser&quot;, &quot;r√©ussir&quot;],
     )
 
-    return await openai_service.generate_quiz(subject, topic, difficulty, num_questions, default_profile)
-
+    return await openai_service.generate_quiz(
+        subject, topic, difficulty, num_questions, default_profile
+    )
--- /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/pdf_generator.py	2025-07-24 07:24:17.026976+00:00
+++ /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/pdf_generator.py	2025-07-24 20:54:02.801286+00:00
@@ -10,11 +10,19 @@
 # Imports pour la g√©n√©ration PDF
 from reportlab.lib.pagesizes import A4, letter
 from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
 from reportlab.lib.units import inch, cm
 from reportlab.lib.colors import Color, black, white, blue, red, green, orange, purple
-from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Image, PageBreak
+from reportlab.platypus import (
+    SimpleDocTemplate,
+    Paragraph,
+    Spacer,
+    Table,
+    TableStyle,
+    Image,
+    PageBreak,
+)
 from reportlab.platypus.flowables import HRFlowable
 from reportlab.lib.enums import TA_LEFT, TA_CENTER, TA_RIGHT, TA_JUSTIFY
 from reportlab.pdfgen import canvas
 from reportlab.lib import colors
 from reportlab.graphics.shapes import Drawing, Rect, Circle, Line
@@ -24,13 +32,15 @@
 
 # Configuration du logging
 logging.basicConfig(level=logging.INFO)
 logger = logging.getLogger(__name__)
 
+
 @dataclass
 class DocumentMetadata:
     &quot;&quot;&quot;M√©tadonn√©es du document&quot;&quot;&quot;
+
     title: str
     subject: str
     author: str = &quot;ARIA - Nexus R√©ussite&quot;
     creator: str = &quot;Nexus R√©ussite Platform&quot;
     student_name: str = &quot;&quot;
@@ -41,345 +51,435 @@
 
     def __post_init__(self):
         if not self.generated_at:
             self.generated_at = datetime.now().strftime(&quot;%d/%m/%Y √† %H:%M&quot;)
 
+
 class NexusPDFGenerator:
     &quot;&quot;&quot;G√©n√©rateur PDF personnalis√© pour Nexus R√©ussite&quot;&quot;&quot;
 
     def __init__(self):
         self.page_width, self.page_height = A4
         self.margin = 2 * cm
         self.content_width = self.page_width - 2 * self.margin
 
         # Couleurs de la charte graphique Nexus
         self.colors = {
-            &#x27;primary&#x27;: Color(0.059, 0.090, 0.165, 1),      # #0F172A (Bleu nuit)
-            &#x27;secondary&#x27;: Color(0.902, 0.224, 0.275, 1),    # #E63946 (Rouge √©nergie)
-            &#x27;accent&#x27;: Color(0.118, 0.161, 0.235, 1),       # #1E293B (Bleu fonc√©)
-            &#x27;light_gray&#x27;: Color(0.941, 0.953, 0.965, 1),   # #F1F5F9
-            &#x27;medium_gray&#x27;: Color(0.475, 0.549, 0.635, 1),  # #798DA3
-            &#x27;success&#x27;: Color(0.133, 0.545, 0.133, 1),      # #228B22
-            &#x27;warning&#x27;: Color(1.0, 0.647, 0.0, 1),          # #FFA500
-            &#x27;error&#x27;: Color(0.863, 0.078, 0.235, 1)         # #DC143C
+            &quot;primary&quot;: Color(0.059, 0.090, 0.165, 1),  # #0F172A (Bleu nuit)
+            &quot;secondary&quot;: Color(0.902, 0.224, 0.275, 1),  # #E63946 (Rouge √©nergie)
+            &quot;accent&quot;: Color(0.118, 0.161, 0.235, 1),  # #1E293B (Bleu fonc√©)
+            &quot;light_gray&quot;: Color(0.941, 0.953, 0.965, 1),  # #F1F5F9
+            &quot;medium_gray&quot;: Color(0.475, 0.549, 0.635, 1),  # #798DA3
+            &quot;success&quot;: Color(0.133, 0.545, 0.133, 1),  # #228B22
+            &quot;warning&quot;: Color(1.0, 0.647, 0.0, 1),  # #FFA500
+            &quot;error&quot;: Color(0.863, 0.078, 0.235, 1),  # #DC143C
         }
 
         # Styles personnalis√©s
         self.styles = self._create_custom_styles()
 
     def _create_custom_styles(self):
         &quot;&quot;&quot;Cr√©e les styles personnalis√©s pour Nexus R√©ussite&quot;&quot;&quot;
         styles = getSampleStyleSheet()
 
         # Style pour le titre principal
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusTitle&#x27;,
-            parent=styles[&#x27;Title&#x27;],
-            fontSize=24,
-            textColor=self.colors[&#x27;primary&#x27;],
-            spaceAfter=20,
-            alignment=TA_CENTER,
-            fontName=&#x27;Helvetica-Bold&#x27;
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusTitle&quot;,
+                parent=styles[&quot;Title&quot;],
+                fontSize=24,
+                textColor=self.colors[&quot;primary&quot;],
+                spaceAfter=20,
+                alignment=TA_CENTER,
+                fontName=&quot;Helvetica-Bold&quot;,
+            )
+        )
 
         # Style pour les sous-titres
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusSubtitle&#x27;,
-            parent=styles[&#x27;Heading1&#x27;],
-            fontSize=18,
-            textColor=self.colors[&#x27;secondary&#x27;],
-            spaceAfter=15,
-            spaceBefore=20,
-            fontName=&#x27;Helvetica-Bold&#x27;
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusSubtitle&quot;,
+                parent=styles[&quot;Heading1&quot;],
+                fontSize=18,
+                textColor=self.colors[&quot;secondary&quot;],
+                spaceAfter=15,
+                spaceBefore=20,
+                fontName=&quot;Helvetica-Bold&quot;,
+            )
+        )
 
         # Style pour les sections
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusSection&#x27;,
-            parent=styles[&#x27;Heading2&#x27;],
-            fontSize=14,
-            textColor=self.colors[&#x27;primary&#x27;],
-            spaceAfter=10,
-            spaceBefore=15,
-            fontName=&#x27;Helvetica-Bold&#x27;
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusSection&quot;,
+                parent=styles[&quot;Heading2&quot;],
+                fontSize=14,
+                textColor=self.colors[&quot;primary&quot;],
+                spaceAfter=10,
+                spaceBefore=15,
+                fontName=&quot;Helvetica-Bold&quot;,
+            )
+        )
 
         # Style pour le texte normal
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusNormal&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=11,
-            textColor=black,
-            spaceAfter=8,
-            alignment=TA_JUSTIFY,
-            fontName=&#x27;Helvetica&#x27;
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusNormal&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=11,
+                textColor=black,
+                spaceAfter=8,
+                alignment=TA_JUSTIFY,
+                fontName=&quot;Helvetica&quot;,
+            )
+        )
 
         # Style pour les d√©finitions
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusDefinition&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=11,
-            textColor=self.colors[&#x27;primary&#x27;],
-            spaceAfter=8,
-            leftIndent=20,
-            fontName=&#x27;Helvetica-Oblique&#x27;,
-            backColor=self.colors[&#x27;light_gray&#x27;]
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusDefinition&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=11,
+                textColor=self.colors[&quot;primary&quot;],
+                spaceAfter=8,
+                leftIndent=20,
+                fontName=&quot;Helvetica-Oblique&quot;,
+                backColor=self.colors[&quot;light_gray&quot;],
+            )
+        )
 
         # Style pour les formules
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusFormula&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=12,
-            textColor=self.colors[&#x27;accent&#x27;],
-            spaceAfter=10,
-            spaceBefore=10,
-            alignment=TA_CENTER,
-            fontName=&#x27;Courier-Bold&#x27;,
-            backColor=self.colors[&#x27;light_gray&#x27;]
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusFormula&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=12,
+                textColor=self.colors[&quot;accent&quot;],
+                spaceAfter=10,
+                spaceBefore=10,
+                alignment=TA_CENTER,
+                fontName=&quot;Courier-Bold&quot;,
+                backColor=self.colors[&quot;light_gray&quot;],
+            )
+        )
 
         # Style pour les exemples
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusExample&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=10,
-            textColor=self.colors[&#x27;medium_gray&#x27;],
-            spaceAfter=8,
-            leftIndent=15,
-            fontName=&#x27;Helvetica&#x27;,
-            borderColor=self.colors[&#x27;secondary&#x27;],
-            borderWidth=1,
-            borderPadding=5
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusExample&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=10,
+                textColor=self.colors[&quot;medium_gray&quot;],
+                spaceAfter=8,
+                leftIndent=15,
+                fontName=&quot;Helvetica&quot;,
+                borderColor=self.colors[&quot;secondary&quot;],
+                borderWidth=1,
+                borderPadding=5,
+            )
+        )
 
         # Style pour les conseils
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusTip&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=10,
-            textColor=self.colors[&#x27;success&#x27;],
-            spaceAfter=8,
-            leftIndent=15,
-            fontName=&#x27;Helvetica-Bold&#x27;,
-            backColor=Color(0.9, 1.0, 0.9, 1)
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusTip&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=10,
+                textColor=self.colors[&quot;success&quot;],
+                spaceAfter=8,
+                leftIndent=15,
+                fontName=&quot;Helvetica-Bold&quot;,
+                backColor=Color(0.9, 1.0, 0.9, 1),
+            )
+        )
 
         # Style pour les avertissements
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusWarning&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=10,
-            textColor=self.colors[&#x27;warning&#x27;],
-            spaceAfter=8,
-            leftIndent=15,
-            fontName=&#x27;Helvetica-Bold&#x27;,
-            backColor=Color(1.0, 0.98, 0.9, 1)
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusWarning&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=10,
+                textColor=self.colors[&quot;warning&quot;],
+                spaceAfter=8,
+                leftIndent=15,
+                fontName=&quot;Helvetica-Bold&quot;,
+                backColor=Color(1.0, 0.98, 0.9, 1),
+            )
+        )
 
         # Style pour le footer
-        styles.add(ParagraphStyle(
-            name=&#x27;NexusFooter&#x27;,
-            parent=styles[&#x27;Normal&#x27;],
-            fontSize=8,
-            textColor=self.colors[&#x27;medium_gray&#x27;],
-            alignment=TA_CENTER,
-            fontName=&#x27;Helvetica&#x27;
-        ))
+        styles.add(
+            ParagraphStyle(
+                name=&quot;NexusFooter&quot;,
+                parent=styles[&quot;Normal&quot;],
+                fontSize=8,
+                textColor=self.colors[&quot;medium_gray&quot;],
+                alignment=TA_CENTER,
+                fontName=&quot;Helvetica&quot;,
+            )
+        )
 
         return styles
 
     def _draw_header(self, canvas, doc, metadata: DocumentMetadata):
         &quot;&quot;&quot;Dessine l&#x27;en-t√™te personnalis√© Nexus R√©ussite&quot;&quot;&quot;
         canvas.saveState()
 
         # Logo et titre Nexus (simplifi√©)
-        canvas.setFillColor(self.colors[&#x27;primary&#x27;])
-        canvas.setFont(&#x27;Helvetica-Bold&#x27;, 16)
+        canvas.setFillColor(self.colors[&quot;primary&quot;])
+        canvas.setFont(&quot;Helvetica-Bold&quot;, 16)
         canvas.drawString(self.margin, self.page_height - self.margin, &quot;NEXUS&quot;)
 
-        canvas.setFillColor(self.colors[&#x27;secondary&#x27;])
-        canvas.setFont(&#x27;Helvetica&#x27;, 12)
+        canvas.setFillColor(self.colors[&quot;secondary&quot;])
+        canvas.setFont(&quot;Helvetica&quot;, 12)
         canvas.drawString(self.margin + 60, self.page_height - self.margin, &quot;R√©ussite&quot;)
 
         # Ligne de s√©paration
-        canvas.setStrokeColor(self.colors[&#x27;secondary&#x27;])
+        canvas.setStrokeColor(self.colors[&quot;secondary&quot;])
         canvas.setLineWidth(2)
-        canvas.line(self.margin, self.page_height - self.margin - 20,
-                   self.page_width - self.margin, self.page_height - self.margin - 20)
+        canvas.line(
+            self.margin,
+            self.page_height - self.margin - 20,
+            self.page_width - self.margin,
+            self.page_height - self.margin - 20,
+        )
 
         # Informations du document
-        canvas.setFillColor(self.colors[&#x27;medium_gray&#x27;])
-        canvas.setFont(&#x27;Helvetica&#x27;, 9)
+        canvas.setFillColor(self.colors[&quot;medium_gray&quot;])
+        canvas.setFont(&quot;Helvetica&quot;, 9)
 
         info_y = self.page_height - self.margin - 35
         canvas.drawString(self.margin, info_y, f&quot;Document: {metadata.document_type}&quot;)
         canvas.drawString(self.margin, info_y - 12, f&quot;Mati√®re: {metadata.subject}&quot;)
         if metadata.topic:
             canvas.drawString(self.margin, info_y - 24, f&quot;Sujet: {metadata.topic}&quot;)
 
         # Informations √©tudiant (c√¥t√© droit)
         if metadata.student_name:
-            canvas.drawRightString(self.page_width - self.margin, info_y, f&quot;√âl√®ve: {metadata.student_name}&quot;)
+            canvas.drawRightString(
+                self.page_width - self.margin, info_y, f&quot;√âl√®ve: {metadata.student_name}&quot;
+            )
         if metadata.student_level:
-            canvas.drawRightString(self.page_width - self.margin, info_y - 12, f&quot;Niveau: {metadata.student_level}&quot;)
-        canvas.drawRightString(self.page_width - self.margin, info_y - 24, f&quot;G√©n√©r√© le: {metadata.generated_at}&quot;)
+            canvas.drawRightString(
+                self.page_width - self.margin,
+                info_y - 12,
+                f&quot;Niveau: {metadata.student_level}&quot;,
+            )
+        canvas.drawRightString(
+            self.page_width - self.margin,
+            info_y - 24,
+            f&quot;G√©n√©r√© le: {metadata.generated_at}&quot;,
+        )
 
         canvas.restoreState()
 
     def _draw_footer(self, canvas, doc):
         &quot;&quot;&quot;Dessine le pied de page&quot;&quot;&quot;
         canvas.saveState()
 
         # Ligne de s√©paration
-        canvas.setStrokeColor(self.colors[&#x27;light_gray&#x27;])
+        canvas.setStrokeColor(self.colors[&quot;light_gray&quot;])
         canvas.setLineWidth(1)
-        canvas.line(self.margin, self.margin + 30,
-                   self.page_width - self.margin, self.margin + 30)
+        canvas.line(
+            self.margin,
+            self.margin + 30,
+            self.page_width - self.margin,
+            self.margin + 30,
+        )
 
         # Texte du footer
-        canvas.setFillColor(self.colors[&#x27;medium_gray&#x27;])
-        canvas.setFont(&#x27;Helvetica&#x27;, 8)
-
-        footer_text = &quot;Nexus R√©ussite - Centre Urbain Nord, Immeuble VENUS, Apt. C13, 1082 Tunis&quot;
+        canvas.setFillColor(self.colors[&quot;medium_gray&quot;])
+        canvas.setFont(&quot;Helvetica&quot;, 8)
+
+        footer_text = (
+            &quot;Nexus R√©ussite - Centre Urbain Nord, Immeuble VENUS, Apt. C13, 1082 Tunis&quot;
+        )
         canvas.drawCentredText(self.page_width / 2, self.margin + 15, footer_text)
 
         # Num√©ro de page
-        canvas.drawRightString(self.page_width - self.margin, self.margin + 15,
-                              f&quot;Page {doc.page}&quot;)
+        canvas.drawRightString(
+            self.page_width - self.margin, self.margin + 15, f&quot;Page {doc.page}&quot;
+        )
 
         canvas.restoreState()
 
     def generate_revision_sheet(
         self,
         content: Dict[str, Any],
         metadata: DocumentMetadata,
-        output_path: Optional[str] = None
+        output_path: Optional[str] = None,
     ) -&gt; bytes:
         &quot;&quot;&quot;G√©n√®re une fiche de r√©vision personnalis√©e&quot;&quot;&quot;
 
         # Cr√©ation du buffer ou fichier
         if output_path:
-            doc = SimpleDocTemplate(output_path, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                output_path,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
         else:
             buffer = io.BytesIO()
-            doc = SimpleDocTemplate(buffer, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                buffer,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
 
         # Construction du contenu
         story = []
 
         # Titre principal
-        story.append(Paragraph(content.get(&#x27;title&#x27;, metadata.title), self.styles[&#x27;NexusTitle&#x27;]))
+        story.append(
+            Paragraph(content.get(&quot;title&quot;, metadata.title), self.styles[&quot;NexusTitle&quot;])
+        )
         story.append(Spacer(1, 20))
 
         # Objectifs d&#x27;apprentissage
-        if &#x27;objectives&#x27; in content:
-            story.append(Paragraph(&quot;üéØ Objectifs d&#x27;apprentissage&quot;, self.styles[&#x27;NexusSubtitle&#x27;]))
-            for objective in content[&#x27;objectives&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {objective}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;objectives&quot; in content:
+            story.append(
+                Paragraph(&quot;üéØ Objectifs d&#x27;apprentissage&quot;, self.styles[&quot;NexusSubtitle&quot;])
+            )
+            for objective in content[&quot;objectives&quot;]:
+                story.append(Paragraph(f&quot;‚Ä¢ {objective}&quot;, self.styles[&quot;NexusNormal&quot;]))
             story.append(Spacer(1, 15))
 
         # Pr√©requis
-        if &#x27;prerequisites&#x27; in content:
-            story.append(Paragraph(&quot;üìö Pr√©requis&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for prereq in content[&#x27;prerequisites&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {prereq}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;prerequisites&quot; in content:
+            story.append(Paragraph(&quot;üìö Pr√©requis&quot;, self.styles[&quot;NexusSection&quot;]))
+            for prereq in content[&quot;prerequisites&quot;]:
+                story.append(Paragraph(f&quot;‚Ä¢ {prereq}&quot;, self.styles[&quot;NexusNormal&quot;]))
             story.append(Spacer(1, 15))
 
         # D√©finitions cl√©s
-        if &#x27;definitions&#x27; in content:
-            story.append(Paragraph(&quot;üìñ D√©finitions cl√©s&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for term, definition in content[&#x27;definitions&#x27;].items():
-                story.append(Paragraph(f&quot;&lt;b&gt;{term}:&lt;/b&gt; {definition}&quot;, self.styles[&#x27;NexusDefinition&#x27;]))
+        if &quot;definitions&quot; in content:
+            story.append(Paragraph(&quot;üìñ D√©finitions cl√©s&quot;, self.styles[&quot;NexusSection&quot;]))
+            for term, definition in content[&quot;definitions&quot;].items():
+                story.append(
+                    Paragraph(
+                        f&quot;&lt;b&gt;{term}:&lt;/b&gt; {definition}&quot;, self.styles[&quot;NexusDefinition&quot;]
+                    )
+                )
             story.append(Spacer(1, 15))
 
         # Formules importantes
-        if &#x27;formulas&#x27; in content:
-            story.append(Paragraph(&quot;üßÆ Formules importantes&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for formula in content[&#x27;formulas&#x27;]:
-                story.append(Paragraph(formula, self.styles[&#x27;NexusFormula&#x27;]))
+        if &quot;formulas&quot; in content:
+            story.append(
+                Paragraph(&quot;üßÆ Formules importantes&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for formula in content[&quot;formulas&quot;]:
+                story.append(Paragraph(formula, self.styles[&quot;NexusFormula&quot;]))
             story.append(Spacer(1, 15))
 
         # M√©thodes et techniques
-        if &#x27;methods&#x27; in content:
-            story.append(Paragraph(&quot;‚öôÔ∏è M√©thodes et techniques&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for i, method in enumerate(content[&#x27;methods&#x27;], 1):
-                story.append(Paragraph(f&quot;&lt;b&gt;M√©thode {i}:&lt;/b&gt; {method}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;methods&quot; in content:
+            story.append(
+                Paragraph(&quot;‚öôÔ∏è M√©thodes et techniques&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for i, method in enumerate(content[&quot;methods&quot;], 1):
+                story.append(
+                    Paragraph(
+                        f&quot;&lt;b&gt;M√©thode {i}:&lt;/b&gt; {method}&quot;, self.styles[&quot;NexusNormal&quot;]
+                    )
+                )
             story.append(Spacer(1, 15))
 
         # Exemples types
-        if &#x27;examples&#x27; in content:
-            story.append(Paragraph(&quot;üí° Exemples types&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for i, example in enumerate(content[&#x27;examples&#x27;], 1):
-                story.append(Paragraph(f&quot;&lt;b&gt;Exemple {i}:&lt;/b&gt;&quot;, self.styles[&#x27;NexusNormal&#x27;]))
-                story.append(Paragraph(example, self.styles[&#x27;NexusExample&#x27;]))
+        if &quot;examples&quot; in content:
+            story.append(Paragraph(&quot;üí° Exemples types&quot;, self.styles[&quot;NexusSection&quot;]))
+            for i, example in enumerate(content[&quot;examples&quot;], 1):
+                story.append(
+                    Paragraph(f&quot;&lt;b&gt;Exemple {i}:&lt;/b&gt;&quot;, self.styles[&quot;NexusNormal&quot;])
+                )
+                story.append(Paragraph(example, self.styles[&quot;NexusExample&quot;]))
             story.append(Spacer(1, 15))
 
         # Conseils et astuces
-        if &#x27;tips&#x27; in content:
-            story.append(Paragraph(&quot;üí° Conseils et astuces&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for tip in content[&#x27;tips&#x27;]:
-                story.append(Paragraph(f&quot;üí° {tip}&quot;, self.styles[&#x27;NexusTip&#x27;]))
+        if &quot;tips&quot; in content:
+            story.append(
+                Paragraph(&quot;üí° Conseils et astuces&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for tip in content[&quot;tips&quot;]:
+                story.append(Paragraph(f&quot;üí° {tip}&quot;, self.styles[&quot;NexusTip&quot;]))
             story.append(Spacer(1, 15))
 
         # Points d&#x27;attention
-        if &#x27;warnings&#x27; in content:
-            story.append(Paragraph(&quot;‚ö†Ô∏è Points d&#x27;attention&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for warning in content[&#x27;warnings&#x27;]:
-                story.append(Paragraph(f&quot;‚ö†Ô∏è {warning}&quot;, self.styles[&#x27;NexusWarning&#x27;]))
+        if &quot;warnings&quot; in content:
+            story.append(Paragraph(&quot;‚ö†Ô∏è Points d&#x27;attention&quot;, self.styles[&quot;NexusSection&quot;]))
+            for warning in content[&quot;warnings&quot;]:
+                story.append(Paragraph(f&quot;‚ö†Ô∏è {warning}&quot;, self.styles[&quot;NexusWarning&quot;]))
             story.append(Spacer(1, 15))
 
         # Exercices d&#x27;application
-        if &#x27;exercises&#x27; in content:
-            story.append(Paragraph(&quot;üìù Exercices d&#x27;application&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for i, exercise in enumerate(content[&#x27;exercises&#x27;], 1):
-                story.append(Paragraph(f&quot;&lt;b&gt;Exercice {i}:&lt;/b&gt; {exercise}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;exercises&quot; in content:
+            story.append(
+                Paragraph(&quot;üìù Exercices d&#x27;application&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for i, exercise in enumerate(content[&quot;exercises&quot;], 1):
+                story.append(
+                    Paragraph(
+                        f&quot;&lt;b&gt;Exercice {i}:&lt;/b&gt; {exercise}&quot;, self.styles[&quot;NexusNormal&quot;]
+                    )
+                )
             story.append(Spacer(1, 15))
 
         # Points cl√©s √† retenir
-        if &#x27;key_points&#x27; in content:
-            story.append(Paragraph(&quot;üîë Points cl√©s √† retenir&quot;, self.styles[&#x27;NexusSection&#x27;]))
+        if &quot;key_points&quot; in content:
+            story.append(
+                Paragraph(&quot;üîë Points cl√©s √† retenir&quot;, self.styles[&quot;NexusSection&quot;])
+            )
 
             # Cr√©ation d&#x27;un tableau pour les points cl√©s
             key_points_data = []
-            for point in content[&#x27;key_points&#x27;]:
+            for point in content[&quot;key_points&quot;]:
                 key_points_data.append([f&quot;‚úì&quot;, point])
 
             if key_points_data:
-                key_table = Table(key_points_data, colWidths=[0.5*cm, self.content_width - 0.5*cm])
-                key_table.setStyle(TableStyle([
-                    (&#x27;BACKGROUND&#x27;, (0, 0), (-1, -1), self.colors[&#x27;light_gray&#x27;]),
-                    (&#x27;TEXTCOLOR&#x27;, (0, 0), (0, -1), self.colors[&#x27;success&#x27;]),
-                    (&#x27;FONTNAME&#x27;, (0, 0), (0, -1), &#x27;Helvetica-Bold&#x27;),
-                    (&#x27;FONTSIZE&#x27;, (0, 0), (-1, -1), 10),
-                    (&#x27;ALIGN&#x27;, (0, 0), (0, -1), &#x27;CENTER&#x27;),
-                    (&#x27;VALIGN&#x27;, (0, 0), (-1, -1), &#x27;TOP&#x27;),
-                    (&#x27;LEFTPADDING&#x27;, (0, 0), (-1, -1), 5),
-                    (&#x27;RIGHTPADDING&#x27;, (0, 0), (-1, -1), 5),
-                    (&#x27;TOPPADDING&#x27;, (0, 0), (-1, -1), 5),
-                    (&#x27;BOTTOMPADDING&#x27;, (0, 0), (-1, -1), 5),
-                ]))
+                key_table = Table(
+                    key_points_data, colWidths=[0.5 * cm, self.content_width - 0.5 * cm]
+                )
+                key_table.setStyle(
+                    TableStyle(
+                        [
+                            (&quot;BACKGROUND&quot;, (0, 0), (-1, -1), self.colors[&quot;light_gray&quot;]),
+                            (&quot;TEXTCOLOR&quot;, (0, 0), (0, -1), self.colors[&quot;success&quot;]),
+                            (&quot;FONTNAME&quot;, (0, 0), (0, -1), &quot;Helvetica-Bold&quot;),
+                            (&quot;FONTSIZE&quot;, (0, 0), (-1, -1), 10),
+                            (&quot;ALIGN&quot;, (0, 0), (0, -1), &quot;CENTER&quot;),
+                            (&quot;VALIGN&quot;, (0, 0), (-1, -1), &quot;TOP&quot;),
+                            (&quot;LEFTPADDING&quot;, (0, 0), (-1, -1), 5),
+                            (&quot;RIGHTPADDING&quot;, (0, 0), (-1, -1), 5),
+                            (&quot;TOPPADDING&quot;, (0, 0), (-1, -1), 5),
+                            (&quot;BOTTOMPADDING&quot;, (0, 0), (-1, -1), 5),
+                        ]
+                    )
+                )
                 story.append(key_table)
                 story.append(Spacer(1, 15))
 
         # Pour aller plus loin
-        if &#x27;further_reading&#x27; in content:
-            story.append(Paragraph(&quot;üìö Pour aller plus loin&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for resource in content[&#x27;further_reading&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {resource}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;further_reading&quot; in content:
+            story.append(
+                Paragraph(&quot;üìö Pour aller plus loin&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for resource in content[&quot;further_reading&quot;]:
+                story.append(Paragraph(f&quot;‚Ä¢ {resource}&quot;, self.styles[&quot;NexusNormal&quot;]))
 
         # Construction du PDF avec en-t√™te et pied de page personnalis√©s
         def add_page_decorations(canvas, doc):
             self._draw_header(canvas, doc, metadata)
             self._draw_footer(canvas, doc)
 
-        doc.build(story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations)
+        doc.build(
+            story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations
+        )
 
         if output_path:
             return output_path
         else:
             buffer.seek(0)
@@ -387,99 +487,127 @@
 
     def generate_exercise_sheet(
         self,
         content: Dict[str, Any],
         metadata: DocumentMetadata,
-        output_path: Optional[str] = None
+        output_path: Optional[str] = None,
     ) -&gt; bytes:
         &quot;&quot;&quot;G√©n√®re une feuille d&#x27;exercices personnalis√©e&quot;&quot;&quot;
 
         # Cr√©ation du buffer ou fichier
         if output_path:
-            doc = SimpleDocTemplate(output_path, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                output_path,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
         else:
             buffer = io.BytesIO()
-            doc = SimpleDocTemplate(buffer, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                buffer,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
 
         story = []
 
         # Titre principal
-        story.append(Paragraph(content.get(&#x27;title&#x27;, metadata.title), self.styles[&#x27;NexusTitle&#x27;]))
+        story.append(
+            Paragraph(content.get(&quot;title&quot;, metadata.title), self.styles[&quot;NexusTitle&quot;])
+        )
         story.append(Spacer(1, 20))
 
         # Instructions g√©n√©rales
-        if &#x27;instructions&#x27; in content:
-            story.append(Paragraph(&quot;üìã Instructions&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            story.append(Paragraph(content[&#x27;instructions&#x27;], self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;instructions&quot; in content:
+            story.append(Paragraph(&quot;üìã Instructions&quot;, self.styles[&quot;NexusSection&quot;]))
+            story.append(Paragraph(content[&quot;instructions&quot;], self.styles[&quot;NexusNormal&quot;]))
             story.append(Spacer(1, 15))
 
         # Dur√©e et bar√®me
         info_data = []
-        if &#x27;duration&#x27; in content:
-            info_data.append([&#x27;‚è±Ô∏è Dur√©e:&#x27;, content[&#x27;duration&#x27;]])
-        if &#x27;total_points&#x27; in content:
-            info_data.append([&#x27;üìä Total:&#x27;, f&quot;{content[&#x27;total_points&#x27;]} points&quot;])
+        if &quot;duration&quot; in content:
+            info_data.append([&quot;‚è±Ô∏è Dur√©e:&quot;, content[&quot;duration&quot;]])
+        if &quot;total_points&quot; in content:
+            info_data.append([&quot;üìä Total:&quot;, f&quot;{content[&#x27;total_points&#x27;]} points&quot;])
 
         if info_data:
-            info_table = Table(info_data, colWidths=[3*cm, 5*cm])
-            info_table.setStyle(TableStyle([
-                (&#x27;BACKGROUND&#x27;, (0, 0), (-1, -1), self.colors[&#x27;light_gray&#x27;]),
-                (&#x27;FONTNAME&#x27;, (0, 0), (0, -1), &#x27;Helvetica-Bold&#x27;),
-                (&#x27;FONTSIZE&#x27;, (0, 0), (-1, -1), 10),
-                (&#x27;ALIGN&#x27;, (0, 0), (-1, -1), &#x27;LEFT&#x27;),
-                (&#x27;LEFTPADDING&#x27;, (0, 0), (-1, -1), 8),
-                (&#x27;RIGHTPADDING&#x27;, (0, 0), (-1, -1), 8),
-                (&#x27;TOPPADDING&#x27;, (0, 0), (-1, -1), 5),
-                (&#x27;BOTTOMPADDING&#x27;, (0, 0), (-1, -1), 5),
-            ]))
+            info_table = Table(info_data, colWidths=[3 * cm, 5 * cm])
+            info_table.setStyle(
+                TableStyle(
+                    [
+                        (&quot;BACKGROUND&quot;, (0, 0), (-1, -1), self.colors[&quot;light_gray&quot;]),
+                        (&quot;FONTNAME&quot;, (0, 0), (0, -1), &quot;Helvetica-Bold&quot;),
+                        (&quot;FONTSIZE&quot;, (0, 0), (-1, -1), 10),
+                        (&quot;ALIGN&quot;, (0, 0), (-1, -1), &quot;LEFT&quot;),
+                        (&quot;LEFTPADDING&quot;, (0, 0), (-1, -1), 8),
+                        (&quot;RIGHTPADDING&quot;, (0, 0), (-1, -1), 8),
+                        (&quot;TOPPADDING&quot;, (0, 0), (-1, -1), 5),
+                        (&quot;BOTTOMPADDING&quot;, (0, 0), (-1, -1), 5),
+                    ]
+                )
+            )
             story.append(info_table)
             story.append(Spacer(1, 20))
 
         # Exercices
-        if &#x27;exercises&#x27; in content:
-            for i, exercise in enumerate(content[&#x27;exercises&#x27;], 1):
+        if &quot;exercises&quot; in content:
+            for i, exercise in enumerate(content[&quot;exercises&quot;], 1):
                 # Titre de l&#x27;exercice
                 exercise_title = f&quot;Exercice {i}&quot;
-                if &#x27;points&#x27; in exercise:
+                if &quot;points&quot; in exercise:
                     exercise_title += f&quot; ({exercise[&#x27;points&#x27;]} points)&quot;
-                if &#x27;difficulty&#x27; in exercise:
-                    difficulty_emoji = {&#x27;easy&#x27;: &#x27;‚≠ê&#x27;, &#x27;medium&#x27;: &#x27;‚≠ê‚≠ê&#x27;, &#x27;hard&#x27;: &#x27;‚≠ê‚≠ê‚≠ê&#x27;}
-                    exercise_title += f&quot; {difficulty_emoji.get(exercise[&#x27;difficulty&#x27;], &#x27;&#x27;)}&quot;
-
-                story.append(Paragraph(exercise_title, self.styles[&#x27;NexusSubtitle&#x27;]))
+                if &quot;difficulty&quot; in exercise:
+                    difficulty_emoji = {
+                        &quot;easy&quot;: &quot;‚≠ê&quot;,
+                        &quot;medium&quot;: &quot;‚≠ê‚≠ê&quot;,
+                        &quot;hard&quot;: &quot;‚≠ê‚≠ê‚≠ê&quot;,
+                    }
+                    exercise_title += (
+                        f&quot; {difficulty_emoji.get(exercise[&#x27;difficulty&#x27;], &#x27;&#x27;)}&quot;
+                    )
+
+                story.append(Paragraph(exercise_title, self.styles[&quot;NexusSubtitle&quot;]))
 
                 # √ânonc√©
-                if &#x27;statement&#x27; in exercise:
-                    story.append(Paragraph(exercise[&#x27;statement&#x27;], self.styles[&#x27;NexusNormal&#x27;]))
+                if &quot;statement&quot; in exercise:
+                    story.append(
+                        Paragraph(exercise[&quot;statement&quot;], self.styles[&quot;NexusNormal&quot;])
+                    )
 
                 # Questions
-                if &#x27;questions&#x27; in exercise:
-                    for j, question in enumerate(exercise[&#x27;questions&#x27;], 1):
+                if &quot;questions&quot; in exercise:
+                    for j, question in enumerate(exercise[&quot;questions&quot;], 1):
                         question_text = f&quot;&lt;b&gt;{j}.&lt;/b&gt; {question}&quot;
-                        story.append(Paragraph(question_text, self.styles[&#x27;NexusNormal&#x27;]))
+                        story.append(
+                            Paragraph(question_text, self.styles[&quot;NexusNormal&quot;])
+                        )
 
                         # Espace pour la r√©ponse
                         story.append(Spacer(1, 30))
 
                 # Conseils sp√©cifiques
-                if &#x27;hints&#x27; in exercise:
-                    story.append(Paragraph(&quot;üí° Conseils:&quot;, self.styles[&#x27;NexusSection&#x27;]))
-                    for hint in exercise[&#x27;hints&#x27;]:
-                        story.append(Paragraph(f&quot;‚Ä¢ {hint}&quot;, self.styles[&#x27;NexusTip&#x27;]))
+                if &quot;hints&quot; in exercise:
+                    story.append(Paragraph(&quot;üí° Conseils:&quot;, self.styles[&quot;NexusSection&quot;]))
+                    for hint in exercise[&quot;hints&quot;]:
+                        story.append(Paragraph(f&quot;‚Ä¢ {hint}&quot;, self.styles[&quot;NexusTip&quot;]))
 
                 story.append(Spacer(1, 20))
 
         # Construction du PDF
         def add_page_decorations(canvas, doc):
             self._draw_header(canvas, doc, metadata)
             self._draw_footer(canvas, doc)
 
-        doc.build(story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations)
+        doc.build(
+            story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations
+        )
 
         if output_path:
             return output_path
         else:
             buffer.seek(0)
@@ -487,125 +615,157 @@
 
     def generate_evaluation_report(
         self,
         content: Dict[str, Any],
         metadata: DocumentMetadata,
-        output_path: Optional[str] = None
+        output_path: Optional[str] = None,
     ) -&gt; bytes:
         &quot;&quot;&quot;G√©n√®re un rapport d&#x27;√©valuation personnalis√©&quot;&quot;&quot;
 
         # Cr√©ation du buffer ou fichier
         if output_path:
-            doc = SimpleDocTemplate(output_path, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                output_path,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
         else:
             buffer = io.BytesIO()
-            doc = SimpleDocTemplate(buffer, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                buffer,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
 
         story = []
 
         # Titre principal
-        story.append(Paragraph(content.get(&#x27;title&#x27;, &#x27;Rapport d\&#x27;√©valuation&#x27;), self.styles[&#x27;NexusTitle&#x27;]))
+        story.append(
+            Paragraph(
+                content.get(&quot;title&quot;, &quot;Rapport d&#x27;√©valuation&quot;), self.styles[&quot;NexusTitle&quot;]
+            )
+        )
         story.append(Spacer(1, 20))
 
         # R√©sum√© ex√©cutif
-        if &#x27;summary&#x27; in content:
-            story.append(Paragraph(&quot;üìä R√©sum√© ex√©cutif&quot;, self.styles[&#x27;NexusSubtitle&#x27;]))
-            story.append(Paragraph(content[&#x27;summary&#x27;], self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;summary&quot; in content:
+            story.append(Paragraph(&quot;üìä R√©sum√© ex√©cutif&quot;, self.styles[&quot;NexusSubtitle&quot;]))
+            story.append(Paragraph(content[&quot;summary&quot;], self.styles[&quot;NexusNormal&quot;]))
             story.append(Spacer(1, 15))
 
         # R√©sultats globaux
-        if &#x27;overall_results&#x27; in content:
-            results = content[&#x27;overall_results&#x27;]
+        if &quot;overall_results&quot; in content:
+            results = content[&quot;overall_results&quot;]
 
             # Tableau des r√©sultats
-            results_data = [[&#x27;Crit√®re&#x27;, &#x27;Score&#x27;, &#x27;Commentaire&#x27;]]
+            results_data = [[&quot;Crit√®re&quot;, &quot;Score&quot;, &quot;Commentaire&quot;]]
 
             for criterion, data in results.items():
-                score = data.get(&#x27;score&#x27;, &#x27;N/A&#x27;)
-                comment = data.get(&#x27;comment&#x27;, &#x27;&#x27;)
+                score = data.get(&quot;score&quot;, &quot;N/A&quot;)
+                comment = data.get(&quot;comment&quot;, &quot;&quot;)
                 results_data.append([criterion, str(score), comment])
 
-            results_table = Table(results_data, colWidths=[4*cm, 2*cm, 8*cm])
-            results_table.setStyle(TableStyle([
-                (&#x27;BACKGROUND&#x27;, (0, 0), (-1, 0), self.colors[&#x27;primary&#x27;]),
-                (&#x27;TEXTCOLOR&#x27;, (0, 0), (-1, 0), white),
-                (&#x27;FONTNAME&#x27;, (0, 0), (-1, 0), &#x27;Helvetica-Bold&#x27;),
-                (&#x27;FONTSIZE&#x27;, (0, 0), (-1, -1), 10),
-                (&#x27;ALIGN&#x27;, (0, 0), (-1, -1), &#x27;LEFT&#x27;),
-                (&#x27;ALIGN&#x27;, (1, 1), (1, -1), &#x27;CENTER&#x27;),
-                (&#x27;VALIGN&#x27;, (0, 0), (-1, -1), &#x27;TOP&#x27;),
-                (&#x27;GRID&#x27;, (0, 0), (-1, -1), 1, black),
-                (&#x27;LEFTPADDING&#x27;, (0, 0), (-1, -1), 8),
-                (&#x27;RIGHTPADDING&#x27;, (0, 0), (-1, -1), 8),
-                (&#x27;TOPPADDING&#x27;, (0, 0), (-1, -1), 5),
-                (&#x27;BOTTOMPADDING&#x27;, (0, 0), (-1, -1), 5),
-            ]))
+            results_table = Table(results_data, colWidths=[4 * cm, 2 * cm, 8 * cm])
+            results_table.setStyle(
+                TableStyle(
+                    [
+                        (&quot;BACKGROUND&quot;, (0, 0), (-1, 0), self.colors[&quot;primary&quot;]),
+                        (&quot;TEXTCOLOR&quot;, (0, 0), (-1, 0), white),
+                        (&quot;FONTNAME&quot;, (0, 0), (-1, 0), &quot;Helvetica-Bold&quot;),
+                        (&quot;FONTSIZE&quot;, (0, 0), (-1, -1), 10),
+                        (&quot;ALIGN&quot;, (0, 0), (-1, -1), &quot;LEFT&quot;),
+                        (&quot;ALIGN&quot;, (1, 1), (1, -1), &quot;CENTER&quot;),
+                        (&quot;VALIGN&quot;, (0, 0), (-1, -1), &quot;TOP&quot;),
+                        (&quot;GRID&quot;, (0, 0), (-1, -1), 1, black),
+                        (&quot;LEFTPADDING&quot;, (0, 0), (-1, -1), 8),
+                        (&quot;RIGHTPADDING&quot;, (0, 0), (-1, -1), 8),
+                        (&quot;TOPPADDING&quot;, (0, 0), (-1, -1), 5),
+                        (&quot;BOTTOMPADDING&quot;, (0, 0), (-1, -1), 5),
+                    ]
+                )
+            )
 
             story.append(results_table)
             story.append(Spacer(1, 20))
 
         # Points forts
-        if &#x27;strengths&#x27; in content:
-            story.append(Paragraph(&quot;‚úÖ Points forts&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for strength in content[&#x27;strengths&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {strength}&quot;, self.styles[&#x27;NexusTip&#x27;]))
+        if &quot;strengths&quot; in content:
+            story.append(Paragraph(&quot;‚úÖ Points forts&quot;, self.styles[&quot;NexusSection&quot;]))
+            for strength in content[&quot;strengths&quot;]:
+                story.append(Paragraph(f&quot;‚Ä¢ {strength}&quot;, self.styles[&quot;NexusTip&quot;]))
             story.append(Spacer(1, 15))
 
         # Axes d&#x27;am√©lioration
-        if &#x27;improvements&#x27; in content:
-            story.append(Paragraph(&quot;üìà Axes d&#x27;am√©lioration&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for improvement in content[&#x27;improvements&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {improvement}&quot;, self.styles[&#x27;NexusWarning&#x27;]))
+        if &quot;improvements&quot; in content:
+            story.append(
+                Paragraph(&quot;üìà Axes d&#x27;am√©lioration&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for improvement in content[&quot;improvements&quot;]:
+                story.append(Paragraph(f&quot;‚Ä¢ {improvement}&quot;, self.styles[&quot;NexusWarning&quot;]))
             story.append(Spacer(1, 15))
 
         # Recommandations
-        if &#x27;recommendations&#x27; in content:
-            story.append(Paragraph(&quot;üéØ Recommandations&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for i, recommendation in enumerate(content[&#x27;recommendations&#x27;], 1):
-                story.append(Paragraph(f&quot;&lt;b&gt;{i}.&lt;/b&gt; {recommendation}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;recommendations&quot; in content:
+            story.append(Paragraph(&quot;üéØ Recommandations&quot;, self.styles[&quot;NexusSection&quot;]))
+            for i, recommendation in enumerate(content[&quot;recommendations&quot;], 1):
+                story.append(
+                    Paragraph(
+                        f&quot;&lt;b&gt;{i}.&lt;/b&gt; {recommendation}&quot;, self.styles[&quot;NexusNormal&quot;]
+                    )
+                )
             story.append(Spacer(1, 15))
 
         # Plan d&#x27;action
-        if &#x27;action_plan&#x27; in content:
-            story.append(Paragraph(&quot;üìã Plan d&#x27;action&quot;, self.styles[&#x27;NexusSection&#x27;]))
-
-            action_data = [[&#x27;Action&#x27;, &#x27;Priorit√©&#x27;, &#x27;√âch√©ance&#x27;]]
-            for action in content[&#x27;action_plan&#x27;]:
-                action_data.append([
-                    action.get(&#x27;description&#x27;, &#x27;&#x27;),
-                    action.get(&#x27;priority&#x27;, &#x27;&#x27;),
-                    action.get(&#x27;deadline&#x27;, &#x27;&#x27;)
-                ])
-
-            action_table = Table(action_data, colWidths=[8*cm, 3*cm, 3*cm])
-            action_table.setStyle(TableStyle([
-                (&#x27;BACKGROUND&#x27;, (0, 0), (-1, 0), self.colors[&#x27;secondary&#x27;]),
-                (&#x27;TEXTCOLOR&#x27;, (0, 0), (-1, 0), white),
-                (&#x27;FONTNAME&#x27;, (0, 0), (-1, 0), &#x27;Helvetica-Bold&#x27;),
-                (&#x27;FONTSIZE&#x27;, (0, 0), (-1, -1), 10),
-                (&#x27;ALIGN&#x27;, (0, 0), (-1, -1), &#x27;LEFT&#x27;),
-                (&#x27;ALIGN&#x27;, (1, 1), (2, -1), &#x27;CENTER&#x27;),
-                (&#x27;VALIGN&#x27;, (0, 0), (-1, -1), &#x27;TOP&#x27;),
-                (&#x27;GRID&#x27;, (0, 0), (-1, -1), 1, black),
-                (&#x27;LEFTPADDING&#x27;, (0, 0), (-1, -1), 8),
-                (&#x27;RIGHTPADDING&#x27;, (0, 0), (-1, -1), 8),
-                (&#x27;TOPPADDING&#x27;, (0, 0), (-1, -1), 5),
-                (&#x27;BOTTOMPADDING&#x27;, (0, 0), (-1, -1), 5),
-            ]))
+        if &quot;action_plan&quot; in content:
+            story.append(Paragraph(&quot;üìã Plan d&#x27;action&quot;, self.styles[&quot;NexusSection&quot;]))
+
+            action_data = [[&quot;Action&quot;, &quot;Priorit√©&quot;, &quot;√âch√©ance&quot;]]
+            for action in content[&quot;action_plan&quot;]:
+                action_data.append(
+                    [
+                        action.get(&quot;description&quot;, &quot;&quot;),
+                        action.get(&quot;priority&quot;, &quot;&quot;),
+                        action.get(&quot;deadline&quot;, &quot;&quot;),
+                    ]
+                )
+
+            action_table = Table(action_data, colWidths=[8 * cm, 3 * cm, 3 * cm])
+            action_table.setStyle(
+                TableStyle(
+                    [
+                        (&quot;BACKGROUND&quot;, (0, 0), (-1, 0), self.colors[&quot;secondary&quot;]),
+                        (&quot;TEXTCOLOR&quot;, (0, 0), (-1, 0), white),
+                        (&quot;FONTNAME&quot;, (0, 0), (-1, 0), &quot;Helvetica-Bold&quot;),
+                        (&quot;FONTSIZE&quot;, (0, 0), (-1, -1), 10),
+                        (&quot;ALIGN&quot;, (0, 0), (-1, -1), &quot;LEFT&quot;),
+                        (&quot;ALIGN&quot;, (1, 1), (2, -1), &quot;CENTER&quot;),
+                        (&quot;VALIGN&quot;, (0, 0), (-1, -1), &quot;TOP&quot;),
+                        (&quot;GRID&quot;, (0, 0), (-1, -1), 1, black),
+                        (&quot;LEFTPADDING&quot;, (0, 0), (-1, -1), 8),
+                        (&quot;RIGHTPADDING&quot;, (0, 0), (-1, -1), 8),
+                        (&quot;TOPPADDING&quot;, (0, 0), (-1, -1), 5),
+                        (&quot;BOTTOMPADDING&quot;, (0, 0), (-1, -1), 5),
+                    ]
+                )
+            )
 
             story.append(action_table)
 
         # Construction du PDF
         def add_page_decorations(canvas, doc):
             self._draw_header(canvas, doc, metadata)
             self._draw_footer(canvas, doc)
 
-        doc.build(story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations)
+        doc.build(
+            story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations
+        )
 
         if output_path:
             return output_path
         else:
             buffer.seek(0)
@@ -613,180 +773,232 @@
 
     def generate_progress_report(
         self,
         student_data: Dict[str, Any],
         metadata: DocumentMetadata,
-        output_path: Optional[str] = None
+        output_path: Optional[str] = None,
     ) -&gt; bytes:
         &quot;&quot;&quot;G√©n√®re un rapport de progression pour les parents&quot;&quot;&quot;
 
         # Cr√©ation du buffer ou fichier
         if output_path:
-            doc = SimpleDocTemplate(output_path, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                output_path,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
         else:
             buffer = io.BytesIO()
-            doc = SimpleDocTemplate(buffer, pagesize=A4,
-                                  rightMargin=self.margin, leftMargin=self.margin,
-                                  topMargin=self.margin + 60, bottomMargin=self.margin + 40)
+            doc = SimpleDocTemplate(
+                buffer,
+                pagesize=A4,
+                rightMargin=self.margin,
+                leftMargin=self.margin,
+                topMargin=self.margin + 60,
+                bottomMargin=self.margin + 40,
+            )
 
         story = []
 
         # Titre principal
-        story.append(Paragraph(f&quot;Rapport de progression - {metadata.student_name}&quot;, self.styles[&#x27;NexusTitle&#x27;]))
+        story.append(
+            Paragraph(
+                f&quot;Rapport de progression - {metadata.student_name}&quot;,
+                self.styles[&quot;NexusTitle&quot;],
+            )
+        )
         story.append(Spacer(1, 20))
 
         # P√©riode du rapport
-        if &#x27;period&#x27; in student_data:
-            story.append(Paragraph(f&quot;P√©riode: {student_data[&#x27;period&#x27;]}&quot;, self.styles[&#x27;NexusSection&#x27;]))
+        if &quot;period&quot; in student_data:
+            story.append(
+                Paragraph(
+                    f&quot;P√©riode: {student_data[&#x27;period&#x27;]}&quot;, self.styles[&quot;NexusSection&quot;]
+                )
+            )
             story.append(Spacer(1, 10))
 
         # Vue d&#x27;ensemble
-        if &#x27;overview&#x27; in student_data:
-            story.append(Paragraph(&quot;üìä Vue d&#x27;ensemble&quot;, self.styles[&#x27;NexusSubtitle&#x27;]))
-            story.append(Paragraph(student_data[&#x27;overview&#x27;], self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;overview&quot; in student_data:
+            story.append(Paragraph(&quot;üìä Vue d&#x27;ensemble&quot;, self.styles[&quot;NexusSubtitle&quot;]))
+            story.append(
+                Paragraph(student_data[&quot;overview&quot;], self.styles[&quot;NexusNormal&quot;])
+            )
             story.append(Spacer(1, 15))
 
         # Progression par mati√®re
-        if &#x27;subjects_progress&#x27; in student_data:
-            story.append(Paragraph(&quot;üìö Progression par mati√®re&quot;, self.styles[&#x27;NexusSubtitle&#x27;]))
-
-            for subject, progress in student_data[&#x27;subjects_progress&#x27;].items():
-                story.append(Paragraph(f&quot;&lt;b&gt;{subject}&lt;/b&gt;&quot;, self.styles[&#x27;NexusSection&#x27;]))
+        if &quot;subjects_progress&quot; in student_data:
+            story.append(
+                Paragraph(&quot;üìö Progression par mati√®re&quot;, self.styles[&quot;NexusSubtitle&quot;])
+            )
+
+            for subject, progress in student_data[&quot;subjects_progress&quot;].items():
+                story.append(
+                    Paragraph(f&quot;&lt;b&gt;{subject}&lt;/b&gt;&quot;, self.styles[&quot;NexusSection&quot;])
+                )
 
                 # Tableau de progression
-                progress_data = [
-                    [&#x27;Aspect&#x27;, &#x27;Note&#x27;, &#x27;√âvolution&#x27;, &#x27;Commentaire&#x27;]
-                ]
+                progress_data = [[&quot;Aspect&quot;, &quot;Note&quot;, &quot;√âvolution&quot;, &quot;Commentaire&quot;]]
 
                 for aspect, data in progress.items():
                     if isinstance(data, dict):
-                        evolution = data.get(&#x27;evolution&#x27;, &#x27;&#x27;)
-                        if evolution == &#x27;up&#x27;:
-                            evolution = &#x27;üìà&#x27;
-                        elif evolution == &#x27;down&#x27;:
-                            evolution = &#x27;üìâ&#x27;
-                        elif evolution == &#x27;stable&#x27;:
-                            evolution = &#x27;‚û°Ô∏è&#x27;
-
-                        progress_data.append([
-                            aspect,
-                            str(data.get(&#x27;score&#x27;, &#x27;N/A&#x27;)),
-                            evolution,
-                            data.get(&#x27;comment&#x27;, &#x27;&#x27;)
-                        ])
+                        evolution = data.get(&quot;evolution&quot;, &quot;&quot;)
+                        if evolution == &quot;up&quot;:
+                            evolution = &quot;üìà&quot;
+                        elif evolution == &quot;down&quot;:
+                            evolution = &quot;üìâ&quot;
+                        elif evolution == &quot;stable&quot;:
+                            evolution = &quot;‚û°Ô∏è&quot;
+
+                        progress_data.append(
+                            [
+                                aspect,
+                                str(data.get(&quot;score&quot;, &quot;N/A&quot;)),
+                                evolution,
+                                data.get(&quot;comment&quot;, &quot;&quot;),
+                            ]
+                        )
 
                 if len(progress_data) &gt; 1:
-                    progress_table = Table(progress_data, colWidths=[3*cm, 2*cm, 2*cm, 7*cm])
-                    progress_table.setStyle(TableStyle([
-                        (&#x27;BACKGROUND&#x27;, (0, 0), (-1, 0), self.colors[&#x27;accent&#x27;]),
-                        (&#x27;TEXTCOLOR&#x27;, (0, 0), (-1, 0), white),
-                        (&#x27;FONTNAME&#x27;, (0, 0), (-1, 0), &#x27;Helvetica-Bold&#x27;),
-                        (&#x27;FONTSIZE&#x27;, (0, 0), (-1, -1), 9),
-                        (&#x27;ALIGN&#x27;, (0, 0), (-1, -1), &#x27;LEFT&#x27;),
-                        (&#x27;ALIGN&#x27;, (1, 1), (2, -1), &#x27;CENTER&#x27;),
-                        (&#x27;VALIGN&#x27;, (0, 0), (-1, -1), &#x27;TOP&#x27;),
-                        (&#x27;GRID&#x27;, (0, 0), (-1, -1), 1, black),
-                        (&#x27;LEFTPADDING&#x27;, (0, 0), (-1, -1), 5),
-                        (&#x27;RIGHTPADDING&#x27;, (0, 0), (-1, -1), 5),
-                        (&#x27;TOPPADDING&#x27;, (0, 0), (-1, -1), 3),
-                        (&#x27;BOTTOMPADDING&#x27;, (0, 0), (-1, -1), 3),
-                    ]))
+                    progress_table = Table(
+                        progress_data, colWidths=[3 * cm, 2 * cm, 2 * cm, 7 * cm]
+                    )
+                    progress_table.setStyle(
+                        TableStyle(
+                            [
+                                (&quot;BACKGROUND&quot;, (0, 0), (-1, 0), self.colors[&quot;accent&quot;]),
+                                (&quot;TEXTCOLOR&quot;, (0, 0), (-1, 0), white),
+                                (&quot;FONTNAME&quot;, (0, 0), (-1, 0), &quot;Helvetica-Bold&quot;),
+                                (&quot;FONTSIZE&quot;, (0, 0), (-1, -1), 9),
+                                (&quot;ALIGN&quot;, (0, 0), (-1, -1), &quot;LEFT&quot;),
+                                (&quot;ALIGN&quot;, (1, 1), (2, -1), &quot;CENTER&quot;),
+                                (&quot;VALIGN&quot;, (0, 0), (-1, -1), &quot;TOP&quot;),
+                                (&quot;GRID&quot;, (0, 0), (-1, -1), 1, black),
+                                (&quot;LEFTPADDING&quot;, (0, 0), (-1, -1), 5),
+                                (&quot;RIGHTPADDING&quot;, (0, 0), (-1, -1), 5),
+                                (&quot;TOPPADDING&quot;, (0, 0), (-1, -1), 3),
+                                (&quot;BOTTOMPADDING&quot;, (0, 0), (-1, -1), 3),
+                            ]
+                        )
+                    )
 
                     story.append(progress_table)
                     story.append(Spacer(1, 10))
 
         # Objectifs atteints
-        if &#x27;achieved_goals&#x27; in student_data:
-            story.append(Paragraph(&quot;üéØ Objectifs atteints&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for goal in student_data[&#x27;achieved_goals&#x27;]:
-                story.append(Paragraph(f&quot;‚úÖ {goal}&quot;, self.styles[&#x27;NexusTip&#x27;]))
+        if &quot;achieved_goals&quot; in student_data:
+            story.append(
+                Paragraph(&quot;üéØ Objectifs atteints&quot;, self.styles[&quot;NexusSection&quot;])
+            )
+            for goal in student_data[&quot;achieved_goals&quot;]:
+                story.append(Paragraph(f&quot;‚úÖ {goal}&quot;, self.styles[&quot;NexusTip&quot;]))
             story.append(Spacer(1, 15))
 
         # D√©fis √† relever
-        if &#x27;challenges&#x27; in student_data:
-            story.append(Paragraph(&quot;üöÄ D√©fis √† relever&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for challenge in student_data[&#x27;challenges&#x27;]:
-                story.append(Paragraph(f&quot;üéØ {challenge}&quot;, self.styles[&#x27;NexusWarning&#x27;]))
+        if &quot;challenges&quot; in student_data:
+            story.append(Paragraph(&quot;üöÄ D√©fis √† relever&quot;, self.styles[&quot;NexusSection&quot;]))
+            for challenge in student_data[&quot;challenges&quot;]:
+                story.append(Paragraph(f&quot;üéØ {challenge}&quot;, self.styles[&quot;NexusWarning&quot;]))
             story.append(Spacer(1, 15))
 
         # Recommandations pour les parents
-        if &#x27;parent_recommendations&#x27; in student_data:
-            story.append(Paragraph(&quot;üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Recommandations pour les parents&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for recommendation in student_data[&#x27;parent_recommendations&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {recommendation}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;parent_recommendations&quot; in student_data:
+            story.append(
+                Paragraph(
+                    &quot;üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Recommandations pour les parents&quot;,
+                    self.styles[&quot;NexusSection&quot;],
+                )
+            )
+            for recommendation in student_data[&quot;parent_recommendations&quot;]:
+                story.append(
+                    Paragraph(f&quot;‚Ä¢ {recommendation}&quot;, self.styles[&quot;NexusNormal&quot;])
+                )
             story.append(Spacer(1, 15))
 
         # Prochaines √©tapes
-        if &#x27;next_steps&#x27; in student_data:
-            story.append(Paragraph(&quot;‚û°Ô∏è Prochaines √©tapes&quot;, self.styles[&#x27;NexusSection&#x27;]))
-            for step in student_data[&#x27;next_steps&#x27;]:
-                story.append(Paragraph(f&quot;‚Ä¢ {step}&quot;, self.styles[&#x27;NexusNormal&#x27;]))
+        if &quot;next_steps&quot; in student_data:
+            story.append(Paragraph(&quot;‚û°Ô∏è Prochaines √©tapes&quot;, self.styles[&quot;NexusSection&quot;]))
+            for step in student_data[&quot;next_steps&quot;]:
+                story.append(Paragraph(f&quot;‚Ä¢ {step}&quot;, self.styles[&quot;NexusNormal&quot;]))
 
         # Construction du PDF
         def add_page_decorations(canvas, doc):
             self._draw_header(canvas, doc, metadata)
             self._draw_footer(canvas, doc)
 
-        doc.build(story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations)
+        doc.build(
+            story, onFirstPage=add_page_decorations, onLaterPages=add_page_decorations
+        )
 
         if output_path:
             return output_path
         else:
             buffer.seek(0)
             return buffer.getvalue()
 
+
 # Instance globale du g√©n√©rateur PDF
 pdf_generator = NexusPDFGenerator()
 
+
 # Fonctions utilitaires
-def create_revision_sheet_pdf(content: Dict, student_name: str, subject: str, topic: str) -&gt; bytes:
+def create_revision_sheet_pdf(
+    content: Dict, student_name: str, subject: str, topic: str
+) -&gt; bytes:
     &quot;&quot;&quot;Cr√©e une fiche de r√©vision PDF&quot;&quot;&quot;
     metadata = DocumentMetadata(
         title=f&quot;Fiche de r√©vision - {topic}&quot;,
         subject=subject,
         student_name=student_name,
         student_level=&quot;Terminale&quot;,
         document_type=&quot;Fiche de r√©vision&quot;,
-        topic=topic
+        topic=topic,
     )
 
     return pdf_generator.generate_revision_sheet(content, metadata)
 
-def create_exercise_sheet_pdf(content: Dict, student_name: str, subject: str, topic: str) -&gt; bytes:
+
+def create_exercise_sheet_pdf(
+    content: Dict, student_name: str, subject: str, topic: str
+) -&gt; bytes:
     &quot;&quot;&quot;Cr√©e une feuille d&#x27;exercices PDF&quot;&quot;&quot;
     metadata = DocumentMetadata(
         title=f&quot;Exercices - {topic}&quot;,
         subject=subject,
         student_name=student_name,
         student_level=&quot;Terminale&quot;,
         document_type=&quot;Feuille d&#x27;exercices&quot;,
-        topic=topic
+        topic=topic,
     )
 
     return pdf_generator.generate_exercise_sheet(content, metadata)
 
-def create_evaluation_report_pdf(content: Dict, student_name: str, subject: str) -&gt; bytes:
+
+def create_evaluation_report_pdf(
+    content: Dict, student_name: str, subject: str
+) -&gt; bytes:
     &quot;&quot;&quot;Cr√©e un rapport d&#x27;√©valuation PDF&quot;&quot;&quot;
     metadata = DocumentMetadata(
         title=&quot;Rapport d&#x27;√©valuation&quot;,
         subject=subject,
         student_name=student_name,
         student_level=&quot;Terminale&quot;,
-        document_type=&quot;Rapport d&#x27;√©valuation&quot;
+        document_type=&quot;Rapport d&#x27;√©valuation&quot;,
     )
 
     return pdf_generator.generate_evaluation_report(content, metadata)
+
 
 def create_progress_report_pdf(student_data: Dict, student_name: str) -&gt; bytes:
     &quot;&quot;&quot;Cr√©e un rapport de progression PDF&quot;&quot;&quot;
     metadata = DocumentMetadata(
         title=&quot;Rapport de progression&quot;,
         subject=&quot;Toutes mati√®res&quot;,
         student_name=student_name,
         student_level=&quot;Terminale&quot;,
-        document_type=&quot;Rapport de progression&quot;
+        document_type=&quot;Rapport de progression&quot;,
     )
 
     return pdf_generator.generate_progress_report(student_data, metadata)
-
</pre>
            </div>
        </div>
        
        <div class="section">
            <h2>üì• Standard Error</h2>
            <div class="code-block">
                <pre>would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/__init__.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/__init__.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/__init__.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/config.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/user.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/__init__.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/content_system.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/aria.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/main_production.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/aria_ai_simple.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database/init_db_improved.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/student.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/database/init_db.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/content_bank.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/websocket_routes.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/video_conference_routes.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/formulas.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/user.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/document_database.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/students.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/openai_routes.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/routes/documents.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/content_engine.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/models/formulas.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/aria_ai.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/parent_dashboard.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/websocket_service.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/video_conference.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/openai_integration.py
would reformat /home/alaeddine/Documents/NSI_cours_accompagnement/nexus-reussite/backend/src/services/pdf_generator.py

Oh no! üí• üíî üí•
31 files would be reformatted.
</pre>
            </div>
        </div>
        
    </div>
</body>
</html>
